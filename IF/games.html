<!DOCTYPE html>
<html>
<head>
  <title>Phillip J Rhoades - Getting To Work And Other Bullshit â€” Play</title>
  <meta http-equiv="Content-Type" content="text/html;charset=utf-8">
  <meta name="viewport" content="width=device-width, user-scalable=no">
  <meta name="author" content="Phillip J Rhoades">


<style>

body
{
	font-family: Georgia, Palatino, "Times New Roman", Times, serif;
	font-size: 100%;
	-webkit-text-size-adjust: none;
	margin: 0px;
	top: 0px;
	bottom: 0px;
	width: 100%;
	background: #000000;
	color: white;
}

/* Used in index.html and source.html. */
#pageheader {
	width: 100%;
	top: 0px;
	height: 20px; /* header height */
	margin: 0px;
	background: #A9A9A9; /* this color fills the header, all the way across */
}

/* Used in play.html. */
#header {
	position: absolute;
	width: 100%;
	top: 0px;
	height: 20px; /* header height */
	margin: 0px;
	background: #A9A9A9; /* this color fills the header, all the way across */
}

/* Used in all pages -- defines the width. */
#subheader {
	position: relative;
	width: 700px; /* column width */
	height: 100%;
	margin: auto;
	/* a background color here will fill the header at a width of 600px */
}

/* Used in index.html and source.html. */
#pagefooter {
	width: 100%;
	height: 20px; /* footer height */
	margin: 0px;
	margin-top: 2em;
	background: #A9A9A9; /* this color fills the footer, all the way across */
}

/* Used in play.html. */
#footer {
	position: absolute;
	width: 100%;
	bottom: 0px;
	height: 20px; /* footer height */
	margin: 0px;
	background: #A9A9A9; /* this color fills the footer, all the way across */
}

/* Used in all pages -- defines the width. */
#subfooter {
	position: relative;
	width: 700px; /* column width */
	height: 100%;
	margin: auto;
	/* a background color here will fill the footer at a width of 600px */
}

/* 
This class is used for the sample header and footer text. You can replace it
with your own CSS classes. 
*/
.framelabel {
	padding-top: 1em;
	font-size: 14px;
	font-style: italic;
}


/* Used in index.html and source.html. */
#pagecolumn {
	width: 100%;
	top: 20px; /* header height */
	margin: 0px;
}

/* Used in play.html. */
#column {
	position: absolute;
	width: 100%;
	top: 20px; /* header height */
	bottom: 20px; /* footer height */
	margin: 0px;
}

/* Used in all pages -- defines the width. */
#subcolumn {
	position: relative;
	width: 700px; /* column width */
	height: 100%;
	margin: auto;
}


.container
{

}

/* 
Paragraph features defined here apply without distinction to blurb and
source paragraphs. 
*/

p
{
	font-size: 1em;
	line-height: 1.4;
}

/* 
Here we get rid of underlining for links, and provide a more subdued 
color scheme than the bright-blue HTML standard. 

Best color schemes are likely to vary depending on cover art.
*/

a
{
	text-decoration: none;
	color: #369;
}

a:visited
{
	text-decoration: none;
	color: #006;
}

a:hover
{
	text-decoration: none;
	color: #33C;
}

.coverimage
{
	margin-top: 0em;
	margin-right: 1em;
	text-align: left;
	float: left;
	clear: right;
} 

/* 
Here we make invisible the one-pixel border that currently goes around
the cover image. 
*/

.coverimage a
{
	font-style: normal;
	font-variant: normal;
	font-weight: normal;
	color: #FFF;
}

/* 
The introduction formatting applies to the title, author name, and release
number, here presented at the top of the page. 

To change the appearance of specific elements, tweak

	h1 for the title
	h2 for the author name
	.bibliography for the release information

*/

.introduction
{ 
	padding-top: 2.4em;
	margin-left: 1em;
	line-height: 1;
	text-align: left;
}

/* 
These set the sizes for the title (h1) and the author name (h2). 

The ideal font-size for h1 may vary quite a bit depending on how long the 
game's title is: larger for one-word titles, smaller for longer titles.

Should we wish to remove the title entirely and allow the cover art alone
to represent the game, we need only add the line "display: none;" to the
definition of h1.

*/
h1 { font-size: 2em; }
h2 { font-size: 1em; line-height: .25;}

/* The about formatting applies to blurb information. */

.about
{
	margin: 1em;
    border-top-style: solid;
	text-align: left;
	clear: both;
	overflow: auto;
}

/* 
By setting about p and about p + p, we instruct the first paragraph of the
blurb to be unindented but subsequent paragraphs to be indented a small 
distance. 
*/

.about p { margin-bottom: 0; }

.about p + p
{
	text-indent: 0em;
	margin-top: 0;
}

/* 
Playinfo affects the paragraph at the bottom of the home-page that supplies
the IFID for the game and suggests interpreters for the author to use. */

.playinfo
{
	margin: 1em 0px 0px 1em;
}

.playinfo p {
	font-size: .75em;
}


/* 
The links formatting applies to the story file and auxiliary links found
on the home page, and to the Contents, Next, and Previous links on the 
source pages. Here we arrange for them to appear in a column at the left
side of the page. 
*/

.links
{
	font-size: 0.8em;
}

.links li
{
	list-style-type: none;
	list-style-position: default;
	padding: .4 em;
}

/* 
The filetype id applies only to the little (blorb), (pdf), and similar
denotations found on the links. Here we make these appear smaller than the 
surrounding text. In order to get rid of them entirely, we would add 
"display: none;" to our filetype definition. 
*/ 

span.filetype { font-size: .75em; }

/* 
Source formatting applies to the source text on generated pages. 
*/

.source
{
	margin-top: 1.4em;
	margin-left: 1em;
	line-height: 1.4;
}

.sourceintroduction
{
	margin-left: 1em;
}

.sourceintroduction h1
{
	padding-top: 2.8em;
	font-size: 1em;
	line-height: 1;
	text-align: right;
	text-decoration: none;
	font-weight: normal;
	font-style: italic;
}

.sourceintroduction h2
{
	display: none;
}

.sourcecoverimage
{
	margin-top: 1em;
	margin-left: 1em;
	text-align: right;
	float: right;
} 

/* 
Here we make invisible the one-pixel border that currently goes around
the cover image. 
*/

.sourcecoverimage a
{
	font-style: normal;
	font-variant: normal;
	font-weight: normal;
	color: #FFF;
}

.sourcebibliography
{
	display: none;
}

span.quote { color: #369; }

span.comment {
	color: #390;}

span.substitution
{
	color: #69B;
	font-variant: small-caps;
}
	
span.i6code { color: #666; font-family: monospace; }

span.columnhead { 
	font-style: italic; 
	font-size: 1em;
}

span.heading
{
	font-weight: bold;
} 

.source td
{
	padding-top: .7em;
	padding-bottom: .7em;
	padding-right: 1.4em;
	font-size: .75em;
	text-align: left;
	vertical-align: top;
} 

/*
We could alter the following in order to make the footnote links in the source
text appear different from other links, but otherwise they will be the same
color as other links -- which is fine as a default.
*/

span.notecue
{
	font-size: .75em;
	vertical-align: super;
}

/* 
Here we tell the elements of the table of contents not to be listed with
bullets because this tends to produce considerable visual clutter especially
with large project files. 
*/

.source li
{
	list-style-type: none;
	list-style-position: default;
}

/* 
Notes applies to footnotes on the source text. 
*/

.notes
{
	margin-left: 16.8em;
}

.notes p
{
	text-indent: -1.4em;
	font-size: .75em;
}

.notesheading { font-style: italic; }

p.indent0 
{	margin-bottom: 0;
}

p.indent1 
{
	padding-left: 2.8em;
	text-indent: -.7em;
	margin-bottom: 0;
	margin-top: 0;
}

p.indent2 
{	margin-bottom: 0; 
	padding-left: 5.6em;
	text-indent: -.7em;
	margin-top: 0;
}

p.indent3 
{
	padding-left: 8.4em;
	text-indent: -.7em;
	margin-bottom: 0;
	margin-top: 0;
}

p.indent4
{	margin-bottom: 0; 
	padding-left: 11.2em;
	text-indent: -.7em;
	margin-top: 0;
}

p.indent5
{
	padding-left: 14em;
	text-indent: -.7em;
	margin-bottom: 0;
	margin-top: 0;
}

p.indent6
{	margin-bottom: 0; 
	padding-left: 16.8em;
	text-indent: -.7em;
	margin-top: 0;
}

p.indent7
{
	padding-left: 19.6em;
	text-indent: -.7em;
	margin-bottom: 0;
	margin-top: 0;
}


p.indent8
{	margin-bottom: 0; 
	padding-left: 22.4em;
	text-indent: -.7em;
	margin-top: 0;
}

p.indent9
{
	padding-left: 25.2em;
	text-indent: -.7em;
	margin-bottom: 0;
	margin-top: 0;
}

/*
Styles for play.html
*/
.play .coverimage
{
}
.play .links
{
}

.interpretercredit
{
	bottom: 1em;
	font-size: 80%;
	position: fixed;
}

#gameport
{
	background: black;
	bottom: 20px;
	left: 1em;
	line-height: 1.4;
	margin: 0px;
	position: absolute;
	right: 0px;
	top: 20px;
	border-style: solid;
	border-width: medium;
	border-color: lightgrey;
}

/*
Styles for mobile browsers: change to a one-column layout.
*/

@media screen and (max-device-width: 480px)
{
	.coverimage, .introduction, .about, .playinfo, .source, .sourceintroduction, .sourcecoverimage, .notes
	{
		float: none;
		margin-left: 1em;
		margin-right: 1em;
		text-align: left;
	}

	.play .coverimage, .play .interpretercredit
	{
		display: none;
	}
	
	#gameport
	{
		left: 0px;
		width: auto;
	}

	#subheader, #subfooter, #subcolumn
	{
		width: 320px;
	}

	.framelabel, .play .links
	{
		font-size: 12px;
		padding-left: 10px;
		padding-right: 10px;
	}
}


#windowport {
  width: 100%;
  height: 100%;
}

#errorpane {
  position: absolute;
  top: 0px;
  width: 100%;
  background: #FFA0A0;
  border-bottom: 3px solid #FF4040;
}

#errorpane.WarningPane {
  background: #B0B0FF;
  border-bottom: 3px solid #6060FF;
}

#errorpane:hover {
  background: rgba(255, 160, 160, 0.5);
  border-bottom: 3px solid rgba(255, 64, 64, 0.3);
}

#errorpane.WarningPane:hover {
  background: rgba(176, 176, 255, 0.5);
  border-bottom: 3px solid rgba(96, 96, 255, 0.3);
}

#errorcontent {
  font-size: 1.1em;
  padding: 1em;
  text-align: center;
}

#loadingpane {
  position: absolute;
  width: 100%;
  text-align: center;
  top: 20%;
}

.WindowFrame {
  /* This class provides the default background color of windows. You
     can change that, but don't touch the position or margin. */
  position: absolute;
  margin: 0px;
  background: black;
  color: #FFFFFF;
}

.BufferWindow {
  overflow: scroll;   /* vertical scrollbar is mandatory */
  overflow-x: hidden; /* but horizontal scrollbar is forbidden */
  font-family: Georgia, "Times New Roman", Times, serif;
  font-size: 15px;
  color: #FFFFFF;
  line-height: 1.4;
  padding: 6px 10px 6px 10px;
}

.BufferLine {
}

.GridWindow {
  background: #696969;
  color: #FFFFFF;
  overflow: hidden;
  font-family: monaco, andale mono, lucidatypewriter, courier, courier new, monospace; /* necessary! */
  font-size: 14px;
  padding: 6px 10px 6px 10px;
}

.GridLine {
  white-space: pre; /* required for spaces to work right */
}

.InvisibleCursor {
  /* This provides the padding below the last line of text (and the input
     prompt). Without this, they'd be flush against the bottom of the
     window, which would be ugly. Do not modify this CSS class. */
  position: relative;
  padding-bottom: 14px;
}

.MorePrompt {
  /* This describes the "More" prompt that flashes in the bottom right corner
     of a window when it needs paging. */
  font-weight: bold;
  position: absolute;
  background: #603010;
  color: #FFFFCC;
  opacity: 0.5;
  padding: 2px 6px;
  -webkit-border-radius: 4px;
  -moz-border-radius: 4px;
}

.PreviousMark {
  /* This describes the small horizontal mark that appears in a window
     when it needs paging. */
  position: absolute;
  background: #B09888;
  height: 2px;
  width: 12px;
  top: 0px;
  right: 0px;
}

.Input {
  /* This class mimicks the Style_input class. It also eliminates the 
     usual decoration of an <input> field, as much as possible. */
  border: none;
  margin: 0px;
  padding: 0px;
  outline-width: 0px;
  outline-style: none;
  background: none;
  color: #FFFFFF;
  font-weight: bold;
}

.BufferWindow .Input {
  font-family: Georgia, "Times New Roman", Times, serif;
  font-size: 15px;
  color: #FFFFFF;
}

.GridWindow .Input {
  font-family: monaco, andale mono, lucidatypewriter, courier, courier new, monospace; /* necessary! */
  font-size: 14px;
}

/* The following are used for image alignment (in buffer windows). */

.ImageMarginLeft {
  float: left;
  margin-right: 0.5em;
}

.ImageMarginRight {
  float: right;
  margin-left: 0.5em;
}

.ImageInlineDown {
  vertical-align: text-top;
}

.ImageInlineUp {
  vertical-align: text-bottom;
}

.ImageInlineCenter {
  vertical-align: middle;
}

.FlowBreak {
  clear: both;
}

.GraphicsWindow canvas {
  display: block;
  background-color: white;
}

/* The following are the standard Glk styles. */

.Style_normal {
}

.Style_emphasized {
  font-style: italic;
}

.Style_preformatted {
  font-family: monaco, andale mono, lucidatypewriter, courier, courier new, monospace;
}

.Style_header {
  font-weight: bold;
}

.BufferWindow .Style_header {
  font-size: 17px;
}

.Style_subheader {
  font-weight: bold;
}

.Style_alert {
  font-weight: bold;
}

.Style_note {
  font-style: italic;
}

.Style_blockquote {
  background: #FFF0C0;
}

.Style_input {
  font-weight: bold;
  color: #FFFFFF;
}

.Style_user1 {
}

.Style_user2 {
}

#dialog_screen {
  position: absolute;
  width: 100%;
  height: 100%;
  background: #000000;
  opacity: 0.5;
}

/* dialog_frame is an invisible pane that fills the root element. It exists
   so that the dialog can easily be centered in it.
*/
#dialog_frame {
  position: absolute;
  width: 100%;
  height: 100%;
}

/* dialog is the dialog div itself. It is displayed near the top of
   dialog_frame. The auto margins keep it horizontally centered.
*/
#dialog {
  position: relative;
  width: 400px;
  margin-left: auto;
  margin-right: auto;
  margin-top: 100px;
  background: black;
  border: 4px solid #AAA;
  -webkit-box-shadow: 1px 1px 15px #222;
  -moz-box-shadow: 1px 1px 15px #222;
  -webkit-border-radius: 10px;
  -moz-border-radius: 10px;
}

#dialog .DiaCaption {
  margin: 16px;
}

#dialog .DiaInput {
  margin: 16px;
}

#dialog input {
  width: 100%;
}

#dialog .DiaBody {
  margin: 16px;
  clear: both;
}

#dialog select {
  width: 100%;
}

#dialog button {
  margin-left: 8px;
}

#dialog .DiaButtons {
  margin: 16px;
  text-align: right;
}

#dialog .DiaButtonsFloat {
  margin-left: 16px;
  margin-right: 16px;
  float: right;
}

#dialog .DiaDisplayText {
  height: 200px;
  padding: 4px 8px;
  overflow: scroll;   /* vertical scrollbar is mandatory */
  overflow-x: hidden; /* but horizontal scrollbar is forbidden */
  font-size: 14px;
  white-space: pre-wrap;
  background: #FED;
}

/* End of Dialog default stylesheet. */

</style>

<script type="text/javascript">
/*! jQuery v1.12.4 | (c) jQuery Foundation | jquery.org/license */
!function(a,b){"object"==typeof module&&"object"==typeof module.exports?module.exports=a.document?b(a,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return b(a)}:b(a)}("undefined"!=typeof window?window:this,function(a,b){var c=[],d=a.document,e=c.slice,f=c.concat,g=c.push,h=c.indexOf,i={},j=i.toString,k=i.hasOwnProperty,l={},m="1.12.4",n=function(a,b){return new n.fn.init(a,b)},o=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,p=/^-ms-/,q=/-([\da-z])/gi,r=function(a,b){return b.toUpperCase()};n.fn=n.prototype={jquery:m,constructor:n,selector:"",length:0,toArray:function(){return e.call(this)},get:function(a){return null!=a?0>a?this[a+this.length]:this[a]:e.call(this)},pushStack:function(a){var b=n.merge(this.constructor(),a);return b.prevObject=this,b.context=this.context,b},each:function(a){return n.each(this,a)},map:function(a){return this.pushStack(n.map(this,function(b,c){return a.call(b,c,b)}))},slice:function(){return this.pushStack(e.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(a){var b=this.length,c=+a+(0>a?b:0);return this.pushStack(c>=0&&b>c?[this[c]]:[])},end:function(){return this.prevObject||this.constructor()},push:g,sort:c.sort,splice:c.splice},n.extend=n.fn.extend=function(){var a,b,c,d,e,f,g=arguments[0]||{},h=1,i=arguments.length,j=!1;for("boolean"==typeof g&&(j=g,g=arguments[h]||{},h++),"object"==typeof g||n.isFunction(g)||(g={}),h===i&&(g=this,h--);i>h;h++)if(null!=(e=arguments[h]))for(d in e)a=g[d],c=e[d],g!==c&&(j&&c&&(n.isPlainObject(c)||(b=n.isArray(c)))?(b?(b=!1,f=a&&n.isArray(a)?a:[]):f=a&&n.isPlainObject(a)?a:{},g[d]=n.extend(j,f,c)):void 0!==c&&(g[d]=c));return g},n.extend({expando:"jQuery"+(m+Math.random()).replace(/\D/g,""),isReady:!0,error:function(a){throw new Error(a)},noop:function(){},isFunction:function(a){return"function"===n.type(a)},isArray:Array.isArray||function(a){return"array"===n.type(a)},isWindow:function(a){return null!=a&&a==a.window},isNumeric:function(a){var b=a&&a.toString();return!n.isArray(a)&&b-parseFloat(b)+1>=0},isEmptyObject:function(a){var b;for(b in a)return!1;return!0},isPlainObject:function(a){var b;if(!a||"object"!==n.type(a)||a.nodeType||n.isWindow(a))return!1;try{if(a.constructor&&!k.call(a,"constructor")&&!k.call(a.constructor.prototype,"isPrototypeOf"))return!1}catch(c){return!1}if(!l.ownFirst)for(b in a)return k.call(a,b);for(b in a);return void 0===b||k.call(a,b)},type:function(a){return null==a?a+"":"object"==typeof a||"function"==typeof a?i[j.call(a)]||"object":typeof a},globalEval:function(b){b&&n.trim(b)&&(a.execScript||function(b){a.eval.call(a,b)})(b)},camelCase:function(a){return a.replace(p,"ms-").replace(q,r)},nodeName:function(a,b){return a.nodeName&&a.nodeName.toLowerCase()===b.toLowerCase()},each:function(a,b){var c,d=0;if(s(a)){for(c=a.length;c>d;d++)if(b.call(a[d],d,a[d])===!1)break}else for(d in a)if(b.call(a[d],d,a[d])===!1)break;return a},trim:function(a){return null==a?"":(a+"").replace(o,"")},makeArray:function(a,b){var c=b||[];return null!=a&&(s(Object(a))?n.merge(c,"string"==typeof a?[a]:a):g.call(c,a)),c},inArray:function(a,b,c){var d;if(b){if(h)return h.call(b,a,c);for(d=b.length,c=c?0>c?Math.max(0,d+c):c:0;d>c;c++)if(c in b&&b[c]===a)return c}return-1},merge:function(a,b){var c=+b.length,d=0,e=a.length;while(c>d)a[e++]=b[d++];if(c!==c)while(void 0!==b[d])a[e++]=b[d++];return a.length=e,a},grep:function(a,b,c){for(var d,e=[],f=0,g=a.length,h=!c;g>f;f++)d=!b(a[f],f),d!==h&&e.push(a[f]);return e},map:function(a,b,c){var d,e,g=0,h=[];if(s(a))for(d=a.length;d>g;g++)e=b(a[g],g,c),null!=e&&h.push(e);else for(g in a)e=b(a[g],g,c),null!=e&&h.push(e);return f.apply([],h)},guid:1,proxy:function(a,b){var c,d,f;return"string"==typeof b&&(f=a[b],b=a,a=f),n.isFunction(a)?(c=e.call(arguments,2),d=function(){return a.apply(b||this,c.concat(e.call(arguments)))},d.guid=a.guid=a.guid||n.guid++,d):void 0},now:function(){return+new Date},support:l}),"function"==typeof Symbol&&(n.fn[Symbol.iterator]=c[Symbol.iterator]),n.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(a,b){i["[object "+b+"]"]=b.toLowerCase()});function s(a){var b=!!a&&"length"in a&&a.length,c=n.type(a);return"function"===c||n.isWindow(a)?!1:"array"===c||0===b||"number"==typeof b&&b>0&&b-1 in a}var t=function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u="sizzle"+1*new Date,v=a.document,w=0,x=0,y=ga(),z=ga(),A=ga(),B=function(a,b){return a===b&&(l=!0),0},C=1<<31,D={}.hasOwnProperty,E=[],F=E.pop,G=E.push,H=E.push,I=E.slice,J=function(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},K="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",L="[\\x20\\t\\r\\n\\f]",M="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",N="\\["+L+"*("+M+")(?:"+L+"*([*^$|!~]?=)"+L+"*(?:'((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\"|("+M+"))|)"+L+"*\\]",O=":("+M+")(?:\\((('((?:\\\\.|[^\\\\'])*)'|\"((?:\\\\.|[^\\\\\"])*)\")|((?:\\\\.|[^\\\\()[\\]]|"+N+")*)|.*)\\)|)",P=new RegExp(L+"+","g"),Q=new RegExp("^"+L+"+|((?:^|[^\\\\])(?:\\\\.)*)"+L+"+$","g"),R=new RegExp("^"+L+"*,"+L+"*"),S=new RegExp("^"+L+"*([>+~]|"+L+")"+L+"*"),T=new RegExp("="+L+"*([^\\]'\"]*?)"+L+"*\\]","g"),U=new RegExp(O),V=new RegExp("^"+M+"$"),W={ID:new RegExp("^#("+M+")"),CLASS:new RegExp("^\\.("+M+")"),TAG:new RegExp("^("+M+"|[*])"),ATTR:new RegExp("^"+N),PSEUDO:new RegExp("^"+O),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+L+"*(even|odd|(([+-]|)(\\d*)n|)"+L+"*(?:([+-]|)"+L+"*(\\d+)|))"+L+"*\\)|)","i"),bool:new RegExp("^(?:"+K+")$","i"),needsContext:new RegExp("^"+L+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+L+"*((?:-\\d)?\\d*)"+L+"*\\)|)(?=[^-]|$)","i")},X=/^(?:input|select|textarea|button)$/i,Y=/^h\d$/i,Z=/^[^{]+\{\s*\[native \w/,$=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,_=/[+~]/,aa=/'|\\/g,ba=new RegExp("\\\\([\\da-f]{1,6}"+L+"?|("+L+")|.)","ig"),ca=function(a,b,c){var d="0x"+b-65536;return d!==d||c?b:0>d?String.fromCharCode(d+65536):String.fromCharCode(d>>10|55296,1023&d|56320)},da=function(){m()};try{H.apply(E=I.call(v.childNodes),v.childNodes),E[v.childNodes.length].nodeType}catch(ea){H={apply:E.length?function(a,b){G.apply(a,I.call(b))}:function(a,b){var c=a.length,d=0;while(a[c++]=b[d++]);a.length=c-1}}}function fa(a,b,d,e){var f,h,j,k,l,o,r,s,w=b&&b.ownerDocument,x=b?b.nodeType:9;if(d=d||[],"string"!=typeof a||!a||1!==x&&9!==x&&11!==x)return d;if(!e&&((b?b.ownerDocument||b:v)!==n&&m(b),b=b||n,p)){if(11!==x&&(o=$.exec(a)))if(f=o[1]){if(9===x){if(!(j=b.getElementById(f)))return d;if(j.id===f)return d.push(j),d}else if(w&&(j=w.getElementById(f))&&t(b,j)&&j.id===f)return d.push(j),d}else{if(o[2])return H.apply(d,b.getElementsByTagName(a)),d;if((f=o[3])&&c.getElementsByClassName&&b.getElementsByClassName)return H.apply(d,b.getElementsByClassName(f)),d}if(c.qsa&&!A[a+" "]&&(!q||!q.test(a))){if(1!==x)w=b,s=a;else if("object"!==b.nodeName.toLowerCase()){(k=b.getAttribute("id"))?k=k.replace(aa,"\\$&"):b.setAttribute("id",k=u),r=g(a),h=r.length,l=V.test(k)?"#"+k:"[id='"+k+"']";while(h--)r[h]=l+" "+qa(r[h]);s=r.join(","),w=_.test(a)&&oa(b.parentNode)||b}if(s)try{return H.apply(d,w.querySelectorAll(s)),d}catch(y){}finally{k===u&&b.removeAttribute("id")}}}return i(a.replace(Q,"$1"),b,d,e)}function ga(){var a=[];function b(c,e){return a.push(c+" ")>d.cacheLength&&delete b[a.shift()],b[c+" "]=e}return b}function ha(a){return a[u]=!0,a}function ia(a){var b=n.createElement("div");try{return!!a(b)}catch(c){return!1}finally{b.parentNode&&b.parentNode.removeChild(b),b=null}}function ja(a,b){var c=a.split("|"),e=c.length;while(e--)d.attrHandle[c[e]]=b}function ka(a,b){var c=b&&a,d=c&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||C)-(~a.sourceIndex||C);if(d)return d;if(c)while(c=c.nextSibling)if(c===b)return-1;return a?1:-1}function la(a){return function(b){var c=b.nodeName.toLowerCase();return"input"===c&&b.type===a}}function ma(a){return function(b){var c=b.nodeName.toLowerCase();return("input"===c||"button"===c)&&b.type===a}}function na(a){return ha(function(b){return b=+b,ha(function(c,d){var e,f=a([],c.length,b),g=f.length;while(g--)c[e=f[g]]&&(c[e]=!(d[e]=c[e]))})})}function oa(a){return a&&"undefined"!=typeof a.getElementsByTagName&&a}c=fa.support={},f=fa.isXML=function(a){var b=a&&(a.ownerDocument||a).documentElement;return b?"HTML"!==b.nodeName:!1},m=fa.setDocument=function(a){var b,e,g=a?a.ownerDocument||a:v;return g!==n&&9===g.nodeType&&g.documentElement?(n=g,o=n.documentElement,p=!f(n),(e=n.defaultView)&&e.top!==e&&(e.addEventListener?e.addEventListener("unload",da,!1):e.attachEvent&&e.attachEvent("onunload",da)),c.attributes=ia(function(a){return a.className="i",!a.getAttribute("className")}),c.getElementsByTagName=ia(function(a){return a.appendChild(n.createComment("")),!a.getElementsByTagName("*").length}),c.getElementsByClassName=Z.test(n.getElementsByClassName),c.getById=ia(function(a){return o.appendChild(a).id=u,!n.getElementsByName||!n.getElementsByName(u).length}),c.getById?(d.find.ID=function(a,b){if("undefined"!=typeof b.getElementById&&p){var c=b.getElementById(a);return c?[c]:[]}},d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){return a.getAttribute("id")===b}}):(delete d.find.ID,d.filter.ID=function(a){var b=a.replace(ba,ca);return function(a){var c="undefined"!=typeof a.getAttributeNode&&a.getAttributeNode("id");return c&&c.value===b}}),d.find.TAG=c.getElementsByTagName?function(a,b){return"undefined"!=typeof b.getElementsByTagName?b.getElementsByTagName(a):c.qsa?b.querySelectorAll(a):void 0}:function(a,b){var c,d=[],e=0,f=b.getElementsByTagName(a);if("*"===a){while(c=f[e++])1===c.nodeType&&d.push(c);return d}return f},d.find.CLASS=c.getElementsByClassName&&function(a,b){return"undefined"!=typeof b.getElementsByClassName&&p?b.getElementsByClassName(a):void 0},r=[],q=[],(c.qsa=Z.test(n.querySelectorAll))&&(ia(function(a){o.appendChild(a).innerHTML="<a id='"+u+"'></a><select id='"+u+"-\r\\' msallowcapture=''><option selected=''></option></select>",a.querySelectorAll("[msallowcapture^='']").length&&q.push("[*^$]="+L+"*(?:''|\"\")"),a.querySelectorAll("[selected]").length||q.push("\\["+L+"*(?:value|"+K+")"),a.querySelectorAll("[id~="+u+"-]").length||q.push("~="),a.querySelectorAll(":checked").length||q.push(":checked"),a.querySelectorAll("a#"+u+"+*").length||q.push(".#.+[+~]")}),ia(function(a){var b=n.createElement("input");b.setAttribute("type","hidden"),a.appendChild(b).setAttribute("name","D"),a.querySelectorAll("[name=d]").length&&q.push("name"+L+"*[*^$|!~]?="),a.querySelectorAll(":enabled").length||q.push(":enabled",":disabled"),a.querySelectorAll("*,:x"),q.push(",.*:")})),(c.matchesSelector=Z.test(s=o.matches||o.webkitMatchesSelector||o.mozMatchesSelector||o.oMatchesSelector||o.msMatchesSelector))&&ia(function(a){c.disconnectedMatch=s.call(a,"div"),s.call(a,"[s!='']:x"),r.push("!=",O)}),q=q.length&&new RegExp(q.join("|")),r=r.length&&new RegExp(r.join("|")),b=Z.test(o.compareDocumentPosition),t=b||Z.test(o.contains)?function(a,b){var c=9===a.nodeType?a.documentElement:a,d=b&&b.parentNode;return a===d||!(!d||1!==d.nodeType||!(c.contains?c.contains(d):a.compareDocumentPosition&&16&a.compareDocumentPosition(d)))}:function(a,b){if(b)while(b=b.parentNode)if(b===a)return!0;return!1},B=b?function(a,b){if(a===b)return l=!0,0;var d=!a.compareDocumentPosition-!b.compareDocumentPosition;return d?d:(d=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1,1&d||!c.sortDetached&&b.compareDocumentPosition(a)===d?a===n||a.ownerDocument===v&&t(v,a)?-1:b===n||b.ownerDocument===v&&t(v,b)?1:k?J(k,a)-J(k,b):0:4&d?-1:1)}:function(a,b){if(a===b)return l=!0,0;var c,d=0,e=a.parentNode,f=b.parentNode,g=[a],h=[b];if(!e||!f)return a===n?-1:b===n?1:e?-1:f?1:k?J(k,a)-J(k,b):0;if(e===f)return ka(a,b);c=a;while(c=c.parentNode)g.unshift(c);c=b;while(c=c.parentNode)h.unshift(c);while(g[d]===h[d])d++;return d?ka(g[d],h[d]):g[d]===v?-1:h[d]===v?1:0},n):n},fa.matches=function(a,b){return fa(a,null,null,b)},fa.matchesSelector=function(a,b){if((a.ownerDocument||a)!==n&&m(a),b=b.replace(T,"='$1']"),c.matchesSelector&&p&&!A[b+" "]&&(!r||!r.test(b))&&(!q||!q.test(b)))try{var d=s.call(a,b);if(d||c.disconnectedMatch||a.document&&11!==a.document.nodeType)return d}catch(e){}return fa(b,n,null,[a]).length>0},fa.contains=function(a,b){return(a.ownerDocument||a)!==n&&m(a),t(a,b)},fa.attr=function(a,b){(a.ownerDocument||a)!==n&&m(a);var e=d.attrHandle[b.toLowerCase()],f=e&&D.call(d.attrHandle,b.toLowerCase())?e(a,b,!p):void 0;return void 0!==f?f:c.attributes||!p?a.getAttribute(b):(f=a.getAttributeNode(b))&&f.specified?f.value:null},fa.error=function(a){throw new Error("Syntax error, unrecognized expression: "+a)},fa.uniqueSort=function(a){var b,d=[],e=0,f=0;if(l=!c.detectDuplicates,k=!c.sortStable&&a.slice(0),a.sort(B),l){while(b=a[f++])b===a[f]&&(e=d.push(f));while(e--)a.splice(d[e],1)}return k=null,a},e=fa.getText=function(a){var b,c="",d=0,f=a.nodeType;if(f){if(1===f||9===f||11===f){if("string"==typeof a.textContent)return a.textContent;for(a=a.firstChild;a;a=a.nextSibling)c+=e(a)}else if(3===f||4===f)return a.nodeValue}else while(b=a[d++])c+=e(b);return c},d=fa.selectors={cacheLength:50,createPseudo:ha,match:W,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(a){return a[1]=a[1].replace(ba,ca),a[3]=(a[3]||a[4]||a[5]||"").replace(ba,ca),"~="===a[2]&&(a[3]=" "+a[3]+" "),a.slice(0,4)},CHILD:function(a){return a[1]=a[1].toLowerCase(),"nth"===a[1].slice(0,3)?(a[3]||fa.error(a[0]),a[4]=+(a[4]?a[5]+(a[6]||1):2*("even"===a[3]||"odd"===a[3])),a[5]=+(a[7]+a[8]||"odd"===a[3])):a[3]&&fa.error(a[0]),a},PSEUDO:function(a){var b,c=!a[6]&&a[2];return W.CHILD.test(a[0])?null:(a[3]?a[2]=a[4]||a[5]||"":c&&U.test(c)&&(b=g(c,!0))&&(b=c.indexOf(")",c.length-b)-c.length)&&(a[0]=a[0].slice(0,b),a[2]=c.slice(0,b)),a.slice(0,3))}},filter:{TAG:function(a){var b=a.replace(ba,ca).toLowerCase();return"*"===a?function(){return!0}:function(a){return a.nodeName&&a.nodeName.toLowerCase()===b}},CLASS:function(a){var b=y[a+" "];return b||(b=new RegExp("(^|"+L+")"+a+"("+L+"|$)"))&&y(a,function(a){return b.test("string"==typeof a.className&&a.className||"undefined"!=typeof a.getAttribute&&a.getAttribute("class")||"")})},ATTR:function(a,b,c){return function(d){var e=fa.attr(d,a);return null==e?"!="===b:b?(e+="","="===b?e===c:"!="===b?e!==c:"^="===b?c&&0===e.indexOf(c):"*="===b?c&&e.indexOf(c)>-1:"$="===b?c&&e.slice(-c.length)===c:"~="===b?(" "+e.replace(P," ")+" ").indexOf(c)>-1:"|="===b?e===c||e.slice(0,c.length+1)===c+"-":!1):!0}},CHILD:function(a,b,c,d,e){var f="nth"!==a.slice(0,3),g="last"!==a.slice(-4),h="of-type"===b;return 1===d&&0===e?function(a){return!!a.parentNode}:function(b,c,i){var j,k,l,m,n,o,p=f!==g?"nextSibling":"previousSibling",q=b.parentNode,r=h&&b.nodeName.toLowerCase(),s=!i&&!h,t=!1;if(q){if(f){while(p){m=b;while(m=m[p])if(h?m.nodeName.toLowerCase()===r:1===m.nodeType)return!1;o=p="only"===a&&!o&&"nextSibling"}return!0}if(o=[g?q.firstChild:q.lastChild],g&&s){m=q,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n&&j[2],m=n&&q.childNodes[n];while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if(1===m.nodeType&&++t&&m===b){k[a]=[w,n,t];break}}else if(s&&(m=b,l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),j=k[a]||[],n=j[0]===w&&j[1],t=n),t===!1)while(m=++n&&m&&m[p]||(t=n=0)||o.pop())if((h?m.nodeName.toLowerCase()===r:1===m.nodeType)&&++t&&(s&&(l=m[u]||(m[u]={}),k=l[m.uniqueID]||(l[m.uniqueID]={}),k[a]=[w,t]),m===b))break;return t-=e,t===d||t%d===0&&t/d>=0}}},PSEUDO:function(a,b){var c,e=d.pseudos[a]||d.setFilters[a.toLowerCase()]||fa.error("unsupported pseudo: "+a);return e[u]?e(b):e.length>1?(c=[a,a,"",b],d.setFilters.hasOwnProperty(a.toLowerCase())?ha(function(a,c){var d,f=e(a,b),g=f.length;while(g--)d=J(a,f[g]),a[d]=!(c[d]=f[g])}):function(a){return e(a,0,c)}):e}},pseudos:{not:ha(function(a){var b=[],c=[],d=h(a.replace(Q,"$1"));return d[u]?ha(function(a,b,c,e){var f,g=d(a,null,e,[]),h=a.length;while(h--)(f=g[h])&&(a[h]=!(b[h]=f))}):function(a,e,f){return b[0]=a,d(b,null,f,c),b[0]=null,!c.pop()}}),has:ha(function(a){return function(b){return fa(a,b).length>0}}),contains:ha(function(a){return a=a.replace(ba,ca),function(b){return(b.textContent||b.innerText||e(b)).indexOf(a)>-1}}),lang:ha(function(a){return V.test(a||"")||fa.error("unsupported lang: "+a),a=a.replace(ba,ca).toLowerCase(),function(b){var c;do if(c=p?b.lang:b.getAttribute("xml:lang")||b.getAttribute("lang"))return c=c.toLowerCase(),c===a||0===c.indexOf(a+"-");while((b=b.parentNode)&&1===b.nodeType);return!1}}),target:function(b){var c=a.location&&a.location.hash;return c&&c.slice(1)===b.id},root:function(a){return a===o},focus:function(a){return a===n.activeElement&&(!n.hasFocus||n.hasFocus())&&!!(a.type||a.href||~a.tabIndex)},enabled:function(a){return a.disabled===!1},disabled:function(a){return a.disabled===!0},checked:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&!!a.checked||"option"===b&&!!a.selected},selected:function(a){return a.parentNode&&a.parentNode.selectedIndex,a.selected===!0},empty:function(a){for(a=a.firstChild;a;a=a.nextSibling)if(a.nodeType<6)return!1;return!0},parent:function(a){return!d.pseudos.empty(a)},header:function(a){return Y.test(a.nodeName)},input:function(a){return X.test(a.nodeName)},button:function(a){var b=a.nodeName.toLowerCase();return"input"===b&&"button"===a.type||"button"===b},text:function(a){var b;return"input"===a.nodeName.toLowerCase()&&"text"===a.type&&(null==(b=a.getAttribute("type"))||"text"===b.toLowerCase())},first:na(function(){return[0]}),last:na(function(a,b){return[b-1]}),eq:na(function(a,b,c){return[0>c?c+b:c]}),even:na(function(a,b){for(var c=0;b>c;c+=2)a.push(c);return a}),odd:na(function(a,b){for(var c=1;b>c;c+=2)a.push(c);return a}),lt:na(function(a,b,c){for(var d=0>c?c+b:c;--d>=0;)a.push(d);return a}),gt:na(function(a,b,c){for(var d=0>c?c+b:c;++d<b;)a.push(d);return a})}},d.pseudos.nth=d.pseudos.eq;for(b in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})d.pseudos[b]=la(b);for(b in{submit:!0,reset:!0})d.pseudos[b]=ma(b);function pa(){}pa.prototype=d.filters=d.pseudos,d.setFilters=new pa,g=fa.tokenize=function(a,b){var c,e,f,g,h,i,j,k=z[a+" "];if(k)return b?0:k.slice(0);h=a,i=[],j=d.preFilter;while(h){c&&!(e=R.exec(h))||(e&&(h=h.slice(e[0].length)||h),i.push(f=[])),c=!1,(e=S.exec(h))&&(c=e.shift(),f.push({value:c,type:e[0].replace(Q," ")}),h=h.slice(c.length));for(g in d.filter)!(e=W[g].exec(h))||j[g]&&!(e=j[g](e))||(c=e.shift(),f.push({value:c,type:g,matches:e}),h=h.slice(c.length));if(!c)break}return b?h.length:h?fa.error(a):z(a,i).slice(0)};function qa(a){for(var b=0,c=a.length,d="";c>b;b++)d+=a[b].value;return d}function ra(a,b,c){var d=b.dir,e=c&&"parentNode"===d,f=x++;return b.first?function(b,c,f){while(b=b[d])if(1===b.nodeType||e)return a(b,c,f)}:function(b,c,g){var h,i,j,k=[w,f];if(g){while(b=b[d])if((1===b.nodeType||e)&&a(b,c,g))return!0}else while(b=b[d])if(1===b.nodeType||e){if(j=b[u]||(b[u]={}),i=j[b.uniqueID]||(j[b.uniqueID]={}),(h=i[d])&&h[0]===w&&h[1]===f)return k[2]=h[2];if(i[d]=k,k[2]=a(b,c,g))return!0}}}function sa(a){return a.length>1?function(b,c,d){var e=a.length;while(e--)if(!a[e](b,c,d))return!1;return!0}:a[0]}function ta(a,b,c){for(var d=0,e=b.length;e>d;d++)fa(a,b[d],c);return c}function ua(a,b,c,d,e){for(var f,g=[],h=0,i=a.length,j=null!=b;i>h;h++)(f=a[h])&&(c&&!c(f,d,e)||(g.push(f),j&&b.push(h)));return g}function va(a,b,c,d,e,f){return d&&!d[u]&&(d=va(d)),e&&!e[u]&&(e=va(e,f)),ha(function(f,g,h,i){var j,k,l,m=[],n=[],o=g.length,p=f||ta(b||"*",h.nodeType?[h]:h,[]),q=!a||!f&&b?p:ua(p,m,a,h,i),r=c?e||(f?a:o||d)?[]:g:q;if(c&&c(q,r,h,i),d){j=ua(r,n),d(j,[],h,i),k=j.length;while(k--)(l=j[k])&&(r[n[k]]=!(q[n[k]]=l))}if(f){if(e||a){if(e){j=[],k=r.length;while(k--)(l=r[k])&&j.push(q[k]=l);e(null,r=[],j,i)}k=r.length;while(k--)(l=r[k])&&(j=e?J(f,l):m[k])>-1&&(f[j]=!(g[j]=l))}}else r=ua(r===g?r.splice(o,r.length):r),e?e(null,g,r,i):H.apply(g,r)})}function wa(a){for(var b,c,e,f=a.length,g=d.relative[a[0].type],h=g||d.relative[" "],i=g?1:0,k=ra(function(a){return a===b},h,!0),l=ra(function(a){return J(b,a)>-1},h,!0),m=[function(a,c,d){var e=!g&&(d||c!==j)||((b=c).nodeType?k(a,c,d):l(a,c,d));return b=null,e}];f>i;i++)if(c=d.relative[a[i].type])m=[ra(sa(m),c)];else{if(c=d.filter[a[i].type].apply(null,a[i].matches),c[u]){for(e=++i;f>e;e++)if(d.relative[a[e].type])break;return va(i>1&&sa(m),i>1&&qa(a.slice(0,i-1).concat({value:" "===a[i-2].type?"*":""})).replace(Q,"$1"),c,e>i&&wa(a.slice(i,e)),f>e&&wa(a=a.slice(e)),f>e&&qa(a))}m.push(c)}return sa(m)}function xa(a,b){var c=b.length>0,e=a.length>0,f=function(f,g,h,i,k){var l,o,q,r=0,s="0",t=f&&[],u=[],v=j,x=f||e&&d.find.TAG("*",k),y=w+=null==v?1:Math.random()||.1,z=x.length;for(k&&(j=g===n||g||k);s!==z&&null!=(l=x[s]);s++){if(e&&l){o=0,g||l.ownerDocument===n||(m(l),h=!p);while(q=a[o++])if(q(l,g||n,h)){i.push(l);break}k&&(w=y)}c&&((l=!q&&l)&&r--,f&&t.push(l))}if(r+=s,c&&s!==r){o=0;while(q=b[o++])q(t,u,g,h);if(f){if(r>0)while(s--)t[s]||u[s]||(u[s]=F.call(i));u=ua(u)}H.apply(i,u),k&&!f&&u.length>0&&r+b.length>1&&fa.uniqueSort(i)}return k&&(w=y,j=v),t};return c?ha(f):f}return h=fa.compile=function(a,b){var c,d=[],e=[],f=A[a+" "];if(!f){b||(b=g(a)),c=b.length;while(c--)f=wa(b[c]),f[u]?d.push(f):e.push(f);f=A(a,xa(e,d)),f.selector=a}return f},i=fa.select=function(a,b,e,f){var i,j,k,l,m,n="function"==typeof a&&a,o=!f&&g(a=n.selector||a);if(e=e||[],1===o.length){if(j=o[0]=o[0].slice(0),j.length>2&&"ID"===(k=j[0]).type&&c.getById&&9===b.nodeType&&p&&d.relative[j[1].type]){if(b=(d.find.ID(k.matches[0].replace(ba,ca),b)||[])[0],!b)return e;n&&(b=b.parentNode),a=a.slice(j.shift().value.length)}i=W.needsContext.test(a)?0:j.length;while(i--){if(k=j[i],d.relative[l=k.type])break;if((m=d.find[l])&&(f=m(k.matches[0].replace(ba,ca),_.test(j[0].type)&&oa(b.parentNode)||b))){if(j.splice(i,1),a=f.length&&qa(j),!a)return H.apply(e,f),e;break}}}return(n||h(a,o))(f,b,!p,e,!b||_.test(a)&&oa(b.parentNode)||b),e},c.sortStable=u.split("").sort(B).join("")===u,c.detectDuplicates=!!l,m(),c.sortDetached=ia(function(a){return 1&a.compareDocumentPosition(n.createElement("div"))}),ia(function(a){return a.innerHTML="<a href='#'></a>","#"===a.firstChild.getAttribute("href")})||ja("type|href|height|width",function(a,b,c){return c?void 0:a.getAttribute(b,"type"===b.toLowerCase()?1:2)}),c.attributes&&ia(function(a){return a.innerHTML="<input/>",a.firstChild.setAttribute("value",""),""===a.firstChild.getAttribute("value")})||ja("value",function(a,b,c){return c||"input"!==a.nodeName.toLowerCase()?void 0:a.defaultValue}),ia(function(a){return null==a.getAttribute("disabled")})||ja(K,function(a,b,c){var d;return c?void 0:a[b]===!0?b.toLowerCase():(d=a.getAttributeNode(b))&&d.specified?d.value:null}),fa}(a);n.find=t,n.expr=t.selectors,n.expr[":"]=n.expr.pseudos,n.uniqueSort=n.unique=t.uniqueSort,n.text=t.getText,n.isXMLDoc=t.isXML,n.contains=t.contains;var u=function(a,b,c){var d=[],e=void 0!==c;while((a=a[b])&&9!==a.nodeType)if(1===a.nodeType){if(e&&n(a).is(c))break;d.push(a)}return d},v=function(a,b){for(var c=[];a;a=a.nextSibling)1===a.nodeType&&a!==b&&c.push(a);return c},w=n.expr.match.needsContext,x=/^<([\w-]+)\s*\/?>(?:<\/\1>|)$/,y=/^.[^:#\[\.,]*$/;function z(a,b,c){if(n.isFunction(b))return n.grep(a,function(a,d){return!!b.call(a,d,a)!==c});if(b.nodeType)return n.grep(a,function(a){return a===b!==c});if("string"==typeof b){if(y.test(b))return n.filter(b,a,c);b=n.filter(b,a)}return n.grep(a,function(a){return n.inArray(a,b)>-1!==c})}n.filter=function(a,b,c){var d=b[0];return c&&(a=":not("+a+")"),1===b.length&&1===d.nodeType?n.find.matchesSelector(d,a)?[d]:[]:n.find.matches(a,n.grep(b,function(a){return 1===a.nodeType}))},n.fn.extend({find:function(a){var b,c=[],d=this,e=d.length;if("string"!=typeof a)return this.pushStack(n(a).filter(function(){for(b=0;e>b;b++)if(n.contains(d[b],this))return!0}));for(b=0;e>b;b++)n.find(a,d[b],c);return c=this.pushStack(e>1?n.unique(c):c),c.selector=this.selector?this.selector+" "+a:a,c},filter:function(a){return this.pushStack(z(this,a||[],!1))},not:function(a){return this.pushStack(z(this,a||[],!0))},is:function(a){return!!z(this,"string"==typeof a&&w.test(a)?n(a):a||[],!1).length}});var A,B=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,C=n.fn.init=function(a,b,c){var e,f;if(!a)return this;if(c=c||A,"string"==typeof a){if(e="<"===a.charAt(0)&&">"===a.charAt(a.length-1)&&a.length>=3?[null,a,null]:B.exec(a),!e||!e[1]&&b)return!b||b.jquery?(b||c).find(a):this.constructor(b).find(a);if(e[1]){if(b=b instanceof n?b[0]:b,n.merge(this,n.parseHTML(e[1],b&&b.nodeType?b.ownerDocument||b:d,!0)),x.test(e[1])&&n.isPlainObject(b))for(e in b)n.isFunction(this[e])?this[e](b[e]):this.attr(e,b[e]);return this}if(f=d.getElementById(e[2]),f&&f.parentNode){if(f.id!==e[2])return A.find(a);this.length=1,this[0]=f}return this.context=d,this.selector=a,this}return a.nodeType?(this.context=this[0]=a,this.length=1,this):n.isFunction(a)?"undefined"!=typeof c.ready?c.ready(a):a(n):(void 0!==a.selector&&(this.selector=a.selector,this.context=a.context),n.makeArray(a,this))};C.prototype=n.fn,A=n(d);var D=/^(?:parents|prev(?:Until|All))/,E={children:!0,contents:!0,next:!0,prev:!0};n.fn.extend({has:function(a){var b,c=n(a,this),d=c.length;return this.filter(function(){for(b=0;d>b;b++)if(n.contains(this,c[b]))return!0})},closest:function(a,b){for(var c,d=0,e=this.length,f=[],g=w.test(a)||"string"!=typeof a?n(a,b||this.context):0;e>d;d++)for(c=this[d];c&&c!==b;c=c.parentNode)if(c.nodeType<11&&(g?g.index(c)>-1:1===c.nodeType&&n.find.matchesSelector(c,a))){f.push(c);break}return this.pushStack(f.length>1?n.uniqueSort(f):f)},index:function(a){return a?"string"==typeof a?n.inArray(this[0],n(a)):n.inArray(a.jquery?a[0]:a,this):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(a,b){return this.pushStack(n.uniqueSort(n.merge(this.get(),n(a,b))))},addBack:function(a){return this.add(null==a?this.prevObject:this.prevObject.filter(a))}});function F(a,b){do a=a[b];while(a&&1!==a.nodeType);return a}n.each({parent:function(a){var b=a.parentNode;return b&&11!==b.nodeType?b:null},parents:function(a){return u(a,"parentNode")},parentsUntil:function(a,b,c){return u(a,"parentNode",c)},next:function(a){return F(a,"nextSibling")},prev:function(a){return F(a,"previousSibling")},nextAll:function(a){return u(a,"nextSibling")},prevAll:function(a){return u(a,"previousSibling")},nextUntil:function(a,b,c){return u(a,"nextSibling",c)},prevUntil:function(a,b,c){return u(a,"previousSibling",c)},siblings:function(a){return v((a.parentNode||{}).firstChild,a)},children:function(a){return v(a.firstChild)},contents:function(a){return n.nodeName(a,"iframe")?a.contentDocument||a.contentWindow.document:n.merge([],a.childNodes)}},function(a,b){n.fn[a]=function(c,d){var e=n.map(this,b,c);return"Until"!==a.slice(-5)&&(d=c),d&&"string"==typeof d&&(e=n.filter(d,e)),this.length>1&&(E[a]||(e=n.uniqueSort(e)),D.test(a)&&(e=e.reverse())),this.pushStack(e)}});var G=/\S+/g;function H(a){var b={};return n.each(a.match(G)||[],function(a,c){b[c]=!0}),b}n.Callbacks=function(a){a="string"==typeof a?H(a):n.extend({},a);var b,c,d,e,f=[],g=[],h=-1,i=function(){for(e=a.once,d=b=!0;g.length;h=-1){c=g.shift();while(++h<f.length)f[h].apply(c[0],c[1])===!1&&a.stopOnFalse&&(h=f.length,c=!1)}a.memory||(c=!1),b=!1,e&&(f=c?[]:"")},j={add:function(){return f&&(c&&!b&&(h=f.length-1,g.push(c)),function d(b){n.each(b,function(b,c){n.isFunction(c)?a.unique&&j.has(c)||f.push(c):c&&c.length&&"string"!==n.type(c)&&d(c)})}(arguments),c&&!b&&i()),this},remove:function(){return n.each(arguments,function(a,b){var c;while((c=n.inArray(b,f,c))>-1)f.splice(c,1),h>=c&&h--}),this},has:function(a){return a?n.inArray(a,f)>-1:f.length>0},empty:function(){return f&&(f=[]),this},disable:function(){return e=g=[],f=c="",this},disabled:function(){return!f},lock:function(){return e=!0,c||j.disable(),this},locked:function(){return!!e},fireWith:function(a,c){return e||(c=c||[],c=[a,c.slice?c.slice():c],g.push(c),b||i()),this},fire:function(){return j.fireWith(this,arguments),this},fired:function(){return!!d}};return j},n.extend({Deferred:function(a){var b=[["resolve","done",n.Callbacks("once memory"),"resolved"],["reject","fail",n.Callbacks("once memory"),"rejected"],["notify","progress",n.Callbacks("memory")]],c="pending",d={state:function(){return c},always:function(){return e.done(arguments).fail(arguments),this},then:function(){var a=arguments;return n.Deferred(function(c){n.each(b,function(b,f){var g=n.isFunction(a[b])&&a[b];e[f[1]](function(){var a=g&&g.apply(this,arguments);a&&n.isFunction(a.promise)?a.promise().progress(c.notify).done(c.resolve).fail(c.reject):c[f[0]+"With"](this===d?c.promise():this,g?[a]:arguments)})}),a=null}).promise()},promise:function(a){return null!=a?n.extend(a,d):d}},e={};return d.pipe=d.then,n.each(b,function(a,f){var g=f[2],h=f[3];d[f[1]]=g.add,h&&g.add(function(){c=h},b[1^a][2].disable,b[2][2].lock),e[f[0]]=function(){return e[f[0]+"With"](this===e?d:this,arguments),this},e[f[0]+"With"]=g.fireWith}),d.promise(e),a&&a.call(e,e),e},when:function(a){var b=0,c=e.call(arguments),d=c.length,f=1!==d||a&&n.isFunction(a.promise)?d:0,g=1===f?a:n.Deferred(),h=function(a,b,c){return function(d){b[a]=this,c[a]=arguments.length>1?e.call(arguments):d,c===i?g.notifyWith(b,c):--f||g.resolveWith(b,c)}},i,j,k;if(d>1)for(i=new Array(d),j=new Array(d),k=new Array(d);d>b;b++)c[b]&&n.isFunction(c[b].promise)?c[b].promise().progress(h(b,j,i)).done(h(b,k,c)).fail(g.reject):--f;return f||g.resolveWith(k,c),g.promise()}});var I;n.fn.ready=function(a){return n.ready.promise().done(a),this},n.extend({isReady:!1,readyWait:1,holdReady:function(a){a?n.readyWait++:n.ready(!0)},ready:function(a){(a===!0?--n.readyWait:n.isReady)||(n.isReady=!0,a!==!0&&--n.readyWait>0||(I.resolveWith(d,[n]),n.fn.triggerHandler&&(n(d).triggerHandler("ready"),n(d).off("ready"))))}});function J(){d.addEventListener?(d.removeEventListener("DOMContentLoaded",K),a.removeEventListener("load",K)):(d.detachEvent("onreadystatechange",K),a.detachEvent("onload",K))}function K(){(d.addEventListener||"load"===a.event.type||"complete"===d.readyState)&&(J(),n.ready())}n.ready.promise=function(b){if(!I)if(I=n.Deferred(),"complete"===d.readyState||"loading"!==d.readyState&&!d.documentElement.doScroll)a.setTimeout(n.ready);else if(d.addEventListener)d.addEventListener("DOMContentLoaded",K),a.addEventListener("load",K);else{d.attachEvent("onreadystatechange",K),a.attachEvent("onload",K);var c=!1;try{c=null==a.frameElement&&d.documentElement}catch(e){}c&&c.doScroll&&!function f(){if(!n.isReady){try{c.doScroll("left")}catch(b){return a.setTimeout(f,50)}J(),n.ready()}}()}return I.promise(b)},n.ready.promise();var L;for(L in n(l))break;l.ownFirst="0"===L,l.inlineBlockNeedsLayout=!1,n(function(){var a,b,c,e;c=d.getElementsByTagName("body")[0],c&&c.style&&(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="display:inline;margin:0;border:0;padding:1px;width:1px;zoom:1",l.inlineBlockNeedsLayout=a=3===b.offsetWidth,a&&(c.style.zoom=1)),c.removeChild(e))}),function(){var a=d.createElement("div");l.deleteExpando=!0;try{delete a.test}catch(b){l.deleteExpando=!1}a=null}();var M=function(a){var b=n.noData[(a.nodeName+" ").toLowerCase()],c=+a.nodeType||1;return 1!==c&&9!==c?!1:!b||b!==!0&&a.getAttribute("classid")===b},N=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,O=/([A-Z])/g;function P(a,b,c){if(void 0===c&&1===a.nodeType){var d="data-"+b.replace(O,"-$1").toLowerCase();if(c=a.getAttribute(d),"string"==typeof c){try{c="true"===c?!0:"false"===c?!1:"null"===c?null:+c+""===c?+c:N.test(c)?n.parseJSON(c):c}catch(e){}n.data(a,b,c)}else c=void 0;
}return c}function Q(a){var b;for(b in a)if(("data"!==b||!n.isEmptyObject(a[b]))&&"toJSON"!==b)return!1;return!0}function R(a,b,d,e){if(M(a)){var f,g,h=n.expando,i=a.nodeType,j=i?n.cache:a,k=i?a[h]:a[h]&&h;if(k&&j[k]&&(e||j[k].data)||void 0!==d||"string"!=typeof b)return k||(k=i?a[h]=c.pop()||n.guid++:h),j[k]||(j[k]=i?{}:{toJSON:n.noop}),"object"!=typeof b&&"function"!=typeof b||(e?j[k]=n.extend(j[k],b):j[k].data=n.extend(j[k].data,b)),g=j[k],e||(g.data||(g.data={}),g=g.data),void 0!==d&&(g[n.camelCase(b)]=d),"string"==typeof b?(f=g[b],null==f&&(f=g[n.camelCase(b)])):f=g,f}}function S(a,b,c){if(M(a)){var d,e,f=a.nodeType,g=f?n.cache:a,h=f?a[n.expando]:n.expando;if(g[h]){if(b&&(d=c?g[h]:g[h].data)){n.isArray(b)?b=b.concat(n.map(b,n.camelCase)):b in d?b=[b]:(b=n.camelCase(b),b=b in d?[b]:b.split(" ")),e=b.length;while(e--)delete d[b[e]];if(c?!Q(d):!n.isEmptyObject(d))return}(c||(delete g[h].data,Q(g[h])))&&(f?n.cleanData([a],!0):l.deleteExpando||g!=g.window?delete g[h]:g[h]=void 0)}}}n.extend({cache:{},noData:{"applet ":!0,"embed ":!0,"object ":"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000"},hasData:function(a){return a=a.nodeType?n.cache[a[n.expando]]:a[n.expando],!!a&&!Q(a)},data:function(a,b,c){return R(a,b,c)},removeData:function(a,b){return S(a,b)},_data:function(a,b,c){return R(a,b,c,!0)},_removeData:function(a,b){return S(a,b,!0)}}),n.fn.extend({data:function(a,b){var c,d,e,f=this[0],g=f&&f.attributes;if(void 0===a){if(this.length&&(e=n.data(f),1===f.nodeType&&!n._data(f,"parsedAttrs"))){c=g.length;while(c--)g[c]&&(d=g[c].name,0===d.indexOf("data-")&&(d=n.camelCase(d.slice(5)),P(f,d,e[d])));n._data(f,"parsedAttrs",!0)}return e}return"object"==typeof a?this.each(function(){n.data(this,a)}):arguments.length>1?this.each(function(){n.data(this,a,b)}):f?P(f,a,n.data(f,a)):void 0},removeData:function(a){return this.each(function(){n.removeData(this,a)})}}),n.extend({queue:function(a,b,c){var d;return a?(b=(b||"fx")+"queue",d=n._data(a,b),c&&(!d||n.isArray(c)?d=n._data(a,b,n.makeArray(c)):d.push(c)),d||[]):void 0},dequeue:function(a,b){b=b||"fx";var c=n.queue(a,b),d=c.length,e=c.shift(),f=n._queueHooks(a,b),g=function(){n.dequeue(a,b)};"inprogress"===e&&(e=c.shift(),d--),e&&("fx"===b&&c.unshift("inprogress"),delete f.stop,e.call(a,g,f)),!d&&f&&f.empty.fire()},_queueHooks:function(a,b){var c=b+"queueHooks";return n._data(a,c)||n._data(a,c,{empty:n.Callbacks("once memory").add(function(){n._removeData(a,b+"queue"),n._removeData(a,c)})})}}),n.fn.extend({queue:function(a,b){var c=2;return"string"!=typeof a&&(b=a,a="fx",c--),arguments.length<c?n.queue(this[0],a):void 0===b?this:this.each(function(){var c=n.queue(this,a,b);n._queueHooks(this,a),"fx"===a&&"inprogress"!==c[0]&&n.dequeue(this,a)})},dequeue:function(a){return this.each(function(){n.dequeue(this,a)})},clearQueue:function(a){return this.queue(a||"fx",[])},promise:function(a,b){var c,d=1,e=n.Deferred(),f=this,g=this.length,h=function(){--d||e.resolveWith(f,[f])};"string"!=typeof a&&(b=a,a=void 0),a=a||"fx";while(g--)c=n._data(f[g],a+"queueHooks"),c&&c.empty&&(d++,c.empty.add(h));return h(),e.promise(b)}}),function(){var a;l.shrinkWrapBlocks=function(){if(null!=a)return a;a=!1;var b,c,e;return c=d.getElementsByTagName("body")[0],c&&c.style?(b=d.createElement("div"),e=d.createElement("div"),e.style.cssText="position:absolute;border:0;width:0;height:0;top:0;left:-9999px",c.appendChild(e).appendChild(b),"undefined"!=typeof b.style.zoom&&(b.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:1px;width:1px;zoom:1",b.appendChild(d.createElement("div")).style.width="5px",a=3!==b.offsetWidth),c.removeChild(e),a):void 0}}();var T=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,U=new RegExp("^(?:([+-])=|)("+T+")([a-z%]*)$","i"),V=["Top","Right","Bottom","Left"],W=function(a,b){return a=b||a,"none"===n.css(a,"display")||!n.contains(a.ownerDocument,a)};function X(a,b,c,d){var e,f=1,g=20,h=d?function(){return d.cur()}:function(){return n.css(a,b,"")},i=h(),j=c&&c[3]||(n.cssNumber[b]?"":"px"),k=(n.cssNumber[b]||"px"!==j&&+i)&&U.exec(n.css(a,b));if(k&&k[3]!==j){j=j||k[3],c=c||[],k=+i||1;do f=f||".5",k/=f,n.style(a,b,k+j);while(f!==(f=h()/i)&&1!==f&&--g)}return c&&(k=+k||+i||0,e=c[1]?k+(c[1]+1)*c[2]:+c[2],d&&(d.unit=j,d.start=k,d.end=e)),e}var Y=function(a,b,c,d,e,f,g){var h=0,i=a.length,j=null==c;if("object"===n.type(c)){e=!0;for(h in c)Y(a,b,h,c[h],!0,f,g)}else if(void 0!==d&&(e=!0,n.isFunction(d)||(g=!0),j&&(g?(b.call(a,d),b=null):(j=b,b=function(a,b,c){return j.call(n(a),c)})),b))for(;i>h;h++)b(a[h],c,g?d:d.call(a[h],h,b(a[h],c)));return e?a:j?b.call(a):i?b(a[0],c):f},Z=/^(?:checkbox|radio)$/i,$=/<([\w:-]+)/,_=/^$|\/(?:java|ecma)script/i,aa=/^\s+/,ba="abbr|article|aside|audio|bdi|canvas|data|datalist|details|dialog|figcaption|figure|footer|header|hgroup|main|mark|meter|nav|output|picture|progress|section|summary|template|time|video";function ca(a){var b=ba.split("|"),c=a.createDocumentFragment();if(c.createElement)while(b.length)c.createElement(b.pop());return c}!function(){var a=d.createElement("div"),b=d.createDocumentFragment(),c=d.createElement("input");a.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",l.leadingWhitespace=3===a.firstChild.nodeType,l.tbody=!a.getElementsByTagName("tbody").length,l.htmlSerialize=!!a.getElementsByTagName("link").length,l.html5Clone="<:nav></:nav>"!==d.createElement("nav").cloneNode(!0).outerHTML,c.type="checkbox",c.checked=!0,b.appendChild(c),l.appendChecked=c.checked,a.innerHTML="<textarea>x</textarea>",l.noCloneChecked=!!a.cloneNode(!0).lastChild.defaultValue,b.appendChild(a),c=d.createElement("input"),c.setAttribute("type","radio"),c.setAttribute("checked","checked"),c.setAttribute("name","t"),a.appendChild(c),l.checkClone=a.cloneNode(!0).cloneNode(!0).lastChild.checked,l.noCloneEvent=!!a.addEventListener,a[n.expando]=1,l.attributes=!a.getAttribute(n.expando)}();var da={option:[1,"<select multiple='multiple'>","</select>"],legend:[1,"<fieldset>","</fieldset>"],area:[1,"<map>","</map>"],param:[1,"<object>","</object>"],thead:[1,"<table>","</table>"],tr:[2,"<table><tbody>","</tbody></table>"],col:[2,"<table><tbody></tbody><colgroup>","</colgroup></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:l.htmlSerialize?[0,"",""]:[1,"X<div>","</div>"]};da.optgroup=da.option,da.tbody=da.tfoot=da.colgroup=da.caption=da.thead,da.th=da.td;function ea(a,b){var c,d,e=0,f="undefined"!=typeof a.getElementsByTagName?a.getElementsByTagName(b||"*"):"undefined"!=typeof a.querySelectorAll?a.querySelectorAll(b||"*"):void 0;if(!f)for(f=[],c=a.childNodes||a;null!=(d=c[e]);e++)!b||n.nodeName(d,b)?f.push(d):n.merge(f,ea(d,b));return void 0===b||b&&n.nodeName(a,b)?n.merge([a],f):f}function fa(a,b){for(var c,d=0;null!=(c=a[d]);d++)n._data(c,"globalEval",!b||n._data(b[d],"globalEval"))}var ga=/<|&#?\w+;/,ha=/<tbody/i;function ia(a){Z.test(a.type)&&(a.defaultChecked=a.checked)}function ja(a,b,c,d,e){for(var f,g,h,i,j,k,m,o=a.length,p=ca(b),q=[],r=0;o>r;r++)if(g=a[r],g||0===g)if("object"===n.type(g))n.merge(q,g.nodeType?[g]:g);else if(ga.test(g)){i=i||p.appendChild(b.createElement("div")),j=($.exec(g)||["",""])[1].toLowerCase(),m=da[j]||da._default,i.innerHTML=m[1]+n.htmlPrefilter(g)+m[2],f=m[0];while(f--)i=i.lastChild;if(!l.leadingWhitespace&&aa.test(g)&&q.push(b.createTextNode(aa.exec(g)[0])),!l.tbody){g="table"!==j||ha.test(g)?"<table>"!==m[1]||ha.test(g)?0:i:i.firstChild,f=g&&g.childNodes.length;while(f--)n.nodeName(k=g.childNodes[f],"tbody")&&!k.childNodes.length&&g.removeChild(k)}n.merge(q,i.childNodes),i.textContent="";while(i.firstChild)i.removeChild(i.firstChild);i=p.lastChild}else q.push(b.createTextNode(g));i&&p.removeChild(i),l.appendChecked||n.grep(ea(q,"input"),ia),r=0;while(g=q[r++])if(d&&n.inArray(g,d)>-1)e&&e.push(g);else if(h=n.contains(g.ownerDocument,g),i=ea(p.appendChild(g),"script"),h&&fa(i),c){f=0;while(g=i[f++])_.test(g.type||"")&&c.push(g)}return i=null,p}!function(){var b,c,e=d.createElement("div");for(b in{submit:!0,change:!0,focusin:!0})c="on"+b,(l[b]=c in a)||(e.setAttribute(c,"t"),l[b]=e.attributes[c].expando===!1);e=null}();var ka=/^(?:input|select|textarea)$/i,la=/^key/,ma=/^(?:mouse|pointer|contextmenu|drag|drop)|click/,na=/^(?:focusinfocus|focusoutblur)$/,oa=/^([^.]*)(?:\.(.+)|)/;function pa(){return!0}function qa(){return!1}function ra(){try{return d.activeElement}catch(a){}}function sa(a,b,c,d,e,f){var g,h;if("object"==typeof b){"string"!=typeof c&&(d=d||c,c=void 0);for(h in b)sa(a,h,c,d,b[h],f);return a}if(null==d&&null==e?(e=c,d=c=void 0):null==e&&("string"==typeof c?(e=d,d=void 0):(e=d,d=c,c=void 0)),e===!1)e=qa;else if(!e)return a;return 1===f&&(g=e,e=function(a){return n().off(a),g.apply(this,arguments)},e.guid=g.guid||(g.guid=n.guid++)),a.each(function(){n.event.add(this,b,e,d,c)})}n.event={global:{},add:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n._data(a);if(r){c.handler&&(i=c,c=i.handler,e=i.selector),c.guid||(c.guid=n.guid++),(g=r.events)||(g=r.events={}),(k=r.handle)||(k=r.handle=function(a){return"undefined"==typeof n||a&&n.event.triggered===a.type?void 0:n.event.dispatch.apply(k.elem,arguments)},k.elem=a),b=(b||"").match(G)||[""],h=b.length;while(h--)f=oa.exec(b[h])||[],o=q=f[1],p=(f[2]||"").split(".").sort(),o&&(j=n.event.special[o]||{},o=(e?j.delegateType:j.bindType)||o,j=n.event.special[o]||{},l=n.extend({type:o,origType:q,data:d,handler:c,guid:c.guid,selector:e,needsContext:e&&n.expr.match.needsContext.test(e),namespace:p.join(".")},i),(m=g[o])||(m=g[o]=[],m.delegateCount=0,j.setup&&j.setup.call(a,d,p,k)!==!1||(a.addEventListener?a.addEventListener(o,k,!1):a.attachEvent&&a.attachEvent("on"+o,k))),j.add&&(j.add.call(a,l),l.handler.guid||(l.handler.guid=c.guid)),e?m.splice(m.delegateCount++,0,l):m.push(l),n.event.global[o]=!0);a=null}},remove:function(a,b,c,d,e){var f,g,h,i,j,k,l,m,o,p,q,r=n.hasData(a)&&n._data(a);if(r&&(k=r.events)){b=(b||"").match(G)||[""],j=b.length;while(j--)if(h=oa.exec(b[j])||[],o=q=h[1],p=(h[2]||"").split(".").sort(),o){l=n.event.special[o]||{},o=(d?l.delegateType:l.bindType)||o,m=k[o]||[],h=h[2]&&new RegExp("(^|\\.)"+p.join("\\.(?:.*\\.|)")+"(\\.|$)"),i=f=m.length;while(f--)g=m[f],!e&&q!==g.origType||c&&c.guid!==g.guid||h&&!h.test(g.namespace)||d&&d!==g.selector&&("**"!==d||!g.selector)||(m.splice(f,1),g.selector&&m.delegateCount--,l.remove&&l.remove.call(a,g));i&&!m.length&&(l.teardown&&l.teardown.call(a,p,r.handle)!==!1||n.removeEvent(a,o,r.handle),delete k[o])}else for(o in k)n.event.remove(a,o+b[j],c,d,!0);n.isEmptyObject(k)&&(delete r.handle,n._removeData(a,"events"))}},trigger:function(b,c,e,f){var g,h,i,j,l,m,o,p=[e||d],q=k.call(b,"type")?b.type:b,r=k.call(b,"namespace")?b.namespace.split("."):[];if(i=m=e=e||d,3!==e.nodeType&&8!==e.nodeType&&!na.test(q+n.event.triggered)&&(q.indexOf(".")>-1&&(r=q.split("."),q=r.shift(),r.sort()),h=q.indexOf(":")<0&&"on"+q,b=b[n.expando]?b:new n.Event(q,"object"==typeof b&&b),b.isTrigger=f?2:3,b.namespace=r.join("."),b.rnamespace=b.namespace?new RegExp("(^|\\.)"+r.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,b.result=void 0,b.target||(b.target=e),c=null==c?[b]:n.makeArray(c,[b]),l=n.event.special[q]||{},f||!l.trigger||l.trigger.apply(e,c)!==!1)){if(!f&&!l.noBubble&&!n.isWindow(e)){for(j=l.delegateType||q,na.test(j+q)||(i=i.parentNode);i;i=i.parentNode)p.push(i),m=i;m===(e.ownerDocument||d)&&p.push(m.defaultView||m.parentWindow||a)}o=0;while((i=p[o++])&&!b.isPropagationStopped())b.type=o>1?j:l.bindType||q,g=(n._data(i,"events")||{})[b.type]&&n._data(i,"handle"),g&&g.apply(i,c),g=h&&i[h],g&&g.apply&&M(i)&&(b.result=g.apply(i,c),b.result===!1&&b.preventDefault());if(b.type=q,!f&&!b.isDefaultPrevented()&&(!l._default||l._default.apply(p.pop(),c)===!1)&&M(e)&&h&&e[q]&&!n.isWindow(e)){m=e[h],m&&(e[h]=null),n.event.triggered=q;try{e[q]()}catch(s){}n.event.triggered=void 0,m&&(e[h]=m)}return b.result}},dispatch:function(a){a=n.event.fix(a);var b,c,d,f,g,h=[],i=e.call(arguments),j=(n._data(this,"events")||{})[a.type]||[],k=n.event.special[a.type]||{};if(i[0]=a,a.delegateTarget=this,!k.preDispatch||k.preDispatch.call(this,a)!==!1){h=n.event.handlers.call(this,a,j),b=0;while((f=h[b++])&&!a.isPropagationStopped()){a.currentTarget=f.elem,c=0;while((g=f.handlers[c++])&&!a.isImmediatePropagationStopped())a.rnamespace&&!a.rnamespace.test(g.namespace)||(a.handleObj=g,a.data=g.data,d=((n.event.special[g.origType]||{}).handle||g.handler).apply(f.elem,i),void 0!==d&&(a.result=d)===!1&&(a.preventDefault(),a.stopPropagation()))}return k.postDispatch&&k.postDispatch.call(this,a),a.result}},handlers:function(a,b){var c,d,e,f,g=[],h=b.delegateCount,i=a.target;if(h&&i.nodeType&&("click"!==a.type||isNaN(a.button)||a.button<1))for(;i!=this;i=i.parentNode||this)if(1===i.nodeType&&(i.disabled!==!0||"click"!==a.type)){for(d=[],c=0;h>c;c++)f=b[c],e=f.selector+" ",void 0===d[e]&&(d[e]=f.needsContext?n(e,this).index(i)>-1:n.find(e,this,null,[i]).length),d[e]&&d.push(f);d.length&&g.push({elem:i,handlers:d})}return h<b.length&&g.push({elem:this,handlers:b.slice(h)}),g},fix:function(a){if(a[n.expando])return a;var b,c,e,f=a.type,g=a,h=this.fixHooks[f];h||(this.fixHooks[f]=h=ma.test(f)?this.mouseHooks:la.test(f)?this.keyHooks:{}),e=h.props?this.props.concat(h.props):this.props,a=new n.Event(g),b=e.length;while(b--)c=e[b],a[c]=g[c];return a.target||(a.target=g.srcElement||d),3===a.target.nodeType&&(a.target=a.target.parentNode),a.metaKey=!!a.metaKey,h.filter?h.filter(a,g):a},props:"altKey bubbles cancelable ctrlKey currentTarget detail eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(a,b){return null==a.which&&(a.which=null!=b.charCode?b.charCode:b.keyCode),a}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(a,b){var c,e,f,g=b.button,h=b.fromElement;return null==a.pageX&&null!=b.clientX&&(e=a.target.ownerDocument||d,f=e.documentElement,c=e.body,a.pageX=b.clientX+(f&&f.scrollLeft||c&&c.scrollLeft||0)-(f&&f.clientLeft||c&&c.clientLeft||0),a.pageY=b.clientY+(f&&f.scrollTop||c&&c.scrollTop||0)-(f&&f.clientTop||c&&c.clientTop||0)),!a.relatedTarget&&h&&(a.relatedTarget=h===a.target?b.toElement:h),a.which||void 0===g||(a.which=1&g?1:2&g?3:4&g?2:0),a}},special:{load:{noBubble:!0},focus:{trigger:function(){if(this!==ra()&&this.focus)try{return this.focus(),!1}catch(a){}},delegateType:"focusin"},blur:{trigger:function(){return this===ra()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return n.nodeName(this,"input")&&"checkbox"===this.type&&this.click?(this.click(),!1):void 0},_default:function(a){return n.nodeName(a.target,"a")}},beforeunload:{postDispatch:function(a){void 0!==a.result&&a.originalEvent&&(a.originalEvent.returnValue=a.result)}}},simulate:function(a,b,c){var d=n.extend(new n.Event,c,{type:a,isSimulated:!0});n.event.trigger(d,null,b),d.isDefaultPrevented()&&c.preventDefault()}},n.removeEvent=d.removeEventListener?function(a,b,c){a.removeEventListener&&a.removeEventListener(b,c)}:function(a,b,c){var d="on"+b;a.detachEvent&&("undefined"==typeof a[d]&&(a[d]=null),a.detachEvent(d,c))},n.Event=function(a,b){return this instanceof n.Event?(a&&a.type?(this.originalEvent=a,this.type=a.type,this.isDefaultPrevented=a.defaultPrevented||void 0===a.defaultPrevented&&a.returnValue===!1?pa:qa):this.type=a,b&&n.extend(this,b),this.timeStamp=a&&a.timeStamp||n.now(),void(this[n.expando]=!0)):new n.Event(a,b)},n.Event.prototype={constructor:n.Event,isDefaultPrevented:qa,isPropagationStopped:qa,isImmediatePropagationStopped:qa,preventDefault:function(){var a=this.originalEvent;this.isDefaultPrevented=pa,a&&(a.preventDefault?a.preventDefault():a.returnValue=!1)},stopPropagation:function(){var a=this.originalEvent;this.isPropagationStopped=pa,a&&!this.isSimulated&&(a.stopPropagation&&a.stopPropagation(),a.cancelBubble=!0)},stopImmediatePropagation:function(){var a=this.originalEvent;this.isImmediatePropagationStopped=pa,a&&a.stopImmediatePropagation&&a.stopImmediatePropagation(),this.stopPropagation()}},n.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(a,b){n.event.special[a]={delegateType:b,bindType:b,handle:function(a){var c,d=this,e=a.relatedTarget,f=a.handleObj;return e&&(e===d||n.contains(d,e))||(a.type=f.origType,c=f.handler.apply(this,arguments),a.type=b),c}}}),l.submit||(n.event.special.submit={setup:function(){return n.nodeName(this,"form")?!1:void n.event.add(this,"click._submit keypress._submit",function(a){var b=a.target,c=n.nodeName(b,"input")||n.nodeName(b,"button")?n.prop(b,"form"):void 0;c&&!n._data(c,"submit")&&(n.event.add(c,"submit._submit",function(a){a._submitBubble=!0}),n._data(c,"submit",!0))})},postDispatch:function(a){a._submitBubble&&(delete a._submitBubble,this.parentNode&&!a.isTrigger&&n.event.simulate("submit",this.parentNode,a))},teardown:function(){return n.nodeName(this,"form")?!1:void n.event.remove(this,"._submit")}}),l.change||(n.event.special.change={setup:function(){return ka.test(this.nodeName)?("checkbox"!==this.type&&"radio"!==this.type||(n.event.add(this,"propertychange._change",function(a){"checked"===a.originalEvent.propertyName&&(this._justChanged=!0)}),n.event.add(this,"click._change",function(a){this._justChanged&&!a.isTrigger&&(this._justChanged=!1),n.event.simulate("change",this,a)})),!1):void n.event.add(this,"beforeactivate._change",function(a){var b=a.target;ka.test(b.nodeName)&&!n._data(b,"change")&&(n.event.add(b,"change._change",function(a){!this.parentNode||a.isSimulated||a.isTrigger||n.event.simulate("change",this.parentNode,a)}),n._data(b,"change",!0))})},handle:function(a){var b=a.target;return this!==b||a.isSimulated||a.isTrigger||"radio"!==b.type&&"checkbox"!==b.type?a.handleObj.handler.apply(this,arguments):void 0},teardown:function(){return n.event.remove(this,"._change"),!ka.test(this.nodeName)}}),l.focusin||n.each({focus:"focusin",blur:"focusout"},function(a,b){var c=function(a){n.event.simulate(b,a.target,n.event.fix(a))};n.event.special[b]={setup:function(){var d=this.ownerDocument||this,e=n._data(d,b);e||d.addEventListener(a,c,!0),n._data(d,b,(e||0)+1)},teardown:function(){var d=this.ownerDocument||this,e=n._data(d,b)-1;e?n._data(d,b,e):(d.removeEventListener(a,c,!0),n._removeData(d,b))}}}),n.fn.extend({on:function(a,b,c,d){return sa(this,a,b,c,d)},one:function(a,b,c,d){return sa(this,a,b,c,d,1)},off:function(a,b,c){var d,e;if(a&&a.preventDefault&&a.handleObj)return d=a.handleObj,n(a.delegateTarget).off(d.namespace?d.origType+"."+d.namespace:d.origType,d.selector,d.handler),this;if("object"==typeof a){for(e in a)this.off(e,b,a[e]);return this}return b!==!1&&"function"!=typeof b||(c=b,b=void 0),c===!1&&(c=qa),this.each(function(){n.event.remove(this,a,c,b)})},trigger:function(a,b){return this.each(function(){n.event.trigger(a,b,this)})},triggerHandler:function(a,b){var c=this[0];return c?n.event.trigger(a,b,c,!0):void 0}});var ta=/ jQuery\d+="(?:null|\d+)"/g,ua=new RegExp("<(?:"+ba+")[\\s/>]","i"),va=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:-]+)[^>]*)\/>/gi,wa=/<script|<style|<link/i,xa=/checked\s*(?:[^=]|=\s*.checked.)/i,ya=/^true\/(.*)/,za=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,Aa=ca(d),Ba=Aa.appendChild(d.createElement("div"));function Ca(a,b){return n.nodeName(a,"table")&&n.nodeName(11!==b.nodeType?b:b.firstChild,"tr")?a.getElementsByTagName("tbody")[0]||a.appendChild(a.ownerDocument.createElement("tbody")):a}function Da(a){return a.type=(null!==n.find.attr(a,"type"))+"/"+a.type,a}function Ea(a){var b=ya.exec(a.type);return b?a.type=b[1]:a.removeAttribute("type"),a}function Fa(a,b){if(1===b.nodeType&&n.hasData(a)){var c,d,e,f=n._data(a),g=n._data(b,f),h=f.events;if(h){delete g.handle,g.events={};for(c in h)for(d=0,e=h[c].length;e>d;d++)n.event.add(b,c,h[c][d])}g.data&&(g.data=n.extend({},g.data))}}function Ga(a,b){var c,d,e;if(1===b.nodeType){if(c=b.nodeName.toLowerCase(),!l.noCloneEvent&&b[n.expando]){e=n._data(b);for(d in e.events)n.removeEvent(b,d,e.handle);b.removeAttribute(n.expando)}"script"===c&&b.text!==a.text?(Da(b).text=a.text,Ea(b)):"object"===c?(b.parentNode&&(b.outerHTML=a.outerHTML),l.html5Clone&&a.innerHTML&&!n.trim(b.innerHTML)&&(b.innerHTML=a.innerHTML)):"input"===c&&Z.test(a.type)?(b.defaultChecked=b.checked=a.checked,b.value!==a.value&&(b.value=a.value)):"option"===c?b.defaultSelected=b.selected=a.defaultSelected:"input"!==c&&"textarea"!==c||(b.defaultValue=a.defaultValue)}}function Ha(a,b,c,d){b=f.apply([],b);var e,g,h,i,j,k,m=0,o=a.length,p=o-1,q=b[0],r=n.isFunction(q);if(r||o>1&&"string"==typeof q&&!l.checkClone&&xa.test(q))return a.each(function(e){var f=a.eq(e);r&&(b[0]=q.call(this,e,f.html())),Ha(f,b,c,d)});if(o&&(k=ja(b,a[0].ownerDocument,!1,a,d),e=k.firstChild,1===k.childNodes.length&&(k=e),e||d)){for(i=n.map(ea(k,"script"),Da),h=i.length;o>m;m++)g=k,m!==p&&(g=n.clone(g,!0,!0),h&&n.merge(i,ea(g,"script"))),c.call(a[m],g,m);if(h)for(j=i[i.length-1].ownerDocument,n.map(i,Ea),m=0;h>m;m++)g=i[m],_.test(g.type||"")&&!n._data(g,"globalEval")&&n.contains(j,g)&&(g.src?n._evalUrl&&n._evalUrl(g.src):n.globalEval((g.text||g.textContent||g.innerHTML||"").replace(za,"")));k=e=null}return a}function Ia(a,b,c){for(var d,e=b?n.filter(b,a):a,f=0;null!=(d=e[f]);f++)c||1!==d.nodeType||n.cleanData(ea(d)),d.parentNode&&(c&&n.contains(d.ownerDocument,d)&&fa(ea(d,"script")),d.parentNode.removeChild(d));return a}n.extend({htmlPrefilter:function(a){return a.replace(va,"<$1></$2>")},clone:function(a,b,c){var d,e,f,g,h,i=n.contains(a.ownerDocument,a);if(l.html5Clone||n.isXMLDoc(a)||!ua.test("<"+a.nodeName+">")?f=a.cloneNode(!0):(Ba.innerHTML=a.outerHTML,Ba.removeChild(f=Ba.firstChild)),!(l.noCloneEvent&&l.noCloneChecked||1!==a.nodeType&&11!==a.nodeType||n.isXMLDoc(a)))for(d=ea(f),h=ea(a),g=0;null!=(e=h[g]);++g)d[g]&&Ga(e,d[g]);if(b)if(c)for(h=h||ea(a),d=d||ea(f),g=0;null!=(e=h[g]);g++)Fa(e,d[g]);else Fa(a,f);return d=ea(f,"script"),d.length>0&&fa(d,!i&&ea(a,"script")),d=h=e=null,f},cleanData:function(a,b){for(var d,e,f,g,h=0,i=n.expando,j=n.cache,k=l.attributes,m=n.event.special;null!=(d=a[h]);h++)if((b||M(d))&&(f=d[i],g=f&&j[f])){if(g.events)for(e in g.events)m[e]?n.event.remove(d,e):n.removeEvent(d,e,g.handle);j[f]&&(delete j[f],k||"undefined"==typeof d.removeAttribute?d[i]=void 0:d.removeAttribute(i),c.push(f))}}}),n.fn.extend({domManip:Ha,detach:function(a){return Ia(this,a,!0)},remove:function(a){return Ia(this,a)},text:function(a){return Y(this,function(a){return void 0===a?n.text(this):this.empty().append((this[0]&&this[0].ownerDocument||d).createTextNode(a))},null,a,arguments.length)},append:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.appendChild(a)}})},prepend:function(){return Ha(this,arguments,function(a){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var b=Ca(this,a);b.insertBefore(a,b.firstChild)}})},before:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this)})},after:function(){return Ha(this,arguments,function(a){this.parentNode&&this.parentNode.insertBefore(a,this.nextSibling)})},empty:function(){for(var a,b=0;null!=(a=this[b]);b++){1===a.nodeType&&n.cleanData(ea(a,!1));while(a.firstChild)a.removeChild(a.firstChild);a.options&&n.nodeName(a,"select")&&(a.options.length=0)}return this},clone:function(a,b){return a=null==a?!1:a,b=null==b?a:b,this.map(function(){return n.clone(this,a,b)})},html:function(a){return Y(this,function(a){var b=this[0]||{},c=0,d=this.length;if(void 0===a)return 1===b.nodeType?b.innerHTML.replace(ta,""):void 0;if("string"==typeof a&&!wa.test(a)&&(l.htmlSerialize||!ua.test(a))&&(l.leadingWhitespace||!aa.test(a))&&!da[($.exec(a)||["",""])[1].toLowerCase()]){a=n.htmlPrefilter(a);try{for(;d>c;c++)b=this[c]||{},1===b.nodeType&&(n.cleanData(ea(b,!1)),b.innerHTML=a);b=0}catch(e){}}b&&this.empty().append(a)},null,a,arguments.length)},replaceWith:function(){var a=[];return Ha(this,arguments,function(b){var c=this.parentNode;n.inArray(this,a)<0&&(n.cleanData(ea(this)),c&&c.replaceChild(b,this))},a)}}),n.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(a,b){n.fn[a]=function(a){for(var c,d=0,e=[],f=n(a),h=f.length-1;h>=d;d++)c=d===h?this:this.clone(!0),n(f[d])[b](c),g.apply(e,c.get());return this.pushStack(e)}});var Ja,Ka={HTML:"block",BODY:"block"};function La(a,b){var c=n(b.createElement(a)).appendTo(b.body),d=n.css(c[0],"display");return c.detach(),d}function Ma(a){var b=d,c=Ka[a];return c||(c=La(a,b),"none"!==c&&c||(Ja=(Ja||n("<iframe frameborder='0' width='0' height='0'/>")).appendTo(b.documentElement),b=(Ja[0].contentWindow||Ja[0].contentDocument).document,b.write(),b.close(),c=La(a,b),Ja.detach()),Ka[a]=c),c}var Na=/^margin/,Oa=new RegExp("^("+T+")(?!px)[a-z%]+$","i"),Pa=function(a,b,c,d){var e,f,g={};for(f in b)g[f]=a.style[f],a.style[f]=b[f];e=c.apply(a,d||[]);for(f in b)a.style[f]=g[f];return e},Qa=d.documentElement;!function(){var b,c,e,f,g,h,i=d.createElement("div"),j=d.createElement("div");if(j.style){j.style.cssText="float:left;opacity:.5",l.opacity="0.5"===j.style.opacity,l.cssFloat=!!j.style.cssFloat,j.style.backgroundClip="content-box",j.cloneNode(!0).style.backgroundClip="",l.clearCloneStyle="content-box"===j.style.backgroundClip,i=d.createElement("div"),i.style.cssText="border:0;width:8px;height:0;top:0;left:-9999px;padding:0;margin-top:1px;position:absolute",j.innerHTML="",i.appendChild(j),l.boxSizing=""===j.style.boxSizing||""===j.style.MozBoxSizing||""===j.style.WebkitBoxSizing,n.extend(l,{reliableHiddenOffsets:function(){return null==b&&k(),f},boxSizingReliable:function(){return null==b&&k(),e},pixelMarginRight:function(){return null==b&&k(),c},pixelPosition:function(){return null==b&&k(),b},reliableMarginRight:function(){return null==b&&k(),g},reliableMarginLeft:function(){return null==b&&k(),h}});function k(){var k,l,m=d.documentElement;m.appendChild(i),j.style.cssText="-webkit-box-sizing:border-box;box-sizing:border-box;position:relative;display:block;margin:auto;border:1px;padding:1px;top:1%;width:50%",b=e=h=!1,c=g=!0,a.getComputedStyle&&(l=a.getComputedStyle(j),b="1%"!==(l||{}).top,h="2px"===(l||{}).marginLeft,e="4px"===(l||{width:"4px"}).width,j.style.marginRight="50%",c="4px"===(l||{marginRight:"4px"}).marginRight,k=j.appendChild(d.createElement("div")),k.style.cssText=j.style.cssText="-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;display:block;margin:0;border:0;padding:0",k.style.marginRight=k.style.width="0",j.style.width="1px",g=!parseFloat((a.getComputedStyle(k)||{}).marginRight),j.removeChild(k)),j.style.display="none",f=0===j.getClientRects().length,f&&(j.style.display="",j.innerHTML="<table><tr><td></td><td>t</td></tr></table>",j.childNodes[0].style.borderCollapse="separate",k=j.getElementsByTagName("td"),k[0].style.cssText="margin:0;border:0;padding:0;display:none",f=0===k[0].offsetHeight,f&&(k[0].style.display="",k[1].style.display="none",f=0===k[0].offsetHeight)),m.removeChild(i)}}}();var Ra,Sa,Ta=/^(top|right|bottom|left)$/;a.getComputedStyle?(Ra=function(b){var c=b.ownerDocument.defaultView;return c&&c.opener||(c=a),c.getComputedStyle(b)},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c.getPropertyValue(b)||c[b]:void 0,""!==g&&void 0!==g||n.contains(a.ownerDocument,a)||(g=n.style(a,b)),c&&!l.pixelMarginRight()&&Oa.test(g)&&Na.test(b)&&(d=h.width,e=h.minWidth,f=h.maxWidth,h.minWidth=h.maxWidth=h.width=g,g=c.width,h.width=d,h.minWidth=e,h.maxWidth=f),void 0===g?g:g+""}):Qa.currentStyle&&(Ra=function(a){return a.currentStyle},Sa=function(a,b,c){var d,e,f,g,h=a.style;return c=c||Ra(a),g=c?c[b]:void 0,null==g&&h&&h[b]&&(g=h[b]),Oa.test(g)&&!Ta.test(b)&&(d=h.left,e=a.runtimeStyle,f=e&&e.left,f&&(e.left=a.currentStyle.left),h.left="fontSize"===b?"1em":g,g=h.pixelLeft+"px",h.left=d,f&&(e.left=f)),void 0===g?g:g+""||"auto"});function Ua(a,b){return{get:function(){return a()?void delete this.get:(this.get=b).apply(this,arguments)}}}var Va=/alpha\([^)]*\)/i,Wa=/opacity\s*=\s*([^)]*)/i,Xa=/^(none|table(?!-c[ea]).+)/,Ya=new RegExp("^("+T+")(.*)$","i"),Za={position:"absolute",visibility:"hidden",display:"block"},$a={letterSpacing:"0",fontWeight:"400"},_a=["Webkit","O","Moz","ms"],ab=d.createElement("div").style;function bb(a){if(a in ab)return a;var b=a.charAt(0).toUpperCase()+a.slice(1),c=_a.length;while(c--)if(a=_a[c]+b,a in ab)return a}function cb(a,b){for(var c,d,e,f=[],g=0,h=a.length;h>g;g++)d=a[g],d.style&&(f[g]=n._data(d,"olddisplay"),c=d.style.display,b?(f[g]||"none"!==c||(d.style.display=""),""===d.style.display&&W(d)&&(f[g]=n._data(d,"olddisplay",Ma(d.nodeName)))):(e=W(d),(c&&"none"!==c||!e)&&n._data(d,"olddisplay",e?c:n.css(d,"display"))));for(g=0;h>g;g++)d=a[g],d.style&&(b&&"none"!==d.style.display&&""!==d.style.display||(d.style.display=b?f[g]||"":"none"));return a}function db(a,b,c){var d=Ya.exec(b);return d?Math.max(0,d[1]-(c||0))+(d[2]||"px"):b}function eb(a,b,c,d,e){for(var f=c===(d?"border":"content")?4:"width"===b?1:0,g=0;4>f;f+=2)"margin"===c&&(g+=n.css(a,c+V[f],!0,e)),d?("content"===c&&(g-=n.css(a,"padding"+V[f],!0,e)),"margin"!==c&&(g-=n.css(a,"border"+V[f]+"Width",!0,e))):(g+=n.css(a,"padding"+V[f],!0,e),"padding"!==c&&(g+=n.css(a,"border"+V[f]+"Width",!0,e)));return g}function fb(a,b,c){var d=!0,e="width"===b?a.offsetWidth:a.offsetHeight,f=Ra(a),g=l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,f);if(0>=e||null==e){if(e=Sa(a,b,f),(0>e||null==e)&&(e=a.style[b]),Oa.test(e))return e;d=g&&(l.boxSizingReliable()||e===a.style[b]),e=parseFloat(e)||0}return e+eb(a,b,c||(g?"border":"content"),d,f)+"px"}n.extend({cssHooks:{opacity:{get:function(a,b){if(b){var c=Sa(a,"opacity");return""===c?"1":c}}}},cssNumber:{animationIterationCount:!0,columnCount:!0,fillOpacity:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":l.cssFloat?"cssFloat":"styleFloat"},style:function(a,b,c,d){if(a&&3!==a.nodeType&&8!==a.nodeType&&a.style){var e,f,g,h=n.camelCase(b),i=a.style;if(b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],void 0===c)return g&&"get"in g&&void 0!==(e=g.get(a,!1,d))?e:i[b];if(f=typeof c,"string"===f&&(e=U.exec(c))&&e[1]&&(c=X(a,b,e),f="number"),null!=c&&c===c&&("number"===f&&(c+=e&&e[3]||(n.cssNumber[h]?"":"px")),l.clearCloneStyle||""!==c||0!==b.indexOf("background")||(i[b]="inherit"),!(g&&"set"in g&&void 0===(c=g.set(a,c,d)))))try{i[b]=c}catch(j){}}},css:function(a,b,c,d){var e,f,g,h=n.camelCase(b);return b=n.cssProps[h]||(n.cssProps[h]=bb(h)||h),g=n.cssHooks[b]||n.cssHooks[h],g&&"get"in g&&(f=g.get(a,!0,c)),void 0===f&&(f=Sa(a,b,d)),"normal"===f&&b in $a&&(f=$a[b]),""===c||c?(e=parseFloat(f),c===!0||isFinite(e)?e||0:f):f}}),n.each(["height","width"],function(a,b){n.cssHooks[b]={get:function(a,c,d){return c?Xa.test(n.css(a,"display"))&&0===a.offsetWidth?Pa(a,Za,function(){return fb(a,b,d)}):fb(a,b,d):void 0},set:function(a,c,d){var e=d&&Ra(a);return db(a,c,d?eb(a,b,d,l.boxSizing&&"border-box"===n.css(a,"boxSizing",!1,e),e):0)}}}),l.opacity||(n.cssHooks.opacity={get:function(a,b){return Wa.test((b&&a.currentStyle?a.currentStyle.filter:a.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":b?"1":""},set:function(a,b){var c=a.style,d=a.currentStyle,e=n.isNumeric(b)?"alpha(opacity="+100*b+")":"",f=d&&d.filter||c.filter||"";c.zoom=1,(b>=1||""===b)&&""===n.trim(f.replace(Va,""))&&c.removeAttribute&&(c.removeAttribute("filter"),""===b||d&&!d.filter)||(c.filter=Va.test(f)?f.replace(Va,e):f+" "+e)}}),n.cssHooks.marginRight=Ua(l.reliableMarginRight,function(a,b){return b?Pa(a,{display:"inline-block"},Sa,[a,"marginRight"]):void 0}),n.cssHooks.marginLeft=Ua(l.reliableMarginLeft,function(a,b){return b?(parseFloat(Sa(a,"marginLeft"))||(n.contains(a.ownerDocument,a)?a.getBoundingClientRect().left-Pa(a,{
marginLeft:0},function(){return a.getBoundingClientRect().left}):0))+"px":void 0}),n.each({margin:"",padding:"",border:"Width"},function(a,b){n.cssHooks[a+b]={expand:function(c){for(var d=0,e={},f="string"==typeof c?c.split(" "):[c];4>d;d++)e[a+V[d]+b]=f[d]||f[d-2]||f[0];return e}},Na.test(a)||(n.cssHooks[a+b].set=db)}),n.fn.extend({css:function(a,b){return Y(this,function(a,b,c){var d,e,f={},g=0;if(n.isArray(b)){for(d=Ra(a),e=b.length;e>g;g++)f[b[g]]=n.css(a,b[g],!1,d);return f}return void 0!==c?n.style(a,b,c):n.css(a,b)},a,b,arguments.length>1)},show:function(){return cb(this,!0)},hide:function(){return cb(this)},toggle:function(a){return"boolean"==typeof a?a?this.show():this.hide():this.each(function(){W(this)?n(this).show():n(this).hide()})}});function gb(a,b,c,d,e){return new gb.prototype.init(a,b,c,d,e)}n.Tween=gb,gb.prototype={constructor:gb,init:function(a,b,c,d,e,f){this.elem=a,this.prop=c,this.easing=e||n.easing._default,this.options=b,this.start=this.now=this.cur(),this.end=d,this.unit=f||(n.cssNumber[c]?"":"px")},cur:function(){var a=gb.propHooks[this.prop];return a&&a.get?a.get(this):gb.propHooks._default.get(this)},run:function(a){var b,c=gb.propHooks[this.prop];return this.options.duration?this.pos=b=n.easing[this.easing](a,this.options.duration*a,0,1,this.options.duration):this.pos=b=a,this.now=(this.end-this.start)*b+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),c&&c.set?c.set(this):gb.propHooks._default.set(this),this}},gb.prototype.init.prototype=gb.prototype,gb.propHooks={_default:{get:function(a){var b;return 1!==a.elem.nodeType||null!=a.elem[a.prop]&&null==a.elem.style[a.prop]?a.elem[a.prop]:(b=n.css(a.elem,a.prop,""),b&&"auto"!==b?b:0)},set:function(a){n.fx.step[a.prop]?n.fx.step[a.prop](a):1!==a.elem.nodeType||null==a.elem.style[n.cssProps[a.prop]]&&!n.cssHooks[a.prop]?a.elem[a.prop]=a.now:n.style(a.elem,a.prop,a.now+a.unit)}}},gb.propHooks.scrollTop=gb.propHooks.scrollLeft={set:function(a){a.elem.nodeType&&a.elem.parentNode&&(a.elem[a.prop]=a.now)}},n.easing={linear:function(a){return a},swing:function(a){return.5-Math.cos(a*Math.PI)/2},_default:"swing"},n.fx=gb.prototype.init,n.fx.step={};var hb,ib,jb=/^(?:toggle|show|hide)$/,kb=/queueHooks$/;function lb(){return a.setTimeout(function(){hb=void 0}),hb=n.now()}function mb(a,b){var c,d={height:a},e=0;for(b=b?1:0;4>e;e+=2-b)c=V[e],d["margin"+c]=d["padding"+c]=a;return b&&(d.opacity=d.width=a),d}function nb(a,b,c){for(var d,e=(qb.tweeners[b]||[]).concat(qb.tweeners["*"]),f=0,g=e.length;g>f;f++)if(d=e[f].call(c,b,a))return d}function ob(a,b,c){var d,e,f,g,h,i,j,k,m=this,o={},p=a.style,q=a.nodeType&&W(a),r=n._data(a,"fxshow");c.queue||(h=n._queueHooks(a,"fx"),null==h.unqueued&&(h.unqueued=0,i=h.empty.fire,h.empty.fire=function(){h.unqueued||i()}),h.unqueued++,m.always(function(){m.always(function(){h.unqueued--,n.queue(a,"fx").length||h.empty.fire()})})),1===a.nodeType&&("height"in b||"width"in b)&&(c.overflow=[p.overflow,p.overflowX,p.overflowY],j=n.css(a,"display"),k="none"===j?n._data(a,"olddisplay")||Ma(a.nodeName):j,"inline"===k&&"none"===n.css(a,"float")&&(l.inlineBlockNeedsLayout&&"inline"!==Ma(a.nodeName)?p.zoom=1:p.display="inline-block")),c.overflow&&(p.overflow="hidden",l.shrinkWrapBlocks()||m.always(function(){p.overflow=c.overflow[0],p.overflowX=c.overflow[1],p.overflowY=c.overflow[2]}));for(d in b)if(e=b[d],jb.exec(e)){if(delete b[d],f=f||"toggle"===e,e===(q?"hide":"show")){if("show"!==e||!r||void 0===r[d])continue;q=!0}o[d]=r&&r[d]||n.style(a,d)}else j=void 0;if(n.isEmptyObject(o))"inline"===("none"===j?Ma(a.nodeName):j)&&(p.display=j);else{r?"hidden"in r&&(q=r.hidden):r=n._data(a,"fxshow",{}),f&&(r.hidden=!q),q?n(a).show():m.done(function(){n(a).hide()}),m.done(function(){var b;n._removeData(a,"fxshow");for(b in o)n.style(a,b,o[b])});for(d in o)g=nb(q?r[d]:0,d,m),d in r||(r[d]=g.start,q&&(g.end=g.start,g.start="width"===d||"height"===d?1:0))}}function pb(a,b){var c,d,e,f,g;for(c in a)if(d=n.camelCase(c),e=b[d],f=a[c],n.isArray(f)&&(e=f[1],f=a[c]=f[0]),c!==d&&(a[d]=f,delete a[c]),g=n.cssHooks[d],g&&"expand"in g){f=g.expand(f),delete a[d];for(c in f)c in a||(a[c]=f[c],b[c]=e)}else b[d]=e}function qb(a,b,c){var d,e,f=0,g=qb.prefilters.length,h=n.Deferred().always(function(){delete i.elem}),i=function(){if(e)return!1;for(var b=hb||lb(),c=Math.max(0,j.startTime+j.duration-b),d=c/j.duration||0,f=1-d,g=0,i=j.tweens.length;i>g;g++)j.tweens[g].run(f);return h.notifyWith(a,[j,f,c]),1>f&&i?c:(h.resolveWith(a,[j]),!1)},j=h.promise({elem:a,props:n.extend({},b),opts:n.extend(!0,{specialEasing:{},easing:n.easing._default},c),originalProperties:b,originalOptions:c,startTime:hb||lb(),duration:c.duration,tweens:[],createTween:function(b,c){var d=n.Tween(a,j.opts,b,c,j.opts.specialEasing[b]||j.opts.easing);return j.tweens.push(d),d},stop:function(b){var c=0,d=b?j.tweens.length:0;if(e)return this;for(e=!0;d>c;c++)j.tweens[c].run(1);return b?(h.notifyWith(a,[j,1,0]),h.resolveWith(a,[j,b])):h.rejectWith(a,[j,b]),this}}),k=j.props;for(pb(k,j.opts.specialEasing);g>f;f++)if(d=qb.prefilters[f].call(j,a,k,j.opts))return n.isFunction(d.stop)&&(n._queueHooks(j.elem,j.opts.queue).stop=n.proxy(d.stop,d)),d;return n.map(k,nb,j),n.isFunction(j.opts.start)&&j.opts.start.call(a,j),n.fx.timer(n.extend(i,{elem:a,anim:j,queue:j.opts.queue})),j.progress(j.opts.progress).done(j.opts.done,j.opts.complete).fail(j.opts.fail).always(j.opts.always)}n.Animation=n.extend(qb,{tweeners:{"*":[function(a,b){var c=this.createTween(a,b);return X(c.elem,a,U.exec(b),c),c}]},tweener:function(a,b){n.isFunction(a)?(b=a,a=["*"]):a=a.match(G);for(var c,d=0,e=a.length;e>d;d++)c=a[d],qb.tweeners[c]=qb.tweeners[c]||[],qb.tweeners[c].unshift(b)},prefilters:[ob],prefilter:function(a,b){b?qb.prefilters.unshift(a):qb.prefilters.push(a)}}),n.speed=function(a,b,c){var d=a&&"object"==typeof a?n.extend({},a):{complete:c||!c&&b||n.isFunction(a)&&a,duration:a,easing:c&&b||b&&!n.isFunction(b)&&b};return d.duration=n.fx.off?0:"number"==typeof d.duration?d.duration:d.duration in n.fx.speeds?n.fx.speeds[d.duration]:n.fx.speeds._default,null!=d.queue&&d.queue!==!0||(d.queue="fx"),d.old=d.complete,d.complete=function(){n.isFunction(d.old)&&d.old.call(this),d.queue&&n.dequeue(this,d.queue)},d},n.fn.extend({fadeTo:function(a,b,c,d){return this.filter(W).css("opacity",0).show().end().animate({opacity:b},a,c,d)},animate:function(a,b,c,d){var e=n.isEmptyObject(a),f=n.speed(b,c,d),g=function(){var b=qb(this,n.extend({},a),f);(e||n._data(this,"finish"))&&b.stop(!0)};return g.finish=g,e||f.queue===!1?this.each(g):this.queue(f.queue,g)},stop:function(a,b,c){var d=function(a){var b=a.stop;delete a.stop,b(c)};return"string"!=typeof a&&(c=b,b=a,a=void 0),b&&a!==!1&&this.queue(a||"fx",[]),this.each(function(){var b=!0,e=null!=a&&a+"queueHooks",f=n.timers,g=n._data(this);if(e)g[e]&&g[e].stop&&d(g[e]);else for(e in g)g[e]&&g[e].stop&&kb.test(e)&&d(g[e]);for(e=f.length;e--;)f[e].elem!==this||null!=a&&f[e].queue!==a||(f[e].anim.stop(c),b=!1,f.splice(e,1));!b&&c||n.dequeue(this,a)})},finish:function(a){return a!==!1&&(a=a||"fx"),this.each(function(){var b,c=n._data(this),d=c[a+"queue"],e=c[a+"queueHooks"],f=n.timers,g=d?d.length:0;for(c.finish=!0,n.queue(this,a,[]),e&&e.stop&&e.stop.call(this,!0),b=f.length;b--;)f[b].elem===this&&f[b].queue===a&&(f[b].anim.stop(!0),f.splice(b,1));for(b=0;g>b;b++)d[b]&&d[b].finish&&d[b].finish.call(this);delete c.finish})}}),n.each(["toggle","show","hide"],function(a,b){var c=n.fn[b];n.fn[b]=function(a,d,e){return null==a||"boolean"==typeof a?c.apply(this,arguments):this.animate(mb(b,!0),a,d,e)}}),n.each({slideDown:mb("show"),slideUp:mb("hide"),slideToggle:mb("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(a,b){n.fn[a]=function(a,c,d){return this.animate(b,a,c,d)}}),n.timers=[],n.fx.tick=function(){var a,b=n.timers,c=0;for(hb=n.now();c<b.length;c++)a=b[c],a()||b[c]!==a||b.splice(c--,1);b.length||n.fx.stop(),hb=void 0},n.fx.timer=function(a){n.timers.push(a),a()?n.fx.start():n.timers.pop()},n.fx.interval=13,n.fx.start=function(){ib||(ib=a.setInterval(n.fx.tick,n.fx.interval))},n.fx.stop=function(){a.clearInterval(ib),ib=null},n.fx.speeds={slow:600,fast:200,_default:400},n.fn.delay=function(b,c){return b=n.fx?n.fx.speeds[b]||b:b,c=c||"fx",this.queue(c,function(c,d){var e=a.setTimeout(c,b);d.stop=function(){a.clearTimeout(e)}})},function(){var a,b=d.createElement("input"),c=d.createElement("div"),e=d.createElement("select"),f=e.appendChild(d.createElement("option"));c=d.createElement("div"),c.setAttribute("className","t"),c.innerHTML="  <link/><table></table><a href='/a'>a</a><input type='checkbox'/>",a=c.getElementsByTagName("a")[0],b.setAttribute("type","checkbox"),c.appendChild(b),a=c.getElementsByTagName("a")[0],a.style.cssText="top:1px",l.getSetAttribute="t"!==c.className,l.style=/top/.test(a.getAttribute("style")),l.hrefNormalized="/a"===a.getAttribute("href"),l.checkOn=!!b.value,l.optSelected=f.selected,l.enctype=!!d.createElement("form").enctype,e.disabled=!0,l.optDisabled=!f.disabled,b=d.createElement("input"),b.setAttribute("value",""),l.input=""===b.getAttribute("value"),b.value="t",b.setAttribute("type","radio"),l.radioValue="t"===b.value}();var rb=/\r/g,sb=/[\x20\t\r\n\f]+/g;n.fn.extend({val:function(a){var b,c,d,e=this[0];{if(arguments.length)return d=n.isFunction(a),this.each(function(c){var e;1===this.nodeType&&(e=d?a.call(this,c,n(this).val()):a,null==e?e="":"number"==typeof e?e+="":n.isArray(e)&&(e=n.map(e,function(a){return null==a?"":a+""})),b=n.valHooks[this.type]||n.valHooks[this.nodeName.toLowerCase()],b&&"set"in b&&void 0!==b.set(this,e,"value")||(this.value=e))});if(e)return b=n.valHooks[e.type]||n.valHooks[e.nodeName.toLowerCase()],b&&"get"in b&&void 0!==(c=b.get(e,"value"))?c:(c=e.value,"string"==typeof c?c.replace(rb,""):null==c?"":c)}}}),n.extend({valHooks:{option:{get:function(a){var b=n.find.attr(a,"value");return null!=b?b:n.trim(n.text(a)).replace(sb," ")}},select:{get:function(a){for(var b,c,d=a.options,e=a.selectedIndex,f="select-one"===a.type||0>e,g=f?null:[],h=f?e+1:d.length,i=0>e?h:f?e:0;h>i;i++)if(c=d[i],(c.selected||i===e)&&(l.optDisabled?!c.disabled:null===c.getAttribute("disabled"))&&(!c.parentNode.disabled||!n.nodeName(c.parentNode,"optgroup"))){if(b=n(c).val(),f)return b;g.push(b)}return g},set:function(a,b){var c,d,e=a.options,f=n.makeArray(b),g=e.length;while(g--)if(d=e[g],n.inArray(n.valHooks.option.get(d),f)>-1)try{d.selected=c=!0}catch(h){d.scrollHeight}else d.selected=!1;return c||(a.selectedIndex=-1),e}}}}),n.each(["radio","checkbox"],function(){n.valHooks[this]={set:function(a,b){return n.isArray(b)?a.checked=n.inArray(n(a).val(),b)>-1:void 0}},l.checkOn||(n.valHooks[this].get=function(a){return null===a.getAttribute("value")?"on":a.value})});var tb,ub,vb=n.expr.attrHandle,wb=/^(?:checked|selected)$/i,xb=l.getSetAttribute,yb=l.input;n.fn.extend({attr:function(a,b){return Y(this,n.attr,a,b,arguments.length>1)},removeAttr:function(a){return this.each(function(){n.removeAttr(this,a)})}}),n.extend({attr:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return"undefined"==typeof a.getAttribute?n.prop(a,b,c):(1===f&&n.isXMLDoc(a)||(b=b.toLowerCase(),e=n.attrHooks[b]||(n.expr.match.bool.test(b)?ub:tb)),void 0!==c?null===c?void n.removeAttr(a,b):e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:(a.setAttribute(b,c+""),c):e&&"get"in e&&null!==(d=e.get(a,b))?d:(d=n.find.attr(a,b),null==d?void 0:d))},attrHooks:{type:{set:function(a,b){if(!l.radioValue&&"radio"===b&&n.nodeName(a,"input")){var c=a.value;return a.setAttribute("type",b),c&&(a.value=c),b}}}},removeAttr:function(a,b){var c,d,e=0,f=b&&b.match(G);if(f&&1===a.nodeType)while(c=f[e++])d=n.propFix[c]||c,n.expr.match.bool.test(c)?yb&&xb||!wb.test(c)?a[d]=!1:a[n.camelCase("default-"+c)]=a[d]=!1:n.attr(a,c,""),a.removeAttribute(xb?c:d)}}),ub={set:function(a,b,c){return b===!1?n.removeAttr(a,c):yb&&xb||!wb.test(c)?a.setAttribute(!xb&&n.propFix[c]||c,c):a[n.camelCase("default-"+c)]=a[c]=!0,c}},n.each(n.expr.match.bool.source.match(/\w+/g),function(a,b){var c=vb[b]||n.find.attr;yb&&xb||!wb.test(b)?vb[b]=function(a,b,d){var e,f;return d||(f=vb[b],vb[b]=e,e=null!=c(a,b,d)?b.toLowerCase():null,vb[b]=f),e}:vb[b]=function(a,b,c){return c?void 0:a[n.camelCase("default-"+b)]?b.toLowerCase():null}}),yb&&xb||(n.attrHooks.value={set:function(a,b,c){return n.nodeName(a,"input")?void(a.defaultValue=b):tb&&tb.set(a,b,c)}}),xb||(tb={set:function(a,b,c){var d=a.getAttributeNode(c);return d||a.setAttributeNode(d=a.ownerDocument.createAttribute(c)),d.value=b+="","value"===c||b===a.getAttribute(c)?b:void 0}},vb.id=vb.name=vb.coords=function(a,b,c){var d;return c?void 0:(d=a.getAttributeNode(b))&&""!==d.value?d.value:null},n.valHooks.button={get:function(a,b){var c=a.getAttributeNode(b);return c&&c.specified?c.value:void 0},set:tb.set},n.attrHooks.contenteditable={set:function(a,b,c){tb.set(a,""===b?!1:b,c)}},n.each(["width","height"],function(a,b){n.attrHooks[b]={set:function(a,c){return""===c?(a.setAttribute(b,"auto"),c):void 0}}})),l.style||(n.attrHooks.style={get:function(a){return a.style.cssText||void 0},set:function(a,b){return a.style.cssText=b+""}});var zb=/^(?:input|select|textarea|button|object)$/i,Ab=/^(?:a|area)$/i;n.fn.extend({prop:function(a,b){return Y(this,n.prop,a,b,arguments.length>1)},removeProp:function(a){return a=n.propFix[a]||a,this.each(function(){try{this[a]=void 0,delete this[a]}catch(b){}})}}),n.extend({prop:function(a,b,c){var d,e,f=a.nodeType;if(3!==f&&8!==f&&2!==f)return 1===f&&n.isXMLDoc(a)||(b=n.propFix[b]||b,e=n.propHooks[b]),void 0!==c?e&&"set"in e&&void 0!==(d=e.set(a,c,b))?d:a[b]=c:e&&"get"in e&&null!==(d=e.get(a,b))?d:a[b]},propHooks:{tabIndex:{get:function(a){var b=n.find.attr(a,"tabindex");return b?parseInt(b,10):zb.test(a.nodeName)||Ab.test(a.nodeName)&&a.href?0:-1}}},propFix:{"for":"htmlFor","class":"className"}}),l.hrefNormalized||n.each(["href","src"],function(a,b){n.propHooks[b]={get:function(a){return a.getAttribute(b,4)}}}),l.optSelected||(n.propHooks.selected={get:function(a){var b=a.parentNode;return b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex),null},set:function(a){var b=a.parentNode;b&&(b.selectedIndex,b.parentNode&&b.parentNode.selectedIndex)}}),n.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){n.propFix[this.toLowerCase()]=this}),l.enctype||(n.propFix.enctype="encoding");var Bb=/[\t\r\n\f]/g;function Cb(a){return n.attr(a,"class")||""}n.fn.extend({addClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).addClass(a.call(this,b,Cb(this)))});if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])d.indexOf(" "+f+" ")<0&&(d+=f+" ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},removeClass:function(a){var b,c,d,e,f,g,h,i=0;if(n.isFunction(a))return this.each(function(b){n(this).removeClass(a.call(this,b,Cb(this)))});if(!arguments.length)return this.attr("class","");if("string"==typeof a&&a){b=a.match(G)||[];while(c=this[i++])if(e=Cb(c),d=1===c.nodeType&&(" "+e+" ").replace(Bb," ")){g=0;while(f=b[g++])while(d.indexOf(" "+f+" ")>-1)d=d.replace(" "+f+" "," ");h=n.trim(d),e!==h&&n.attr(c,"class",h)}}return this},toggleClass:function(a,b){var c=typeof a;return"boolean"==typeof b&&"string"===c?b?this.addClass(a):this.removeClass(a):n.isFunction(a)?this.each(function(c){n(this).toggleClass(a.call(this,c,Cb(this),b),b)}):this.each(function(){var b,d,e,f;if("string"===c){d=0,e=n(this),f=a.match(G)||[];while(b=f[d++])e.hasClass(b)?e.removeClass(b):e.addClass(b)}else void 0!==a&&"boolean"!==c||(b=Cb(this),b&&n._data(this,"__className__",b),n.attr(this,"class",b||a===!1?"":n._data(this,"__className__")||""))})},hasClass:function(a){var b,c,d=0;b=" "+a+" ";while(c=this[d++])if(1===c.nodeType&&(" "+Cb(c)+" ").replace(Bb," ").indexOf(b)>-1)return!0;return!1}}),n.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(a,b){n.fn[b]=function(a,c){return arguments.length>0?this.on(b,null,a,c):this.trigger(b)}}),n.fn.extend({hover:function(a,b){return this.mouseenter(a).mouseleave(b||a)}});var Db=a.location,Eb=n.now(),Fb=/\?/,Gb=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;n.parseJSON=function(b){if(a.JSON&&a.JSON.parse)return a.JSON.parse(b+"");var c,d=null,e=n.trim(b+"");return e&&!n.trim(e.replace(Gb,function(a,b,e,f){return c&&b&&(d=0),0===d?a:(c=e||b,d+=!f-!e,"")}))?Function("return "+e)():n.error("Invalid JSON: "+b)},n.parseXML=function(b){var c,d;if(!b||"string"!=typeof b)return null;try{a.DOMParser?(d=new a.DOMParser,c=d.parseFromString(b,"text/xml")):(c=new a.ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(b))}catch(e){c=void 0}return c&&c.documentElement&&!c.getElementsByTagName("parsererror").length||n.error("Invalid XML: "+b),c};var Hb=/#.*$/,Ib=/([?&])_=[^&]*/,Jb=/^(.*?):[ \t]*([^\r\n]*)\r?$/gm,Kb=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,Lb=/^(?:GET|HEAD)$/,Mb=/^\/\//,Nb=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,Ob={},Pb={},Qb="*/".concat("*"),Rb=Db.href,Sb=Nb.exec(Rb.toLowerCase())||[];function Tb(a){return function(b,c){"string"!=typeof b&&(c=b,b="*");var d,e=0,f=b.toLowerCase().match(G)||[];if(n.isFunction(c))while(d=f[e++])"+"===d.charAt(0)?(d=d.slice(1)||"*",(a[d]=a[d]||[]).unshift(c)):(a[d]=a[d]||[]).push(c)}}function Ub(a,b,c,d){var e={},f=a===Pb;function g(h){var i;return e[h]=!0,n.each(a[h]||[],function(a,h){var j=h(b,c,d);return"string"!=typeof j||f||e[j]?f?!(i=j):void 0:(b.dataTypes.unshift(j),g(j),!1)}),i}return g(b.dataTypes[0])||!e["*"]&&g("*")}function Vb(a,b){var c,d,e=n.ajaxSettings.flatOptions||{};for(d in b)void 0!==b[d]&&((e[d]?a:c||(c={}))[d]=b[d]);return c&&n.extend(!0,a,c),a}function Wb(a,b,c){var d,e,f,g,h=a.contents,i=a.dataTypes;while("*"===i[0])i.shift(),void 0===e&&(e=a.mimeType||b.getResponseHeader("Content-Type"));if(e)for(g in h)if(h[g]&&h[g].test(e)){i.unshift(g);break}if(i[0]in c)f=i[0];else{for(g in c){if(!i[0]||a.converters[g+" "+i[0]]){f=g;break}d||(d=g)}f=f||d}return f?(f!==i[0]&&i.unshift(f),c[f]):void 0}function Xb(a,b,c,d){var e,f,g,h,i,j={},k=a.dataTypes.slice();if(k[1])for(g in a.converters)j[g.toLowerCase()]=a.converters[g];f=k.shift();while(f)if(a.responseFields[f]&&(c[a.responseFields[f]]=b),!i&&d&&a.dataFilter&&(b=a.dataFilter(b,a.dataType)),i=f,f=k.shift())if("*"===f)f=i;else if("*"!==i&&i!==f){if(g=j[i+" "+f]||j["* "+f],!g)for(e in j)if(h=e.split(" "),h[1]===f&&(g=j[i+" "+h[0]]||j["* "+h[0]])){g===!0?g=j[e]:j[e]!==!0&&(f=h[0],k.unshift(h[1]));break}if(g!==!0)if(g&&a["throws"])b=g(b);else try{b=g(b)}catch(l){return{state:"parsererror",error:g?l:"No conversion from "+i+" to "+f}}}return{state:"success",data:b}}n.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:Rb,type:"GET",isLocal:Kb.test(Sb[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":Qb,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":n.parseJSON,"text xml":n.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(a,b){return b?Vb(Vb(a,n.ajaxSettings),b):Vb(n.ajaxSettings,a)},ajaxPrefilter:Tb(Ob),ajaxTransport:Tb(Pb),ajax:function(b,c){"object"==typeof b&&(c=b,b=void 0),c=c||{};var d,e,f,g,h,i,j,k,l=n.ajaxSetup({},c),m=l.context||l,o=l.context&&(m.nodeType||m.jquery)?n(m):n.event,p=n.Deferred(),q=n.Callbacks("once memory"),r=l.statusCode||{},s={},t={},u=0,v="canceled",w={readyState:0,getResponseHeader:function(a){var b;if(2===u){if(!k){k={};while(b=Jb.exec(g))k[b[1].toLowerCase()]=b[2]}b=k[a.toLowerCase()]}return null==b?null:b},getAllResponseHeaders:function(){return 2===u?g:null},setRequestHeader:function(a,b){var c=a.toLowerCase();return u||(a=t[c]=t[c]||a,s[a]=b),this},overrideMimeType:function(a){return u||(l.mimeType=a),this},statusCode:function(a){var b;if(a)if(2>u)for(b in a)r[b]=[r[b],a[b]];else w.always(a[w.status]);return this},abort:function(a){var b=a||v;return j&&j.abort(b),y(0,b),this}};if(p.promise(w).complete=q.add,w.success=w.done,w.error=w.fail,l.url=((b||l.url||Rb)+"").replace(Hb,"").replace(Mb,Sb[1]+"//"),l.type=c.method||c.type||l.method||l.type,l.dataTypes=n.trim(l.dataType||"*").toLowerCase().match(G)||[""],null==l.crossDomain&&(d=Nb.exec(l.url.toLowerCase()),l.crossDomain=!(!d||d[1]===Sb[1]&&d[2]===Sb[2]&&(d[3]||("http:"===d[1]?"80":"443"))===(Sb[3]||("http:"===Sb[1]?"80":"443")))),l.data&&l.processData&&"string"!=typeof l.data&&(l.data=n.param(l.data,l.traditional)),Ub(Ob,l,c,w),2===u)return w;i=n.event&&l.global,i&&0===n.active++&&n.event.trigger("ajaxStart"),l.type=l.type.toUpperCase(),l.hasContent=!Lb.test(l.type),f=l.url,l.hasContent||(l.data&&(f=l.url+=(Fb.test(f)?"&":"?")+l.data,delete l.data),l.cache===!1&&(l.url=Ib.test(f)?f.replace(Ib,"$1_="+Eb++):f+(Fb.test(f)?"&":"?")+"_="+Eb++)),l.ifModified&&(n.lastModified[f]&&w.setRequestHeader("If-Modified-Since",n.lastModified[f]),n.etag[f]&&w.setRequestHeader("If-None-Match",n.etag[f])),(l.data&&l.hasContent&&l.contentType!==!1||c.contentType)&&w.setRequestHeader("Content-Type",l.contentType),w.setRequestHeader("Accept",l.dataTypes[0]&&l.accepts[l.dataTypes[0]]?l.accepts[l.dataTypes[0]]+("*"!==l.dataTypes[0]?", "+Qb+"; q=0.01":""):l.accepts["*"]);for(e in l.headers)w.setRequestHeader(e,l.headers[e]);if(l.beforeSend&&(l.beforeSend.call(m,w,l)===!1||2===u))return w.abort();v="abort";for(e in{success:1,error:1,complete:1})w[e](l[e]);if(j=Ub(Pb,l,c,w)){if(w.readyState=1,i&&o.trigger("ajaxSend",[w,l]),2===u)return w;l.async&&l.timeout>0&&(h=a.setTimeout(function(){w.abort("timeout")},l.timeout));try{u=1,j.send(s,y)}catch(x){if(!(2>u))throw x;y(-1,x)}}else y(-1,"No Transport");function y(b,c,d,e){var k,s,t,v,x,y=c;2!==u&&(u=2,h&&a.clearTimeout(h),j=void 0,g=e||"",w.readyState=b>0?4:0,k=b>=200&&300>b||304===b,d&&(v=Wb(l,w,d)),v=Xb(l,v,w,k),k?(l.ifModified&&(x=w.getResponseHeader("Last-Modified"),x&&(n.lastModified[f]=x),x=w.getResponseHeader("etag"),x&&(n.etag[f]=x)),204===b||"HEAD"===l.type?y="nocontent":304===b?y="notmodified":(y=v.state,s=v.data,t=v.error,k=!t)):(t=y,!b&&y||(y="error",0>b&&(b=0))),w.status=b,w.statusText=(c||y)+"",k?p.resolveWith(m,[s,y,w]):p.rejectWith(m,[w,y,t]),w.statusCode(r),r=void 0,i&&o.trigger(k?"ajaxSuccess":"ajaxError",[w,l,k?s:t]),q.fireWith(m,[w,y]),i&&(o.trigger("ajaxComplete",[w,l]),--n.active||n.event.trigger("ajaxStop")))}return w},getJSON:function(a,b,c){return n.get(a,b,c,"json")},getScript:function(a,b){return n.get(a,void 0,b,"script")}}),n.each(["get","post"],function(a,b){n[b]=function(a,c,d,e){return n.isFunction(c)&&(e=e||d,d=c,c=void 0),n.ajax(n.extend({url:a,type:b,dataType:e,data:c,success:d},n.isPlainObject(a)&&a))}}),n._evalUrl=function(a){return n.ajax({url:a,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,"throws":!0})},n.fn.extend({wrapAll:function(a){if(n.isFunction(a))return this.each(function(b){n(this).wrapAll(a.call(this,b))});if(this[0]){var b=n(a,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&b.insertBefore(this[0]),b.map(function(){var a=this;while(a.firstChild&&1===a.firstChild.nodeType)a=a.firstChild;return a}).append(this)}return this},wrapInner:function(a){return n.isFunction(a)?this.each(function(b){n(this).wrapInner(a.call(this,b))}):this.each(function(){var b=n(this),c=b.contents();c.length?c.wrapAll(a):b.append(a)})},wrap:function(a){var b=n.isFunction(a);return this.each(function(c){n(this).wrapAll(b?a.call(this,c):a)})},unwrap:function(){return this.parent().each(function(){n.nodeName(this,"body")||n(this).replaceWith(this.childNodes)}).end()}});function Yb(a){return a.style&&a.style.display||n.css(a,"display")}function Zb(a){if(!n.contains(a.ownerDocument||d,a))return!0;while(a&&1===a.nodeType){if("none"===Yb(a)||"hidden"===a.type)return!0;a=a.parentNode}return!1}n.expr.filters.hidden=function(a){return l.reliableHiddenOffsets()?a.offsetWidth<=0&&a.offsetHeight<=0&&!a.getClientRects().length:Zb(a)},n.expr.filters.visible=function(a){return!n.expr.filters.hidden(a)};var $b=/%20/g,_b=/\[\]$/,ac=/\r?\n/g,bc=/^(?:submit|button|image|reset|file)$/i,cc=/^(?:input|select|textarea|keygen)/i;function dc(a,b,c,d){var e;if(n.isArray(b))n.each(b,function(b,e){c||_b.test(a)?d(a,e):dc(a+"["+("object"==typeof e&&null!=e?b:"")+"]",e,c,d)});else if(c||"object"!==n.type(b))d(a,b);else for(e in b)dc(a+"["+e+"]",b[e],c,d)}n.param=function(a,b){var c,d=[],e=function(a,b){b=n.isFunction(b)?b():null==b?"":b,d[d.length]=encodeURIComponent(a)+"="+encodeURIComponent(b)};if(void 0===b&&(b=n.ajaxSettings&&n.ajaxSettings.traditional),n.isArray(a)||a.jquery&&!n.isPlainObject(a))n.each(a,function(){e(this.name,this.value)});else for(c in a)dc(c,a[c],b,e);return d.join("&").replace($b,"+")},n.fn.extend({serialize:function(){return n.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var a=n.prop(this,"elements");return a?n.makeArray(a):this}).filter(function(){var a=this.type;return this.name&&!n(this).is(":disabled")&&cc.test(this.nodeName)&&!bc.test(a)&&(this.checked||!Z.test(a))}).map(function(a,b){var c=n(this).val();return null==c?null:n.isArray(c)?n.map(c,function(a){return{name:b.name,value:a.replace(ac,"\r\n")}}):{name:b.name,value:c.replace(ac,"\r\n")}}).get()}}),n.ajaxSettings.xhr=void 0!==a.ActiveXObject?function(){return this.isLocal?ic():d.documentMode>8?hc():/^(get|post|head|put|delete|options)$/i.test(this.type)&&hc()||ic()}:hc;var ec=0,fc={},gc=n.ajaxSettings.xhr();a.attachEvent&&a.attachEvent("onunload",function(){for(var a in fc)fc[a](void 0,!0)}),l.cors=!!gc&&"withCredentials"in gc,gc=l.ajax=!!gc,gc&&n.ajaxTransport(function(b){if(!b.crossDomain||l.cors){var c;return{send:function(d,e){var f,g=b.xhr(),h=++ec;if(g.open(b.type,b.url,b.async,b.username,b.password),b.xhrFields)for(f in b.xhrFields)g[f]=b.xhrFields[f];b.mimeType&&g.overrideMimeType&&g.overrideMimeType(b.mimeType),b.crossDomain||d["X-Requested-With"]||(d["X-Requested-With"]="XMLHttpRequest");for(f in d)void 0!==d[f]&&g.setRequestHeader(f,d[f]+"");g.send(b.hasContent&&b.data||null),c=function(a,d){var f,i,j;if(c&&(d||4===g.readyState))if(delete fc[h],c=void 0,g.onreadystatechange=n.noop,d)4!==g.readyState&&g.abort();else{j={},f=g.status,"string"==typeof g.responseText&&(j.text=g.responseText);try{i=g.statusText}catch(k){i=""}f||!b.isLocal||b.crossDomain?1223===f&&(f=204):f=j.text?200:404}j&&e(f,i,j,g.getAllResponseHeaders())},b.async?4===g.readyState?a.setTimeout(c):g.onreadystatechange=fc[h]=c:c()},abort:function(){c&&c(void 0,!0)}}}});function hc(){try{return new a.XMLHttpRequest}catch(b){}}function ic(){try{return new a.ActiveXObject("Microsoft.XMLHTTP")}catch(b){}}n.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(a){return n.globalEval(a),a}}}),n.ajaxPrefilter("script",function(a){void 0===a.cache&&(a.cache=!1),a.crossDomain&&(a.type="GET",a.global=!1)}),n.ajaxTransport("script",function(a){if(a.crossDomain){var b,c=d.head||n("head")[0]||d.documentElement;return{send:function(e,f){b=d.createElement("script"),b.async=!0,a.scriptCharset&&(b.charset=a.scriptCharset),b.src=a.url,b.onload=b.onreadystatechange=function(a,c){(c||!b.readyState||/loaded|complete/.test(b.readyState))&&(b.onload=b.onreadystatechange=null,b.parentNode&&b.parentNode.removeChild(b),b=null,c||f(200,"success"))},c.insertBefore(b,c.firstChild)},abort:function(){b&&b.onload(void 0,!0)}}}});var jc=[],kc=/(=)\?(?=&|$)|\?\?/;n.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var a=jc.pop()||n.expando+"_"+Eb++;return this[a]=!0,a}}),n.ajaxPrefilter("json jsonp",function(b,c,d){var e,f,g,h=b.jsonp!==!1&&(kc.test(b.url)?"url":"string"==typeof b.data&&0===(b.contentType||"").indexOf("application/x-www-form-urlencoded")&&kc.test(b.data)&&"data");return h||"jsonp"===b.dataTypes[0]?(e=b.jsonpCallback=n.isFunction(b.jsonpCallback)?b.jsonpCallback():b.jsonpCallback,h?b[h]=b[h].replace(kc,"$1"+e):b.jsonp!==!1&&(b.url+=(Fb.test(b.url)?"&":"?")+b.jsonp+"="+e),b.converters["script json"]=function(){return g||n.error(e+" was not called"),g[0]},b.dataTypes[0]="json",f=a[e],a[e]=function(){g=arguments},d.always(function(){void 0===f?n(a).removeProp(e):a[e]=f,b[e]&&(b.jsonpCallback=c.jsonpCallback,jc.push(e)),g&&n.isFunction(f)&&f(g[0]),g=f=void 0}),"script"):void 0}),n.parseHTML=function(a,b,c){if(!a||"string"!=typeof a)return null;"boolean"==typeof b&&(c=b,b=!1),b=b||d;var e=x.exec(a),f=!c&&[];return e?[b.createElement(e[1])]:(e=ja([a],b,f),f&&f.length&&n(f).remove(),n.merge([],e.childNodes))};var lc=n.fn.load;n.fn.load=function(a,b,c){if("string"!=typeof a&&lc)return lc.apply(this,arguments);var d,e,f,g=this,h=a.indexOf(" ");return h>-1&&(d=n.trim(a.slice(h,a.length)),a=a.slice(0,h)),n.isFunction(b)?(c=b,b=void 0):b&&"object"==typeof b&&(e="POST"),g.length>0&&n.ajax({url:a,type:e||"GET",dataType:"html",data:b}).done(function(a){f=arguments,g.html(d?n("<div>").append(n.parseHTML(a)).find(d):a)}).always(c&&function(a,b){g.each(function(){c.apply(this,f||[a.responseText,b,a])})}),this},n.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(a,b){n.fn[b]=function(a){return this.on(b,a)}}),n.expr.filters.animated=function(a){return n.grep(n.timers,function(b){return a===b.elem}).length};function mc(a){return n.isWindow(a)?a:9===a.nodeType?a.defaultView||a.parentWindow:!1}n.offset={setOffset:function(a,b,c){var d,e,f,g,h,i,j,k=n.css(a,"position"),l=n(a),m={};"static"===k&&(a.style.position="relative"),h=l.offset(),f=n.css(a,"top"),i=n.css(a,"left"),j=("absolute"===k||"fixed"===k)&&n.inArray("auto",[f,i])>-1,j?(d=l.position(),g=d.top,e=d.left):(g=parseFloat(f)||0,e=parseFloat(i)||0),n.isFunction(b)&&(b=b.call(a,c,n.extend({},h))),null!=b.top&&(m.top=b.top-h.top+g),null!=b.left&&(m.left=b.left-h.left+e),"using"in b?b.using.call(a,m):l.css(m)}},n.fn.extend({offset:function(a){if(arguments.length)return void 0===a?this:this.each(function(b){n.offset.setOffset(this,a,b)});var b,c,d={top:0,left:0},e=this[0],f=e&&e.ownerDocument;if(f)return b=f.documentElement,n.contains(b,e)?("undefined"!=typeof e.getBoundingClientRect&&(d=e.getBoundingClientRect()),c=mc(f),{top:d.top+(c.pageYOffset||b.scrollTop)-(b.clientTop||0),left:d.left+(c.pageXOffset||b.scrollLeft)-(b.clientLeft||0)}):d},position:function(){if(this[0]){var a,b,c={top:0,left:0},d=this[0];return"fixed"===n.css(d,"position")?b=d.getBoundingClientRect():(a=this.offsetParent(),b=this.offset(),n.nodeName(a[0],"html")||(c=a.offset()),c.top+=n.css(a[0],"borderTopWidth",!0),c.left+=n.css(a[0],"borderLeftWidth",!0)),{top:b.top-c.top-n.css(d,"marginTop",!0),left:b.left-c.left-n.css(d,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){var a=this.offsetParent;while(a&&!n.nodeName(a,"html")&&"static"===n.css(a,"position"))a=a.offsetParent;return a||Qa})}}),n.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(a,b){var c=/Y/.test(b);n.fn[a]=function(d){return Y(this,function(a,d,e){var f=mc(a);return void 0===e?f?b in f?f[b]:f.document.documentElement[d]:a[d]:void(f?f.scrollTo(c?n(f).scrollLeft():e,c?e:n(f).scrollTop()):a[d]=e)},a,d,arguments.length,null)}}),n.each(["top","left"],function(a,b){n.cssHooks[b]=Ua(l.pixelPosition,function(a,c){return c?(c=Sa(a,b),Oa.test(c)?n(a).position()[b]+"px":c):void 0})}),n.each({Height:"height",Width:"width"},function(a,b){n.each({
padding:"inner"+a,content:b,"":"outer"+a},function(c,d){n.fn[d]=function(d,e){var f=arguments.length&&(c||"boolean"!=typeof d),g=c||(d===!0||e===!0?"margin":"border");return Y(this,function(b,c,d){var e;return n.isWindow(b)?b.document.documentElement["client"+a]:9===b.nodeType?(e=b.documentElement,Math.max(b.body["scroll"+a],e["scroll"+a],b.body["offset"+a],e["offset"+a],e["client"+a])):void 0===d?n.css(b,c,g):n.style(b,c,d,g)},b,f?d:void 0,f,null)}})}),n.fn.extend({bind:function(a,b,c){return this.on(a,null,b,c)},unbind:function(a,b){return this.off(a,null,b)},delegate:function(a,b,c,d){return this.on(b,a,c,d)},undelegate:function(a,b,c){return 1===arguments.length?this.off(a,"**"):this.off(b,a||"**",c)}}),n.fn.size=function(){return this.length},n.fn.andSelf=n.fn.addBack,"function"==typeof define&&define.amd&&define("jquery",[],function(){return n});var nc=a.jQuery,oc=a.$;return n.noConflict=function(b){return a.$===n&&(a.$=oc),b&&a.jQuery===n&&(a.jQuery=nc),n},b||(a.jQuery=a.$=n),n});
</script>


<script type="text/javascript">
GlkOte=function(){var game_interface=null;var dom_context=undefined;var windowport_id='windowport';var gameport_id='gameport';var generation=0;var disabled=false;var loading_visible=null;var error_visible=false;var windowdic=null;var current_metrics=null;var current_devpixelratio=null;var currently_focussed=false;var last_known_focus=0;var last_known_paging=0;var windows_paging_count=0;var graphics_draw_queue=[];var resize_timer=null;var retry_timer=null;var perform_paging=true;var detect_external_links=false;var regex_external_links=null;var NBSP="\xa0";var max_buffer_length=200;var approx_scroll_width=20;var moreprompt_margin=2;var key_codes={KEY_BACKSPACE:8,KEY_TAB:9,KEY_RETURN:13,KEY_ESC:27,KEY_LEFT:37,KEY_UP:38,KEY_RIGHT:39,KEY_DOWN:40,KEY_DELETE:46,KEY_HOME:36,KEY_END:35,KEY_PAGEUP:33,KEY_PAGEDOWN:34,KEY_INSERT:45};var terminator_key_names={escape:key_codes.KEY_ESC,func1:112,func2:113,func3:114,func4:115,func5:116,func6:117,func7:118,func8:119,func9:120,func10:121,func11:122,func12:123};var terminator_key_values={};var recording=false;var recording_state=null;var recording_handler=null;var recording_handler_url=null;var recording_context={};var image_cache={};function glkote_init(iface){if(!iface&&window.Game)
iface=window.Game;if(!iface){glkote_error('No game interface object has been provided.');return;}
if(!iface.accept){glkote_error('The game interface object must have an accept() function.');return;}
game_interface=iface;if(!window.jQuery||!jQuery.fn.jquery){glkote_error('The jQuery library has not been loaded.');return;}
var version=jQuery.fn.jquery.split('.');if(version.length<2||version[0]<1||(version[0]==1&&version[1]<9)){glkote_error('This version of the jQuery library is too old. (Version '+jQuery.fn.jquery+' found; 1.9.0 required.)');return;}
for(var val in terminator_key_names){terminator_key_values[terminator_key_names[val]]=val;}
if(false){perform_paging=false;}
windowdic={};if(iface.windowport)
windowport_id=iface.windowport;if(iface.gameport)
gameport_id=iface.gameport;var el=$('#'+windowport_id,dom_context);if(!el.length){glkote_error('Cannot find windowport element #'+windowport_id+' in this document.');return;}
el.empty();if(perform_paging)
$(document).on('keypress',evhan_doc_keypress);$(window).on('resize',evhan_doc_resize);current_devpixelratio=window.devicePixelRatio||1;if(window.matchMedia){window.matchMedia('screen and (min-resolution: 1.5dppx)').addListener(evhan_doc_pixelreschange);window.matchMedia('screen and (min-resolution: 2dppx)').addListener(evhan_doc_pixelreschange);window.matchMedia('screen and (min-resolution: 3dppx)').addListener(evhan_doc_pixelreschange);window.matchMedia('screen and (min-resolution: 4dppx)').addListener(evhan_doc_pixelreschange);}
var res=measure_window();if(jQuery.type(res)==='string'){glkote_error(res);return;}
current_metrics=res;create_resize_sensors();detect_external_links=iface.detect_external_links;if(detect_external_links){regex_external_links=iface.regex_external_links;if(!regex_external_links){if(detect_external_links=='search'){regex_external_links=RegExp('\\b((?:https?://)(?:[^\\s()<>]+|\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\))+(?:\\(([^\\s()<>]+|(\\([^\\s()<>]+\\)))*\\)|[^\\s`!()\\[\\]{};:\'".,<>?\u00ab\u00bb\u201c\u201d\u2018\u2019]))','i');}
else{regex_external_links=RegExp('^https?:','i');}}}
if(iface.recording_url){recording=true;recording_handler=recording_standard_handler;recording_handler_url=iface.recording_url;}
if(iface.recording_handler){recording=true;recording_handler=iface.recording_handler;recording_handler_url='(custom handler)';}
if(recording){var qparams=get_query_params();var flag=qparams['feedback'];if(jQuery.type(flag)!='undefined'&&flag!='1'){recording=false;glkote_log('User has opted out of transcript recording.');}
else{recording_state={sessionId:(new Date().getTime())+""+(Math.ceil(Math.random()*10000)),input:null,output:null,timestamp:0,outtimestamp:0}
if(iface.recording_label)
recording_state.label=iface.recording_label;if(iface.recording_format=='simple')
recording_state.format='simple';else
recording_state.format='glkote';glkote_log('Transcript recording active: session '+recording_state.sessionId+' "'+recording_state.label+'", destination '+recording_handler_url);}}
send_response('init',null,current_metrics);}
function measure_window(){var metrics={};var winsize,line1size,line2size,spansize,canvassize;var gameport=$('#'+gameport_id,dom_context);if(!gameport.length)
return'Cannot find gameport element #'+gameport_id+' in this document.';$('#layouttestpane',dom_context).remove();metrics.width=gameport.width();metrics.height=gameport.height();metrics.width=gameport.width();metrics.height=gameport.height();var layout_test_pane=$('<div>',{'id':'layout_test_pane'});layout_test_pane.text('This should not be visible');layout_test_pane.css({position:'absolute',visibility:'hidden',left:'-1000px'});var line=$('<div>');line.append($('<span>',{'class':"Style_normal"}).text('12345678'));var gridwin=$('<div>',{'class':'WindowFrame GridWindow'});var gridline1=line.clone().addClass('GridLine').appendTo(gridwin);var gridline2=line.clone().addClass('GridLine').appendTo(gridwin);var gridspan=gridline1.children('span');layout_test_pane.append(gridwin);var bufwin=$('<div>',{'class':'WindowFrame BufferWindow'});var bufline1=line.clone().addClass('BufferLine').appendTo(bufwin);var bufline2=line.clone().addClass('BufferLine').appendTo(bufwin);var bufspan=bufline1.children('span');layout_test_pane.append(bufwin);var graphwin=$('<div>',{'class':'WindowFrame GraphicsWindow'});var graphcanvas=$('<canvas>');graphcanvas.attr('width',64);graphcanvas.attr('height',32);graphwin.append(graphcanvas);layout_test_pane.append(graphwin);gameport.append(layout_test_pane);var get_size=function(el){return{width:el.outerWidth(),height:el.outerHeight()};};winsize=get_size(gridwin);spansize=get_size(gridspan);line1size=get_size(gridline1);line2size=get_size(gridline2);metrics.gridcharheight=gridline2.position().top-gridline1.position().top;metrics.gridcharwidth=gridspan.width()/8;metrics.gridmarginx=winsize.width-spansize.width;metrics.gridmarginy=winsize.height-(line1size.height+line2size.height);winsize=get_size(bufwin);spansize=get_size(bufspan);line1size=get_size(bufline1);line2size=get_size(bufline2);metrics.buffercharheight=bufline2.position().top-bufline1.position().top;metrics.buffercharwidth=bufspan.width()/8;metrics.buffermarginx=winsize.width-spansize.width;metrics.buffermarginy=winsize.height-(line1size.height+line2size.height);winsize=get_size(graphwin);canvassize=get_size(graphcanvas);metrics.graphicsmarginx=winsize.width-canvassize.width;metrics.graphicsmarginy=winsize.height-canvassize.height;layout_test_pane.remove();metrics.outspacingx=0;metrics.outspacingy=0;metrics.inspacingx=0;metrics.inspacingy=0;if(game_interface.spacing!=undefined){metrics.outspacingx=game_interface.spacing;metrics.outspacingy=game_interface.spacing;metrics.inspacingx=game_interface.spacing;metrics.inspacingy=game_interface.spacing;}
if(game_interface.outspacing!=undefined){metrics.outspacingx=game_interface.outspacing;metrics.outspacingy=game_interface.outspacing;}
if(game_interface.inspacing!=undefined){metrics.inspacingx=game_interface.inspacing;metrics.inspacingy=game_interface.inspacing;}
if(game_interface.inspacingx!=undefined)
metrics.inspacingx=game_interface.inspacingx;if(game_interface.inspacingy!=undefined)
metrics.inspacingy=game_interface.inspacingy;if(game_interface.outspacingx!=undefined)
metrics.outspacingx=game_interface.outspacingx;if(game_interface.outspacingy!=undefined)
metrics.outspacingy=game_interface.outspacingy;return metrics;}
function create_resize_sensors(){var gameport=$('#'+gameport_id,dom_context);if(!gameport.length)
return'Cannot find gameport element #'+gameport_id+' in this document.';var shrinkel=$('<div>',{id:'resize-sensor-shrink'}).css({position:'absolute',left:'0',right:'0',top:'0',bottom:'0',overflow:'hidden',visibility:'hidden','z-index':'-1'});shrinkel.append($('<div>',{id:'resize-sensor-shrink-child'}).css({position:'absolute',left:'0',right:'0',width:'200%',height:'200%'}));var expandel=$('<div>',{id:'resize-sensor-expand'}).css({position:'absolute',left:'0',right:'0',top:'0',bottom:'0',overflow:'hidden',visibility:'hidden','z-index':'-1'});expandel.append($('<div>',{id:'resize-sensor-expand-child'}).css({position:'absolute',left:'0',right:'0'}));var shrinkdom=shrinkel.get(0);var expanddom=expandel.get(0);var expandchilddom=expanddom.childNodes[0];var reset=function(){shrinkdom.scrollLeft=100000;shrinkdom.scrollTop=100000;expandchilddom.style.width='100000px';expandchilddom.style.height='100000px';expanddom.scrollLeft=100000;expanddom.scrollTop=100000;}
gameport.append(shrinkel);gameport.append(expandel);reset();var evhan=function(ev){evhan_doc_resize(ev);reset();}
shrinkel.on('scroll',evhan);expandel.on('scroll',evhan);}
function glkote_update(arg){hide_loading();var autorestore=null;if(arg.autorestore&&generation==0)
autorestore=arg.autorestore;delete arg.autorestore;if(recording)
recording_send(arg);if(arg.type=='error'){glkote_error(arg.message);return;}
if(arg.type=='pass'){return;}
if(arg.type=='retry'){if(!retry_timer){glkote_log('Event has timed out; will retry...');show_loading();retry_timer=delay_func(2,retry_update);}
else{glkote_log('Event has timed out, but a retry is already queued!');}
return;}
if(arg.type!='update'){glkote_log('Ignoring unknown message type '+arg.type+'.');return;}
if(arg.gen==generation){glkote_log('Ignoring repeated generation number: '+generation);return;}
if(arg.gen<generation){glkote_log('Ignoring out-of-order generation number: got '+arg.gen+', currently at '+generation);return;}
generation=arg.gen;if(disabled){jQuery.each(windowdic,function(winid,win){if(win.inputel){win.inputel.prop('disabled',false);}});disabled=false;}
if(arg.input!=null)
accept_inputcancel(arg.input);if(arg.windows!=null)
accept_windowset(arg.windows);if(arg.content!=null)
accept_contentset(arg.content);if(arg.input!=null)
accept_inputset(arg.input);if(arg.specialinput!=null)
accept_specialinput(arg.specialinput);jQuery.each(windowdic,function(winid,win){if(win.type=='buffer'&&win.needscroll){win.needscroll=false;if(!win.needspaging){var frameel=win.frameel;if(!perform_paging){frameel.scrollTop(frameel.get(0).scrollHeight);win.needspaging=false;}
else{frameel.scrollTop(win.topunseen-current_metrics.buffercharheight);win.pagefrommark=win.topunseen;var frameheight=frameel.outerHeight();var realbottom=buffer_last_line_top_offset(win);var newtopunseen=frameel.scrollTop()+frameheight;if(newtopunseen>realbottom)
newtopunseen=realbottom;if(win.topunseen<newtopunseen)
win.topunseen=newtopunseen;if(frameel.scrollTop()+frameheight+moreprompt_margin>=frameel.get(0).scrollHeight){win.needspaging=false;}
else{win.needspaging=true;}}
var moreel=$('#win'+win.id+'_moreprompt',dom_context);var prevel=$('#win'+win.id+'_prevmark',dom_context);if(!win.needspaging){if(moreel.length)
moreel.remove();if(prevel.length)
prevel.remove();}
else{if(!moreel.length){moreel=$('<div>',{id:'win'+win.id+'_moreprompt','class':'MorePrompt'});moreel.append('More');var morex=win.coords.right+approx_scroll_width;var morey=win.coords.bottom;moreel.css({bottom:morey+'px',right:morex+'px'});$('#'+windowport_id,dom_context).append(moreel);}
if(!prevel.length){prevel=$('<div>',{id:'win'+win.id+'_prevmark','class':'PreviousMark'});frameel.prepend(prevel);}
prevel.css('top',(win.pagefrommark+'px'));}}}});readjust_paging_focus(false);disabled=false;if(arg.disable||arg.specialinput){disabled=true;jQuery.each(windowdic,function(winid,win){if(win.inputel){win.inputel.prop('disabled',true);}});}
var newinputwin=0;if(!disabled&&!windows_paging_count){jQuery.each(windowdic,function(winid,win){if(win.input){if(!newinputwin||win.id==last_known_focus)
newinputwin=win.id;}});}
if(newinputwin){var focusfunc=function(){var win=windowdic[newinputwin];if(win.inputel){win.inputel.focus();}};defer_func(focusfunc);}
if(autorestore){if(autorestore.history){jQuery.each(autorestore.history,function(winid,ls){win=windowdic[winid];if(win!=null){win.history=ls.slice(0);win.historypos=win.history.length;}});}
if(autorestore.defcolor){jQuery.each(autorestore.defcolor,function(winid,val){win=windowdic[winid];if(win!=null){win.defcolor=val;}});}
jQuery.each(windowdic,function(winid,win){if(win.type=='buffer'){window_scroll_to_bottom(win);}});if(!(autorestore.metrics&&autorestore.metrics.width==current_metrics.width&&autorestore.metrics.height==current_metrics.height)){current_metrics.width+=2;evhan_doc_resize();}}}
function accept_windowset(arg){jQuery.each(windowdic,function(winid,win){win.inplace=false;});jQuery.map(arg,accept_one_window);var closewins=jQuery.map(windowdic,function(win,winid){if(!win.inplace)
return win;});jQuery.map(closewins,close_one_window);}
function accept_one_window(arg){var frameel,win;if(!arg){return;}
win=windowdic[arg.id];if(win==null){win={id:arg.id,type:arg.type,rock:arg.rock};windowdic[arg.id]=win;var typeclass;if(win.type=='grid')
typeclass='GridWindow';if(win.type=='buffer')
typeclass='BufferWindow';if(win.type=='graphics')
typeclass='GraphicsWindow';var rockclass='WindowRock_'+arg.rock;frameel=$('<div>',{id:'window'+arg.id,'class':'WindowFrame '+typeclass+' '+rockclass});frameel.data('winid',arg.id);frameel.on('mousedown',arg.id,evhan_window_mousedown);if(perform_paging&&win.type=='buffer')
frameel.on('scroll',arg.id,evhan_window_scroll);if(win.type=='grid'||win.type=='graphics')
frameel.on('click',win.id,evhan_input_mouse_click);if(win.type=='buffer')
frameel.attr({'aria-live':'polite','aria-atomic':'false','aria-relevant':'additions'});win.frameel=frameel;win.gridheight=0;win.gridwidth=0;win.input=null;win.inputel=null;win.terminators={};win.reqhyperlink=false;win.reqmouse=false;win.needscroll=false;win.needspaging=false;win.topunseen=0;win.pagefrommark=0;win.coords={left:null,top:null,right:null,bottom:null};win.history=new Array();win.historypos=0;$('#'+windowport_id,dom_context).append(frameel);}
else{frameel=win.frameel;if(win.type!=arg.type)
glkote_error('Window '+arg.id+' was created with type '+win.type+', but now is described as type '+arg.type);}
win.inplace=true;if(win.type=='grid'){var ix;if(arg.gridheight>win.gridheight){for(ix=win.gridheight;ix<arg.gridheight;ix++){var el=$('<div>',{id:'win'+win.id+'_ln'+ix,'class':'GridLine'});el.append(NBSP);win.frameel.append(el);}}
if(arg.gridheight<win.gridheight){for(ix=arg.gridheight;ix<win.gridheight;ix++){var el=$('#win'+win.id+'_ln'+ix,dom_context);if(el.length)
el.remove();}}
win.gridheight=arg.gridheight;win.gridwidth=arg.gridwidth;}
if(win.type=='buffer'){}
if(win.type=='graphics'){var el=$('#win'+win.id+'_canvas',dom_context);if(!el.length){win.graphwidth=arg.graphwidth;win.graphheight=arg.graphheight;win.defcolor='#FFF';el=$('<canvas>',{id:'win'+win.id+'_canvas'});win.backpixelratio=1;var canvas=el.get(0);var ctx=canvas_get_2dcontext(el);if(ctx){win.backpixelratio=ctx.webkitBackingStorePixelRatio||ctx.mozBackingStorePixelRatio||ctx.msBackingStorePixelRatio||ctx.oBackingStorePixelRatio||ctx.backingStorePixelRatio||1;}
win.scaleratio=current_devpixelratio/win.backpixelratio;el.attr('width',win.graphwidth*win.scaleratio);el.attr('height',win.graphheight*win.scaleratio);el.css('width',(win.graphwidth+'px'));el.css('height',(win.graphheight+'px'));win.frameel.css('background-color',win.defcolor);if(ctx){ctx.setTransform(win.scaleratio,0,0,win.scaleratio,0,0);}
win.frameel.append(el);}
else{if(win.graphwidth!=arg.graphwidth||win.graphheight!=arg.graphheight){win.graphwidth=arg.graphwidth;win.graphheight=arg.graphheight;el.attr('width',win.graphwidth*win.scaleratio);el.attr('height',win.graphheight*win.scaleratio);el.css('width',(win.graphwidth+'px'));el.css('height',(win.graphheight+'px'));var ctx=canvas_get_2dcontext(el);if(ctx){ctx.setTransform(win.scaleratio,0,0,win.scaleratio,0,0);ctx.fillStyle=win.defcolor;ctx.fillRect(0,0,win.graphwidth,win.graphheight);ctx.fillStyle='#000000';}
win.frameel.css('background-color',win.defcolor);var funcarg=win.id;defer_func(function(){send_window_redraw(funcarg);});}}}
var styledic;if(0){var width=arg.width;var height=arg.height;if(arg.type=='grid'){width-=current_metrics.gridmarginx;height-=current_metrics.gridmarginy;}
if(arg.type=='buffer'){width-=current_metrics.buffermarginx;height-=current_metrics.buffermarginy;}
if(width<0)
width=0;if(height<0)
height=0;styledic={left:arg.left+'px',top:arg.top+'px',width:width+'px',height:height+'px'};win.coords.left=arg.left;win.coords.top=arg.top;win.coords.right=current_metrics.width-(arg.left+arg.width);win.coords.bottom=current_metrics.height-(arg.top+arg.height);}
else{var right=current_metrics.width-(arg.left+arg.width);var bottom=current_metrics.height-(arg.top+arg.height);styledic={left:arg.left+'px',top:arg.top+'px',right:right+'px',bottom:bottom+'px'};win.coords.left=arg.left;win.coords.top=arg.top;win.coords.right=right;win.coords.bottom=bottom;}
frameel.css(styledic);}
function close_one_window(win){win.frameel.remove();delete windowdic[win.id];win.frameel=null;var moreel=$('#win'+win.id+'_moreprompt',dom_context);if(moreel.length)
moreel.remove();}
var regex_initial_whitespace=new RegExp('^ ');var regex_final_whitespace=new RegExp(' $');var regex_long_whitespace=new RegExp('  +','g');function func_long_whitespace(match){var len=match.length;if(len==1)
return' ';var res=new Array(len).join(NBSP);return res+' ';}
function accept_contentset(arg){jQuery.map(arg,accept_one_content);}
function accept_one_content(arg){var win=windowdic[arg.id];if(win==null){glkote_error('Got content update for window '+arg.id+', which does not exist.');return;}
if(win.input&&win.input.type=='line'){glkote_error('Got content update for window '+arg.id+', which is awaiting line input.');return;}
win.needscroll=true;if(win.type=='grid'){var lines=arg.lines;var ix,sx;for(ix=0;ix<lines.length;ix++){var linearg=lines[ix];var linenum=linearg.line;var content=linearg.content;var lineel=$('#win'+win.id+'_ln'+linenum,dom_context);if(!lineel.length){glkote_error('Got content for nonexistent line '+linenum+' of window '+arg.id+'.');continue;}
if(!content||!content.length){lineel.text(NBSP);}
else{lineel.empty();for(sx=0;sx<content.length;sx++){var rdesc=content[sx];var rstyle,rtext,rlink;if(jQuery.type(rdesc)==='object'){if(rdesc.special!==undefined)
continue;rstyle=rdesc.style;rtext=rdesc.text;rlink=rdesc.hyperlink;}
else{rstyle=rdesc;sx++;rtext=content[sx];rlink=undefined;}
var el=$('<span>',{'class':'Style_'+rstyle});if(rlink==undefined){insert_text_detecting(el,rtext);}
else{var ael=$('<a>',{'href':'#','class':'Internal'});ael.text(rtext);ael.on('click',build_evhan_hyperlink(win.id,rlink));el.append(ael);}
lineel.append(el);}}}}
if(win.type=='buffer'){var text=arg.text;var ix,sx;if(win.inputel){win.inputel.detach();}
var cursel=$('#win'+win.id+'_cursor',dom_context);if(cursel.length)
cursel.remove();cursel=null;if(arg.clear){win.frameel.empty();win.topunseen=0;win.pagefrommark=0;}
if(text===undefined)
text=[];for(ix=0;ix<text.length;ix++){var textarg=text[ix];var content=textarg.content;var divel=null;if(textarg.append){if(!content||!content.length)
continue;divel=buffer_last_line(win);}
if(divel==null){divel=$('<div>',{'class':'BufferLine'});divel.data('blankpara',true);divel.data('endswhite',true);win.frameel.append(divel);}
if(textarg.flowbreak)
divel.addClass('FlowBreak');if(!content||!content.length){if(divel.data('blankpara'))
divel.text(NBSP);continue;}
if(divel.data('blankpara')){divel.data('blankpara',false);divel.empty();}
for(sx=0;sx<content.length;sx++){var rdesc=content[sx];var rstyle,rtext,rlink;if(jQuery.type(rdesc)==='object'){if(rdesc.special!==undefined){if(rdesc.special=='image'){var imgurl=rdesc.url;if(window.GiLoad&&GiLoad.get_image_url){var newurl=GiLoad.get_image_url(rdesc.image);if(newurl)
imgurl=newurl;}
var el=$('<img>',{src:imgurl,width:''+rdesc.width,height:''+rdesc.height});if(rdesc.alttext)
el.attr('alt',rdesc.alttext);else
el.attr('alt','Image '+rdesc.image);switch(rdesc.alignment){case'inlineup':el.addClass('ImageInlineUp');break;case'inlinedown':el.addClass('ImageInlineDown');break;case'inlinecenter':el.addClass('ImageInlineCenter');break;case'marginleft':el.addClass('ImageMarginLeft');break;case'marginright':el.addClass('ImageMarginRight');break;default:el.addClass('ImageInlineUp');break;}
if(rdesc.hyperlink!=undefined){var ael=$('<a>',{'href':'#','class':'Internal'});ael.append(el);ael.on('click',build_evhan_hyperlink(win.id,rdesc.hyperlink));el=ael;}
divel.append(el);divel.data('endswhite',false);continue;}
glkote_log('Unknown special entry in line data: '+rdesc.special);continue;}
rstyle=rdesc.style;rtext=rdesc.text;rlink=rdesc.hyperlink;}
else{rstyle=rdesc;sx++;rtext=content[sx];rlink=undefined;}
var el=$('<span>',{'class':'Style_'+rstyle});rtext=rtext.replace(regex_long_whitespace,func_long_whitespace);if(divel.data('endswhite')){rtext=rtext.replace(regex_initial_whitespace,NBSP);}
if(rlink==undefined){insert_text_detecting(el,rtext);}
else{var ael=$('<a>',{'href':'#','class':'Internal'});ael.text(rtext);ael.on('click',build_evhan_hyperlink(win.id,rlink));el.append(ael);}
divel.append(el);divel.data('endswhite',regex_final_whitespace.test(rtext));}}
var parals=win.frameel.children();if(parals.length){var totrim=parals.length-max_buffer_length;if(totrim>0){var ix,obj;var offtop=parals.get(totrim).offsetTop;win.topunseen-=offtop;if(win.topunseen<0)
win.topunseen=0;win.pagefrommark-=offtop;if(win.pagefrommark<0)
win.pagefrommark=0;for(ix=0;ix<totrim;ix++){$(parals.get(ix)).remove();}}}
var divel=buffer_last_line(win);if(divel){cursel=$('<span>',{id:'win'+win.id+'_cursor','class':'InvisibleCursor'});cursel.append(NBSP);divel.append(cursel);if(win.inputel){var inputel=win.inputel;var pos=cursel.position();var width=win.frameel.width()-(current_metrics.buffermarginx+pos.left+2);if(width<1)
width=1;inputel.css({position:'absolute',left:'0px',top:'0px',width:width+'px'});cursel.append(inputel);}}}
if(win.type=='graphics'){var draw=arg.draw;var ix;if(draw===undefined)
draw=[];var docall=(graphics_draw_queue.length==0);for(ix=0;ix<draw.length;ix++){var op=draw[ix];var newop={winid:win.id};jQuery.extend(newop,op);graphics_draw_queue.push(newop);}
if(docall&&graphics_draw_queue.length>0){perform_graphics_ops(null);}}}
function accept_inputcancel(arg){var hasinput={};jQuery.map(arg,function(argi){if(argi.type)
hasinput[argi.id]=argi;});jQuery.each(windowdic,function(winid,win){if(win.input){var argi=hasinput[win.id];if(argi==null||argi.gen>win.input.gen){win.input=null;if(win.inputel){win.inputel.remove();win.inputel=null;}}}});}
function accept_inputset(arg){var hasinput={};var hashyperlink={};var hasmouse={};jQuery.map(arg,function(argi){if(argi.type)
hasinput[argi.id]=argi;if(argi.hyperlink)
hashyperlink[argi.id]=true;if(argi.mouse)
hasmouse[argi.id]=true;});jQuery.each(windowdic,function(tmpid,win){win.reqhyperlink=hashyperlink[win.id];win.reqmouse=hasmouse[win.id];var argi=hasinput[win.id];if(argi==null)
return;win.input=argi;var maxlen=1;if(argi.type=='line')
maxlen=argi.maxlen;var inputel=win.inputel;if(inputel==null){var classes='Input';if(argi.type=='line'){classes+=' LineInput';}
else if(argi.type=='char'){classes+=' CharInput';}
else{glkote_error('Window '+win.id+' has requested unrecognized input type '+argi.type+'.');}
inputel=$('<input>',{id:'win'+win.id+'_input','class':classes,type:'text',maxlength:maxlen});if(true)
inputel.attr('autocapitalize','off');inputel.attr({'aria-live':'off'});if(argi.type=='line'){inputel.on('keypress',evhan_input_keypress);inputel.on('keydown',evhan_input_keydown);if(argi.initial)
inputel.val(argi.initial);win.terminators={};if(argi.terminators){for(var ix=0;ix<argi.terminators.length;ix++)
win.terminators[argi.terminators[ix]]=true;}}
else if(argi.type=='char'){inputel.on('keypress',evhan_input_char_keypress);inputel.on('keydown',evhan_input_char_keydown);}
inputel.on('focus',win.id,evhan_input_focus);inputel.on('blur',win.id,evhan_input_blur);inputel.data('winid',win.id);win.inputel=inputel;win.historypos=win.history.length;win.needscroll=true;}
if(win.type=='grid'){var lineel=$('#win'+win.id+'_ln'+argi.ypos,dom_context);if(!lineel.length){glkote_error('Window '+win.id+' has requested input at unknown line '+argi.ypos+'.');return;}
var pos=lineel.position();var xpos=pos.left+Math.round(argi.xpos*current_metrics.gridcharwidth);var width=Math.round(maxlen*current_metrics.gridcharwidth);var maxwidth=win.frameel.width()-(current_metrics.buffermarginx+xpos+2);if(width>maxwidth)
width=maxwidth;inputel.css({position:'absolute',left:xpos+'px',top:pos.top+'px',width:width+'px'});win.frameel.append(inputel);}
if(win.type=='buffer'){var cursel=$('#win'+win.id+'_cursor',dom_context);if(!cursel.length){cursel=$('<span>',{id:'win'+win.id+'_cursor','class':'InvisibleCursor'});cursel.append(NBSP);win.frameel.append(cursel);}
var pos=cursel.position();var width=win.frameel.width()-(current_metrics.buffermarginx+pos.left+2);if(width<1)
width=1;inputel.css({position:'absolute',left:'0px',top:'0px',width:width+'px'});cursel.append(inputel);}});}
function accept_specialinput(arg){if(arg.type=='fileref_prompt'){var replyfunc=function(ref){send_response('specialresponse',null,'fileref_prompt',ref);};try{var writable=(arg.filemode!='read');Dialog.open(writable,arg.filetype,arg.gameid,replyfunc);}
catch(ex){GlkOte.log('Unable to open file dialog: '+ex);replyfunc=function(ref){send_response('specialresponse',null,'fileref_prompt',null);};defer_func(replyfunc);}}
else{glkote_error('Request for unknown special input type: '+arg.type);}}
function buffer_last_line(win){var divel=last_child_of(win.frameel);if(divel==null)
return null;if(divel.className!='BufferLine')
return null;return $(divel);}
function buffer_last_line_top_offset(win){var divel=buffer_last_line(win);if(!divel||!divel.length)
return 0;return divel.get(0).offsetTop;}
function readjust_paging_focus(canfocus){windows_paging_count=0;var pageable_win=0;if(perform_paging){jQuery.each(windowdic,function(tmpid,win){if(win.needspaging){windows_paging_count+=1;if(!pageable_win||win.id==last_known_paging)
pageable_win=win.id;}});}
if(windows_paging_count){last_known_paging=pageable_win;}
if(!windows_paging_count&&canfocus){var newinputwin=0;if(!disabled&&!windows_paging_count){jQuery.each(windowdic,function(tmpid,win){if(win.input){if(!newinputwin||win.id==last_known_focus)
newinputwin=win.id;}});}
if(newinputwin){var win=windowdic[newinputwin];if(win.inputel){win.inputel.focus();}}}}
function glkote_get_interface(){return game_interface;}
function glkote_set_dom_context(val){dom_context=val;}
function glkote_get_dom_context(){return dom_context;}
function glkote_save_allstate(){var obj={metrics:{width:current_metrics.width,height:current_metrics.height},history:{}};jQuery.each(windowdic,function(winid,win){if(win.history&&win.history.length)
obj.history[winid]=win.history.slice(0);if(win.defcolor){if(obj.defcolor===undefined)
obj.defcolor={};obj.defcolor[winid]=win.defcolor;}});return obj;}
function glkote_log(msg){if(window.console&&console.log)
console.log(msg);else if(window.opera&&opera.postError)
opera.postError(msg);}
function glkote_error(msg){if(!msg)
msg='???';var el=document.getElementById('errorcontent');remove_children(el);el.appendChild(document.createTextNode(msg));el=document.getElementById('errorpane');if(el.className=='WarningPane')
el.className=null;el.style.display='';error_visible=true;hide_loading();}
function glkote_warning(msg){if(error_visible)
return;if(!msg){$('#errorpane').hide();return;}
var el=document.getElementById('errorcontent');remove_children(el);el.appendChild(document.createTextNode(msg));$('#errorpane').addClass('WarningPane');$('#errorpane').show();hide_loading();}
function glkote_extevent(val){send_response('external',null,val);}
function retry_update(){retry_timer=null;glkote_log('Retrying update...');send_response('refresh',null,null);}
function clear_error(){$('#errorpane',dom_context).hide();}
function hide_loading(){if(loading_visible==false)
return;loading_visible=false;var el=document.getElementById('loadingpane');if(el){el.style.display='none';}}
function show_loading(){if(loading_visible==true)
return;loading_visible=true;var el=document.getElementById('loadingpane');if(el){el.style.display='';}}
function remove_children(parent){var obj,ls;ls=parent.childNodes;while(ls.length>0){obj=ls.item(0);parent.removeChild(obj);}}
function last_child_of(obj){var ls=obj.children();if(!ls||!ls.length)
return null;return ls.get(ls.length-1);}
function insert_text_detecting(el,val){if(!detect_external_links){el.append(document.createTextNode(val));return;}
if(detect_external_links=='match'){if(regex_external_links.test(val)){var ael=$('<a>',{'href':val,'class':'External','target':'_blank'});ael.text(val);el.append(ael);return;}}
else if(detect_external_links=='search'){while(true){var match=regex_external_links.exec(val);if(!match)
break;if(match.index>0){var prefix=val.substring(0,match.index);el.append(document.createTextNode(prefix));}
var ael=$('<a>',{'href':match[0],'class':'External','target':'_blank'});ael.text(match[0]);el.append(ael);val=val.substring(match.index+match[0].length);}
if(!val.length)
return;}
el.append(document.createTextNode(val));}
function canvas_get_2dcontext(canvasel){if(!canvasel||!canvasel.length)
return undefined;var canvas=canvasel.get(0);if(canvas&&canvas.getContext){return canvas.getContext('2d');}
return undefined;}
function perform_graphics_ops(loadedimg,loadedev){if(graphics_draw_queue.length==0){glkote_log('perform_graphics_ops called with no queued ops'+(loadedimg?' (plus image!)':''));return;}
while(graphics_draw_queue.length){var op=graphics_draw_queue[0];var win=windowdic[op.winid];if(!win){glkote_log('perform_graphics_ops: op for nonexistent window '+op.winid);graphics_draw_queue.shift();continue;}
var el=$('#win'+win.id+'_canvas',dom_context);var ctx=canvas_get_2dcontext(el);if(!ctx){glkote_log('perform_graphics_ops: op for nonexistent canvas '+win.id);graphics_draw_queue.shift();continue;}
var optype=op.special;switch(optype){case'setcolor':win.defcolor=op.color;break;case'fill':if(op.color===undefined)
ctx.fillStyle=win.defcolor;else
ctx.fillStyle=op.color;if(op.x===undefined){ctx.fillRect(0,0,win.graphwidth,win.graphheight);win.frameel.css('background-color',ctx.fillStyle);}
else{ctx.fillRect(op.x,op.y,op.width,op.height);}
ctx.fillStyle='#000000';break;case'image':if(!loadedimg){var oldimg=image_cache[op.image];if(oldimg&&oldimg.width>0&&oldimg.height>0){loadedimg=oldimg;loadedev=true;}
else{delete image_cache[op.image];}}
if(!loadedimg){var imgurl=op.url;if(window.GiLoad&&GiLoad.get_image_url){var newurl=GiLoad.get_image_url(op.image);if(newurl)
imgurl=newurl;}
var newimg=new Image();$(newimg).on('load',function(ev){perform_graphics_ops(newimg,ev);});$(newimg).on('error',function(ev){perform_graphics_ops(newimg,null);});newimg.src=imgurl;return;}
if(loadedev){image_cache[op.image]=loadedimg;ctx.drawImage(loadedimg,op.x,op.y,op.width,op.height);}
loadedev=null;loadedimg=null;break;default:glkote_log('Unknown special entry in graphics content: '+optype);break;}
graphics_draw_queue.shift();}}
function delay_func(timeout,func)
{return window.setTimeout(func,timeout*1000);}
function defer_func(func)
{return window.setTimeout(func,0.01*1000);}
function inspect_deep(res){var keys=jQuery.map(res,function(val,key){return key;});keys.sort();var els=jQuery.map(keys,function(key){var val=res[key];if(jQuery.type(val)==='string')
val="'"+val+"'";else if(!(jQuery.type(val)==='number'))
val=inspect_deep(val);return key+':'+val;});return'{'+els.join(', ')+'}';}
function inspect_shallow(res){var keys=jQuery.map(res,function(val,key){return key;});keys.sort();var els=jQuery.map(keys,function(key){var val=res[key];if(jQuery.type(val)==='string')
val="'"+val+"'";return key+':'+val;});return'{'+els.join(', ')+'}';}
function submit_line_input(win,val,termkey){var historylast=null;if(win.history.length)
historylast=win.history[win.history.length-1];if(val&&val!=historylast){win.history.push(val);if(win.history.length>20){win.history.shift();}}
send_response('line',win,val,termkey);}
function send_response(type,win,val,val2){if(disabled&&type!='specialresponse')
return;var winid=0;if(win)
winid=win.id;var res={type:type,gen:generation};if(type=='line'){res.window=win.id;res.value=val;if(val2)
res.terminator=val2;}
else if(type=='char'){res.window=win.id;res.value=val;}
else if(type=='hyperlink'){res.window=win.id;res.value=val;}
else if(type=='mouse'){res.window=win.id;res.x=val;res.y=val2;}
else if(type=='external'){res.value=val;}
else if(type=='specialresponse'){res.response=val;res.value=val2;}
else if(type=='redraw'){res.window=win.id;}
else if(type=='init'||type=='arrange'){res.metrics=val;}
if(!(type=='init'||type=='refresh'||type=='specialresponse')){jQuery.each(windowdic,function(tmpid,win){var savepartial=(type!='line'&&type!='char')||(win.id!=winid);if(savepartial&&win.input&&win.input.type=='line'&&win.inputel&&win.inputel.val()){var partial=res.partial;if(!partial){partial={};res.partial=partial;};partial[win.id]=win.inputel.val();}});}
if(recording){recording_state.input=res;recording_state.timestamp=(new Date().getTime());}
game_interface.accept(res);}
function get_query_params(){var map={};var qs=location.search.substring(1,location.search.length);if(qs.length){var args=qs.split('&');qs=qs.replace(/\+/g,' ');for(var ix=0;ix<args.length;ix++){var pair=args[ix].split('=');var name=decodeURIComponent(pair[0]);var value=(pair.length==2)?decodeURIComponent(pair[1]):name;map[name]=value;}}
return map;}
function recording_send(arg){recording_state.output=arg;recording_state.outtimestamp=(new Date().getTime());var send=true;if(recording_state.format=='simple'){var input=recording_state.input;var output=recording_state.output;var inputtype=null;if(input)
inputtype=input.type;if(inputtype=='line'||inputtype=='char'){recording_state.input=input.value;}
else if(inputtype=='init'||inputtype=='external'||inputtype=='specialresponse'||!inputtype){recording_state.input='';}
else{send=false;}
if(output.windows){recording_context.bufferwins={};for(var ix=0;ix<output.windows.length;ix++){if(output.windows[ix].type=='buffer')
recording_context.bufferwins[output.windows[ix].id]=true;}}
var buffer='';if(output.content){for(var ix=0;ix<output.content.length;ix++){var content=output.content[ix];if(recording_context.bufferwins&&recording_context.bufferwins[content.id]){if(content.text){for(var jx=0;jx<content.text.length;jx++){var text=content.text[jx];if(!text.append)
buffer=buffer+'\n';if(text.content){for(var kx=0;kx<text.content.length;kx++){var el=text.content[kx];if(jQuery.type(el)=='string'){kx++;buffer=buffer+text.content[kx];}
else{if(el.text)
buffer=buffer+el.text;}}}}}}}}
recording_state.output=buffer;}
if(send)
recording_handler(recording_state);recording_state.input=null;recording_state.output=null;recording_state.timestamp=0;recording_state.outtimestamp=0;}
function recording_standard_handler(state){jQuery.ajax(recording_handler_url,{type:'POST',contentType:'application/json',data:JSON.stringify(state),error:function(jqxhr,textstatus,errorthrown){glkote_log('Transcript recording failed; deactivating. Error '+textstatus+': '+errorthrown);recording=false;}});}
function evhan_doc_resize(ev){if(resize_timer!=null){window.clearTimeout(resize_timer);resize_timer=null;}
resize_timer=delay_func(0.20,doc_resize_real);}
function doc_resize_real(){resize_timer=null;if(disabled){resize_timer=delay_func(0.20,doc_resize_real);return;}
var new_metrics=measure_window();if(new_metrics.width==current_metrics.width&&new_metrics.height==current_metrics.height){return;}
current_metrics=new_metrics;send_response('arrange',null,current_metrics);}
function send_window_redraw(winid){var win=windowdic[winid];if(!win||win.type!='graphics')
return;send_response('redraw',win,null);}
function evhan_doc_pixelreschange(ev){var ratio=window.devicePixelRatio||1;if(ratio!=current_devpixelratio){current_devpixelratio=ratio;glkote_log('### devicePixelRatio changed to '+current_devpixelratio);jQuery.each(windowdic,function(winid,win){if(win.type=='graphics'){var el=$('#win'+win.id+'_canvas',dom_context);win.scaleratio=current_devpixelratio/win.backpixelratio;var ctx=canvas_get_2dcontext(el);el.attr('width',win.graphwidth*win.scaleratio);el.attr('height',win.graphheight*win.scaleratio);el.css('width',(win.graphwidth+'px'));el.css('height',(win.graphheight+'px'));if(ctx){ctx.setTransform(win.scaleratio,0,0,win.scaleratio,0,0);ctx.fillStyle=win.defcolor;ctx.fillRect(0,0,win.graphwidth,win.graphheight);ctx.fillStyle='#000000';}
win.frameel.css('background-color',win.defcolor);defer_func(function(){send_window_redraw(winid);});}});}}
function evhan_doc_keypress(ev){if(disabled){return;}
var keycode=0;if(ev)keycode=ev.which;if(ev.target.tagName.toUpperCase()=='INPUT'){return;}
if(ev.target.className.indexOf('CanHaveInputFocus')>=0){return;}
if(ev.altKey||ev.metaKey||ev.ctrlKey){return;}
if(0){if(!keycode)
return;if(keycode<32&&keycode!=13)
return;}
var win;if(windows_paging_count){win=windowdic[last_known_paging];if(win){if(!((keycode>=32&&keycode<=126)||keycode==13)){return;}
ev.preventDefault();var frameel=win.frameel;frameel.scrollTop(win.topunseen-current_metrics.buffercharheight);var frameheight=frameel.outerHeight();var realbottom=buffer_last_line_top_offset(win);var newtopunseen=frameel.scrollTop()+frameheight;if(newtopunseen>realbottom)
newtopunseen=realbottom;if(win.topunseen<newtopunseen)
win.topunseen=newtopunseen;if(win.needspaging){if(frameel.scrollTop()+frameheight+moreprompt_margin>=frameel.get(0).scrollHeight){win.needspaging=false;var moreel=$('#win'+win.id+'_moreprompt',dom_context);if(moreel.length)
moreel.remove();readjust_paging_focus(true);}}
return;}}
win=windowdic[last_known_focus];if(!win)
return;if(!win.inputel)
return;win.inputel.focus();if(win.input.type=='line'){if(keycode==13){submit_line_input(win,win.inputel.val(),null);ev.preventDefault();return;}
if(keycode){if(keycode>=32){var val=String.fromCharCode(keycode);win.inputel.val(win.inputel.val()+val);}
ev.preventDefault();return;}}
else{var res=null;if(keycode==13)
res='return';else if(keycode==key_codes.KEY_BACKSPACE)
res='delete';else if(keycode)
res=String.fromCharCode(keycode);if(res){send_response('char',win,res);}
ev.preventDefault();return;}}
function evhan_window_mousedown(ev){var winid=ev.data;var win=windowdic[winid];if(!win)
return;if(win.inputel){last_known_focus=win.id;if(0){ev.preventDefault();win.inputel.focus();}}
if(win.needspaging)
last_known_paging=win.id;else if(win.inputel)
last_known_paging=0;}
function evhan_input_mouse_click(ev){var winid=ev.data;var win=windowdic[winid];if(!win)
return;if(ev.button!=0)
return;if(!win.reqmouse)
return;var xpos=0;var ypos=0;if(win.type=='grid'){var lineel=$('#win'+win.id+'_ln'+0,dom_context);if(lineel.length){var linepos=lineel.offset();xpos=Math.floor((ev.clientX-linepos.left)/current_metrics.gridcharwidth);ypos=Math.floor((ev.clientY-linepos.top)/current_metrics.gridcharheight);}
if(xpos>=win.gridwidth)
xpos=win.gridwidth-1;if(xpos<0)
xpos=0;if(ypos>=win.gridheight)
ypos=win.gridheight-1;if(ypos<0)
ypos=0;}
else if(win.type=='graphics'){var canel=$('#win'+win.id+'_canvas',dom_context);if(canel.length){var pos=canel.offset();xpos=ev.clientX-pos.left;ypos=ev.clientY-pos.top;}
if(xpos>=win.graphwidth)
xpos=win.graphwidth-1;if(xpos<0)
xpos=0;if(ypos>=win.graphheight)
ypos=win.graphheight-1;if(ypos<0)
ypos=0;}
else{return;}
ev.preventDefault();send_response('mouse',win,xpos,ypos);}
function evhan_input_char_keydown(ev){var keycode=0;if(ev)keycode=ev.keyCode;if(!keycode)return true;var res=null;switch(keycode){case key_codes.KEY_LEFT:res='left';break;case key_codes.KEY_RIGHT:res='right';break;case key_codes.KEY_UP:res='up';break;case key_codes.KEY_DOWN:res='down';break;case key_codes.KEY_BACKSPACE:res='delete';break;case key_codes.KEY_ESC:res='escape';break;case key_codes.KEY_TAB:res='tab';break;case key_codes.KEY_PAGEUP:res='pageup';break;case key_codes.KEY_PAGEDOWN:res='pagedown';break;case key_codes.KEY_HOME:res='home';break;case key_codes.KEY_END:res='end';break;case 112:res='func1';break;case 113:res='func2';break;case 114:res='func3';break;case 115:res='func4';break;case 116:res='func5';break;case 117:res='func6';break;case 118:res='func7';break;case 119:res='func8';break;case 120:res='func9';break;case 121:res='func10';break;case 122:res='func11';break;case 123:res='func12';break;}
if(res){var winid=$(this).data('winid');var win=windowdic[winid];if(!win||!win.input)
return true;send_response('char',win,res);return false;}
return true;}
function evhan_input_char_keypress(ev){var keycode=0;if(ev)keycode=ev.which;if(!keycode)return false;var res;if(keycode==13)
res='return';else
res=String.fromCharCode(keycode);var winid=$(this).data('winid');var win=windowdic[winid];if(!win||!win.input)
return true;send_response('char',win,res);return false;}
function evhan_input_keydown(ev){var keycode=0;if(ev)keycode=ev.keyCode;if(!keycode)return true;if(keycode==key_codes.KEY_UP||keycode==key_codes.KEY_DOWN){var winid=$(this).data('winid');var win=windowdic[winid];if(!win||!win.input)
return true;if(keycode==key_codes.KEY_UP&&win.historypos>0){win.historypos-=1;if(win.historypos<win.history.length)
this.value=win.history[win.historypos];else
this.value='';}
if(keycode==key_codes.KEY_DOWN&&win.historypos<win.history.length){win.historypos+=1;if(win.historypos<win.history.length)
this.value=win.history[win.historypos];else
this.value='';}
return false;}
else if(terminator_key_values[keycode]){var winid=$(this).data('winid');var win=windowdic[winid];if(!win||!win.input)
return true;if(win.terminators[terminator_key_values[keycode]]){submit_line_input(win,win.inputel.val(),terminator_key_values[keycode]);return false;}}
return true;}
function evhan_input_keypress(ev){var keycode=0;if(ev)keycode=ev.which;if(!keycode)return true;if(keycode==13){var winid=$(this).data('winid');var win=windowdic[winid];if(!win||!win.input)
return true;submit_line_input(win,this.value,null);return false;}
return true;}
function evhan_input_focus(ev){var winid=ev.data;var win=windowdic[winid];if(!win)
return;currently_focussed=true;last_known_focus=winid;last_known_paging=winid;}
function evhan_input_blur(ev){var winid=ev.data;var win=windowdic[winid];if(!win)
return;currently_focussed=false;}
function evhan_window_scroll(ev){var winid=ev.data;var win=windowdic[winid];if(!win)
return;if(!win.needspaging)
return;var frameel=win.frameel;var frameheight=frameel.outerHeight();var realbottom=buffer_last_line_top_offset(win);var newtopunseen=frameel.scrollTop()+frameheight;if(newtopunseen>realbottom)
newtopunseen=realbottom;if(win.topunseen<newtopunseen)
win.topunseen=newtopunseen;if(frameel.scrollTop()+frameheight+moreprompt_margin>=frameel.get(0).scrollHeight){win.needspaging=false;var moreel=$('#win'+win.id+'_moreprompt',dom_context);if(moreel.length)
moreel.remove();readjust_paging_focus(true);return;}}
function window_scroll_to_bottom(win){var frameel=win.frameel;var frameheight=frameel.outerHeight();frameel.scrollTop(frameel.get(0).scrollHeight-frameheight);var realbottom=buffer_last_line_top_offset(win);var newtopunseen=frameel.scrollTop()+frameheight;if(newtopunseen>realbottom)
newtopunseen=realbottom;if(win.topunseen<newtopunseen)
win.topunseen=newtopunseen;if(win.needspaging){if(frameel.scrollTop()+frameheight+moreprompt_margin>=frameel.get(0).scrollHeight){win.needspaging=false;var moreel=$('#win'+win.id+'_moreprompt',dom_context);if(moreel.length)
moreel.remove();readjust_paging_focus(true);}}}
function build_evhan_hyperlink(winid,linkval){return function(){var win=windowdic[winid];if(!win)
return false;if(!win.reqhyperlink)
return false;send_response('hyperlink',win,linkval);return false;};}
return{version:'2.2.3',init:glkote_init,update:glkote_update,extevent:glkote_extevent,getinterface:glkote_get_interface,getdomcontext:glkote_get_dom_context,setdomcontext:glkote_set_dom_context,save_allstate:glkote_save_allstate,log:glkote_log,warning:glkote_warning,error:glkote_error};}();Dialog=function(){var dialog_el_id='dialog';var is_open=false;var dialog_callback=null;var will_save;var confirming;var editing;var editing_dirent;var cur_usage;var cur_usage_name;var cur_gameid;var cur_filelist;function dialog_open(tosave,usage,gameid,callback){if(is_open)
throw new Error('Dialog: dialog box is already open.');if(localStorage==null)
throw new Error('Dialog: your browser does not support local storage.');dialog_callback=callback;will_save=tosave;confirming=false;editing=false;editing_dirent=null;cur_usage=usage;cur_gameid=gameid;cur_usage_name=label_for_usage(cur_usage);var root_el_id='windowport';var iface=window.Game;if(window.GlkOte)
iface=window.GlkOte.getinterface();if(iface&&iface.windowport)
root_el_id=iface.windowport;var rootel=$('#'+root_el_id);if(!rootel.length)
throw new Error('Dialog: unable to find root element #'+root_el_id+'.');var screen=$('#'+dialog_el_id+'_screen');if(!screen.length){screen=$('<div>',{id:dialog_el_id+'_screen'});rootel.append(screen);}
var frame=$('#'+dialog_el_id+'_frame');if(!frame.length){frame=$('<div>',{id:dialog_el_id+'_frame'});rootel.append(frame);}
var dia=$('#'+dialog_el_id);if(dia.length)
dia.remove();dia=$('<div>',{id:dialog_el_id});var form,el,row;form=$('<form>');form.on('submit',(will_save?evhan_accept_save_button:evhan_accept_load_button));dia.append(form);row=$('<div>',{'class':'DiaButtonsFloat'});el=$('<button>',{id:dialog_el_id+'_edit',type:'button'});el.append('Edit');el.on('click',evhan_edit_button);row.append(el);form.append(row);row=$('<div>',{id:dialog_el_id+'_cap','class':'DiaCaption'});row.append('XXX');form.append(row);if(will_save){row=$('<div>',{id:dialog_el_id+'_input','class':'DiaInput'});form.append(row);el=$('<input>',{id:dialog_el_id+'_infield',type:'text',name:'filename'});row.append(el);}
row=$('<div>',{id:dialog_el_id+'_body','class':'DiaBody'});form.append(row);row=$('<div>',{id:dialog_el_id+'_cap2','class':'DiaCaption'});row.hide();form.append(row);row=$('<div>',{id:dialog_el_id+'_buttonrow','class':'DiaButtons'});{el=$('<button>',{id:dialog_el_id+'_cancel',type:'button'});el.append('Cancel');el.on('click',evhan_cancel_button);row.append(el);el=$('<button>',{id:dialog_el_id+'_delete',type:'button'});el.append('Delete');el.on('click',evhan_delete_button);el.hide();row.append(el);el=$('<button>',{id:dialog_el_id+'_display',type:'button'});el.append('Display');el.on('click',evhan_display_button);el.hide();row.append(el);el=$('<button>',{id:dialog_el_id+'_accept',type:'submit'});el.append(will_save?'Save':'Load');el.on('click',(will_save?evhan_accept_save_button:evhan_accept_load_button));row.append(el);}
form.append(row);frame.append(dia);is_open=true;evhan_storage_changed();var focusfunc;if(will_save){focusfunc=function(){var el=$('#'+dialog_el_id+'_infield');if(el.length)
el.focus();};}
else{focusfunc=function(){var el=$('#'+dialog_el_id+'_select');if(el.length)
el.focus();};}
defer_func(focusfunc);}
function dialog_close(){var dia=$('#'+dialog_el_id);if(dia.length)
dia.remove();var frame=$('#'+dialog_el_id+'_frame');if(frame.length)
frame.remove();var screen=$('#'+dialog_el_id+'_screen');if(screen.length)
screen.remove();is_open=false;dialog_callback=null;cur_filelist=null;editing=false;editing_dirent=null;}
function set_caption(msg,isupper){var elid=(isupper?dialog_el_id+'_cap':dialog_el_id+'_cap2');var el=$('#'+elid);if(!el.length)
return;if(!msg){el.hide();}
else{el.text(msg);el.show();}}
function label_for_usage(val){switch(val){case'data':return'data file';case'save':return'save file';case'transcript':return'transcript';case'command':return'command script';default:return'file';}}
function usage_is_textual(val){return(val=='transcript'||val=='command');}
function defer_func(func)
{return window.setTimeout(func,0.01*1000);}
function evhan_select_change(){if(!is_open)
return false;if(confirming)
return false;var selel=$('#'+dialog_el_id+'_select');if(!selel.length)
return false;var pos=selel.prop('selectedIndex');if(!cur_filelist||pos<0||pos>=cur_filelist.length)
return false;var file=cur_filelist[pos];var fel=$('#'+dialog_el_id+'_infield');if(!fel.length)
return false;fel.val(file.dirent.filename);return false;}
function evhan_select_change_editing(){if(!is_open)
return false;if(!editing||editing_dirent)
return false;var butel=$('#'+dialog_el_id+'_delete');butel.prop('disabled',true);butel=$('#'+dialog_el_id+'_display');butel.prop('disabled',true);var selel=$('#'+dialog_el_id+'_select');if(!selel.length)
return false;var pos=selel.prop('selectedIndex');if(!cur_filelist||pos<0||pos>=cur_filelist.length)
return false;var file=cur_filelist[pos];if(!file||!file.dirent||!file_ref_exists(file.dirent))
return false;butel=$('#'+dialog_el_id+'_delete');butel.prop('disabled',false);butel=$('#'+dialog_el_id+'_display');butel.prop('disabled',false);}
function evhan_accept_load_button(ev){ev.preventDefault();if(!is_open)
return false;if(editing)
return false;var selel=$('#'+dialog_el_id+'_select');if(!selel.length)
return false;var pos=selel.prop('selectedIndex');if(!cur_filelist||pos<0||pos>=cur_filelist.length)
return false;var file=cur_filelist[pos];if(!file||!file.dirent||!file_ref_exists(file.dirent))
return false;var callback=dialog_callback;dialog_close();if(callback)
callback(file.dirent);return false;}
function evhan_accept_save_button(ev){ev.preventDefault();if(!is_open)
return false;if(editing)
return false;var fel=$('#'+dialog_el_id+'_infield');if(!fel.length)
return false;var filename=fel.val();filename=jQuery.trim(filename);if(!filename.length)
return false;var dirent=file_construct_ref(filename,cur_usage,cur_gameid);if(file_ref_exists(dirent)&&!confirming){confirming=true;set_caption('You already have a '+cur_usage_name+' "'
+dirent.filename+'". Do you want to replace it?',false);fel.prop('disabled',true);var butel=$('#'+dialog_el_id+'_accept');butel.text('Replace');return false;}
var callback=dialog_callback;dialog_close();if(callback)
callback(dirent);return false;}
function evhan_edit_button(ev){ev.preventDefault();if(!is_open)
return false;if(!editing){editing=true;editing_dirent=null;if(confirming){confirming=false;set_caption(null,false);var fel=$('#'+dialog_el_id+'_infield');fel.prop('disabled',false);var butel=$('#'+dialog_el_id+'_accept');butel.prop('disabled',false);butel.text('Save');}
var fel=$('#'+dialog_el_id+'_input');if(fel.length){fel.hide();}
var butel=$('#'+dialog_el_id+'_edit');butel.text('Done');butel=$('#'+dialog_el_id+'_delete');butel.show();butel=$('#'+dialog_el_id+'_display');butel.show();butel=$('#'+dialog_el_id+'_accept');butel.hide();evhan_storage_changed();return false;}
else if(!editing_dirent){editing=false;editing_dirent=null;var fel=$('#'+dialog_el_id+'_input');if(fel.length){fel.show();}
var butel=$('#'+dialog_el_id+'_edit');butel.text('Edit');butel=$('#'+dialog_el_id+'_delete');butel.hide();butel=$('#'+dialog_el_id+'_display');butel.hide();butel=$('#'+dialog_el_id+'_accept');butel.show();evhan_storage_changed();return false;}
else{editing=true;editing_dirent=null;$('#'+dialog_el_id+'_buttonrow').show();var butel=$('#'+dialog_el_id+'_edit');butel.text('Done');evhan_storage_changed();return false;}}
function evhan_delete_button(ev){ev.preventDefault();if(!is_open)
return false;if(!editing||editing_dirent)
return false;var selel=$('#'+dialog_el_id+'_select');if(!selel.length)
return false;var pos=selel.prop('selectedIndex');if(!cur_filelist||pos<0||pos>=cur_filelist.length)
return false;var file=cur_filelist[pos];if(!file||!file.dirent)
return false;file_remove_ref(file.dirent);evhan_storage_changed();return false;}
function evhan_display_button(ev){ev.preventDefault();if(!is_open)
return false;if(!editing||editing_dirent)
return false;var selel=$('#'+dialog_el_id+'_select');if(!selel.length)
return false;var pos=selel.prop('selectedIndex');if(!cur_filelist||pos<0||pos>=cur_filelist.length)
return false;var file=cur_filelist[pos];if(!file||!file.dirent||!file_ref_exists(file.dirent))
return false;$('#'+dialog_el_id+'_buttonrow').hide();var butel=$('#'+dialog_el_id+'_edit');butel.text('Close');editing_dirent=file.dirent;evhan_storage_changed();return false;}
function evhan_cancel_button(ev){ev.preventDefault();if(!is_open)
return false;if(confirming){confirming=false;set_caption(null,false);var fel=$('#'+dialog_el_id+'_infield');fel.prop('disabled',false);var butel=$('#'+dialog_el_id+'_accept');butel.prop('disabled',false);butel.text('Save');return false;}
var callback=dialog_callback;dialog_close();if(callback)
callback(null);return false;}
function evhan_storage_changed(ev){if(!is_open)
return false;var el,bodyel,butel,ls,lastusage;var changedkey=null;if(ev)
changedkey=ev.key;bodyel=$('#'+dialog_el_id+'_body');if(!bodyel.length)
return false;if(editing&&editing_dirent){if(!file_ref_exists(editing_dirent)){editing_dirent=null;$('#'+dialog_el_id+'_buttonrow').show();butel=$('#'+dialog_el_id+'_edit');butel.text('Done');}}
if(editing&&editing_dirent){bodyel.empty();var dat=file_read(editing_dirent);dat=String.fromCharCode.apply(this,dat);if(usage_is_textual(editing_dirent.usage)){var textel=$('<div>',{'class':'DiaDisplayText'});textel.text(dat);bodyel.append(textel);set_caption('Displaying file contents...',true);}
else{var b64dat=window.btoa(dat);var linkel=$('<a>',{'href':'data:application/octet-stream;base64,'+b64dat,'target':'_blank','download':'data'});linkel.text(editing_dirent.filename);bodyel.append(linkel);set_caption('Use "Save As" option in your browser to download this link.',true);}
return false;}
if(editing){ls=files_list(null,cur_gameid);if(cur_gameid!=''){ls=ls.concat(files_list(null,''));}
ls.sort(function(f1,f2){if(f1.dirent.usage<f2.dirent.usage)
return-1;else if(f1.dirent.usage>f2.dirent.usage)
return 1;return f2.modified.getTime()-f1.modified.getTime();});if(ls.length==0){bodyel.empty();butel=$('#'+dialog_el_id+'_delete');butel.prop('disabled',true);butel=$('#'+dialog_el_id+'_display');butel.prop('disabled',true);set_caption('You have no stored files. Press Done to continue.',true);return false;}
cur_filelist=[];lastusage='';for(ix=0;ix<ls.length;ix++){file=ls[ix];if(file.dirent.usage!=lastusage){lastusage=file.dirent.usage;cur_filelist.push({label:lastusage});}
cur_filelist.push(file);}
ls=cur_filelist;bodyel.empty();var selel=$('<select>',{id:dialog_el_id+'_select',name:'files'});selel.prop('size','5');var ix,file,datestr;var anyselected=false;for(ix=0;ix<ls.length;ix++){file=ls[ix];if(!file.dirent){el=$('<option>',{name:'f'+ix});el.prop('disabled',true);el.text('-- '+label_for_usage(file.label)+'s --');selel.append(el);continue;}
el=$('<option>',{name:'f'+ix});if(!anyselected){anyselected=true;el.selected=true;}
datestr=format_date(file.modified);el.text(file.dirent.filename+' -- '+datestr);selel.append(el);}
bodyel.append(selel);selel.on('change',evhan_select_change_editing);evhan_select_change_editing();set_caption('All stored files are now visible. You may delete them, and display files containing text. Press Done when finished.',true);return false;}
ls=files_list(cur_usage,cur_gameid);ls.sort(function(f1,f2){return f2.modified.getTime()-f1.modified.getTime();});cur_filelist=ls;if(ls.length==0){bodyel.empty();}
else{bodyel.empty();var selel=$('<select>',{id:dialog_el_id+'_select',name:'files'});selel.prop('size','5');var ix,file,datestr;for(ix=0;ix<ls.length;ix++){file=ls[ix];el=$('<option>',{name:'f'+ix});if(ix==0)
el.selected=true;datestr=format_date(file.modified);el.text(file.dirent.filename+' -- '+datestr);selel.append(el);}
bodyel.append(selel);if(will_save)
selel.on('change',evhan_select_change);}
if(will_save){set_caption('Name this '+cur_usage_name+'.',true);el=$('#'+dialog_el_id+'_accept');el.prop('disabled',false);}
else{if(ls.length==0){set_caption('You have no '+cur_usage_name+'s for this game.',true);el=$('#'+dialog_el_id+'_accept');el.prop('disabled',true);}
else{set_caption('Select a '+cur_usage_name+' to load.',true);el=$('#'+dialog_el_id+'_accept');el.prop('disabled',false);}}}
function file_clean_fixed_name(filename,usage){return filename;}
function file_construct_ref(filename,usage,gameid){if(!filename)
filename='';if(!usage)
usage='';if(!gameid)
gameid='';var key=usage+':'+gameid+':'+filename;var ref={dirent:'dirent:'+key,content:'content:'+key,filename:filename,usage:usage,gameid:gameid};return ref;}
function file_construct_temp_ref(usage){var timestamp=new Date().getTime();var filename="_temp_"+timestamp+"_"+Math.random();filename=filename.replace('.','');return file_construct_ref(filename,usage);}
function file_decode_ref(dirkey){if(dirkey.slice(0,7)!='dirent:')
return null;var oldpos=7;var pos=dirkey.indexOf(':',oldpos);if(pos<0)
return null;var usage=dirkey.slice(oldpos,pos);oldpos=pos+1;pos=dirkey.indexOf(':',oldpos);if(pos<0)
return null;var gameid=dirkey.slice(oldpos,pos);oldpos=pos+1;var filename=dirkey.slice(oldpos);var conkey='cont'+dirkey.slice(3);var ref={dirent:dirkey,content:conkey,filename:filename,usage:usage,gameid:gameid};return ref;}
function file_load_dirent(dirent){if(typeof(dirent)!='object'){dirent=file_decode_ref(dirent);if(!dirent)
return null;}
var statstring=localStorage.getItem(dirent.dirent);if(!statstring)
return null;var file={dirent:dirent};var ix,pos,key,val;var ls=statstring.toString().split(',');for(ix=0;ix<ls.length;ix++){val=ls[ix];pos=val.indexOf(':');if(pos<0)
continue;key=val.slice(0,pos);val=val.slice(pos+1);switch(key){case'created':file.created=new Date(Number(val));break;case'modified':file.modified=new Date(Number(val));break;}}
return file;}
function file_ref_exists(ref){var statstring=localStorage.getItem(ref.dirent);if(!statstring)
return false;else
return true;}
function file_remove_ref(ref){localStorage.removeItem(ref.dirent);localStorage.removeItem(ref.content);}
function file_write(dirent,content,israw){var val,ls;var file=file_load_dirent(dirent);if(!file){file={dirent:dirent,created:new Date()};}
file.modified=new Date();if(!israw)
content=encode_array(content);ls=[];if(file.created)
ls.push('created:'+file.created.getTime());if(file.modified)
ls.push('modified:'+file.modified.getTime());val=ls.join(',');localStorage.setItem(file.dirent.dirent,val);localStorage.setItem(file.dirent.content,content);return true;}
function file_read(dirent,israw){var file=file_load_dirent(dirent);if(!file)
return null;var content=localStorage.getItem(dirent.content);if(content==null)
return null;content=content.toString();if(!content){if(israw)
return'';else
return[];}
if(israw)
return content;else
return decode_array(content);}
function file_notimplemented(){throw new Error('streaming function not implemented in Dialog');}
function file_ref_matches(ref,usage,gameid){if(usage!=null){if(ref.usage!=usage)
return false;}
if(gameid!=null){if(ref.gameid!=gameid)
return false;}
return true;}
function files_list(usage,gameid){var ix;var ls=[];if(!localStorage)
return ls;for(ix=0;ix<localStorage.length;ix++){var key=localStorage.key(ix);if(!key)
continue;var dirent=file_decode_ref(key.toString());if(!dirent)
continue;if(!file_ref_matches(dirent,usage,gameid))
continue;var file=file_load_dirent(dirent);ls.push(file);}
return ls;}
function format_date(date){if(!date)
return'???';var day=(date.getMonth()+1)+'/'+date.getDate();var time=date.getHours()+':'+(date.getMinutes()<10?'0':'')+date.getMinutes();return day+' '+time;}
function autosave_write(signature,snapshot){var key='autosave:'+signature;if(!snapshot){localStorage.removeItem(key);}
else{localStorage.setItem(key,JSON.stringify(snapshot));}}
function autosave_read(signature){var key='autosave:'+signature;var val=localStorage.getItem(key);if(val){try{return JSON.parse(val);}
catch(ex){}}
return null;}
var encode_array=null;var decode_array=null;if(window.JSON){encode_array=function(arr){var res=JSON.stringify(arr);var len=res.length;if(res[0]=='"'&&res[len-1]=='"')
res=res.slice(1,len-1);return res;}
decode_array=function(val){return JSON.parse(val);}}
else{encode_array=function(arr){return'['+arr+']';}
decode_array=function(val){return eval(val);}}
var localStorage=null;try{if(window.localStorage!=null){localStorage=window.localStorage;}
else if(window.globalStorage!=null){localStorage=window.globalStorage[location.hostname];}}
catch(ex){}
if(localStorage==null){localStorage={data:{},keys:[],length:0,getItem:function(key){return localStorage.data[key];},setItem:function(key,val){if(localStorage.keys.indexOf(key)<0){localStorage.keys.push(key);localStorage.length=localStorage.keys.length;}
localStorage.data[key]=val;},removeItem:function(key){if(localStorage.keys.indexOf(key)>=0){localStorage.keys=localStorage.keys.without(key);localStorage.length=localStorage.keys.length;delete localStorage.data[key];}},key:function(index){return localStorage.keys[index];},clear:function(){localStorage.data={};localStorage.keys=[];localStorage.length=0;}}}
$(window).on('storage',evhan_storage_changed);return{streaming:false,open:dialog_open,file_clean_fixed_name:file_clean_fixed_name,file_construct_ref:file_construct_ref,file_construct_temp_ref:file_construct_temp_ref,file_ref_exists:file_ref_exists,file_remove_ref:file_remove_ref,file_write:file_write,file_read:file_read,file_fopen:file_notimplemented,autosave_write:autosave_write,autosave_read:autosave_read};}();Glk=function(){var VM=null;var has_canvas;var option_exit_warning;var option_do_vm_autosave;var option_before_select_hook;var option_extevent_hook;var option_glk_gestalt_hook;var has_exited=false;var ui_disabled=false;var ui_specialinput=null;var ui_specialcallback=null;var event_generation=0;var current_partial_inputs=null;var current_partial_outputs=null;function init(vm_options){has_canvas=(document.createElement('canvas').getContext!=undefined);VM=vm_options.vm;if(window.GiDispa)
GiDispa.set_vm(VM);vm_options.accept=accept_ui_event;GlkOte.init(vm_options);option_exit_warning=vm_options.exit_warning;option_do_vm_autosave=vm_options.do_vm_autosave;option_before_select_hook=vm_options.before_select_hook;option_extevent_hook=vm_options.extevent_hook;option_glk_gestalt_hook=vm_options.glk_gestalt_hook;if(option_before_select_hook){option_before_select_hook();}}
function accept_ui_event(obj){var box;if(ui_disabled){qlog("### ui is disabled, ignoring event");return;}
if(obj.gen!=event_generation){GlkOte.log('Input event had wrong generation number: got '+obj.gen+', currently at '+event_generation);return;}
event_generation+=1;current_partial_inputs=obj.partial;switch(obj.type){case'init':content_metrics=obj.metrics;VM.init();break;case'external':var res=null;if(option_extevent_hook){res=option_extevent_hook(obj.value);}
if(!res&&obj.value=='timer'){res={type:Const.evtype_Timer};}
if(res&&res.type){handle_external_input(res);}
break;case'hyperlink':handle_hyperlink_input(obj.window,obj.value);break;case'mouse':handle_mouse_input(obj.window,obj.x,obj.y);break;case'char':handle_char_input(obj.window,obj.value);break;case'line':handle_line_input(obj.window,obj.value,obj.terminator);break;case'arrange':content_metrics=obj.metrics;box={left:content_metrics.outspacingx,top:content_metrics.outspacingy,right:content_metrics.width-content_metrics.outspacingx,bottom:content_metrics.height-content_metrics.outspacingy};if(gli_rootwin)
gli_window_rearrange(gli_rootwin,box);handle_arrange_input();break;case'redraw':handle_redraw_input();break;case'specialresponse':if(obj.response=='fileref_prompt'){gli_fileref_create_by_prompt_callback(obj);}
break;}}
function handle_arrange_input(){if(!gli_selectref)
return;gli_selectref.set_field(0,Const.evtype_Arrange);gli_selectref.set_field(1,null);gli_selectref.set_field(2,0);gli_selectref.set_field(3,0);if(window.GiDispa)
GiDispa.prepare_resume(gli_selectref);gli_selectref=null;VM.resume();}
function handle_redraw_input(){if(!gli_selectref)
return;gli_selectref.set_field(0,Const.evtype_Redraw);gli_selectref.set_field(1,null);gli_selectref.set_field(2,0);gli_selectref.set_field(3,0);if(window.GiDispa)
GiDispa.prepare_resume(gli_selectref);gli_selectref=null;VM.resume();}
function handle_external_input(res){if(!gli_selectref)
return;var val1=0;var val2=0;if(res.val1)
val1=res.val1;if(res.val2)
val2=res.val2;gli_selectref.set_field(0,res.type);gli_selectref.set_field(1,null);gli_selectref.set_field(2,val1);gli_selectref.set_field(3,val2);if(window.GiDispa)
GiDispa.prepare_resume(gli_selectref);gli_selectref=null;VM.resume();}
function handle_hyperlink_input(disprock,val){if(!gli_selectref)
return;var win=null;for(win=gli_windowlist;win;win=win.next){if(win.disprock==disprock)
break;}
if(!win||!win.hyperlink_request)
return;gli_selectref.set_field(0,Const.evtype_Hyperlink);gli_selectref.set_field(1,win);gli_selectref.set_field(2,val);gli_selectref.set_field(3,0);win.hyperlink_request=false;if(window.GiDispa)
GiDispa.prepare_resume(gli_selectref);gli_selectref=null;VM.resume();}
function handle_mouse_input(disprock,xpos,ypos){if(!gli_selectref)
return;var win=null;for(win=gli_windowlist;win;win=win.next){if(win.disprock==disprock)
break;}
if(!win||!win.mouse_request)
return;gli_selectref.set_field(0,Const.evtype_MouseInput);gli_selectref.set_field(1,win);gli_selectref.set_field(2,xpos);gli_selectref.set_field(3,ypos);win.mouse_request=false;if(window.GiDispa)
GiDispa.prepare_resume(gli_selectref);gli_selectref=null;VM.resume();}
function handle_char_input(disprock,input){var charval;if(!gli_selectref)
return;var win=null;for(win=gli_windowlist;win;win=win.next){if(win.disprock==disprock)
break;}
if(!win||!win.char_request)
return;if(input.length==1){charval=input.charCodeAt(0);if(!win.char_request_uni)
charval=charval&0xFF;}
else{charval=KeystrokeNameMap[input];if(!charval)
charval=Const.keycode_Unknown;}
gli_selectref.set_field(0,Const.evtype_CharInput);gli_selectref.set_field(1,win);gli_selectref.set_field(2,charval);gli_selectref.set_field(3,0);win.char_request=false;win.char_request_uni=false;win.input_generation=null;if(window.GiDispa)
GiDispa.prepare_resume(gli_selectref);gli_selectref=null;VM.resume();}
function handle_line_input(disprock,input,termkey){var ix;if(!gli_selectref)
return;var win=null;for(win=gli_windowlist;win;win=win.next){if(win.disprock==disprock)
break;}
if(!win||!win.line_request)
return;if(input.length>win.linebuf.length)
input=input.slice(0,win.linebuf.length);if(win.request_echo_line_input){ix=win.style;gli_set_style(win.str,Const.style_Input);gli_window_put_string(win,input);if(win.echostr)
glk_put_jstring_stream(win.echostr,input);gli_set_style(win.str,ix);gli_window_put_string(win,"\n");if(win.echostr)
glk_put_jstring_stream(win.echostr,"\n");}
for(ix=0;ix<input.length;ix++)
win.linebuf[ix]=input.charCodeAt(ix);var termcode=0;if(termkey&&KeystrokeNameMap[termkey])
termcode=KeystrokeNameMap[termkey];gli_selectref.set_field(0,Const.evtype_LineInput);gli_selectref.set_field(1,win);gli_selectref.set_field(2,input.length);gli_selectref.set_field(3,termcode);if(window.GiDispa)
GiDispa.unretain_array(win.linebuf);win.line_request=false;win.line_request_uni=false;win.request_echo_line_input=null;win.input_generation=null;win.linebuf=null;if(window.GiDispa)
GiDispa.prepare_resume(gli_selectref);gli_selectref=null;VM.resume();}
function update(){var dataobj={type:'update',gen:event_generation};var winarray=null;var contentarray=null;var inputarray=null;var win,obj,robj,useobj,lineobj,ls,val,ix,cx;var initial,lastpos,laststyle,lasthyperlink;if(geometry_changed){geometry_changed=false;winarray=[];for(win=gli_windowlist;win;win=win.next){if(win.type==Const.wintype_Pair)
continue;obj={id:win.disprock,rock:win.rock};winarray.push(obj);switch(win.type){case Const.wintype_TextBuffer:obj.type='buffer';break;case Const.wintype_TextGrid:obj.type='grid';obj.gridwidth=win.gridwidth;obj.gridheight=win.gridheight;break;case Const.wintype_Graphics:obj.type='graphics';obj.graphwidth=win.graphwidth;obj.graphheight=win.graphheight;break;}
obj.left=win.bbox.left;obj.top=win.bbox.top;obj.width=win.bbox.right-win.bbox.left;obj.height=win.bbox.bottom-win.bbox.top;}}
for(win=gli_windowlist;win;win=win.next){useobj=false;obj={id:win.disprock};if(contentarray==null)
contentarray=[];switch(win.type){case Const.wintype_TextBuffer:gli_window_buffer_deaccumulate(win);if(win.content.length){obj.text=win.content.slice(0);win.content.length=0;useobj=true;}
if(win.clearcontent){obj.clear=true;win.clearcontent=false;useobj=true;if(!obj.text){obj.text=[];}
win.reserve.length=0;}
if(obj.text&&obj.text.length){for(ix=0;ix<obj.text.length;ix++){win.reserve.push(obj.text[ix]);}}
if(win.reserve.length>100){win.reserve.splice(0,win.reserve.length-100);}
break;case Const.wintype_TextGrid:if(win.gridwidth==0||win.gridheight==0)
break;obj.lines=[];for(ix=0;ix<win.gridheight;ix++){lineobj=win.lines[ix];if(!lineobj.dirty)
continue;lineobj.dirty=false;ls=[];lastpos=0;for(cx=0;cx<win.gridwidth;){laststyle=lineobj.styles[cx];lasthyperlink=lineobj.hyperlinks[cx];for(;cx<win.gridwidth&&lineobj.styles[cx]==laststyle&&lineobj.hyperlinks[cx]==lasthyperlink;cx++){}
if(lastpos<cx){if(!lasthyperlink){ls.push(StyleNameMap[laststyle]);ls.push(lineobj.chars.slice(lastpos,cx).join(''));}
else{robj={style:StyleNameMap[laststyle],text:lineobj.chars.slice(lastpos,cx).join(''),hyperlink:lasthyperlink};ls.push(robj);}
lastpos=cx;}}
obj.lines.push({line:ix,content:ls});}
useobj=obj.lines.length;break;case Const.wintype_Graphics:if(win.content.length){obj.draw=win.content.slice(0);win.content.length=0;useobj=true;}
var clearedat=-1;if(obj.draw&&obj.draw.length){for(ix=0;ix<obj.draw.length;ix++){var drawel=obj.draw[ix];if(drawel.special=='fill'&&drawel.x===undefined&&drawel.y===undefined&&drawel.width===undefined&&drawel.height===undefined){clearedat=win.reserve.length;}
win.reserve.push(drawel);}}
if(clearedat>=0){var setcol=null;for(ix=0;ix<win.reserve.length&&ix<clearedat;ix++){var drawel=win.reserve[ix];if(drawel.special=='setcolor')
setcol=drawel;}
win.reserve.splice(0,clearedat);if(setcol)
win.reserve.unshift(setcol);}
break;}
if(useobj)
contentarray.push(obj);}
inputarray=[];for(win=gli_windowlist;win;win=win.next){obj=null;if(win.char_request){obj={id:win.disprock,type:'char',gen:win.input_generation};if(win.type==Const.wintype_TextGrid){if(gli_window_grid_canonicalize(win)){obj.xpos=win.gridwidth;obj.ypos=win.gridheight-1;}
else{obj.xpos=win.cursorx;obj.ypos=win.cursory;}}}
if(win.line_request){initial='';if(current_partial_outputs){val=current_partial_outputs[win.disprock];if(val)
initial=val;}
obj={id:win.disprock,type:'line',gen:win.input_generation,maxlen:win.linebuf.length,initial:initial};if(win.line_input_terminators.length){obj.terminators=win.line_input_terminators;}
if(win.type==Const.wintype_TextGrid){if(gli_window_grid_canonicalize(win)){obj.xpos=win.gridwidth;obj.ypos=win.gridheight-1;}
else{obj.xpos=win.cursorx;obj.ypos=win.cursory;}}}
if(win.hyperlink_request){if(!obj)
obj={id:win.disprock};obj.hyperlink=true;}
if(win.mouse_request){if(!obj)
obj={id:win.disprock};obj.mouse=true;}
if(obj)
inputarray.push(obj);}
dataobj.windows=winarray;dataobj.content=contentarray;dataobj.input=inputarray;if(ui_specialinput){dataobj.specialinput=ui_specialinput;}
if(ui_disabled){dataobj.disable=true;}
current_partial_outputs=null;if(gli_autorestore_glkstate)
dataobj.autorestore=gli_autorestore_glkstate;gli_autorestore_glkstate=null;GlkOte.update(dataobj,gli_autorestore_glkstate);if(option_before_select_hook){option_before_select_hook();}
if(option_do_vm_autosave){if(has_exited){VM.do_autosave(-1);}
else{var eventarg=GiDispa.check_autosave();if(eventarg)
VM.do_autosave(eventarg);}}}
function save_allstate(){var res={};if(gli_rootwin)
res.rootwin=gli_rootwin.disprock;if(gli_currentstr)
res.currentstr=gli_currentstr.disprock;if(gli_timer_interval)
res.timer_interval=gli_timer_interval;res.windows=[];for(var win=gli_windowlist;win;win=win.next){var obj={type:win.type,rock:win.rock,disprock:win.disprock,style:win.style,hyperlink:win.hyperlink};if(win.parent)
obj.parent=win.parent.disprock;obj.str=win.str.disprock;if(win.echostr)
obj.echostr=win.echostr.disprock;obj.bbox={left:win.bbox.left,right:win.bbox.right,top:win.bbox.top,bottom:win.bbox.bottom};if(win.linebuf!==null){var info=GiDispa.get_retained_array(win.linebuf);obj.linebuf={addr:info.addr,len:info.len,arr:info.arr.slice(0),arg:info.arg.serialize()};}
obj.char_request=win.char_request;obj.line_request=win.line_request;obj.char_request_uni=win.char_request_uni;obj.line_request_uni=win.line_request_uni;obj.hyperlink_request=win.hyperlink_request;obj.mouse_request=win.mouse_request;obj.echo_line_input=win.echo_line_input;obj.request_echo_line_input=win.request_echo_line_input;obj.line_input_terminators=win.line_input_terminators.slice(0);switch(win.type){case Const.wintype_TextBuffer:obj.reserve=win.reserve.slice(0);break;case Const.wintype_TextGrid:obj.gridwidth=win.gridwidth;obj.gridheight=win.gridheight;obj.lines=[];for(var ix=0;ix<win.lines.length;ix++){var ln=win.lines[ix];obj.lines.push({chars:ln.chars.slice(0),styles:ln.styles.slice(0),hyperlinks:ln.hyperlinks.slice(0)});}
obj.cursorx=win.cursorx;obj.cursory=win.cursory;break;case Const.wintype_Graphics:obj.graphwidth=win.graphwidth;obj.graphheight=win.graphheight;obj.reserve=win.reserve.slice(0);break;case Const.wintype_Pair:obj.pair_dir=win.pair_dir;obj.pair_division=win.pair_division;obj.pair_key=win.pair_key.disprock;obj.pair_keydamage=false;obj.pair_size=win.pair_size;obj.pair_hasborder=win.pair_hasborder;obj.pair_vertical=win.pair_vertical;obj.pair_backward=win.pair_backward;obj.child1=win.child1.disprock;obj.child2=win.child2.disprock;break;}
res.windows.push(obj);}
res.streams=[];for(var str=gli_streamlist;str;str=str.next){var obj={type:str.type,rock:str.rock,disprock:str.disprock,unicode:str.unicode,isbinary:str.isbinary,readcount:str.readcount,writecount:str.writecount,readable:str.readable,writable:str.writable,streaming:str.streaming};switch(str.type){case strtype_Window:if(str.win)
obj.win=str.win.disprock;break;case strtype_Memory:if(str.buf!==null){var info=GiDispa.get_retained_array(str.buf);obj.buf={addr:info.addr,len:info.len,arr:info.arr.slice(0),arg:info.arg.serialize()};}
obj.buflen=str.buflen;obj.bufpos=str.bufpos;obj.bufeof=str.bufeof;break;case strtype_Resource:obj.resfilenum=str.resfilenum;obj.buflen=str.buflen;obj.bufpos=str.bufpos;obj.bufeof=str.bufeof;break;case strtype_File:obj.origfmode=str.origfmode;if(!Dialog.streaming){obj.ref=str.ref;gli_stream_flush_file(str);obj.buflen=str.buflen;obj.bufpos=str.bufpos;obj.bufeof=str.bufeof;}
else{str.fstream.fflush();obj.ref=str.ref;obj.filepos=str.fstream.ftell();}
break;}
res.streams.push(obj);}
res.filerefs=[];for(var fref=gli_filereflist;fref;fref=fref.next){var obj={type:fref.type,rock:fref.rock,disprock:fref.disprock,filename:fref.filename,textmode:fref.textmode,filetype:fref.filetype,filetypename:fref.filetypename};obj.ref=fref.ref;res.filerefs.push(obj);}
res.glkote=GlkOte.save_allstate();return res;}
function restore_allstate(res)
{if(gli_windowlist||gli_streamlist||gli_filereflist)
throw('restore_allstate: glkapi module has already been launched');for(var ix=res.windows.length-1;ix>=0;ix--){var obj=res.windows[ix];var win={type:obj.type,rock:obj.rock,disprock:obj.disprock,style:obj.style,hyperlink:obj.hyperlink};GiDispa.class_register('window',win,win.disprock);win.prev=null;win.next=gli_windowlist;gli_windowlist=win;if(win.next)
win.next.prev=win;}
for(var ix=res.streams.length-1;ix>=0;ix--){var obj=res.streams[ix];var str={type:obj.type,rock:obj.rock,disprock:obj.disprock,unicode:obj.unicode,isbinary:obj.isbinary,readcount:obj.readcount,writecount:obj.writecount,readable:obj.readable,writable:obj.writable,streaming:obj.streaming};GiDispa.class_register('stream',str,str.disprock);str.prev=null;str.next=gli_streamlist;gli_streamlist=str;if(str.next)
str.next.prev=str;}
for(var ix=res.filerefs.length-1;ix>=0;ix--){var obj=res.filerefs[ix];var fref={type:obj.type,rock:obj.rock,disprock:obj.disprock,filename:obj.filename,textmode:obj.textmode,filetype:obj.filetype,filetypename:obj.filetypename};GiDispa.class_register('fileref',fref,fref.disprock);fref.prev=null;fref.next=gli_filereflist;gli_filereflist=fref;if(fref.next)
fref.next.prev=fref;}
for(var ix=0;ix<res.windows.length;ix++){var obj=res.windows[ix];var win=GiDispa.class_obj_from_id('window',obj.disprock);win.parent=GiDispa.class_obj_from_id('window',obj.parent);win.str=GiDispa.class_obj_from_id('stream',obj.str);win.echostr=GiDispa.class_obj_from_id('stream',obj.echostr);win.bbox={left:obj.bbox.left,right:obj.bbox.right,top:obj.bbox.top,bottom:obj.bbox.bottom};win.input_generation=null;if(obj.char_request||obj.line_request)
win.input_generation=event_generation;win.linebuf=null;if(obj.linebuf!==undefined){win.linebuf=obj.linebuf.arr;GiDispa.retain_array(win.linebuf,obj.linebuf);}
win.char_request=obj.char_request;win.line_request=obj.line_request;win.char_request_uni=obj.char_request_uni;win.line_request_uni=obj.line_request_uni;win.hyperlink_request=obj.hyperlink_request;win.mouse_request=obj.mouse_request;win.echo_line_input=obj.echo_line_input;win.request_echo_line_input=obj.request_echo_line_input;win.line_input_terminators=obj.line_input_terminators.slice(0);switch(win.type){case Const.wintype_TextBuffer:win.accum=[];win.accumstyle=win.style;win.accumhyperlink=win.hyperlink;win.content=obj.reserve.slice(0);win.clearcontent=false;win.reserve=[];break;case Const.wintype_TextGrid:win.gridwidth=obj.gridwidth;win.gridheight=obj.gridheight;win.lines=[];for(var jx=0;jx<obj.lines.length;jx++){var ln=obj.lines[jx];win.lines.push({dirty:true,chars:ln.chars.slice(0),styles:ln.styles.slice(0),hyperlinks:ln.hyperlinks.slice(0)});}
win.cursorx=obj.cursorx;win.cursory=obj.cursory;break;case Const.wintype_Graphics:win.graphwidth=obj.graphwidth;win.graphheight=obj.graphheight;win.content=obj.reserve.slice(0);win.reserve=[];break;case Const.wintype_Pair:win.pair_dir=obj.pair_dir;win.pair_division=obj.pair_division;win.pair_key=GiDispa.class_obj_from_id('window',obj.pair_key);win.pair_keydamage=false;win.pair_size=obj.pair_size;win.pair_hasborder=obj.pair_hasborder;win.pair_vertical=obj.pair_vertical;win.pair_backward=obj.pair_backward;win.child1=GiDispa.class_obj_from_id('window',obj.child1);win.child2=GiDispa.class_obj_from_id('window',obj.child2);break;}}
for(var ix=0;ix<res.streams.length;ix++){var obj=res.streams[ix];var str=GiDispa.class_obj_from_id('stream',obj.disprock);str.win=null;str.ref=null;str.file=null;str.buf=null;str.bufpos=0;str.buflen=0;str.bufeof=0;str.timer_id=null;str.flush_func=null;str.fstream=null;switch(str.type){case strtype_Window:str.win=GiDispa.class_obj_from_id('window',obj.win);break;case strtype_Memory:if(obj.buf!==undefined){str.buf=obj.buf.arr;GiDispa.retain_array(str.buf,obj.buf);}
str.buflen=obj.buflen;str.bufpos=obj.bufpos;str.bufeof=obj.bufeof;break;case strtype_Resource:str.resfilenum=obj.resfilenum;var el=GiLoad.find_data_chunk(str.resfilenum);if(el){str.buf=el.data;}
str.buflen=obj.buflen;str.bufpos=obj.bufpos;str.bufeof=obj.bufeof;break;case strtype_File:str.origfmode=obj.origfmode;if(!Dialog.streaming){str.ref=obj.ref;str.buflen=obj.buflen;str.bufpos=obj.bufpos;str.bufeof=obj.bufeof;var content=Dialog.file_read(str.ref);if(content==null){content=[];Dialog.file_write(str.ref,'',true);}
str.buf=content;str.bufeof=content.length;if(str.bufpos>str.bufeof)
str.bufpos=str.bufeof;}
else{str.ref=obj.ref;str.fstream=Dialog.file_fopen(str.origfmode,str.ref);if(!str.fstream){var tempref=Dialog.file_construct_temp_ref(str.ref.usage);str.fstream=Dialog.file_fopen(str.origfmode,tempref);if(!str.fstream)
throw('restore_allstate: could not reopen even a temp stream for: '+str.ref.filename);}
if(str.origfmode!=Const.filemode_WriteAppend){str.fstream.fseek(obj.filepos,Const.seekmode_Start);}
str.buffer4=new str.fstream.BufferClass(4);}
break;}}
for(var ix=0;ix<res.filerefs.length;ix++){var obj=res.filerefs[ix];var fref=GiDispa.class_obj_from_id('fileref',obj.disprock);fref.ref=obj.ref;}
gli_rootwin=GiDispa.class_obj_from_id('window',res.rootwin);gli_currentstr=GiDispa.class_obj_from_id('stream',res.currentstr);if(res.timer_interval)
glk_request_timer_events(res.timer_interval);gli_autorestore_glkstate=res.glkote;}
function fatal_error(msg){has_exited=true;ui_disabled=true;GlkOte.error(msg);var dataobj={type:'update',gen:event_generation,disable:true};dataobj.input=[];GlkOte.update(dataobj);}
var Const={gestalt_Version:0,gestalt_CharInput:1,gestalt_LineInput:2,gestalt_CharOutput:3,gestalt_CharOutput_CannotPrint:0,gestalt_CharOutput_ApproxPrint:1,gestalt_CharOutput_ExactPrint:2,gestalt_MouseInput:4,gestalt_Timer:5,gestalt_Graphics:6,gestalt_DrawImage:7,gestalt_Sound:8,gestalt_SoundVolume:9,gestalt_SoundNotify:10,gestalt_Hyperlinks:11,gestalt_HyperlinkInput:12,gestalt_SoundMusic:13,gestalt_GraphicsTransparency:14,gestalt_Unicode:15,gestalt_UnicodeNorm:16,gestalt_LineInputEcho:17,gestalt_LineTerminators:18,gestalt_LineTerminatorKey:19,gestalt_DateTime:20,gestalt_Sound2:21,gestalt_ResourceStream:22,gestalt_GraphicsCharInput:23,keycode_Unknown:0xffffffff,keycode_Left:0xfffffffe,keycode_Right:0xfffffffd,keycode_Up:0xfffffffc,keycode_Down:0xfffffffb,keycode_Return:0xfffffffa,keycode_Delete:0xfffffff9,keycode_Escape:0xfffffff8,keycode_Tab:0xfffffff7,keycode_PageUp:0xfffffff6,keycode_PageDown:0xfffffff5,keycode_Home:0xfffffff4,keycode_End:0xfffffff3,keycode_Func1:0xffffffef,keycode_Func2:0xffffffee,keycode_Func3:0xffffffed,keycode_Func4:0xffffffec,keycode_Func5:0xffffffeb,keycode_Func6:0xffffffea,keycode_Func7:0xffffffe9,keycode_Func8:0xffffffe8,keycode_Func9:0xffffffe7,keycode_Func10:0xffffffe6,keycode_Func11:0xffffffe5,keycode_Func12:0xffffffe4,keycode_MAXVAL:28,evtype_None:0,evtype_Timer:1,evtype_CharInput:2,evtype_LineInput:3,evtype_MouseInput:4,evtype_Arrange:5,evtype_Redraw:6,evtype_SoundNotify:7,evtype_Hyperlink:8,evtype_VolumeNotify:9,style_Normal:0,style_Emphasized:1,style_Preformatted:2,style_Header:3,style_Subheader:4,style_Alert:5,style_Note:6,style_BlockQuote:7,style_Input:8,style_User1:9,style_User2:10,style_NUMSTYLES:11,wintype_AllTypes:0,wintype_Pair:1,wintype_Blank:2,wintype_TextBuffer:3,wintype_TextGrid:4,wintype_Graphics:5,winmethod_Left:0x00,winmethod_Right:0x01,winmethod_Above:0x02,winmethod_Below:0x03,winmethod_DirMask:0x0f,winmethod_Fixed:0x10,winmethod_Proportional:0x20,winmethod_DivisionMask:0xf0,winmethod_Border:0x000,winmethod_NoBorder:0x100,winmethod_BorderMask:0x100,fileusage_Data:0x00,fileusage_SavedGame:0x01,fileusage_Transcript:0x02,fileusage_InputRecord:0x03,fileusage_TypeMask:0x0f,fileusage_TextMode:0x100,fileusage_BinaryMode:0x000,filemode_Write:0x01,filemode_Read:0x02,filemode_ReadWrite:0x03,filemode_WriteAppend:0x05,seekmode_Start:0,seekmode_Current:1,seekmode_End:2,stylehint_Indentation:0,stylehint_ParaIndentation:1,stylehint_Justification:2,stylehint_Size:3,stylehint_Weight:4,stylehint_Oblique:5,stylehint_Proportional:6,stylehint_TextColor:7,stylehint_BackColor:8,stylehint_ReverseColor:9,stylehint_NUMHINTS:10,stylehint_just_LeftFlush:0,stylehint_just_LeftRight:1,stylehint_just_Centered:2,stylehint_just_RightFlush:3,imagealign_InlineUp:1,imagealign_InlineDown:2,imagealign_InlineCenter:3,imagealign_MarginLeft:4,imagealign_MarginRight:5};var KeystrokeNameMap={left:Const.keycode_Left,right:Const.keycode_Right,up:Const.keycode_Up,down:Const.keycode_Down,'return':Const.keycode_Return,'delete':Const.keycode_Delete,escape:Const.keycode_Escape,tab:Const.keycode_Tab,pageup:Const.keycode_PageUp,pagedown:Const.keycode_PageDown,home:Const.keycode_Home,end:Const.keycode_End,func1:Const.keycode_Func1,func2:Const.keycode_Func2,func3:Const.keycode_Func3,func4:Const.keycode_Func4,func5:Const.keycode_Func5,func6:Const.keycode_Func6,func7:Const.keycode_Func7,func8:Const.keycode_Func8,func9:Const.keycode_Func9,func10:Const.keycode_Func10,func11:Const.keycode_Func11,func12:Const.keycode_Func12};var KeystrokeValueMap=null;var StyleNameMap={0:'normal',1:'emphasized',2:'preformatted',3:'header',4:'subheader',5:'alert',6:'note',7:'blockquote',8:'input',9:'user1',10:'user2'};var FileTypeMap={0:'data',1:'save',2:'transcript',3:'command'};var unicode_upper_table={181:924,223:[83,83],255:376,305:73,329:[700,78],383:83,405:502,414:544,447:503,454:452,457:455,460:458,477:398,496:[74,780],499:497,595:385,596:390,598:393,599:394,601:399,603:400,608:403,611:404,616:407,617:406,623:412,626:413,629:415,640:422,643:425,648:430,650:433,651:434,658:439,837:921,912:[921,776,769],940:902,941:904,942:905,943:906,944:[933,776,769],962:931,972:908,973:910,974:911,976:914,977:920,981:934,982:928,1008:922,1010:1017,1013:917,1415:[1333,1362],7830:[72,817],7831:[84,776],7832:[87,778],7833:[89,778],7834:[65,702],7835:7776,8016:[933,787],8018:[933,787,768],8020:[933,787,769],8022:[933,787,834],8048:8122,8049:8123,8050:8136,8051:8137,8052:8138,8053:8139,8054:8154,8055:8155,8056:8184,8057:8185,8058:8170,8059:8171,8060:8186,8061:8187,8064:[7944,921],8065:[7945,921],8066:[7946,921],8067:[7947,921],8068:[7948,921],8069:[7949,921],8070:[7950,921],8071:[7951,921],8072:[7944,921],8073:[7945,921],8074:[7946,921],8075:[7947,921],8076:[7948,921],8077:[7949,921],8078:[7950,921],8079:[7951,921],8080:[7976,921],8081:[7977,921],8082:[7978,921],8083:[7979,921],8084:[7980,921],8085:[7981,921],8086:[7982,921],8087:[7983,921],8088:[7976,921],8089:[7977,921],8090:[7978,921],8091:[7979,921],8092:[7980,921],8093:[7981,921],8094:[7982,921],8095:[7983,921],8096:[8040,921],8097:[8041,921],8098:[8042,921],8099:[8043,921],8100:[8044,921],8101:[8045,921],8102:[8046,921],8103:[8047,921],8104:[8040,921],8105:[8041,921],8106:[8042,921],8107:[8043,921],8108:[8044,921],8109:[8045,921],8110:[8046,921],8111:[8047,921],8114:[8122,921],8115:[913,921],8116:[902,921],8118:[913,834],8119:[913,834,921],8124:[913,921],8126:921,8130:[8138,921],8131:[919,921],8132:[905,921],8134:[919,834],8135:[919,834,921],8140:[919,921],8146:[921,776,768],8147:[921,776,769],8150:[921,834],8151:[921,776,834],8162:[933,776,768],8163:[933,776,769],8164:[929,787],8165:8172,8166:[933,834],8167:[933,776,834],8178:[8186,921],8179:[937,921],8180:[911,921],8182:[937,834],8183:[937,834,921],8188:[937,921],64256:[70,70],64257:[70,73],64258:[70,76],64259:[70,70,73],64260:[70,70,76],64261:[83,84],64262:[83,84],64275:[1348,1350],64276:[1348,1333],64277:[1348,1339],64278:[1358,1350],64279:[1348,1341]};(function(){var ls,ix,val;var map=unicode_upper_table;ls=[7936,7937,7938,7939,7940,7941,7942,7943,7952,7953,7954,7955,7956,7957,7968,7969,7970,7971,7972,7973,7974,7975,7984,7985,7986,7987,7988,7989,7990,7991,8000,8001,8002,8003,8004,8005,8017,8019,8021,8023,8032,8033,8034,8035,8036,8037,8038,8039,8112,8113,8144,8145,8160,8161,];for(ix=0;ix<54;ix++){val=ls[ix];map[val]=val+8;}
for(val=257;val<=303;val+=2){map[val]=val-1;}
for(val=331;val<=375;val+=2){map[val]=val-1;}
for(val=505;val<=543;val+=2){map[val]=val-1;}
for(val=1121;val<=1153;val+=2){map[val]=val-1;}
for(val=1163;val<=1215;val+=2){map[val]=val-1;}
for(val=1233;val<=1269;val+=2){map[val]=val-1;}
for(val=7681;val<=7829;val+=2){map[val]=val-1;}
for(val=7841;val<=7929;val+=2){map[val]=val-1;}
ls=[307,309,311,314,316,318,320,322,324,326,328,378,380,382,387,389,392,396,402,409,417,419,421,424,429,432,436,438,441,445,453,456,459,462,464,466,468,470,472,474,476,479,481,483,485,487,489,491,493,495,498,501,547,549,551,553,555,557,559,561,563,985,987,989,991,993,995,997,999,1001,1003,1005,1007,1016,1019,1218,1220,1222,1224,1226,1228,1230,1273,1281,1283,1285,1287,1289,1291,1293,1295,];for(ix=0;ix<91;ix++){val=ls[ix];map[val]=val-1;}
for(val=8560;val<=8575;val+=1){map[val]=val-16;}
for(val=9424;val<=9449;val+=1){map[val]=val-26;}
for(val=97;val<=122;val+=1){map[val]=val-32;}
for(val=224;val<=246;val+=1){map[val]=val-32;}
for(val=945;val<=961;val+=1){map[val]=val-32;}
for(val=1072;val<=1103;val+=1){map[val]=val-32;}
for(val=65345;val<=65370;val+=1){map[val]=val-32;}
ls=[248,249,250,251,252,253,254,963,964,965,966,967,968,969,970,971,];for(ix=0;ix<16;ix++){val=ls[ix];map[val]=val-32;}
for(val=66600;val<=66639;val+=1){map[val]=val-40;}
for(val=1377;val<=1414;val+=1){map[val]=val-48;}
for(val=1104;val<=1119;val+=1){map[val]=val-80;}
map[1009]=929;})();var unicode_lower_table={304:[105,775],376:255,385:595,390:596,393:598,394:599,398:477,399:601,400:603,403:608,404:611,406:617,407:616,412:623,413:626,415:629,422:640,425:643,430:648,433:650,434:651,439:658,452:454,455:457,458:460,497:499,502:405,503:447,544:414,902:940,904:941,905:942,906:943,908:972,910:973,911:974,1012:952,1017:1010,8122:8048,8123:8049,8124:8115,8136:8050,8137:8051,8138:8052,8139:8053,8140:8131,8154:8054,8155:8055,8170:8058,8171:8059,8172:8165,8184:8056,8185:8057,8186:8060,8187:8061,8188:8179,8486:969,8490:107,8491:229};(function(){var ls,ix,val;var map=unicode_lower_table;for(val=1024;val<=1039;val+=1){map[val]=val+80;}
for(val=1329;val<=1366;val+=1){map[val]=val+48;}
for(val=66560;val<=66599;val+=1){map[val]=val+40;}
for(val=65;val<=90;val+=1){map[val]=val+32;}
for(val=192;val<=214;val+=1){map[val]=val+32;}
for(val=913;val<=929;val+=1){map[val]=val+32;}
for(val=1040;val<=1071;val+=1){map[val]=val+32;}
for(val=65313;val<=65338;val+=1){map[val]=val+32;}
ls=[216,217,218,219,220,221,222,931,932,933,934,935,936,937,938,939,];for(ix=0;ix<16;ix++){val=ls[ix];map[val]=val+32;}
for(val=9398;val<=9423;val+=1){map[val]=val+26;}
for(val=8544;val<=8559;val+=1){map[val]=val+16;}
for(val=256;val<=302;val+=2){map[val]=val+1;}
for(val=330;val<=374;val+=2){map[val]=val+1;}
for(val=504;val<=542;val+=2){map[val]=val+1;}
for(val=1120;val<=1152;val+=2){map[val]=val+1;}
for(val=1162;val<=1214;val+=2){map[val]=val+1;}
for(val=1232;val<=1268;val+=2){map[val]=val+1;}
for(val=7680;val<=7828;val+=2){map[val]=val+1;}
for(val=7840;val<=7928;val+=2){map[val]=val+1;}
ls=[306,308,310,313,315,317,319,321,323,325,327,377,379,381,386,388,391,395,401,408,416,418,420,423,428,431,435,437,440,444,453,456,459,461,463,465,467,469,471,473,475,478,480,482,484,486,488,490,492,494,498,500,546,548,550,552,554,556,558,560,562,984,986,988,990,992,994,996,998,1000,1002,1004,1006,1015,1018,1217,1219,1221,1223,1225,1227,1229,1272,1280,1282,1284,1286,1288,1290,1292,1294,];for(ix=0;ix<91;ix++){val=ls[ix];map[val]=val+1;}
ls=[7944,7945,7946,7947,7948,7949,7950,7951,7960,7961,7962,7963,7964,7965,7976,7977,7978,7979,7980,7981,7982,7983,7992,7993,7994,7995,7996,7997,7998,7999,8008,8009,8010,8011,8012,8013,8025,8027,8029,8031,8040,8041,8042,8043,8044,8045,8046,8047,8072,8073,8074,8075,8076,8077,8078,8079,8088,8089,8090,8091,8092,8093,8094,8095,8104,8105,8106,8107,8108,8109,8110,8111,8120,8121,8152,8153,8168,8169,];for(ix=0;ix<78;ix++){val=ls[ix];map[val]=val-8;}})();var unicode_title_table={223:[83,115],452:453,453:453,454:453,455:456,456:456,457:456,458:459,459:459,460:459,497:498,498:498,499:498,1415:[1333,1410],8114:[8122,837],8115:8124,8116:[902,837],8119:[913,834,837],8124:8124,8130:[8138,837],8131:8140,8132:[905,837],8135:[919,834,837],8140:8140,8178:[8186,837],8179:8188,8180:[911,837],8183:[937,834,837],8188:8188,64256:[70,102],64257:[70,105],64258:[70,108],64259:[70,102,105],64260:[70,102,108],64261:[83,116],64262:[83,116],64275:[1348,1398],64276:[1348,1381],64277:[1348,1387],64278:[1358,1398],64279:[1348,1389]};(function(){var ls,ix,val;var map=unicode_title_table;ls=[8072,8073,8074,8075,8076,8077,8078,8079,8072,8073,8074,8075,8076,8077,8078,8079,8088,8089,8090,8091,8092,8093,8094,8095,8088,8089,8090,8091,8092,8093,8094,8095,8104,8105,8106,8107,8108,8109,8110,8111,8104,8105,8106,8107,8108,8109,8110,8111,];for(ix=0;ix<48;ix++){val=ls[ix];map[ix+8064]=val;}})();var unicode_decomp_table={192:[65,768],193:[65,769],194:[65,770],195:[65,771],196:[65,776],197:[65,778],199:[67,807],200:[69,768],201:[69,769],202:[69,770],203:[69,776],204:[73,768],205:[73,769],206:[73,770],207:[73,776],209:[78,771],210:[79,768],211:[79,769],212:[79,770],213:[79,771],214:[79,776],217:[85,768],218:[85,769],219:[85,770],220:[85,776],221:[89,769],224:[97,768],225:[97,769],226:[97,770],227:[97,771],228:[97,776],229:[97,778],231:[99,807],232:[101,768],233:[101,769],234:[101,770],235:[101,776],236:[105,768],237:[105,769],238:[105,770],239:[105,776],241:[110,771],242:[111,768],243:[111,769],244:[111,770],245:[111,771],246:[111,776],249:[117,768],250:[117,769],251:[117,770],252:[117,776],253:[121,769],296:[73,771],297:[105,771],298:[73,772],299:[105,772],300:[73,774],301:[105,774],302:[73,808],303:[105,808],304:[73,775],308:[74,770],309:[106,770],310:[75,807],311:[107,807],313:[76,769],314:[108,769],315:[76,807],316:[108,807],317:[76,780],318:[108,780],323:[78,769],324:[110,769],325:[78,807],326:[110,807],327:[78,780],328:[110,780],332:[79,772],333:[111,772],334:[79,774],335:[111,774],336:[79,779],337:[111,779],416:[79,795],417:[111,795],431:[85,795],432:[117,795],478:[65,776,772],479:[97,776,772],480:[65,775,772],481:[97,775,772],482:[198,772],483:[230,772],486:[71,780],487:[103,780],488:[75,780],489:[107,780],490:[79,808],491:[111,808],492:[79,808,772],493:[111,808,772],494:[439,780],495:[658,780],496:[106,780],500:[71,769],501:[103,769],542:[72,780],543:[104,780],550:[65,775],551:[97,775],552:[69,807],553:[101,807],554:[79,776,772],555:[111,776,772],556:[79,771,772],557:[111,771,772],558:[79,775],559:[111,775],560:[79,775,772],561:[111,775,772],562:[89,772],563:[121,772],832:768,833:769,835:787,836:[776,769],884:697,894:59,901:[168,769],902:[913,769],903:183,904:[917,769],905:[919,769],906:[921,769],908:[927,769],910:[933,769],911:[937,769],912:[953,776,769],938:[921,776],939:[933,776],940:[945,769],941:[949,769],942:[951,769],943:[953,769],944:[965,776,769],970:[953,776],971:[965,776],972:[959,769],973:[965,769],974:[969,769],979:[978,769],980:[978,776],1024:[1045,768],1025:[1045,776],1027:[1043,769],1031:[1030,776],1036:[1050,769],1037:[1048,768],1038:[1059,774],1049:[1048,774],1081:[1080,774],1104:[1077,768],1105:[1077,776],1107:[1075,769],1111:[1110,776],1116:[1082,769],1117:[1080,768],1118:[1091,774],1142:[1140,783],1143:[1141,783],1217:[1046,774],1218:[1078,774],1232:[1040,774],1233:[1072,774],1234:[1040,776],1235:[1072,776],1238:[1045,774],1239:[1077,774],1242:[1240,776],1243:[1241,776],1244:[1046,776],1245:[1078,776],1246:[1047,776],1247:[1079,776],1250:[1048,772],1251:[1080,772],1252:[1048,776],1253:[1080,776],1254:[1054,776],1255:[1086,776],1258:[1256,776],1259:[1257,776],1260:[1069,776],1261:[1101,776],1262:[1059,772],1263:[1091,772],1264:[1059,776],1265:[1091,776],1266:[1059,779],1267:[1091,779],1268:[1063,776],1269:[1095,776],1272:[1067,776],1273:[1099,776],1570:[1575,1619],1571:[1575,1620],1572:[1608,1620],1573:[1575,1621],1574:[1610,1620],1728:[1749,1620],1730:[1729,1620],1747:[1746,1620],2345:[2344,2364],2353:[2352,2364],2356:[2355,2364],2392:[2325,2364],2393:[2326,2364],2394:[2327,2364],2395:[2332,2364],2396:[2337,2364],2397:[2338,2364],2398:[2347,2364],2399:[2351,2364],2507:[2503,2494],2508:[2503,2519],2524:[2465,2492],2525:[2466,2492],2527:[2479,2492],2611:[2610,2620],2614:[2616,2620],2649:[2582,2620],2650:[2583,2620],2651:[2588,2620],2654:[2603,2620],2888:[2887,2902],2891:[2887,2878],2892:[2887,2903],2908:[2849,2876],2909:[2850,2876],2964:[2962,3031],3018:[3014,3006],3019:[3015,3006],3020:[3014,3031],3144:[3142,3158],3264:[3263,3285],3271:[3270,3285],3272:[3270,3286],3274:[3270,3266],3275:[3270,3266,3285],3402:[3398,3390],3403:[3399,3390],3404:[3398,3415],3546:[3545,3530],3548:[3545,3535],3549:[3545,3535,3530],3550:[3545,3551],3907:[3906,4023],3917:[3916,4023],3922:[3921,4023],3927:[3926,4023],3932:[3931,4023],3945:[3904,4021],3955:[3953,3954],3957:[3953,3956],3958:[4018,3968],3960:[4019,3968],3969:[3953,3968],3987:[3986,4023],3997:[3996,4023],4002:[4001,4023],4007:[4006,4023],4012:[4011,4023],4025:[3984,4021],4134:[4133,4142],7835:[383,775],7960:[917,787],7961:[917,788],7962:[917,787,768],7963:[917,788,768],7964:[917,787,769],7965:[917,788,769],8008:[927,787],8009:[927,788],8010:[927,787,768],8011:[927,788,768],8012:[927,787,769],8013:[927,788,769],8016:[965,787],8017:[965,788],8018:[965,787,768],8019:[965,788,768],8020:[965,787,769],8021:[965,788,769],8022:[965,787,834],8023:[965,788,834],8025:[933,788],8027:[933,788,768],8029:[933,788,769],8118:[945,834],8119:[945,834,837],8120:[913,774],8121:[913,772],8122:[913,768],8123:[913,769],8124:[913,837],8126:953,8129:[168,834],8130:[951,768,837],8131:[951,837],8132:[951,769,837],8134:[951,834],8135:[951,834,837],8136:[917,768],8137:[917,769],8138:[919,768],8139:[919,769],8140:[919,837],8141:[8127,768],8142:[8127,769],8143:[8127,834],8144:[953,774],8145:[953,772],8146:[953,776,768],8147:[953,776,769],8150:[953,834],8151:[953,776,834],8152:[921,774],8153:[921,772],8154:[921,768],8155:[921,769],8178:[969,768,837],8179:[969,837],8180:[969,769,837],8182:[969,834],8183:[969,834,837],8184:[927,768],8185:[927,769],8186:[937,768],8187:[937,769],8188:[937,837],8189:180,8192:8194,8193:8195,8486:937,8490:75,8491:[65,778],8602:[8592,824],8603:[8594,824],8622:[8596,824],8653:[8656,824],8654:[8660,824],8655:[8658,824],8708:[8707,824],8713:[8712,824],8716:[8715,824],8740:[8739,824],8742:[8741,824],8769:[8764,824],8772:[8771,824],8775:[8773,824],8777:[8776,824],8800:[61,824],8802:[8801,824],8813:[8781,824],8814:[60,824],8815:[62,824],8816:[8804,824],8817:[8805,824],8820:[8818,824],8821:[8819,824],8824:[8822,824],8825:[8823,824],8832:[8826,824],8833:[8827,824],8836:[8834,824],8837:[8835,824],8840:[8838,824],8841:[8839,824],8876:[8866,824],8877:[8872,824],8878:[8873,824],8879:[8875,824],8928:[8828,824],8929:[8829,824],8930:[8849,824],8931:[8850,824],8938:[8882,824],8939:[8883,824],8940:[8884,824],8941:[8885,824],9001:12296,9002:12297,10972:[10973,824],12364:[12363,12441],12366:[12365,12441],12368:[12367,12441],12370:[12369,12441],12372:[12371,12441],12374:[12373,12441],12376:[12375,12441],12378:[12377,12441],12380:[12379,12441],12382:[12381,12441],12384:[12383,12441],12386:[12385,12441],12389:[12388,12441],12391:[12390,12441],12393:[12392,12441],12400:[12399,12441],12401:[12399,12442],12403:[12402,12441],12404:[12402,12442],12406:[12405,12441],12407:[12405,12442],12409:[12408,12441],12410:[12408,12442],12412:[12411,12441],12413:[12411,12442],12436:[12358,12441],12446:[12445,12441],12460:[12459,12441],12462:[12461,12441],12464:[12463,12441],12466:[12465,12441],12468:[12467,12441],12470:[12469,12441],12472:[12471,12441],12474:[12473,12441],12476:[12475,12441],12478:[12477,12441],12480:[12479,12441],12482:[12481,12441],12485:[12484,12441],12487:[12486,12441],12489:[12488,12441],12496:[12495,12441],12497:[12495,12442],12499:[12498,12441],12500:[12498,12442],12502:[12501,12441],12503:[12501,12442],12505:[12504,12441],12506:[12504,12442],12508:[12507,12441],12509:[12507,12442],12532:[12454,12441],12535:[12527,12441],12536:[12528,12441],12537:[12529,12441],12538:[12530,12441],12542:[12541,12441],64016:22618,64018:26228,64021:20958,64022:29482,64023:30410,64024:31036,64025:31070,64026:31077,64027:31119,64028:38742,64029:31934,64030:32701,64032:34322,64034:35576,64037:36920,64038:37117,64042:39151,64043:39164,64044:39208,64045:40372,64285:[1497,1460],64287:[1522,1463],64298:[1513,1473],64299:[1513,1474],64300:[1513,1468,1473],64301:[1513,1468,1474],64302:[1488,1463],64303:[1488,1464],64304:[1488,1468],64305:[1489,1468],64306:[1490,1468],64307:[1491,1468],64308:[1492,1468],64309:[1493,1468],64310:[1494,1468],64312:[1496,1468],64313:[1497,1468],64314:[1498,1468],64315:[1499,1468],64316:[1500,1468],64318:[1502,1468],64320:[1504,1468],64321:[1505,1468],64323:[1507,1468],64324:[1508,1468],64326:[1510,1468],64327:[1511,1468],64328:[1512,1468],64329:[1513,1468],64330:[1514,1468],64331:[1493,1465],64332:[1489,1471],64333:[1499,1471],64334:[1508,1471],119134:[119127,119141],119135:[119128,119141],119136:[119128,119141,119150],119137:[119128,119141,119151],119138:[119128,119141,119152],119139:[119128,119141,119153],119140:[119128,119141,119154],119227:[119225,119141],119228:[119226,119141],119229:[119225,119141,119150],119230:[119226,119141,119150],119231:[119225,119141,119151],119232:[119226,119141,119151]};(function(){var ls,ix,val;var map=unicode_decomp_table;ls=[[121,776],[65,772],[97,772],[65,774],[97,774],[65,808],[97,808],[67,769],[99,769],[67,770],[99,770],[67,775],[99,775],[67,780],[99,780],[68,780],[100,780],];for(ix=0;ix<17;ix++){val=ls[ix];map[ix+255]=val;}
ls=[[69,772],[101,772],[69,774],[101,774],[69,775],[101,775],[69,808],[101,808],[69,780],[101,780],[71,770],[103,770],[71,774],[103,774],[71,775],[103,775],[71,807],[103,807],[72,770],[104,770],];for(ix=0;ix<20;ix++){val=ls[ix];map[ix+274]=val;}
ls=[[82,769],[114,769],[82,807],[114,807],[82,780],[114,780],[83,769],[115,769],[83,770],[115,770],[83,807],[115,807],[83,780],[115,780],[84,807],[116,807],[84,780],[116,780],];for(ix=0;ix<18;ix++){val=ls[ix];map[ix+340]=val;}
ls=[[85,771],[117,771],[85,772],[117,772],[85,774],[117,774],[85,778],[117,778],[85,779],[117,779],[85,808],[117,808],[87,770],[119,770],[89,770],[121,770],[89,776],[90,769],[122,769],[90,775],[122,775],[90,780],[122,780],];for(ix=0;ix<23;ix++){val=ls[ix];map[ix+360]=val;}
ls=[[65,780],[97,780],[73,780],[105,780],[79,780],[111,780],[85,780],[117,780],[85,776,772],[117,776,772],[85,776,769],[117,776,769],[85,776,780],[117,776,780],[85,776,768],[117,776,768],];for(ix=0;ix<16;ix++){val=ls[ix];map[ix+461]=val;}
ls=[[78,768],[110,768],[65,778,769],[97,778,769],[198,769],[230,769],[216,769],[248,769],[65,783],[97,783],[65,785],[97,785],[69,783],[101,783],[69,785],[101,785],[73,783],[105,783],[73,785],[105,785],[79,783],[111,783],[79,785],[111,785],[82,783],[114,783],[82,785],[114,785],[85,783],[117,783],[85,785],[117,785],[83,806],[115,806],[84,806],[116,806],];for(ix=0;ix<36;ix++){val=ls[ix];map[ix+504]=val;}
ls=[[65,805],[97,805],[66,775],[98,775],[66,803],[98,803],[66,817],[98,817],[67,807,769],[99,807,769],[68,775],[100,775],[68,803],[100,803],[68,817],[100,817],[68,807],[100,807],[68,813],[100,813],[69,772,768],[101,772,768],[69,772,769],[101,772,769],[69,813],[101,813],[69,816],[101,816],[69,807,774],[101,807,774],[70,775],[102,775],[71,772],[103,772],[72,775],[104,775],[72,803],[104,803],[72,776],[104,776],[72,807],[104,807],[72,814],[104,814],[73,816],[105,816],[73,776,769],[105,776,769],[75,769],[107,769],[75,803],[107,803],[75,817],[107,817],[76,803],[108,803],[76,803,772],[108,803,772],[76,817],[108,817],[76,813],[108,813],[77,769],[109,769],[77,775],[109,775],[77,803],[109,803],[78,775],[110,775],[78,803],[110,803],[78,817],[110,817],[78,813],[110,813],[79,771,769],[111,771,769],[79,771,776],[111,771,776],[79,772,768],[111,772,768],[79,772,769],[111,772,769],[80,769],[112,769],[80,775],[112,775],[82,775],[114,775],[82,803],[114,803],[82,803,772],[114,803,772],[82,817],[114,817],[83,775],[115,775],[83,803],[115,803],[83,769,775],[115,769,775],[83,780,775],[115,780,775],[83,803,775],[115,803,775],[84,775],[116,775],[84,803],[116,803],[84,817],[116,817],[84,813],[116,813],[85,804],[117,804],[85,816],[117,816],[85,813],[117,813],[85,771,769],[117,771,769],[85,772,776],[117,772,776],[86,771],[118,771],[86,803],[118,803],[87,768],[119,768],[87,769],[119,769],[87,776],[119,776],[87,775],[119,775],[87,803],[119,803],[88,775],[120,775],[88,776],[120,776],[89,775],[121,775],[90,770],[122,770],[90,803],[122,803],[90,817],[122,817],[104,817],[116,776],[119,778],[121,778],];for(ix=0;ix<154;ix++){val=ls[ix];map[ix+7680]=val;}
ls=[[65,803],[97,803],[65,777],[97,777],[65,770,769],[97,770,769],[65,770,768],[97,770,768],[65,770,777],[97,770,777],[65,770,771],[97,770,771],[65,803,770],[97,803,770],[65,774,769],[97,774,769],[65,774,768],[97,774,768],[65,774,777],[97,774,777],[65,774,771],[97,774,771],[65,803,774],[97,803,774],[69,803],[101,803],[69,777],[101,777],[69,771],[101,771],[69,770,769],[101,770,769],[69,770,768],[101,770,768],[69,770,777],[101,770,777],[69,770,771],[101,770,771],[69,803,770],[101,803,770],[73,777],[105,777],[73,803],[105,803],[79,803],[111,803],[79,777],[111,777],[79,770,769],[111,770,769],[79,770,768],[111,770,768],[79,770,777],[111,770,777],[79,770,771],[111,770,771],[79,803,770],[111,803,770],[79,795,769],[111,795,769],[79,795,768],[111,795,768],[79,795,777],[111,795,777],[79,795,771],[111,795,771],[79,795,803],[111,795,803],[85,803],[117,803],[85,777],[117,777],[85,795,769],[117,795,769],[85,795,768],[117,795,768],[85,795,777],[117,795,777],[85,795,771],[117,795,771],[85,795,803],[117,795,803],[89,768],[121,768],[89,803],[121,803],[89,777],[121,777],[89,771],[121,771],];for(ix=0;ix<90;ix++){val=ls[ix];map[ix+7840]=val;}
ls=[[945,787],[945,788],[945,787,768],[945,788,768],[945,787,769],[945,788,769],[945,787,834],[945,788,834],[913,787],[913,788],[913,787,768],[913,788,768],[913,787,769],[913,788,769],[913,787,834],[913,788,834],[949,787],[949,788],[949,787,768],[949,788,768],[949,787,769],[949,788,769],];for(ix=0;ix<22;ix++){val=ls[ix];map[ix+7936]=val;}
ls=[[951,787],[951,788],[951,787,768],[951,788,768],[951,787,769],[951,788,769],[951,787,834],[951,788,834],[919,787],[919,788],[919,787,768],[919,788,768],[919,787,769],[919,788,769],[919,787,834],[919,788,834],[953,787],[953,788],[953,787,768],[953,788,768],[953,787,769],[953,788,769],[953,787,834],[953,788,834],[921,787],[921,788],[921,787,768],[921,788,768],[921,787,769],[921,788,769],[921,787,834],[921,788,834],[959,787],[959,788],[959,787,768],[959,788,768],[959,787,769],[959,788,769],];for(ix=0;ix<38;ix++){val=ls[ix];map[ix+7968]=val;}
ls=[[933,788,834],[969,787],[969,788],[969,787,768],[969,788,768],[969,787,769],[969,788,769],[969,787,834],[969,788,834],[937,787],[937,788],[937,787,768],[937,788,768],[937,787,769],[937,788,769],[937,787,834],[937,788,834],[945,768],[945,769],[949,768],[949,769],[951,768],[951,769],[953,768],[953,769],[959,768],[959,769],[965,768],[965,769],[969,768],[969,769],];for(ix=0;ix<31;ix++){val=ls[ix];map[ix+8031]=val;}
ls=[[945,787,837],[945,788,837],[945,787,768,837],[945,788,768,837],[945,787,769,837],[945,788,769,837],[945,787,834,837],[945,788,834,837],[913,787,837],[913,788,837],[913,787,768,837],[913,788,768,837],[913,787,769,837],[913,788,769,837],[913,787,834,837],[913,788,834,837],[951,787,837],[951,788,837],[951,787,768,837],[951,788,768,837],[951,787,769,837],[951,788,769,837],[951,787,834,837],[951,788,834,837],[919,787,837],[919,788,837],[919,787,768,837],[919,788,768,837],[919,787,769,837],[919,788,769,837],[919,787,834,837],[919,788,834,837],[969,787,837],[969,788,837],[969,787,768,837],[969,788,768,837],[969,787,769,837],[969,788,769,837],[969,787,834,837],[969,788,834,837],[937,787,837],[937,788,837],[937,787,768,837],[937,788,768,837],[937,787,769,837],[937,788,769,837],[937,787,834,837],[937,788,834,837],[945,774],[945,772],[945,768,837],[945,837],[945,769,837],];for(ix=0;ix<53;ix++){val=ls[ix];map[ix+8064]=val;}
ls=[[8190,768],[8190,769],[8190,834],[965,774],[965,772],[965,776,768],[965,776,769],[961,787],[961,788],[965,834],[965,776,834],[933,774],[933,772],[933,768],[933,769],[929,788],[168,768],[168,769],96,];for(ix=0;ix<19;ix++){val=ls[ix];map[ix+8157]=val;}
ls=[35912,26356,36554,36040,28369,20018,21477,40860,40860,22865,37329,21895,22856,25078,30313,32645,34367,34746,35064,37007,27138,27931,28889,29662,33853,37226,39409,20098,21365,27396,29211,34349,40478,23888,28651,34253,35172,25289,33240,34847,24266,26391,28010,29436,37070,20358,20919,21214,25796,27347,29200,30439,32769,34310,34396,36335,38706,39791,40442,30860,31103,32160,33737,37636,40575,35542,22751,24324,31840,32894,29282,30922,36034,38647,22744,23650,27155,28122,28431,32047,32311,38475,21202,32907,20956,20940,31260,32190,33777,38517,35712,25295,27138,35582,20025,23527,24594,29575,30064,21271,30971,20415,24489,19981,27852,25976,32034,21443,22622,30465,33865,35498,27578,36784,27784,25342,33509,25504,30053,20142,20841,20937,26753,31975,33391,35538,37327,21237,21570,22899,24300,26053,28670,31018,38317,39530,40599,40654,21147,26310,27511,36706,24180,24976,25088,25754,28451,29001,29833,31178,32244,32879,36646,34030,36899,37706,21015,21155,21693,28872,35010,35498,24265,24565,25467,27566,31806,29557,20196,22265,23527,23994,24604,29618,29801,32666,32838,37428,38646,38728,38936,20363,31150,37300,38584,24801,20102,20698,23534,23615,26009,27138,29134,30274,34044,36988,40845,26248,38446,21129,26491,26611,27969,28316,29705,30041,30827,32016,39006,20845,25134,38520,20523,23833,28138,36650,24459,24900,26647,29575,38534,21033,21519,23653,26131,26446,26792,27877,29702,30178,32633,35023,35041,37324,38626,21311,28346,21533,29136,29848,34298,38563,40023,40607,26519,28107,33256,31435,31520,31890,29376,28825,35672,20160,33590,21050,20999,24230,25299,31958,23429,27934,26292,36667,34892,38477,35211,24275,20800,21952,];for(ix=0;ix<270;ix++){val=ls[ix];map[ix+63744]=val;}
ls=[20398,20711,20813,21193,21220,21329,21917,22022,22120,22592,22696,23652,23662,24724,24936,24974,25074,25935,26082,26257,26757,28023,28186,28450,29038,29227,29730,30865,31038,31049,31048,31056,31062,31069,31117,31118,31296,31361,31680,32244,32265,32321,32626,32773,33261,33401,33401,33879,35088,35222,35585,35641,36051,36104,36790,36920,38627,38911,38971,];for(ix=0;ix<59;ix++){val=ls[ix];map[ix+64048]=val;}
ls=[20029,20024,20033,131362,20320,20398,20411,20482,20602,20633,20711,20687,13470,132666,20813,20820,20836,20855,132380,13497,20839,20877,132427,20887,20900,20172,20908,20917,168415,20981,20995,13535,21051,21062,21106,21111,13589,21191,21193,21220,21242,21253,21254,21271,21321,21329,21338,21363,21373,21375,21375,21375,133676,28784,21450,21471,133987,21483,21489,21510,21662,21560,21576,21608,21666,21750,21776,21843,21859,21892,21892,21913,21931,21939,21954,22294,22022,22295,22097,22132,20999,22766,22478,22516,22541,22411,22578,22577,22700,136420,22770,22775,22790,22810,22818,22882,136872,136938,23020,23067,23079,23000,23142,14062,14076,23304,23358,23358,137672,23491,23512,23527,23539,138008,23551,23558,24403,23586,14209,23648,23662,23744,23693,138724,23875,138726,23918,23915,23932,24033,24034,14383,24061,24104,24125,24169,14434,139651,14460,24240,24243,24246,24266,172946,24318,140081,140081,33281,24354,24354,14535,144056,156122,24418,24427,14563,24474,24525,24535,24569,24705,14650,14620,24724,141012,24775,24904,24908,24910,24908,24954,24974,25010,24996,25007,25054,25074,25078,25104,25115,25181,25265,25300,25424,142092,25405,25340,25448,25475,25572,142321,25634,25541,25513,14894,25705,25726,25757,25719,14956,25935,25964,143370,26083,26360,26185,15129,26257,15112,15076,20882,20885,26368,26268,32941,17369,26391,26395,26401,26462,26451,144323,15177,26618,26501,26706,26757,144493,26766,26655,26900,15261,26946,27043,27114,27304,145059,27355,15384,27425,145575,27476,15438,27506,27551,27578,27579,146061,138507,146170,27726,146620,27839,27853,27751,27926,27966,28023,27969,28009,28024,28037,146718,27956,28207,28270,15667,28363,28359,147153,28153,28526,147294,147342,28614,28729,28702,28699,15766,28746,28797,28791,28845,132389,28997,148067,29084,148395,29224,29237,29264,149000,29312,29333,149301,149524,29562,29579,16044,29605,16056,16056,29767,29788,29809,29829,29898,16155,29988,150582,30014,150674,30064,139679,30224,151457,151480,151620,16380,16392,30452,151795,151794,151833,151859,30494,30495,30495,30538,16441,30603,16454,16534,152605,30798,30860,30924,16611,153126,31062,153242,153285,31119,31211,16687,31296,31306,31311,153980,154279,154279,31470,16898,154539,31686,31689,16935,154752,31954,17056,31976,31971,32000,155526,32099,17153,32199,32258,32325,17204,156200,156231,17241,156377,32634,156478,32661,32762,32773,156890,156963,32864,157096,32880,144223,17365,32946,33027,17419,33086,23221,157607,157621,144275,144284,33281,33284,36766,17515,33425,33419,33437,21171,33457,33459,33469,33510,158524,33509,33565,33635,33709,33571,33725,33767,33879,33619,33738,33740,33756,158774,159083,158933,17707,34033,34035,34070,160714,34148,159532,17757,17761,159665,159954,17771,34384,34396,34407,34409,34473,34440,34574,34530,34681,34600,34667,34694,17879,34785,34817,17913,34912,34915,161383,35031,35038,17973,35066,13499,161966,162150,18110,18119,35488,35565,35722,35925,162984,36011,36033,36123,36215,163631,133124,36299,36284,36336,133342,36564,36664,165330,165357,37012,37105,37137,165678,37147,37432,37591,37592,37500,37881,37909,166906,38283,18837,38327,167287,18918,38595,23986,38691,168261,168474,19054,19062,38880,168970,19122,169110,38923,38923,38953,169398,39138,19251,39209,39335,39362,39422,19406,170800,39698,40000,40189,19662,19693,40295,172238,19704,172293,172558,172689,40635,19798,40697,40702,40709,40719,40726,40763,173568,];for(ix=0;ix<542;ix++){val=ls[ix];map[ix+194560]=val;}})();var unicode_combin_table={768:230,769:230,770:230,771:230,772:230,773:230,774:230,775:230,776:230,777:230,778:230,779:230,780:230,781:230,782:230,783:230,784:230,785:230,786:230,787:230,788:230,789:232,790:220,791:220,792:220,793:220,794:232,795:216,796:220,797:220,798:220,799:220,800:220,801:202,802:202,803:220,804:220,805:220,806:220,807:202,808:202,809:220,810:220,811:220,812:220,813:220,814:220,815:220,816:220,817:220,818:220,819:220,820:1,821:1,822:1,823:1,824:1,825:220,826:220,827:220,828:220,829:230,830:230,831:230,832:230,833:230,834:230,835:230,836:230,837:240,838:230,839:220,840:220,841:220,842:230,843:230,844:230,845:220,846:220,848:230,849:230,850:230,851:220,852:220,853:220,854:220,855:230,861:234,862:234,863:233,864:234,865:234,866:233,867:230,868:230,869:230,870:230,871:230,872:230,873:230,874:230,875:230,876:230,877:230,878:230,879:230,1155:230,1156:230,1157:230,1158:230,1425:220,1426:230,1427:230,1428:230,1429:230,1430:220,1431:230,1432:230,1433:230,1434:222,1435:220,1436:230,1437:230,1438:230,1439:230,1440:230,1441:230,1443:220,1444:220,1445:220,1446:220,1447:220,1448:230,1449:230,1450:220,1451:230,1452:230,1453:222,1454:228,1455:230,1456:10,1457:11,1458:12,1459:13,1460:14,1461:15,1462:16,1463:17,1464:18,1465:19,1467:20,1468:21,1469:22,1471:23,1473:24,1474:25,1476:230,1552:230,1553:230,1554:230,1555:230,1556:230,1557:230,1611:27,1612:28,1613:29,1614:30,1615:31,1616:32,1617:33,1618:34,1619:230,1620:230,1621:220,1622:220,1623:230,1624:230,1648:35,1750:230,1751:230,1752:230,1753:230,1754:230,1755:230,1756:230,1759:230,1760:230,1761:230,1762:230,1763:220,1764:230,1767:230,1768:230,1770:220,1771:230,1772:230,1773:220,1809:36,1840:230,1841:220,1842:230,1843:230,1844:220,1845:230,1846:230,1847:220,1848:220,1849:220,1850:230,1851:220,1852:220,1853:230,1854:220,1855:230,1856:230,1857:230,1858:220,1859:230,1860:220,1861:230,1862:220,1863:230,1864:220,1865:230,1866:230,2364:7,2381:9,2385:230,2386:220,2387:230,2388:230,2492:7,2509:9,2620:7,2637:9,2748:7,2765:9,2876:7,2893:9,3021:9,3149:9,3157:84,3158:91,3260:7,3277:9,3405:9,3530:9,3640:103,3641:103,3642:9,3656:107,3657:107,3658:107,3659:107,3768:118,3769:118,3784:122,3785:122,3786:122,3787:122,3864:220,3865:220,3893:220,3895:220,3897:216,3953:129,3954:130,3956:132,3962:130,3963:130,3964:130,3965:130,3968:130,3970:230,3971:230,3972:9,3974:230,3975:230,4038:220,4151:7,4153:9,5908:9,5940:9,6098:9,6109:230,6313:228,6457:222,6458:230,6459:220,8400:230,8401:230,8402:1,8403:1,8404:230,8405:230,8406:230,8407:230,8408:1,8409:1,8410:1,8411:230,8412:230,8417:230,8421:1,8422:1,8423:230,8424:220,8425:230,8426:1,12330:218,12331:228,12332:232,12333:222,12334:224,12335:224,12441:8,12442:8,64286:26,65056:230,65057:230,65058:230,65059:230,119141:216,119142:216,119143:1,119144:1,119145:1,119149:226,119150:216,119151:216,119152:216,119153:216,119154:216,119163:220,119164:220,119165:220,119166:220,119167:220,119168:220,119169:220,119170:220,119173:230,119174:230,119175:230,119176:230,119177:230,119178:220,119179:220,119210:230,119211:230,119212:230,119213:230};var unicode_compo_table={60:{824:8814},61:{824:8800},62:{824:8815},65:{768:192,769:193,770:194,771:195,772:256,774:258,775:550,776:196,777:7842,778:197,780:461,783:512,785:514,803:7840,805:7680,808:260},66:{775:7682,803:7684,817:7686},67:{769:262,770:264,775:266,780:268,807:199},68:{775:7690,780:270,803:7692,807:7696,813:7698,817:7694},69:{768:200,769:201,770:202,771:7868,772:274,774:276,775:278,776:203,777:7866,780:282,783:516,785:518,803:7864,807:552,808:280,813:7704,816:7706},70:{775:7710},71:{769:500,770:284,772:7712,774:286,775:288,780:486,807:290},72:{770:292,775:7714,776:7718,780:542,803:7716,807:7720,814:7722},73:{768:204,769:205,770:206,771:296,772:298,774:300,775:304,776:207,777:7880,780:463,783:520,785:522,803:7882,808:302,816:7724},74:{770:308},75:{769:7728,780:488,803:7730,807:310,817:7732},76:{769:313,780:317,803:7734,807:315,813:7740,817:7738},77:{769:7742,775:7744,803:7746},78:{768:504,769:323,771:209,775:7748,780:327,803:7750,807:325,813:7754,817:7752},79:{768:210,769:211,770:212,771:213,772:332,774:334,775:558,776:214,777:7886,779:336,780:465,783:524,785:526,795:416,803:7884,808:490},80:{769:7764,775:7766},82:{769:340,775:7768,780:344,783:528,785:530,803:7770,807:342,817:7774},83:{769:346,770:348,775:7776,780:352,803:7778,806:536,807:350},84:{775:7786,780:356,803:7788,806:538,807:354,813:7792,817:7790},85:{768:217,769:218,770:219,771:360,772:362,774:364,776:220,777:7910,778:366,779:368,780:467,783:532,785:534,795:431,803:7908,804:7794,808:370,813:7798,816:7796},86:{771:7804,803:7806},87:{768:7808,769:7810,770:372,775:7814,776:7812,803:7816},88:{775:7818,776:7820},89:{768:7922,769:221,770:374,771:7928,772:562,775:7822,776:376,777:7926,803:7924},90:{769:377,770:7824,775:379,780:381,803:7826,817:7828},97:{768:224,769:225,770:226,771:227,772:257,774:259,775:551,776:228,777:7843,778:229,780:462,783:513,785:515,803:7841,805:7681,808:261},98:{775:7683,803:7685,817:7687},99:{769:263,770:265,775:267,780:269,807:231},100:{775:7691,780:271,803:7693,807:7697,813:7699,817:7695},101:{768:232,769:233,770:234,771:7869,772:275,774:277,775:279,776:235,777:7867,780:283,783:517,785:519,803:7865,807:553,808:281,813:7705,816:7707},102:{775:7711},103:{769:501,770:285,772:7713,774:287,775:289,780:487,807:291},104:{770:293,775:7715,776:7719,780:543,803:7717,807:7721,814:7723,817:7830},105:{768:236,769:237,770:238,771:297,772:299,774:301,776:239,777:7881,780:464,783:521,785:523,803:7883,808:303,816:7725},106:{770:309,780:496},107:{769:7729,780:489,803:7731,807:311,817:7733},108:{769:314,780:318,803:7735,807:316,813:7741,817:7739},109:{769:7743,775:7745,803:7747},110:{768:505,769:324,771:241,775:7749,780:328,803:7751,807:326,813:7755,817:7753},111:{768:242,769:243,770:244,771:245,772:333,774:335,775:559,776:246,777:7887,779:337,780:466,783:525,785:527,795:417,803:7885,808:491},112:{769:7765,775:7767},114:{769:341,775:7769,780:345,783:529,785:531,803:7771,807:343,817:7775},115:{769:347,770:349,775:7777,780:353,803:7779,806:537,807:351},116:{775:7787,776:7831,780:357,803:7789,806:539,807:355,813:7793,817:7791},117:{768:249,769:250,770:251,771:361,772:363,774:365,776:252,777:7911,778:367,779:369,780:468,783:533,785:535,795:432,803:7909,804:7795,808:371,813:7799,816:7797},118:{771:7805,803:7807},119:{768:7809,769:7811,770:373,775:7815,776:7813,778:7832,803:7817},120:{775:7819,776:7821},121:{768:7923,769:253,770:375,771:7929,772:563,775:7823,776:255,777:7927,778:7833,803:7925},122:{769:378,770:7825,775:380,780:382,803:7827,817:7829},168:{768:8173,769:901,834:8129},194:{768:7846,769:7844,771:7850,777:7848},196:{772:478},197:{769:506},198:{769:508,772:482},199:{769:7688},202:{768:7872,769:7870,771:7876,777:7874},207:{769:7726},212:{768:7890,769:7888,771:7894,777:7892},213:{769:7756,772:556,776:7758},214:{772:554},216:{769:510},220:{768:475,769:471,772:469,780:473},226:{768:7847,769:7845,771:7851,777:7849},228:{772:479},229:{769:507},230:{769:509,772:483},231:{769:7689},234:{768:7873,769:7871,771:7877,777:7875},239:{769:7727},244:{768:7891,769:7889,771:7895,777:7893},245:{769:7757,772:557,776:7759},246:{772:555},248:{769:511},252:{768:476,769:472,772:470,780:474},258:{768:7856,769:7854,771:7860,777:7858},259:{768:7857,769:7855,771:7861,777:7859},274:{768:7700,769:7702},275:{768:7701,769:7703},332:{768:7760,769:7762},333:{768:7761,769:7763},346:{775:7780},347:{775:7781},352:{775:7782},353:{775:7783},360:{769:7800},361:{769:7801},362:{776:7802},363:{776:7803},383:{775:7835},416:{768:7900,769:7898,771:7904,777:7902,803:7906},417:{768:7901,769:7899,771:7905,777:7903,803:7907},431:{768:7914,769:7912,771:7918,777:7916,803:7920},432:{768:7915,769:7913,771:7919,777:7917,803:7921},439:{780:494},490:{772:492},491:{772:493},550:{772:480},551:{772:481},552:{774:7708},553:{774:7709},558:{772:560},559:{772:561},658:{780:495},776:{769:836},913:{768:8122,769:902,772:8121,774:8120,787:7944,788:7945,837:8124},917:{768:8136,769:904,787:7960,788:7961},919:{768:8138,769:905,787:7976,788:7977,837:8140},921:{768:8154,769:906,772:8153,774:8152,776:938,787:7992,788:7993},927:{768:8184,769:908,787:8008,788:8009},929:{788:8172},933:{768:8170,769:910,772:8169,774:8168,776:939,788:8025},937:{768:8186,769:911,787:8040,788:8041,837:8188},940:{837:8116},942:{837:8132},945:{768:8048,769:940,772:8113,774:8112,787:7936,788:7937,834:8118,837:8115},949:{768:8050,769:941,787:7952,788:7953},951:{768:8052,769:942,787:7968,788:7969,834:8134,837:8131},953:{768:8054,769:943,772:8145,774:8144,776:970,787:7984,788:7985,834:8150},959:{768:8056,769:972,787:8000,788:8001},961:{787:8164,788:8165},965:{768:8058,769:973,772:8161,774:8160,776:971,787:8016,788:8017,834:8166},969:{768:8060,769:974,787:8032,788:8033,834:8182,837:8179},970:{768:8146,769:912,834:8151},971:{768:8162,769:944,834:8167},974:{837:8180},978:{769:979,776:980},1030:{776:1031},1040:{774:1232,776:1234},1043:{769:1027},1045:{768:1024,774:1238,776:1025},1046:{774:1217,776:1244},1047:{776:1246},1048:{768:1037,772:1250,774:1049,776:1252},1050:{769:1036},1054:{776:1254},1059:{772:1262,774:1038,776:1264,779:1266},1063:{776:1268},1067:{776:1272},1069:{776:1260},1072:{774:1233,776:1235},1075:{769:1107},1077:{768:1104,774:1239,776:1105},1078:{774:1218,776:1245},1079:{776:1247},1080:{768:1117,772:1251,774:1081,776:1253},1082:{769:1116},1086:{776:1255},1091:{772:1263,774:1118,776:1265,779:1267},1095:{776:1269},1099:{776:1273},1101:{776:1261},1110:{776:1111},1140:{783:1142},1141:{783:1143},1240:{776:1242},1241:{776:1243},1256:{776:1258},1257:{776:1259},1488:{1463:64302,1464:64303,1468:64304},1489:{1468:64305,1471:64332},1490:{1468:64306},1491:{1468:64307},1492:{1468:64308},1493:{1465:64331,1468:64309},1494:{1468:64310},1496:{1468:64312},1497:{1460:64285,1468:64313},1498:{1468:64314},1499:{1468:64315,1471:64333},1500:{1468:64316},1502:{1468:64318},1504:{1468:64320},1505:{1468:64321},1507:{1468:64323},1508:{1468:64324,1471:64334},1510:{1468:64326},1511:{1468:64327},1512:{1468:64328},1513:{1468:64329,1473:64298,1474:64299},1514:{1468:64330},1522:{1463:64287},1575:{1619:1570,1620:1571,1621:1573},1608:{1620:1572},1610:{1620:1574},1729:{1620:1730},1746:{1620:1747},1749:{1620:1728},2325:{2364:2392},2326:{2364:2393},2327:{2364:2394},2332:{2364:2395},2337:{2364:2396},2338:{2364:2397},2344:{2364:2345},2347:{2364:2398},2351:{2364:2399},2352:{2364:2353},2355:{2364:2356},2465:{2492:2524},2466:{2492:2525},2479:{2492:2527},2503:{2494:2507,2519:2508},2582:{2620:2649},2583:{2620:2650},2588:{2620:2651},2603:{2620:2654},2610:{2620:2611},2616:{2620:2614},2849:{2876:2908},2850:{2876:2909},2887:{2878:2891,2902:2888,2903:2892},2962:{3031:2964},3014:{3006:3018,3031:3020},3015:{3006:3019},3142:{3158:3144},3263:{3285:3264},3270:{3266:3274,3285:3271,3286:3272},3274:{3285:3275},3398:{3390:3402,3415:3404},3399:{3390:3403},3545:{3530:3546,3535:3548,3551:3550},3548:{3530:3549},3904:{4021:3945},3906:{4023:3907},3916:{4023:3917},3921:{4023:3922},3926:{4023:3927},3931:{4023:3932},3953:{3954:3955,3956:3957,3968:3969},3984:{4021:4025},3986:{4023:3987},3996:{4023:3997},4001:{4023:4002},4006:{4023:4007},4011:{4023:4012},4018:{3968:3958},4019:{3968:3960},4133:{4142:4134},7734:{772:7736},7735:{772:7737},7770:{772:7772},7771:{772:7773},7778:{775:7784},7779:{775:7785},7840:{770:7852,774:7862},7841:{770:7853,774:7863},7864:{770:7878},7865:{770:7879},7884:{770:7896},7885:{770:7897},7936:{768:7938,769:7940,834:7942,837:8064},7937:{768:7939,769:7941,834:7943,837:8065},7938:{837:8066},7939:{837:8067},7940:{837:8068},7941:{837:8069},7942:{837:8070},7943:{837:8071},7944:{768:7946,769:7948,834:7950,837:8072},7945:{768:7947,769:7949,834:7951,837:8073},7946:{837:8074},7947:{837:8075},7948:{837:8076},7949:{837:8077},7950:{837:8078},7951:{837:8079},7952:{768:7954,769:7956},7953:{768:7955,769:7957},7960:{768:7962,769:7964},7961:{768:7963,769:7965},7968:{768:7970,769:7972,834:7974,837:8080},7969:{768:7971,769:7973,834:7975,837:8081},7970:{837:8082},7971:{837:8083},7972:{837:8084},7973:{837:8085},7974:{837:8086},7975:{837:8087},7976:{768:7978,769:7980,834:7982,837:8088},7977:{768:7979,769:7981,834:7983,837:8089},7978:{837:8090},7979:{837:8091},7980:{837:8092},7981:{837:8093},7982:{837:8094},7983:{837:8095},7984:{768:7986,769:7988,834:7990},7985:{768:7987,769:7989,834:7991},7992:{768:7994,769:7996,834:7998},7993:{768:7995,769:7997,834:7999},8000:{768:8002,769:8004},8001:{768:8003,769:8005},8008:{768:8010,769:8012},8009:{768:8011,769:8013},8016:{768:8018,769:8020,834:8022},8017:{768:8019,769:8021,834:8023},8025:{768:8027,769:8029,834:8031},8032:{768:8034,769:8036,834:8038,837:8096},8033:{768:8035,769:8037,834:8039,837:8097},8034:{837:8098},8035:{837:8099},8036:{837:8100},8037:{837:8101},8038:{837:8102},8039:{837:8103},8040:{768:8042,769:8044,834:8046,837:8104},8041:{768:8043,769:8045,834:8047,837:8105},8042:{837:8106},8043:{837:8107},8044:{837:8108},8045:{837:8109},8046:{837:8110},8047:{837:8111},8048:{837:8114},8052:{837:8130},8060:{837:8178},8118:{837:8119},8127:{768:8141,769:8142,834:8143},8134:{837:8135},8182:{837:8183},8190:{768:8157,769:8158,834:8159},8592:{824:8602},8594:{824:8603},8596:{824:8622},8656:{824:8653},8658:{824:8655},8660:{824:8654},8707:{824:8708},8712:{824:8713},8715:{824:8716},8739:{824:8740},8741:{824:8742},8764:{824:8769},8771:{824:8772},8773:{824:8775},8776:{824:8777},8781:{824:8813},8801:{824:8802},8804:{824:8816},8805:{824:8817},8818:{824:8820},8819:{824:8821},8822:{824:8824},8823:{824:8825},8826:{824:8832},8827:{824:8833},8828:{824:8928},8829:{824:8929},8834:{824:8836},8835:{824:8837},8838:{824:8840},8839:{824:8841},8849:{824:8930},8850:{824:8931},8866:{824:8876},8872:{824:8877},8873:{824:8878},8875:{824:8879},8882:{824:8938},8883:{824:8939},8884:{824:8940},8885:{824:8941},10973:{824:10972},12358:{12441:12436},12363:{12441:12364},12365:{12441:12366},12367:{12441:12368},12369:{12441:12370},12371:{12441:12372},12373:{12441:12374},12375:{12441:12376},12377:{12441:12378},12379:{12441:12380},12381:{12441:12382},12383:{12441:12384},12385:{12441:12386},12388:{12441:12389},12390:{12441:12391},12392:{12441:12393},12399:{12441:12400,12442:12401},12402:{12441:12403,12442:12404},12405:{12441:12406,12442:12407},12408:{12441:12409,12442:12410},12411:{12441:12412,12442:12413},12445:{12441:12446},12454:{12441:12532},12459:{12441:12460},12461:{12441:12462},12463:{12441:12464},12465:{12441:12466},12467:{12441:12468},12469:{12441:12470},12471:{12441:12472},12473:{12441:12474},12475:{12441:12476},12477:{12441:12478},12479:{12441:12480},12481:{12441:12482},12484:{12441:12485},12486:{12441:12487},12488:{12441:12489},12495:{12441:12496,12442:12497},12498:{12441:12499,12442:12500},12501:{12441:12502,12442:12503},12504:{12441:12505,12442:12506},12507:{12441:12508,12442:12509},12527:{12441:12535},12528:{12441:12536},12529:{12441:12537},12530:{12441:12538},12541:{12441:12542},64329:{1473:64300,1474:64301},119127:{119141:119134},119128:{119141:119135},119135:{119150:119136,119151:119137,119152:119138,119153:119139,119154:119140},119225:{119141:119227},119226:{119141:119228},119227:{119150:119229,119151:119231},119228:{119150:119230,119151:119232}};function CharToString(val){if(val<0x10000){return String.fromCharCode(val);}
else{val-=0x10000;return String.fromCharCode(0xD800+(val>>10),0xDC00+(val&0x3FF));}}
function TrimArrayToBytes(arr){var ix,newarr;var len=arr.length;for(ix=0;ix<len;ix++){if(arr[ix]<0||arr[ix]>=0x100)
break;}
if(ix==len){return arr;}
newarr=Array(len);for(ix=0;ix<len;ix++){if(arr[ix]<0||arr[ix]>=0x100)
newarr[ix]=63;else
newarr[ix]=arr[ix];}
return newarr;}
function ByteArrayToString(arr){var ix,newarr;var len=arr.length;if(len==0)
return'';for(ix=0;ix<len;ix++){if(arr[ix]<0||arr[ix]>=0x100)
break;}
if(ix==len){return String.fromCharCode.apply(this,arr);}
newarr=Array(len);for(ix=0;ix<len;ix++){newarr[ix]=String.fromCharCode(arr[ix]&0xFF);}
return newarr.join('');}
function UniArrayToString(arr){var ix,val,newarr;var len=arr.length;if(len==0)
return'';for(ix=0;ix<len;ix++){if(arr[ix]>=0x10000)
break;}
if(ix==len){return String.fromCharCode.apply(this,arr);}
newarr=Array(len);for(ix=0;ix<len;ix++){val=arr[ix];if(val<0x10000){newarr[ix]=String.fromCharCode(val);}
else{val-=0x10000;newarr[ix]=String.fromCharCode(0xD800+(val>>10),0xDC00+(val&0x3FF));}}
return newarr.join('');}
function UniArrayToUTF8(arr){var count=0;for(var ix=0;ix<arr.length;ix++){var val=arr[ix];if(val<0x80){count+=1;}
else if(val<0x800){count+=2;}
else if(val<0x10000){count+=3;}
else if(val<0x200000){count+=4;}
else{count+=1;}}
if(count==arr.length)
return arr;var res=[];for(var ix=0;ix<arr.length;ix++){var val=arr[ix];if(val<0x80){res.push(val);}
else if(val<0x800){res.push(0xC0|((val&0x7C0)>>6));res.push(0x80|(val&0x03F));}
else if(val<0x10000){res.push(0xE0|((val&0xF000)>>12));res.push(0x80|((val&0x0FC0)>>6));res.push(0x80|(val&0x003F));}
else if(val<0x200000){res.push(0xF0|((val&0x1C0000)>>18));res.push(0x80|((val&0x03F000)>>12));res.push(0x80|((val&0x000FC0)>>6));res.push(0x80|(val&0x00003F));}
else{res.push(63);}}
return res;}
function UniArrayToBE32(arr){var res=new Array(4*arr.length);for(var ix=0;ix<arr.length;ix++){var val=arr[ix];res[4*ix]=(val>>24)&0xFF;res[4*ix+1]=(val>>16)&0xFF;res[4*ix+2]=(val>>8)&0xFF;res[4*ix+3]=(val)&0xFF;}
return res;}
function qlog(msg){if(window.console&&console.log)
console.log(msg);else if(window.opera&&opera.postError)
opera.postError(msg);}
function RefBox(){this.value=undefined;this.set_value=function(val){this.value=val;}
this.get_value=function(){return this.value;}}
function RefStruct(numels){this.fields=[];this.push_field=function(val){this.fields.push(val);}
this.set_field=function(pos,val){this.fields[pos]=val;}
this.get_field=function(pos){return this.fields[pos];}
this.get_fields=function(){return this.fields;}}
var DidNotReturn={dummy:'Glk call has not yet returned'};function call_may_not_return(id){if(id==0x001||id==0x0C0||id==0x062)
return true;else
return false;}
var strtype_File=1;var strtype_Window=2;var strtype_Memory=3;var strtype_Resource=4;var gli_autorestore_glkstate=null;var gli_windowlist=null;var gli_rootwin=null;var geometry_changed=true;var content_metrics=null;var gli_streamlist=null;var gli_filereflist=null;var gli_schannellist=null;var gli_currentstr=null;var gli_selectref=null;var gli_api_display_rocks=1;var gli_timer_interval=null;var gli_timer_id=null;var gli_timer_started=null;function gli_new_window(type,rock){var win={};win.type=type;win.rock=rock;win.disprock=undefined;win.parent=null;win.str=gli_stream_open_window(win);win.echostr=null;win.style=Const.style_Normal;win.hyperlink=0;win.input_generation=null;win.linebuf=null;win.char_request=false;win.line_request=false;win.char_request_uni=false;win.line_request_uni=false;win.hyperlink_request=false;win.mouse_request=false;win.echo_line_input=true;win.line_input_terminators=[];win.request_echo_line_input=null;win.prev=null;win.next=gli_windowlist;gli_windowlist=win;if(win.next)
win.next.prev=win;if(window.GiDispa)
GiDispa.class_register('window',win);else
win.disprock=gli_api_display_rocks++;geometry_changed=true;return win;}
function gli_delete_window(win){var prev,next;if(window.GiDispa)
GiDispa.class_unregister('window',win);geometry_changed=true;win.echostr=null;if(win.str){gli_delete_stream(win.str);win.str=null;}
prev=win.prev;next=win.next;win.prev=null;win.next=null;if(prev)
prev.next=next;else
gli_windowlist=next;if(next)
next.prev=prev;win.parent=null;win.rock=null;win.disprock=null;}
function gli_windows_unechostream(str){var win;for(win=gli_windowlist;win;win=win.next){if(win.echostr===str)
win.echostr=null;}}
function gli_window_put_string(win,val){var ix,ch;switch(win.type){case Const.wintype_TextBuffer:if(win.style!=win.accumstyle||win.hyperlink!=win.accumhyperlink)
gli_window_buffer_deaccumulate(win);win.accum.push(val);break;case Const.wintype_TextGrid:for(ix=0;ix<val.length;ix++){ch=val.charAt(ix);if(win.cursorx<0)
win.cursorx=0;else if(win.cursorx>=win.gridwidth){win.cursorx=0;win.cursory++;}
if(win.cursory<0)
win.cursory=0;else if(win.cursory>=win.gridheight)
break;if(ch=="\n"){win.cursory++;win.cursorx=0;continue;}
lineobj=win.lines[win.cursory];lineobj.dirty=true;lineobj.chars[win.cursorx]=ch;lineobj.styles[win.cursorx]=win.style;lineobj.hyperlinks[win.cursorx]=win.hyperlink;win.cursorx++;}
break;}}
function gli_window_grid_canonicalize(win){if(win.cursorx<0)
win.cursorx=0;else if(win.cursorx>=win.gridwidth){win.cursorx=0;win.cursory++;}
if(win.cursory<0)
win.cursory=0;else if(win.cursory>=win.gridheight)
return true;return false;}
function gli_window_buffer_deaccumulate(win){var conta=win.content;var stylename=StyleNameMap[win.accumstyle];var text,ls,ix,obj,arr;if(win.accum.length){text=win.accum.join('');ls=text.split('\n');for(ix=0;ix<ls.length;ix++){arr=undefined;if(ix==0){if(ls[ix]){if(conta.length==0){arr=[];conta.push({content:arr,append:true});}
else{obj=conta[conta.length-1];if(!obj.content){arr=[];obj.content=arr;}
else{arr=obj.content;}}}}
else{if(ls[ix]){arr=[];conta.push({content:arr});}
else{conta.push({});}}
if(arr!==undefined){if(!win.accumhyperlink){arr.push(stylename);arr.push(ls[ix]);}
else{arr.push({style:stylename,text:ls[ix],hyperlink:win.accumhyperlink});}}}}
win.accum.length=0;win.accumstyle=win.style;win.accumhyperlink=win.hyperlink;}
function gli_window_buffer_put_special(win,special,flowbreak){gli_window_buffer_deaccumulate(win);var conta=win.content;var arr=undefined;var obj;if(conta.length==0){arr=[];obj={content:arr,append:true};if(flowbreak)
obj.flowbreak=true;conta.push(obj);}
else{obj=conta[conta.length-1];if(flowbreak)
obj.flowbreak=true;if(!obj.content){arr=[];obj.content=arr;}
else{arr=obj.content;}}
if(arr!==undefined&&special!==undefined){arr.push(special);}}
function gli_window_close(win,recurse){var wx;for(wx=win.parent;wx;wx=wx.parent){if(wx.type==Const.wintype_Pair){if(wx.pair_key===win){wx.pair_key=null;wx.pair_keydamage=true;}}}
if(window.GiDispa&&win.linebuf){GiDispa.unretain_array(win.linebuf);win.linebuf=null;}
switch(win.type){case Const.wintype_Pair:if(recurse){if(win.child1)
gli_window_close(win.child1,true);if(win.child2)
gli_window_close(win.child2,true);}
win.child1=null;win.child2=null;win.pair_key=null;break;case Const.wintype_TextBuffer:win.accum=null;win.content=null;win.reserve=null;break;case Const.wintype_TextGrid:win.lines=null;break;case Const.wintype_Graphics:win.content=null;win.reserve=null;break;}
gli_delete_window(win);}
function gli_window_rearrange(win,box){var width,height,oldwidth,oldheight;var min,max,diff,splitwid,ix,cx,lineobj;var box1,box2,ch1,ch2;geometry_changed=true;win.bbox=box;switch(win.type){case Const.wintype_TextGrid:width=box.right-box.left;height=box.bottom-box.top;oldheight=win.gridheight;win.gridwidth=Math.max(0,Math.floor((width-content_metrics.gridmarginx)/content_metrics.gridcharwidth));win.gridheight=Math.max(0,Math.floor((height-content_metrics.gridmarginy)/content_metrics.gridcharheight));if(oldheight>win.gridheight){win.lines.length=win.gridheight;}
else if(oldheight<win.gridheight){for(ix=oldheight;ix<win.gridheight;ix++){win.lines[ix]={chars:[],styles:[],hyperlinks:[],dirty:true};}}
for(ix=0;ix<win.gridheight;ix++){lineobj=win.lines[ix];oldwidth=lineobj.chars.length;if(oldwidth>win.gridwidth){lineobj.dirty=true;lineobj.chars.length=win.gridwidth;lineobj.styles.length=win.gridwidth;lineobj.hyperlinks.length=win.gridwidth;}
else if(oldwidth<win.gridwidth){lineobj.dirty=true;for(cx=oldwidth;cx<win.gridwidth;cx++){lineobj.chars[cx]=' ';lineobj.styles[cx]=Const.style_Normal;lineobj.hyperlinks[cx]=0;}}}
break;case Const.wintype_Graphics:width=box.right-box.left;height=box.bottom-box.top;win.graphwidth=Math.max(0,width-content_metrics.graphicsmarginx);win.graphheight=Math.max(0,height-content_metrics.graphicsmarginy);break;case Const.wintype_Pair:if(win.pair_vertical){min=win.bbox.left;max=win.bbox.right;splitwid=content_metrics.inspacingx;}
else{min=win.bbox.top;max=win.bbox.bottom;splitwid=content_metrics.inspacingy;}
if(!win.pair_hasborder)
splitwid=0;diff=max-min;if(win.pair_division==Const.winmethod_Proportional){split=Math.floor((diff*win.pair_size)/100);}
else if(win.pair_division==Const.winmethod_Fixed){split=0;if(win.pair_key&&win.pair_key.type==Const.wintype_TextBuffer){if(!win.pair_vertical)
split=(win.pair_size*content_metrics.buffercharheight+content_metrics.buffermarginy);else
split=(win.pair_size*content_metrics.buffercharwidth+content_metrics.buffermarginx);}
if(win.pair_key&&win.pair_key.type==Const.wintype_TextGrid){if(!win.pair_vertical)
split=(win.pair_size*content_metrics.gridcharheight+content_metrics.gridmarginy);else
split=(win.pair_size*content_metrics.gridcharwidth+content_metrics.gridmarginx);}
if(win.pair_key&&win.pair_key.type==Const.wintype_Graphics){if(!win.pair_vertical)
split=win.pair_size+content_metrics.graphicsmarginy;else
split=win.pair_size+content_metrics.graphicsmarginx;}
split=Math.ceil(split);}
else{split=Math.floor(diff/2);}
if(!win.pair_backward){split=max-split-splitwid;}
else{split=min+split;}
if(min>=max){split=min;}
else{split=Math.min(Math.max(split,min),max-splitwid);}
win.pair_splitpos=split;win.pair_splitwidth=splitwid;if(win.pair_vertical){box1={left:win.bbox.left,right:win.pair_splitpos,top:win.bbox.top,bottom:win.bbox.bottom};box2={left:box1.right+win.pair_splitwidth,right:win.bbox.right,top:win.bbox.top,bottom:win.bbox.bottom};}
else{box1={top:win.bbox.top,bottom:win.pair_splitpos,left:win.bbox.left,right:win.bbox.right};box2={top:box1.bottom+win.pair_splitwidth,bottom:win.bbox.bottom,left:win.bbox.left,right:win.bbox.right};}
if(!win.pair_backward){ch1=win.child1;ch2=win.child2;}
else{ch1=win.child2;ch2=win.child1;}
gli_window_rearrange(ch1,box1);gli_window_rearrange(ch2,box2);break;}}
function gli_new_stream(type,readable,writable,rock){var str={};str.type=type;str.rock=rock;str.disprock=undefined;str.unicode=false;str.isbinary=false;str.streaming=false;str.ref=null;str.win=null;str.file=null;str.buf=null;str.bufpos=0;str.buflen=0;str.bufeof=0;str.timer_id=null;str.flush_func=null;str.fstream=null;str.readcount=0;str.writecount=0;str.readable=readable;str.writable=writable;str.prev=null;str.next=gli_streamlist;gli_streamlist=str;if(str.next)
str.next.prev=str;if(window.GiDispa)
GiDispa.class_register('stream',str);return str;}
function gli_delete_stream(str){var prev,next;if(str===gli_currentstr){gli_currentstr=null;}
gli_windows_unechostream(str);if(str.type==strtype_Memory){if(window.GiDispa)
GiDispa.unretain_array(str.buf);}
else if(str.type==strtype_File){if(str.fstream){str.fstream.fclose();str.fstream=null;}}
if(window.GiDispa)
GiDispa.class_unregister('stream',str);prev=str.prev;next=str.next;str.prev=null;str.next=null;if(prev)
prev.next=next;else
gli_streamlist=next;if(next)
next.prev=prev;str.fstream=null;str.buf=null;str.readable=false;str.writable=false;str.ref=null;str.win=null;str.file=null;str.rock=null;str.disprock=null;}
function gli_stream_open_window(win){var str;str=gli_new_stream(strtype_Window,false,true,0);str.unicode=true;str.win=win;return str;}
function gli_stream_dirty_file(str){if(str.streaming)
GlkOte.log('### gli_stream_dirty_file called for streaming file!');if(str.timer_id===null){if(str.flush_func===null){str.flush_func=function(){gli_stream_flush_file(str);};}
str.timer_id=setTimeout(str.flush_func,10000);}}
function gli_stream_flush_file(str){if(str.streaming)
GlkOte.log('### gli_stream_flush_file called for streaming file!');if(!(str.timer_id===null)){clearTimeout(str.timer_id);}
str.timer_id=null;Dialog.file_write(str.ref,str.buf);}
function gli_new_fileref(filename,usage,rock,ref){var fref={};fref.filename=filename;fref.rock=rock;fref.disprock=undefined;fref.textmode=((usage&Const.fileusage_TextMode)!=0);fref.filetype=(usage&Const.fileusage_TypeMask);fref.filetypename=FileTypeMap[fref.filetype];if(!fref.filetypename){fref.filetypename='xxx';}
if(!ref){var gameid='';if(fref.filetype==Const.fileusage_SavedGame)
gameid=VM.get_signature();ref=Dialog.file_construct_ref(fref.filename,fref.filetypename,gameid);}
fref.ref=ref;fref.prev=null;fref.next=gli_filereflist;gli_filereflist=fref;if(fref.next)
fref.next.prev=fref;if(window.GiDispa)
GiDispa.class_register('fileref',fref);return fref;}
function gli_delete_fileref(fref){var prev,next;if(window.GiDispa)
GiDispa.class_unregister('fileref',fref);prev=fref.prev;next=fref.next;fref.prev=null;fref.next=null;if(prev)
prev.next=next;else
gli_filereflist=next;if(next)
next.prev=prev;fref.filename=null;fref.ref=null;fref.rock=null;fref.disprock=null;}
function gli_put_char(str,ch){if(!str||!str.writable)
throw('gli_put_char: invalid stream');if(!str.unicode){if(ch<0||ch>=0x100)
ch=63;}
str.writecount+=1;switch(str.type){case strtype_File:if(str.streaming){if(!str.unicode){str.buffer4[0]=ch;str.fstream.fwrite(str.buffer4,1);}
else{if(!str.isbinary){var len;if(ch<0x10000){len=str.buffer4.write(String.fromCharCode(ch));str.fstream.fwrite(str.buffer4,len);}
else{var arr8=UniArrayToUTF8([ch]);var buf=new str.fstream.BufferClass(arr8);str.fstream.fwrite(buf);}}
else{str.buffer4.writeUInt32BE(ch,0,true);str.fstream.fwrite(str.buffer4,4);}}}
else{gli_stream_dirty_file(str);if(!str.unicode||(ch<0x80&&!str.isbinary)){if(str.bufpos<str.buflen){str.buf[str.bufpos]=ch;str.bufpos+=1;if(str.bufpos>str.bufeof)
str.bufeof=str.bufpos;}}
else{var arr;if(!str.isbinary)
arr=UniArrayToUTF8([ch]);else
arr=UniArrayToBE32([ch]);var len=arr.length;if(len>str.buflen-str.bufpos)
len=str.buflen-str.bufpos;for(ix=0;ix<len;ix++)
str.buf[str.bufpos+ix]=arr[ix];str.bufpos+=len;if(str.bufpos>str.bufeof)
str.bufeof=str.bufpos;}}
break;case strtype_Memory:if(str.bufpos<str.buflen){str.buf[str.bufpos]=ch;str.bufpos+=1;if(str.bufpos>str.bufeof)
str.bufeof=str.bufpos;}
break;case strtype_Window:if(str.win.line_request)
throw('gli_put_char: window has pending line request');gli_window_put_string(str.win,CharToString(ch));if(str.win.echostr)
gli_put_char(str.win.echostr,ch);break;}}
function gli_put_array(str,arr,allbytes){var ix,len,val;if(!str||!str.writable)
throw('gli_put_array: invalid stream');if(!str.unicode&&!allbytes){arr=TrimArrayToBytes(arr);allbytes=true;}
str.writecount+=arr.length;switch(str.type){case strtype_File:if(str.streaming){if(!str.unicode){var buf=new str.fstream.BufferClass(arr);str.fstream.fwrite(buf);}
else{if(!str.isbinary){var arr8=UniArrayToUTF8(arr);var buf=new str.fstream.BufferClass(arr8);str.fstream.fwrite(buf);}
else{var buf=new str.fstream.BufferClass(4*arr.length);for(ix=0;ix<arr.length;ix++){buf.writeUInt32BE(arr[ix],4*ix,true);}
str.fstream.fwrite(buf);}}}
else{gli_stream_dirty_file(str);var arr8;if(!str.unicode){arr8=arr;}
else{if(!str.isbinary)
arr8=UniArrayToUTF8(arr);else
arr8=UniArrayToBE32(arr);}
var len=arr8.length;if(len>str.buflen-str.bufpos)
len=str.buflen-str.bufpos;for(ix=0;ix<len;ix++)
str.buf[str.bufpos+ix]=arr8[ix];str.bufpos+=len;if(str.bufpos>str.bufeof)
str.bufeof=str.bufpos;}
break;case strtype_Memory:len=arr.length;if(len>str.buflen-str.bufpos)
len=str.buflen-str.bufpos;for(ix=0;ix<len;ix++)
str.buf[str.bufpos+ix]=arr[ix];str.bufpos+=len;if(str.bufpos>str.bufeof)
str.bufeof=str.bufpos;break;case strtype_Window:if(str.win.line_request)
throw('gli_put_array: window has pending line request');if(allbytes)
val=String.fromCharCode.apply(this,arr);else
val=UniArrayToString(arr);gli_window_put_string(str.win,val);if(str.win.echostr)
gli_put_array(str.win.echostr,arr,allbytes);break;}}
function gli_get_char(str,want_unicode){var ch;if(!str||!str.readable)
return-1;switch(str.type){case strtype_File:if(str.streaming){if(!str.unicode){var len=str.fstream.fread(str.buffer4,1);if(!len)
return-1;str.readcount++;return str.buffer4[0];}
else{if(!str.isbinary){var val0,val1,val2,val3;var len=str.fstream.fread(str.buffer4,1);if(!len)
return-1;val0=str.buffer4[0];if(val0<0x80){ch=val0;}
else{var len=str.fstream.fread(str.buffer4,1);if(!len)
return-1;val1=str.buffer4[0];if((val1&0xC0)!=0x80)
return-1;if((val0&0xE0)==0xC0){ch=(val0&0x1F)<<6;ch|=(val1&0x3F);}
else{var len=str.fstream.fread(str.buffer4,1);if(!len)
return-1;val2=str.buffer4[0];if((val2&0xC0)!=0x80)
return-1;if((val0&0xF0)==0xE0){ch=(((val0&0xF)<<12)&0x0000F000);ch|=(((val1&0x3F)<<6)&0x00000FC0);ch|=(((val2&0x3F))&0x0000003F);}
else if((val0&0xF0)==0xF0){var len=str.fstream.fread(str.buffer4,1);if(!len)
return-1;val3=str.buffer4[0];if((val3&0xC0)!=0x80)
return-1;ch=(((val0&0x7)<<18)&0x1C0000);ch|=(((val1&0x3F)<<12)&0x03F000);ch|=(((val2&0x3F)<<6)&0x000FC0);ch|=(((val3&0x3F))&0x00003F);}
else{return-1;}}}}
else{var len=str.fstream.fread(str.buffer4,4);if(len<4)
return-1;ch=(str.buffer4[0]<<24);ch|=(str.buffer4[1]<<16);ch|=(str.buffer4[2]<<8);ch|=str.buffer4[3];}
str.readcount++;ch>>>=0;if(!want_unicode&&ch>=0x100)
return 63;return ch;}}
case strtype_Resource:if(str.unicode){if(str.isbinary){if(str.bufpos>=str.bufeof)
return-1;ch=str.buf[str.bufpos];str.bufpos++;if(str.bufpos>=str.bufeof)
return-1;ch=(ch<<8)|(str.buf[str.bufpos]&0xFF);str.bufpos++;if(str.bufpos>=str.bufeof)
return-1;ch=(ch<<8)|(str.buf[str.bufpos]&0xFF);str.bufpos++;if(str.bufpos>=str.bufeof)
return-1;ch=(ch<<8)|(str.buf[str.bufpos]&0xFF);str.bufpos++;}
else{var val0,val1,val2,val3;if(str.bufpos>=str.bufeof)
return-1;val0=str.buf[str.bufpos];str.bufpos++;if(val0<0x80){ch=val0;}
else{if(str.bufpos>=str.bufeof)
return-1;val1=str.buf[str.bufpos];str.bufpos++;if((val1&0xC0)!=0x80)
return-1;if((val0&0xE0)==0xC0){ch=(val0&0x1F)<<6;ch|=(val1&0x3F);}
else{if(str.bufpos>=str.bufeof)
return-1;val2=str.buf[str.bufpos];str.bufpos++;if((val2&0xC0)!=0x80)
return-1;if((val0&0xF0)==0xE0){ch=(((val0&0xF)<<12)&0x0000F000);ch|=(((val1&0x3F)<<6)&0x00000FC0);ch|=(((val2&0x3F))&0x0000003F);}
else if((val0&0xF0)==0xF0){if(str.bufpos>=str.bufeof)
return-1;val3=str.buf[str.bufpos];str.bufpos++;if((val3&0xC0)!=0x80)
return-1;ch=(((val0&0x7)<<18)&0x1C0000);ch|=(((val1&0x3F)<<12)&0x03F000);ch|=(((val2&0x3F)<<6)&0x000FC0);ch|=(((val3&0x3F))&0x00003F);}
else{return-1;}}}}
str.readcount++;ch>>>=0;if(!want_unicode&&ch>=0x100)
return 63;return ch;}
case strtype_Memory:if(str.bufpos<str.bufeof){ch=str.buf[str.bufpos];str.bufpos++;str.readcount++;if(!want_unicode&&ch>=0x100)
return 63;return ch;}
else{return-1;}
default:return-1;}}
function gli_get_line(str,buf,want_unicode){if(!str||!str.readable)
return 0;var len=buf.length;var gotnewline;switch(str.type){case strtype_File:if(str.streaming){if(len==0)
return 0;len-=1;gotnewline=false;for(lx=0;lx<len&&!gotnewline;lx++){ch=gli_get_char(str,want_unicode);if(ch==-1)
break;buf[lx]=ch;gotnewline=(ch==10);}
return lx;}
case strtype_Resource:if(str.unicode){if(len==0)
return 0;len-=1;gotnewline=false;for(lx=0;lx<len&&!gotnewline;lx++){ch=gli_get_char(str,want_unicode);if(ch==-1)
break;buf[lx]=ch;gotnewline=(ch==10);}
return lx;}
case strtype_Memory:if(len==0)
return 0;len-=1;if(str.bufpos>=str.bufeof){len=0;}
else{if(str.bufpos+len>str.bufeof){len=str.bufeof-str.bufpos;}}
gotnewline=false;if(!want_unicode){for(lx=0;lx<len&&!gotnewline;lx++){ch=str.buf[str.bufpos++];if(!want_unicode&&ch>=0x100)
ch=63;buf[lx]=ch;gotnewline=(ch==10);}}
else{for(lx=0;lx<len&&!gotnewline;lx++){ch=str.buf[str.bufpos++];buf[lx]=ch;gotnewline=(ch==10);}}
str.readcount+=lx;return lx;default:return 0;}}
function gli_get_buffer(str,buf,want_unicode){if(!str||!str.readable)
return 0;var len=buf.length;var lx,ch;switch(str.type){case strtype_File:if(str.streaming){for(lx=0;lx<len;lx++){ch=gli_get_char(str,want_unicode);if(ch==-1)
break;buf[lx]=ch;}
return lx;}
case strtype_Resource:if(str.unicode){for(lx=0;lx<len;lx++){ch=gli_get_char(str,want_unicode);if(ch==-1)
break;buf[lx]=ch;}
return lx;}
case strtype_Memory:if(str.bufpos>=str.bufeof){len=0;}
else{if(str.bufpos+len>str.bufeof){len=str.bufeof-str.bufpos;}}
if(!want_unicode){for(lx=0;lx<len;lx++){ch=str.buf[str.bufpos++];if(!want_unicode&&ch>=0x100)
ch=63;buf[lx]=ch;}}
else{for(lx=0;lx<len;lx++){buf[lx]=str.buf[str.bufpos++];}}
str.readcount+=len;return len;default:return 0;}}
function gli_stream_fill_result(str,result){if(!result)
return;result.set_field(0,str.readcount);result.set_field(1,str.writecount);}
function glk_put_jstring(val,allbytes){glk_put_jstring_stream(gli_currentstr,val,allbytes);}
function glk_put_jstring_stream(str,val,allbytes){var ix,len;if(!str||!str.writable)
throw('glk_put_jstring: invalid stream');str.writecount+=val.length;switch(str.type){case strtype_File:if(str.streaming){if(!str.unicode){var buf=new str.fstream.BufferClass(val,'binary');str.fstream.fwrite(buf);}
else{if(!str.isbinary){var buf=new str.fstream.BufferClass(val);str.fstream.fwrite(buf);}
else{var buf=new str.fstream.BufferClass(4*val.length);for(ix=0;ix<val.length;ix++){buf.writeUInt32BE(val.charCodeAt(ix),4*ix,true);}
str.fstream.fwrite(buf);}}}
else{gli_stream_dirty_file(str);var arr=[];for(ix=0;ix<val.length;ix++)
arr.push(val.charCodeAt(ix));var arr8;if(!str.unicode){arr8=arr;}
else{if(!str.isbinary)
arr8=UniArrayToUTF8(arr);else
arr8=UniArrayToBE32(arr);}
var len=arr8.length;if(len>str.buflen-str.bufpos)
len=str.buflen-str.bufpos;for(ix=0;ix<len;ix++)
str.buf[str.bufpos+ix]=arr8[ix];str.bufpos+=len;if(str.bufpos>str.bufeof)
str.bufeof=str.bufpos;}
break;case strtype_Memory:len=val.length;if(len>str.buflen-str.bufpos)
len=str.buflen-str.bufpos;if(str.unicode||allbytes){for(ix=0;ix<len;ix++)
str.buf[str.bufpos+ix]=val.charCodeAt(ix);}
else{for(ix=0;ix<len;ix++){var ch=val.charCodeAt(ix);if(ch<0||ch>=0x100)
ch=63;str.buf[str.bufpos+ix]=ch;}}
str.bufpos+=len;if(str.bufpos>str.bufeof)
str.bufeof=str.bufpos;break;case strtype_Window:if(str.win.line_request)
throw('glk_put_jstring: window has pending line request');gli_window_put_string(str.win,val);if(str.win.echostr)
glk_put_jstring_stream(str.win.echostr,val,allbytes);break;}}
function gli_set_style(str,val){if(!str||!str.writable)
throw('gli_set_style: invalid stream');if(val>=Const.style_NUMSTYLES)
val=0;if(str.type==strtype_Window){str.win.style=val;if(str.win.echostr)
gli_set_style(str.win.echostr,val);}}
function gli_set_hyperlink(str,val){if(!str||!str.writable)
throw('gli_set_hyperlink: invalid stream');if(str.type==strtype_Window){str.win.hyperlink=val;if(str.win.echostr)
gli_set_hyperlink(str.win.echostr,val);}}
function gli_timer_callback(){if(ui_disabled){if(has_exited){GlkOte.log("### dropping timer event...");gli_timer_id=null;return;}
else{GlkOte.log("### procrastinating timer event...");gli_timer_id=setTimeout(gli_timer_callback,500);return;}}
gli_timer_id=setTimeout(gli_timer_callback,gli_timer_interval);gli_timer_started=Date.now();GlkOte.extevent('timer');}
function glk_exit(){has_exited=true;ui_disabled=true;gli_selectref=null;if(option_exit_warning)
GlkOte.warning(option_exit_warning);return DidNotReturn;}
function glk_tick(){}
function glk_gestalt(sel,val){return glk_gestalt_ext(sel,val,null);}
function glk_gestalt_ext(sel,val,arr){switch(sel){case 0:return 0x00000704;case 1:if(val<=Const.keycode_Left&&val>=Const.keycode_End)
return 1;if(val>=0x100000000-Const.keycode_MAXVAL)
return 0;if(val>0x10FFFF)
return 0;if((val>=0&&val<32)||(val>=127&&val<160))
return 0;return 1;case 2:if(val>0x10FFFF)
return 0;if((val>=0&&val<32)||(val>=127&&val<160))
return 0;return 1;case 3:if((val>0x10FFFF)||(val>=0&&val<32)||(val>=127&&val<160)){if(arr)
arr[0]=1;return 0;}
if(arr)
arr[0]=1;return 2;case 4:if(val==Const.wintype_TextBuffer)
return 1;if(val==Const.wintype_Graphics&&has_canvas)
return 1;return 0;case 5:return 1;case 6:return 1;case 7:if(val==Const.wintype_TextBuffer)
return 1;if(val==Const.wintype_Graphics&&has_canvas)
return 1;return 0;case 8:return 0;case 9:return 0;case 10:return 0;case 11:return 1;case 12:if(val==3||val==4)
return 1;else
return 0;case 13:return 0;case 14:return 1;case 15:return 1;case 16:return 1;case 17:return 1;case 18:return 1;case 19:if(val==Const.keycode_Escape)
return 1;if(val>=Const.keycode_Func12&&val<=Const.keycode_Func1)
return 1;return 0;case 20:return 1;case 21:return 0;case 22:return 1;case 23:return 0;}
if(option_glk_gestalt_hook){var res=option_glk_gestalt_hook(sel,val,arr);if(res!==undefined)
return res;}
return 0;}
function glk_window_iterate(win,rockref){if(!win)
win=gli_windowlist;else
win=win.next;if(win){if(rockref)
rockref.set_value(win.rock);return win;}
if(rockref)
rockref.set_value(0);return null;}
function glk_window_get_rock(win){if(!win)
throw('glk_window_get_rock: invalid window');return win.rock;}
function glk_window_get_root(){return gli_rootwin;}
function glk_window_open(splitwin,method,size,wintype,rock){var oldparent,box,val;var pairwin,newwin;if(!gli_rootwin){if(splitwin)
throw('glk_window_open: splitwin must be null for first window');oldparent=null;box={left:content_metrics.outspacingx,top:content_metrics.outspacingy,right:content_metrics.width-content_metrics.outspacingx,bottom:content_metrics.height-content_metrics.outspacingy};}
else{if(!splitwin)
throw('glk_window_open: splitwin must not be null');val=(method&Const.winmethod_DivisionMask);if(val!=Const.winmethod_Fixed&&val!=Const.winmethod_Proportional)
throw('glk_window_open: invalid method (not fixed or proportional)');val=(method&Const.winmethod_DirMask);if(val!=Const.winmethod_Above&&val!=Const.winmethod_Below&&val!=Const.winmethod_Left&&val!=Const.winmethod_Right)
throw('glk_window_open: invalid method (bad direction)');box=splitwin.bbox;oldparent=splitwin.parent;if(oldparent&&oldparent.type!=Const.wintype_Pair)
throw('glk_window_open: parent window is not Pair');}
newwin=gli_new_window(wintype,rock);switch(newwin.type){case Const.wintype_TextBuffer:newwin.accum=[];newwin.accumstyle=null;newwin.accumhyperlink=0;newwin.content=[];newwin.clearcontent=false;newwin.reserve=[];break;case Const.wintype_TextGrid:newwin.gridwidth=0;newwin.gridheight=0;newwin.lines=[];newwin.cursorx=0;newwin.cursory=0;break;case Const.wintype_Graphics:if(!has_canvas){gli_delete_window(newwin);return null;}
newwin.content=[];newwin.reserve=[];break;case Const.wintype_Blank:break;case Const.wintype_Pair:throw('glk_window_open: cannot open pair window directly')
default:gli_delete_window(newwin);return null;}
if(!splitwin){gli_rootwin=newwin;gli_window_rearrange(newwin,box);}
else{pairwin=gli_new_window(Const.wintype_Pair,0);pairwin.pair_dir=method&Const.winmethod_DirMask;pairwin.pair_division=method&Const.winmethod_DivisionMask;pairwin.pair_key=newwin;pairwin.pair_keydamage=false;pairwin.pair_size=size;pairwin.pair_hasborder=((method&Const.winmethod_BorderMask)==Const.winmethod_Border);pairwin.pair_vertical=(pairwin.pair_dir==Const.winmethod_Left||pairwin.pair_dir==Const.winmethod_Right);pairwin.pair_backward=(pairwin.pair_dir==Const.winmethod_Left||pairwin.pair_dir==Const.winmethod_Above);pairwin.child1=splitwin;pairwin.child2=newwin;splitwin.parent=pairwin;newwin.parent=pairwin;pairwin.parent=oldparent;if(oldparent){if(oldparent.child1==splitwin)
oldparent.child1=pairwin;else
oldparent.child2=pairwin;}
else{gli_rootwin=pairwin;}
gli_window_rearrange(pairwin,box);}
return newwin;}
function glk_window_close(win,statsref){if(!win)
throw('glk_window_close: invalid window');if(win===gli_rootwin||!win.parent){gli_rootwin=null;gli_stream_fill_result(win.str,statsref);gli_window_close(win,true);}
else{var pairwin,grandparwin,sibwin,box,wx,keydamage_flag;pairwin=win.parent;if(win===pairwin.child1)
sibwin=pairwin.child2;else if(win===pairwin.child2)
sibwin=pairwin.child1;else
throw('glk_window_close: window tree is corrupted');box=pairwin.bbox;grandparwin=pairwin.parent;if(!grandparwin){gli_rootwin=sibwin;sibwin.parent=null;}
else{if(grandparwin.child1===pairwin)
grandparwin.child1=sibwin;else
grandparwin.child2=sibwin;sibwin.parent=grandparwin;}
gli_stream_fill_result(win.str,statsref);gli_window_close(win,true);if(win===pairwin.child1){pairwin.child1=null;}
else if(win===pairwin.child2){pairwin.child2=null;}
gli_window_close(pairwin,false);keydamage_flag=false;for(wx=sibwin;wx;wx=wx.parent){if(wx.type==Const.wintype_Pair){if(wx.pair_keydamage){keydamage_flag=true;wx.pair_keydamage=false;}}}
if(keydamage_flag){box=content_box;gli_window_rearrange(gli_rootwin,box);}
else{gli_window_rearrange(sibwin,box);}}}
function glk_window_get_size(win,widthref,heightref){if(!win)
throw('glk_window_get_size: invalid window');var wid=0;var hgt=0;var boxwidth,boxheight;switch(win.type){case Const.wintype_TextGrid:boxwidth=win.bbox.right-win.bbox.left;boxheight=win.bbox.bottom-win.bbox.top;wid=Math.max(0,Math.floor((boxwidth-content_metrics.gridmarginx)/content_metrics.gridcharwidth));hgt=Math.max(0,Math.floor((boxheight-content_metrics.gridmarginy)/content_metrics.gridcharheight));break;case Const.wintype_TextBuffer:boxwidth=win.bbox.right-win.bbox.left;boxheight=win.bbox.bottom-win.bbox.top;wid=Math.max(0,Math.floor((boxwidth-content_metrics.buffermarginx)/content_metrics.buffercharwidth));hgt=Math.max(0,Math.floor((boxheight-content_metrics.buffermarginy)/content_metrics.buffercharheight));break;case Const.wintype_Graphics:boxwidth=win.bbox.right-win.bbox.left;boxheight=win.bbox.bottom-win.bbox.top;wid=boxwidth-content_metrics.graphicsmarginx;hgt=boxheight-content_metrics.graphicsmarginy;break;}
if(widthref)
widthref.set_value(wid);if(heightref)
heightref.set_value(hgt);}
function glk_window_set_arrangement(win,method,size,keywin){var wx,newdir,newvertical,newbackward;if(!win)
throw('glk_window_set_arrangement: invalid window');if(win.type!=Const.wintype_Pair)
throw('glk_window_set_arrangement: not a pair window');if(keywin){if(keywin.type==Const.wintype_Pair)
throw('glk_window_set_arrangement: keywin cannot be a pair window');for(wx=keywin;wx;wx=wx.parent){if(wx==win)
break;}
if(!wx)
throw('glk_window_set_arrangement: keywin must be a descendant');}
newdir=method&Const.winmethod_DirMask;newvertical=(newdir==Const.winmethod_Left||newdir==Const.winmethod_Right);newbackward=(newdir==Const.winmethod_Left||newdir==Const.winmethod_Above);if(!keywin)
keywin=win.pair_key;if(newvertical&&!win.pair_vertical)
throw('glk_window_set_arrangement: split must stay horizontal');if(!newvertical&&win.pair_vertical)
throw('glk_window_set_arrangement: split must stay vertical');if(keywin&&keywin.type==Const.wintype_Blank&&(method&Const.winmethod_DivisionMask)==Const.winmethod_Fixed)
throw('glk_window_set_arrangement: a blank window cannot have a fixed size');if((newbackward&&!win.pair_backward)||(!newbackward&&win.pair_backward)){wx=win.child1;win.child1=win.child2;win.child2=wx;}
win.pair_dir=newdir;win.pair_division=(method&Const.winmethod_DivisionMask);win.pair_key=keywin;win.pair_size=size;win.pair_hasborder=((method&Const.winmethod_BorderMask)==Const.winmethod_Border);win.pair_vertical=(win.pair_dir==Const.winmethod_Left||win.pair_dir==Const.winmethod_Right);win.pair_backward=(win.pair_dir==Const.winmethod_Left||win.pair_dir==Const.winmethod_Above);gli_window_rearrange(win,win.bbox);}
function glk_window_get_arrangement(win,methodref,sizeref,keywinref){if(!win)
throw('glk_window_get_arrangement: invalid window');if(win.type!=Const.wintype_Pair)
throw('glk_window_get_arrangement: not a pair window');if(sizeref)
sizeref.set_value(win.pair_size);if(keywinref)
keywinref.set_value(win.pair_key);if(methodref)
methodref.set_value(win.pair_dir|win.pair_division|(win.pair_hasborder?Const.winmethod_Border:Const.winmethod_NoBorder));}
function glk_window_get_type(win){if(!win)
throw('glk_window_get_type: invalid window');return win.type;}
function glk_window_get_parent(win){if(!win)
throw('glk_window_get_parent: invalid window');return win.parent;}
function glk_window_clear(win){var ix,cx,lineobj;if(!win)
throw('glk_window_clear: invalid window');if(win.line_request){throw('glk_window_clear: window has pending line request');}
switch(win.type){case Const.wintype_TextBuffer:win.accum.length=0;win.accumstyle=null;win.accumhyperlink=0;win.content.length=0;win.clearcontent=true;break;case Const.wintype_TextGrid:win.cursorx=0;win.cursory=0;for(ix=0;ix<win.gridheight;ix++){lineobj=win.lines[ix];lineobj.dirty=true;for(cx=0;cx<win.gridwidth;cx++){lineobj.chars[cx]=' ';lineobj.styles[cx]=Const.style_Normal;lineobj.hyperlinks[cx]=0;}}
break;case Const.wintype_Graphics:var setcol=null;for(var ix=0;ix<win.content.length;ix++){if(win.content[ix].special=='setcolor')
setcol=win.content[ix];}
win.content.length=0;if(setcol!==null)
win.content.push(setcol);win.content.push({special:'fill'});break;}}
function glk_window_move_cursor(win,xpos,ypos){if(!win)
throw('glk_window_move_cursor: invalid window');if(win.type==Const.wintype_TextGrid){win.cursorx=xpos;win.cursory=ypos;}
else{throw('glk_window_move_cursor: not a grid window');}}
function glk_window_get_stream(win){if(!win)
throw('glk_window_get_stream: invalid window');return win.str;}
function glk_window_set_echo_stream(win,str){if(!win)
throw('glk_window_set_echo_stream: invalid window');win.echostr=str;}
function glk_window_get_echo_stream(win){if(!win)
throw('glk_window_get_echo_stream: invalid window');return win.echostr;}
function glk_set_window(win){if(!win)
gli_currentstr=null;else
gli_currentstr=win.str;}
function glk_window_get_sibling(win){var parent,sib;if(!win)
throw('glk_window_get_sibling: invalid window');parent=win.parent;if(!parent)
return null;if(win===parent.child1)
return parent.child2;else if(win===parent.child2)
return parent.child1;else
throw('glk_window_get_sibling: window tree is corrupted');}
function glk_stream_iterate(str,rockref){if(!str)
str=gli_streamlist;else
str=str.next;if(str){if(rockref)
rockref.set_value(str.rock);return str;}
if(rockref)
rockref.set_value(0);return null;}
function glk_stream_get_rock(str){if(!str)
throw('glk_stream_get_rock: invalid stream');return str.rock;}
function glk_stream_open_file(fref,fmode,rock){if(!fref)
throw('glk_stream_open_file: invalid fileref');var str;var fstream;if(fmode!=Const.filemode_Read&&fmode!=Const.filemode_Write&&fmode!=Const.filemode_ReadWrite&&fmode!=Const.filemode_WriteAppend)
throw('glk_stream_open_file: illegal filemode');if(fmode==Const.filemode_Read&&!Dialog.file_ref_exists(fref.ref))
throw('glk_stream_open_file: file not found for reading: '+fref.ref.filename);if(!Dialog.streaming){var content=null;if(fmode!=Const.filemode_Write){content=Dialog.file_read(fref.ref);}
if(content==null){content=[];if(fmode!=Const.filemode_Read){Dialog.file_write(fref.ref,'',true);}}
if(content.length==null)
throw('glk_stream_open_file: data read had no length');}
else{fstream=Dialog.file_fopen(fmode,fref.ref);if(!fstream)
return null;}
str=gli_new_stream(strtype_File,(fmode!=Const.filemode_Write),(fmode!=Const.filemode_Read),rock);str.unicode=false;str.isbinary=!fref.textmode;str.ref=fref.ref;str.origfmode=fmode;if(!Dialog.streaming){str.streaming=false;str.buf=content;str.buflen=0xFFFFFFFF;if(fmode==Const.filemode_Write)
str.bufeof=0;else
str.bufeof=content.length;if(fmode==Const.filemode_WriteAppend)
str.bufpos=str.bufeof;else
str.bufpos=0;}
else{str.streaming=true;str.fstream=fstream;str.buffer4=new fstream.BufferClass(4);}
return str;}
function glk_stream_open_memory(buf,fmode,rock){var str;if(fmode!=Const.filemode_Read&&fmode!=Const.filemode_Write&&fmode!=Const.filemode_ReadWrite)
throw('glk_stream_open_memory: illegal filemode');str=gli_new_stream(strtype_Memory,(fmode!=Const.filemode_Write),(fmode!=Const.filemode_Read),rock);str.unicode=false;if(buf){str.buf=buf;str.buflen=buf.length;str.bufpos=0;if(fmode==Const.filemode_Write)
str.bufeof=0;else
str.bufeof=str.buflen;if(window.GiDispa)
GiDispa.retain_array(buf);}
return str;}
function glk_stream_open_resource(filenum,rock){var str;if(!window.GiLoad||!GiLoad.find_data_chunk)
return null;var el=GiLoad.find_data_chunk(filenum);if(!el)
return null;var buf=el.data;var isbinary=(el.type=='BINA');str=gli_new_stream(strtype_Resource,true,false,rock);str.unicode=false;str.isbinary=isbinary;str.resfilenum=filenum;str.streaming=false;if(buf){str.buf=buf;str.buflen=buf.length;str.bufpos=0;str.bufeof=str.buflen;}
return str;}
function glk_stream_open_resource_uni(filenum,rock){var str;if(!window.GiLoad||!GiLoad.find_data_chunk)
return null;var el=GiLoad.find_data_chunk(filenum);if(!el)
return null;var buf=el.data;var isbinary=(el.type=='BINA');str=gli_new_stream(strtype_Resource,true,false,rock);str.unicode=true;str.isbinary=isbinary;str.resfilenum=filenum;str.streaming=false;if(buf){str.buf=buf;str.buflen=buf.length;str.bufpos=0;str.bufeof=str.buflen;}
return str;}
function glk_stream_close(str,result){if(!str)
throw('glk_stream_close: invalid stream');if(str.type==strtype_Window)
throw('glk_stream_close: cannot close window stream');if(str.type==strtype_File&&str.writable){if(!str.streaming){if(!(str.timer_id===null)){clearTimeout(str.timer_id);str.timer_id=null;}
Dialog.file_write(str.ref,str.buf);}}
gli_stream_fill_result(str,result);gli_delete_stream(str);}
function glk_stream_set_position(str,pos,seekmode){if(!str)
throw('glk_stream_set_position: invalid stream');switch(str.type){case strtype_File:if(str.streaming){str.fstream.fseek(pos,seekmode);break;}
case strtype_Resource:case strtype_Memory:if(seekmode==Const.seekmode_Current){pos=str.bufpos+pos;}
else if(seekmode==Const.seekmode_End){pos=str.bufeof+pos;}
else{}
if(pos<0)
pos=0;if(pos>str.bufeof)
pos=str.bufeof;str.bufpos=pos;}}
function glk_stream_get_position(str){if(!str)
throw('glk_stream_get_position: invalid stream');switch(str.type){case strtype_File:if(str.streaming){return str.fstream.ftell();}
case strtype_Resource:case strtype_Memory:return str.bufpos;default:return 0;}}
function glk_stream_set_current(str){gli_currentstr=str;}
function glk_stream_get_current(){return gli_currentstr;}
function glk_fileref_create_temp(usage,rock){var filetype=(usage&Const.fileusage_TypeMask);var filetypename=FileTypeMap[filetype];var ref=Dialog.file_construct_temp_ref(filetypename);fref=gli_new_fileref(ref.filename,usage,rock,ref);return fref;}
function glk_fileref_create_by_name(usage,filename,rock){filename=Dialog.file_clean_fixed_name(filename,(usage&Const.fileusage_TypeMask));fref=gli_new_fileref(filename,usage,rock,null);return fref;}
function glk_fileref_create_by_prompt(usage,fmode,rock){var modename;var filetype=(usage&Const.fileusage_TypeMask);var filetypename=FileTypeMap[filetype];if(!filetypename){filetypename='xxx';}
switch(fmode){case Const.filemode_Write:modename='write';break;case Const.filemode_ReadWrite:modename='readwrite';break;case Const.filemode_WriteAppend:modename='writeappend';break;case Const.filemode_Read:default:modename='read';break;}
var special={type:'fileref_prompt',filetype:filetypename,filemode:modename};var callback={usage:usage,rock:rock};if(filetype==Const.fileusage_SavedGame)
special.gameid=VM.get_signature();ui_specialinput=special;ui_specialcallback=callback;gli_selectref=null;return DidNotReturn;}
function gli_fileref_create_by_prompt_callback(obj){var ref=obj.value;var usage=ui_specialcallback.usage;var rock=ui_specialcallback.rock;var fref=null;if(ref){fref=gli_new_fileref(ref.filename,usage,rock,ref);}
ui_specialinput=null;ui_specialcallback=null;if(window.GiDispa)
GiDispa.prepare_resume(fref);VM.resume();}
function glk_fileref_destroy(fref){if(!fref)
throw('glk_fileref_destroy: invalid fileref');gli_delete_fileref(fref);}
function glk_fileref_iterate(fref,rockref){if(!fref)
fref=gli_filereflist;else
fref=fref.next;if(fref){if(rockref)
rockref.set_value(fref.rock);return fref;}
if(rockref)
rockref.set_value(0);return null;}
function glk_fileref_get_rock(fref){if(!fref)
throw('glk_fileref_get_rock: invalid fileref');return fref.rock;}
function glk_fileref_delete_file(fref){if(!fref)
throw('glk_fileref_delete_file: invalid fileref');Dialog.file_remove_ref(fref.ref);}
function glk_fileref_does_file_exist(fref){if(!fref)
throw('glk_fileref_does_file_exist: invalid fileref');if(Dialog.file_ref_exists(fref.ref))
return 1;else
return 0;}
function glk_fileref_create_from_fileref(usage,oldfref,rock){if(!oldfref)
throw('glk_fileref_create_from_fileref: invalid fileref');var fref=gli_new_fileref(oldfref.filename,usage,rock,null);return fref;}
function glk_put_char(ch){gli_put_char(gli_currentstr,ch&0xFF);}
function glk_put_char_stream(str,ch){gli_put_char(str,ch&0xFF);}
function glk_put_string(val){glk_put_jstring_stream(gli_currentstr,val,true);}
function glk_put_string_stream(str,val){glk_put_jstring_stream(str,val,true);}
function glk_put_buffer(arr){arr=TrimArrayToBytes(arr);gli_put_array(gli_currentstr,arr,true);}
function glk_put_buffer_stream(str,arr){arr=TrimArrayToBytes(arr);gli_put_array(str,arr,true);}
function glk_set_style(val){gli_set_style(gli_currentstr,val);}
function glk_set_style_stream(str,val){gli_set_style(str,val);}
function glk_get_char_stream(str){if(!str)
throw('glk_get_char_stream: invalid stream');return gli_get_char(str,false);}
function glk_get_line_stream(str,buf){if(!str)
throw('glk_get_line_stream: invalid stream');return gli_get_line(str,buf,false);}
function glk_get_buffer_stream(str,buf){if(!str)
throw('glk_get_buffer_stream: invalid stream');return gli_get_buffer(str,buf,false);}
function glk_char_to_lower(val){if(val>=0x41&&val<=0x5A)
return val+0x20;if(val>=0xC0&&val<=0xDE&&val!=0xD7)
return val+0x20;return val;}
function glk_char_to_upper(val){if(val>=0x61&&val<=0x7A)
return val-0x20;if(val>=0xE0&&val<=0xFE&&val!=0xF7)
return val-0x20;return val;}
function glk_stylehint_set(wintype,styl,hint,value){}
function glk_stylehint_clear(wintype,styl,hint){}
function glk_style_distinguish(win,styl1,styl2){return 0;}
function glk_style_measure(win,styl,hint,resultref){if(resultref)
resultref.set_value(0);return 0;}
function glk_select(eventref){gli_selectref=eventref;return DidNotReturn;}
function glk_select_poll(eventref){eventref.set_field(0,Const.evtype_None);eventref.set_field(1,null);eventref.set_field(2,0);eventref.set_field(3,0);if(gli_timer_interval&&!(gli_timer_id===null)){var now=Date.now();if(now-gli_timer_started>gli_timer_interval){clearTimeout(gli_timer_id);gli_timer_id=setTimeout(gli_timer_callback,gli_timer_interval);gli_timer_started=Date.now();eventref.set_field(0,Const.evtype_Timer);}}}
function glk_request_line_event(win,buf,initlen){if(!win)
throw('glk_request_line_event: invalid window');if(win.char_request||win.line_request)
throw('glk_request_line_event: window already has keyboard request');if(win.type==Const.wintype_TextBuffer||win.type==Const.wintype_TextGrid){if(initlen){var ls=buf.slice(0,initlen);if(!current_partial_outputs)
current_partial_outputs={};current_partial_outputs[win.disprock]=ByteArrayToString(ls);}
win.line_request=true;win.line_request_uni=false;if(win.type==Const.wintype_TextBuffer)
win.request_echo_line_input=win.echo_line_input;else
win.request_echo_line_input=true;win.input_generation=event_generation;win.linebuf=buf;if(window.GiDispa)
GiDispa.retain_array(buf);}
else{throw('glk_request_line_event: window does not support keyboard input');}}
function glk_cancel_line_event(win,eventref){if(!win)
throw('glk_cancel_line_event: invalid window');if(!win.line_request){if(eventref){eventref.set_field(0,Const.evtype_None);eventref.set_field(1,null);eventref.set_field(2,0);eventref.set_field(3,0);}
return;}
var input="";var ix,val;if(current_partial_inputs){val=current_partial_inputs[win.disprock];if(val)
input=val;}
if(input.length>win.linebuf.length)
input=input.slice(0,win.linebuf.length);if(win.request_echo_line_input){ix=win.style;gli_set_style(win.str,Const.style_Input);gli_window_put_string(win,input);if(win.echostr)
glk_put_jstring_stream(win.echostr,input);gli_set_style(win.str,ix);gli_window_put_string(win,"\n");if(win.echostr)
glk_put_jstring_stream(win.echostr,"\n");}
for(ix=0;ix<input.length;ix++)
win.linebuf[ix]=input.charCodeAt(ix);if(eventref){eventref.set_field(0,Const.evtype_LineInput);eventref.set_field(1,win);eventref.set_field(2,input.length);eventref.set_field(3,0);}
if(window.GiDispa)
GiDispa.unretain_array(win.linebuf);win.line_request=false;win.line_request_uni=false;win.request_echo_line_input=null;win.input_generation=null;win.linebuf=null;}
function glk_request_char_event(win){if(!win)
throw('glk_request_char_event: invalid window');if(win.char_request||win.line_request)
throw('glk_request_char_event: window already has keyboard request');if(win.type==Const.wintype_TextBuffer||win.type==Const.wintype_TextGrid){win.char_request=true;win.char_request_uni=false;win.input_generation=event_generation;}
else{throw('glk_request_char_event: window does not support keyboard input');}}
function glk_cancel_char_event(win){if(!win)
throw('glk_cancel_char_event: invalid window');win.char_request=false;win.char_request_uni=false;}
function glk_set_echo_line_event(win,val){if(!win)
throw('glk_set_echo_line_event: invalid window');win.echo_line_input=(val!=0);}
function glk_set_terminators_line_event(win,arr){if(!win)
throw('glk_set_terminators_line_event: invalid window');if(KeystrokeValueMap===null){KeystrokeValueMap={};for(var val in KeystrokeNameMap){KeystrokeValueMap[KeystrokeNameMap[val]]=val;}}
var res=[];if(arr){for(var ix=0;ix<arr.length;ix++){var val=KeystrokeValueMap[arr[ix]];if(val)
res.push(val);}}
win.line_input_terminators=res;}
function glk_request_mouse_event(win){if(!win)
throw('glk_request_mouse_event: invalid window');if(win.type==Const.wintype_TextGrid||win.type==Const.wintype_Graphics){win.mouse_request=true;}}
function glk_cancel_mouse_event(win){if(!win)
throw('glk_cancel_mouse_event: invalid window');win.mouse_request=false;}
function glk_request_timer_events(msec){if(!(gli_timer_id===null)){clearTimeout(gli_timer_id);gli_timer_id=null;gli_timer_started=null;}
if(!msec){gli_timer_interval=null;}
else{gli_timer_interval=msec;gli_timer_id=setTimeout(gli_timer_callback,gli_timer_interval);gli_timer_started=Date.now();}}
function glk_image_get_info(imgid,widthref,heightref){if(!window.GiLoad||!GiLoad.get_image_info)
return null;var info=GiLoad.get_image_info(imgid);if(info){if(widthref)
widthref.set_value(info.width);if(heightref)
heightref.set_value(info.height);return 1;}
if(widthref)
widthref.set_value(0);if(heightref)
heightref.set_value(0);return 0;}
function glk_image_draw(win,imgid,val1,val2){if(!win)
throw('glk_image_draw: invalid window');if(!window.GiLoad||!GiLoad.get_image_info)
return 0;var info=GiLoad.get_image_info(imgid);if(!info)
return 0;var img={special:'image',image:imgid,url:info.url,alttext:info.alttext,width:info.width,height:info.height};switch(win.type){case Const.wintype_TextBuffer:var alignment='inlineup';switch(val1){case Const.imagealign_InlineUp:alignment='inlineup';break;case Const.imagealign_InlineDown:alignment='inlinedown';break;case Const.imagealign_InlineCenter:alignment='inlinecenter';break;case Const.imagealign_MarginLeft:alignment='marginleft';break;case Const.imagealign_MarginRight:alignment='marginright';break;}
img.alignment=alignment;if(win.hyperlink)
img.hyperlink=win.hyperlink;gli_window_buffer_put_special(win,img);return 1;case Const.wintype_Graphics:img.x=val1;img.y=val2;win.content.push(img);return 1;}
return 0;}
function glk_image_draw_scaled(win,imgid,val1,val2,width,height){if(!win)
throw('glk_image_draw_scaled: invalid window');if(!window.GiLoad||!GiLoad.get_image_info)
return 0;var info=GiLoad.get_image_info(imgid);if(!info)
return 0;var img={special:'image',image:imgid,url:info.url,alttext:info.alttext,width:width,height:height};switch(win.type){case Const.wintype_TextBuffer:var alignment='inlineup';switch(val1){case Const.imagealign_InlineUp:alignment='inlineup';break;case Const.imagealign_InlineDown:alignment='inlinedown';break;case Const.imagealign_InlineCenter:alignment='inlinecenter';break;case Const.imagealign_MarginLeft:alignment='marginleft';break;case Const.imagealign_MarginRight:alignment='marginright';break;}
img.alignment=alignment;if(win.hyperlink)
img.hyperlink=win.hyperlink;gli_window_buffer_put_special(win,img);return 1;case Const.wintype_Graphics:img.x=val1;img.y=val2;win.content.push(img);return 1;}
return 0;}
function glk_window_flow_break(win){if(!win)
throw('glk_window_flow_break: invalid window');if(win.type==Const.wintype_TextBuffer)
gli_window_buffer_put_special(win,undefined,true);}
function glk_window_erase_rect(win,left,top,width,height){if(!win)
throw('glk_window_erase_rect: invalid window');if(win.type!=Const.wintype_Graphics)
throw('glk_window_erase_rect: not a graphics window');win.content.push({special:'fill',x:left,y:top,width:width,height:height});}
function glk_window_fill_rect(win,color,left,top,width,height){if(!win)
throw('glk_window_fill_rect: invalid window');if(win.type!=Const.wintype_Graphics)
throw('glk_window_fill_rect: not a graphics window');var colstr=gli_color_to_css(color);win.content.push({special:'fill',color:colstr,x:left,y:top,width:width,height:height});}
function glk_window_set_background_color(win,color){if(!win)
throw('glk_window_set_background_color: invalid window');if(win.type!=Const.wintype_Graphics)
throw('glk_window_set_background_color: not a graphics window');var colstr=gli_color_to_css(color);win.content.push({special:'setcolor',color:colstr});}
function gli_color_to_css(color){var res=(color&0xFFFFFF).toString(16);while(res.length<6){res='0'+res;}
return'#'+res.toUpperCase();}
function glk_schannel_iterate(schan,rockref){if(!schan)
schan=gli_schannellist;else
schan=schan.next;if(schan){if(rockref)
rockref.set_value(schan.rock);return schan;}
if(rockref)
rockref.set_value(0);return null;}
function glk_schannel_get_rock(schan){if(!schan)
throw('glk_schannel_get_rock: invalid schannel');return schan.rock;}
function glk_schannel_create(rock){return null;}
function glk_schannel_destroy(schan){throw('glk_schannel_destroy: invalid schannel');}
function glk_schannel_play(schan,sndid){throw('glk_schannel_play: invalid schannel');}
function glk_schannel_play_ext(schan,sndid,repeats,notify){throw('glk_schannel_play_ext: invalid schannel');}
function glk_schannel_stop(schan){throw('glk_schannel_stop: invalid schannel');}
function glk_schannel_set_volume(schan,vol){throw('glk_schannel_set_volume: invalid schannel');}
function glk_sound_load_hint(sndid,flag){}
function glk_schannel_create_ext(rock,vol){return null;}
function glk_schannel_play_multi(schans,sndids,notify){throw('glk_schannel_play_multi: invalid schannel');}
function glk_schannel_pause(schan){throw('glk_schannel_pause: invalid schannel');}
function glk_schannel_unpause(schan){throw('glk_schannel_unpause: invalid schannel');}
function glk_schannel_set_volume_ext(schan,vol,duration,notify){throw('glk_schannel_set_volume_ext: invalid schannel');}
function glk_set_hyperlink(val){gli_set_hyperlink(gli_currentstr,val);}
function glk_set_hyperlink_stream(str,val){gli_set_hyperlink(str,val);}
function glk_request_hyperlink_event(win){if(!win)
throw('glk_request_hyperlink_event: invalid window');if(win.type==Const.wintype_TextBuffer||win.type==Const.wintype_TextGrid){win.hyperlink_request=true;}}
function glk_cancel_hyperlink_event(win){if(!win)
throw('glk_cancel_hyperlink_event: invalid window');if(win.type==Const.wintype_TextBuffer||win.type==Const.wintype_TextGrid){win.hyperlink_request=false;}}
function glk_buffer_to_lower_case_uni(arr,numchars){var ix,jx,pos,val,origval;var arrlen=arr.length;var src=arr.slice(0,numchars);if(arrlen<numchars)
throw('buffer_to_lower_case_uni: numchars exceeds array length');pos=0;for(ix=0;ix<numchars;ix++){origval=src[ix];val=unicode_lower_table[origval];if(val===undefined){arr[pos]=origval;pos++;}
else if(!(val instanceof Array)){arr[pos]=val;pos++;}
else{for(jx=0;jx<val.length;jx++){arr[pos]=val[jx];pos++;}}}
arr.length=arrlen;return pos;}
function glk_buffer_to_upper_case_uni(arr,numchars){var ix,jx,pos,val,origval;var arrlen=arr.length;var src=arr.slice(0,numchars);if(arrlen<numchars)
throw('buffer_to_upper_case_uni: numchars exceeds array length');pos=0;for(ix=0;ix<numchars;ix++){origval=src[ix];val=unicode_upper_table[origval];if(val===undefined){arr[pos]=origval;pos++;}
else if(!(val instanceof Array)){arr[pos]=val;pos++;}
else{for(jx=0;jx<val.length;jx++){arr[pos]=val[jx];pos++;}}}
arr.length=arrlen;return pos;}
function glk_buffer_to_title_case_uni(arr,numchars,lowerrest){var ix,jx,pos,val,origval;var arrlen=arr.length;var src=arr.slice(0,numchars);if(arrlen<numchars)
throw('buffer_to_title_case_uni: numchars exceeds array length');pos=0;if(numchars==0)
return 0;ix=0;{origval=src[ix];val=unicode_title_table[origval];if(val===undefined){val=unicode_upper_table[origval];}
if(val===undefined){arr[pos]=origval;pos++;}
else if(!(val instanceof Array)){arr[pos]=val;pos++;}
else{for(jx=0;jx<val.length;jx++){arr[pos]=val[jx];pos++;}}}
if(!lowerrest){for(ix=1;ix<numchars;ix++){origval=src[ix];arr[pos]=origval;pos++;}}
else{for(ix=1;ix<numchars;ix++){origval=src[ix];val=unicode_lower_table[origval];if(val===undefined){arr[pos]=origval;pos++;}
else if(!(val instanceof Array)){arr[pos]=val;pos++;}
else{for(jx=0;jx<val.length;jx++){arr[pos]=val[jx];pos++;}}}}
arr.length=arrlen;return pos;}
function gli_buffer_canon_decompose_uni(arr,numchars){var src=arr.slice(0,numchars);var pos,ix,jx,origval,val;var grpstart,grpend,kx,tmp;pos=0;for(ix=0;ix<numchars;ix++){origval=src[ix];val=unicode_decomp_table[origval];if(val===undefined){arr[pos]=origval;pos++;}
else if(!(val instanceof Array)){arr[pos]=val;pos++;}
else{for(jx=0;jx<val.length;jx++){arr[pos]=val[jx];pos++;}}}
ix=0;while(ix<pos){if(!unicode_combin_table[arr[ix]]){ix++;continue;}
if(ix>=pos)
break;grpstart=ix;while(ix<pos&&unicode_combin_table[arr[ix]])
ix++;grpend=ix;if(grpend-grpstart>=2){for(jx=grpend-1;jx>grpstart;jx--){for(kx=grpstart;kx<jx;kx++){if(unicode_combin_table[arr[kx]]>unicode_combin_table[arr[kx+1]]){tmp=arr[kx];arr[kx]=arr[kx+1];arr[kx+1]=tmp;}}}}}
return pos;}
function gli_buffer_canon_compose_uni(arr,numchars){var ix,jx,curch,newch,curclass,newclass,map,pos;if(numchars==0)
return 0;pos=0;curch=arr[0];curclass=unicode_combin_table[curch];if(curclass)
curclass=999;ix=1;jx=ix;while(true){if(jx>=numchars){arr[pos]=curch;pos=ix;break;}
newch=arr[jx];newclass=unicode_combin_table[newch];map=unicode_compo_table[curch];if(map!==undefined&&map[newch]!==undefined&&(!curclass||(newclass&&curclass<newclass))){curch=map[newch];arr[pos]=curch;}
else{if(!newclass){pos=ix;curch=newch;}
curclass=newclass;arr[ix]=newch;ix++;}
jx++;}
return pos;}
function glk_buffer_canon_decompose_uni(arr,numchars){var arrlen=arr.length;var len;len=gli_buffer_canon_decompose_uni(arr,numchars);arr.length=arrlen;return len;}
function glk_buffer_canon_normalize_uni(arr,numchars){var arrlen=arr.length;var len;len=gli_buffer_canon_decompose_uni(arr,numchars);len=gli_buffer_canon_compose_uni(arr,len);arr.length=arrlen;return len;}
function glk_put_char_uni(ch){gli_put_char(gli_currentstr,ch);}
function glk_put_string_uni(val){glk_put_jstring_stream(gli_currentstr,val,false);}
function glk_put_buffer_uni(arr){gli_put_array(gli_currentstr,arr,false);}
function glk_put_char_stream_uni(str,ch){gli_put_char(str,ch);}
function glk_put_string_stream_uni(str,val){glk_put_jstring_stream(str,val,false);}
function glk_put_buffer_stream_uni(str,arr){gli_put_array(str,arr,false);}
function glk_get_char_stream_uni(str){if(!str)
throw('glk_get_char_stream_uni: invalid stream');return gli_get_char(str,true);}
function glk_get_buffer_stream_uni(str,buf){if(!str)
throw('glk_get_buffer_stream_uni: invalid stream');return gli_get_buffer(str,buf,true);}
function glk_get_line_stream_uni(str,buf){if(!str)
throw('glk_get_line_stream_uni: invalid stream');return gli_get_line(str,buf,true);}
function glk_stream_open_file_uni(fref,fmode,rock){if(!fref)
throw('glk_stream_open_file_uni: invalid fileref');var str;var fstream;if(fmode!=Const.filemode_Read&&fmode!=Const.filemode_Write&&fmode!=Const.filemode_ReadWrite&&fmode!=Const.filemode_WriteAppend)
throw('glk_stream_open_file_uni: illegal filemode');if(fmode==Const.filemode_Read&&!Dialog.file_ref_exists(fref.ref))
throw('glk_stream_open_file_uni: file not found for reading: '+fref.ref.filename);if(!Dialog.streaming){var content=null;if(fmode!=Const.filemode_Write){content=Dialog.file_read(fref.ref);}
if(content==null){content=[];if(fmode!=Const.filemode_Read){Dialog.file_write(fref.ref,'',true);}}
if(content.length==null)
throw('glk_stream_open_file_uni: data read had no length');}
else{fstream=Dialog.file_fopen(fmode,fref.ref);if(!fstream)
return null;}
str=gli_new_stream(strtype_File,(fmode!=Const.filemode_Write),(fmode!=Const.filemode_Read),rock);str.unicode=true;str.isbinary=!fref.textmode;str.ref=fref.ref;str.origfmode=fmode;if(!Dialog.streaming){str.streaming=false;str.buf=content;str.buflen=0xFFFFFFFF;if(fmode==Const.filemode_Write)
str.bufeof=0;else
str.bufeof=content.length;if(fmode==Const.filemode_WriteAppend)
str.bufpos=str.bufeof;else
str.bufpos=0;}
else{str.streaming=true;str.fstream=fstream;str.buffer4=new fstream.BufferClass(4);}
return str;}
function glk_stream_open_memory_uni(buf,fmode,rock){var str;if(fmode!=Const.filemode_Read&&fmode!=Const.filemode_Write&&fmode!=Const.filemode_ReadWrite)
throw('glk_stream_open_memory: illegal filemode');str=gli_new_stream(strtype_Memory,(fmode!=Const.filemode_Write),(fmode!=Const.filemode_Read),rock);str.unicode=true;if(buf){str.buf=buf;str.buflen=buf.length;str.bufpos=0;if(fmode==Const.filemode_Write)
str.bufeof=0;else
str.bufeof=str.buflen;if(window.GiDispa)
GiDispa.retain_array(buf);}
return str;}
function glk_request_char_event_uni(win){if(!win)
throw('glk_request_char_event: invalid window');if(win.char_request||win.line_request)
throw('glk_request_char_event: window already has keyboard request');if(win.type==Const.wintype_TextBuffer||win.type==Const.wintype_TextGrid){win.char_request=true;win.char_request_uni=true;win.input_generation=event_generation;}
else{throw('glk_request_char_event: window does not support keyboard input');}}
function glk_request_line_event_uni(win,buf,initlen){if(!win)
throw('glk_request_line_event: invalid window');if(win.char_request||win.line_request)
throw('glk_request_line_event: window already has keyboard request');if(win.type==Const.wintype_TextBuffer||win.type==Const.wintype_TextGrid){if(initlen){var ls=buf.slice(0,initlen);if(!current_partial_outputs)
current_partial_outputs={};current_partial_outputs[win.disprock]=UniArrayToString(ls);}
win.line_request=true;win.line_request_uni=true;if(win.type==Const.wintype_TextBuffer)
win.request_echo_line_input=win.echo_line_input;else
win.request_echo_line_input=true;win.input_generation=event_generation;win.linebuf=buf;if(window.GiDispa)
GiDispa.retain_array(buf);}
else{throw('glk_request_line_event: window does not support keyboard input');}}
function glk_current_time(timevalref){var now=new Date().getTime();var usec;timevalref.set_field(0,Math.floor(now/4294967296000));timevalref.set_field(1,Math.floor(now/1000)>>>0);usec=Math.floor((now%1000)*1000);if(usec<0)
usec=1000000+usec;timevalref.set_field(2,usec);}
function glk_current_simple_time(factor){var now=new Date().getTime();return Math.floor(now/(factor*1000));}
function glk_time_to_date_utc(timevalref,dateref){var now=timevalref.get_field(0)*4294967296000+timevalref.get_field(1)*1000+timevalref.get_field(2)/1000;var obj=new Date(now);dateref.set_field(0,obj.getUTCFullYear())
dateref.set_field(1,1+obj.getUTCMonth())
dateref.set_field(2,obj.getUTCDate())
dateref.set_field(3,obj.getUTCDay())
dateref.set_field(4,obj.getUTCHours())
dateref.set_field(5,obj.getUTCMinutes())
dateref.set_field(6,obj.getUTCSeconds())
dateref.set_field(7,1000*obj.getUTCMilliseconds())}
function glk_time_to_date_local(timevalref,dateref){var now=timevalref.get_field(0)*4294967296000+timevalref.get_field(1)*1000+timevalref.get_field(2)/1000;var obj=new Date(now);dateref.set_field(0,obj.getFullYear())
dateref.set_field(1,1+obj.getMonth())
dateref.set_field(2,obj.getDate())
dateref.set_field(3,obj.getDay())
dateref.set_field(4,obj.getHours())
dateref.set_field(5,obj.getMinutes())
dateref.set_field(6,obj.getSeconds())
dateref.set_field(7,1000*obj.getMilliseconds())}
function glk_simple_time_to_date_utc(time,factor,dateref){var now=time*(1000*factor);var obj=new Date(now);dateref.set_field(0,obj.getUTCFullYear())
dateref.set_field(1,1+obj.getUTCMonth())
dateref.set_field(2,obj.getUTCDate())
dateref.set_field(3,obj.getUTCDay())
dateref.set_field(4,obj.getUTCHours())
dateref.set_field(5,obj.getUTCMinutes())
dateref.set_field(6,obj.getUTCSeconds())
dateref.set_field(7,1000*obj.getUTCMilliseconds())}
function glk_simple_time_to_date_local(time,factor,dateref){var now=time*(1000*factor);var obj=new Date(now);dateref.set_field(0,obj.getFullYear())
dateref.set_field(1,1+obj.getMonth())
dateref.set_field(2,obj.getDate())
dateref.set_field(3,obj.getDay())
dateref.set_field(4,obj.getHours())
dateref.set_field(5,obj.getMinutes())
dateref.set_field(6,obj.getSeconds())
dateref.set_field(7,1000*obj.getMilliseconds())}
function glk_date_to_time_utc(dateref,timevalref){var obj=new Date(0);obj.setUTCFullYear(dateref.get_field(0));obj.setUTCMonth(dateref.get_field(1)-1);obj.setUTCDate(dateref.get_field(2));obj.setUTCHours(dateref.get_field(4));obj.setUTCMinutes(dateref.get_field(5));obj.setUTCSeconds(dateref.get_field(6));obj.setUTCMilliseconds(dateref.get_field(7)/1000);var now=obj.getTime();var usec;timevalref.set_field(0,Math.floor(now/4294967296000));timevalref.set_field(1,Math.floor(now/1000)>>>0);usec=Math.floor((now%1000)*1000);if(usec<0)
usec=1000000+usec;timevalref.set_field(2,usec);}
function glk_date_to_time_local(dateref,timevalref){var obj=new Date(dateref.get_field(0),dateref.get_field(1)-1,dateref.get_field(2),dateref.get_field(4),dateref.get_field(5),dateref.get_field(6),dateref.get_field(7)/1000);var now=obj.getTime();var usec;timevalref.set_field(0,Math.floor(now/4294967296000));timevalref.set_field(1,Math.floor(now/1000)>>>0);usec=Math.floor((now%1000)*1000);if(usec<0)
usec=1000000+usec;timevalref.set_field(2,usec);}
function glk_date_to_simple_time_utc(dateref,factor){var obj=new Date(0);obj.setUTCFullYear(dateref.get_field(0));obj.setUTCMonth(dateref.get_field(1)-1);obj.setUTCDate(dateref.get_field(2));obj.setUTCHours(dateref.get_field(4));obj.setUTCMinutes(dateref.get_field(5));obj.setUTCSeconds(dateref.get_field(6));obj.setUTCMilliseconds(dateref.get_field(7)/1000);var now=obj.getTime();return Math.floor(now/(factor*1000));}
function glk_date_to_simple_time_local(dateref,factor){var obj=new Date(dateref.get_field(0),dateref.get_field(1)-1,dateref.get_field(2),dateref.get_field(4),dateref.get_field(5),dateref.get_field(6),dateref.get_field(7)/1000);var now=obj.getTime();return Math.floor(now/(factor*1000));}
return{version:'2.2.3',init:init,update:update,save_allstate:save_allstate,restore_allstate:restore_allstate,fatal_error:fatal_error,byte_array_to_string:ByteArrayToString,uni_array_to_string:UniArrayToString,Const:Const,RefBox:RefBox,RefStruct:RefStruct,DidNotReturn:DidNotReturn,call_may_not_return:call_may_not_return,glk_put_jstring:glk_put_jstring,glk_put_jstring_stream:glk_put_jstring_stream,glk_exit:glk_exit,glk_tick:glk_tick,glk_gestalt:glk_gestalt,glk_gestalt_ext:glk_gestalt_ext,glk_window_iterate:glk_window_iterate,glk_window_get_rock:glk_window_get_rock,glk_window_get_root:glk_window_get_root,glk_window_open:glk_window_open,glk_window_close:glk_window_close,glk_window_get_size:glk_window_get_size,glk_window_set_arrangement:glk_window_set_arrangement,glk_window_get_arrangement:glk_window_get_arrangement,glk_window_get_type:glk_window_get_type,glk_window_get_parent:glk_window_get_parent,glk_window_clear:glk_window_clear,glk_window_move_cursor:glk_window_move_cursor,glk_window_get_stream:glk_window_get_stream,glk_window_set_echo_stream:glk_window_set_echo_stream,glk_window_get_echo_stream:glk_window_get_echo_stream,glk_set_window:glk_set_window,glk_window_get_sibling:glk_window_get_sibling,glk_stream_iterate:glk_stream_iterate,glk_stream_get_rock:glk_stream_get_rock,glk_stream_open_file:glk_stream_open_file,glk_stream_open_memory:glk_stream_open_memory,glk_stream_close:glk_stream_close,glk_stream_set_position:glk_stream_set_position,glk_stream_get_position:glk_stream_get_position,glk_stream_set_current:glk_stream_set_current,glk_stream_get_current:glk_stream_get_current,glk_fileref_create_temp:glk_fileref_create_temp,glk_fileref_create_by_name:glk_fileref_create_by_name,glk_fileref_create_by_prompt:glk_fileref_create_by_prompt,glk_fileref_destroy:glk_fileref_destroy,glk_fileref_iterate:glk_fileref_iterate,glk_fileref_get_rock:glk_fileref_get_rock,glk_fileref_delete_file:glk_fileref_delete_file,glk_fileref_does_file_exist:glk_fileref_does_file_exist,glk_fileref_create_from_fileref:glk_fileref_create_from_fileref,glk_put_char:glk_put_char,glk_put_char_stream:glk_put_char_stream,glk_put_string:glk_put_string,glk_put_string_stream:glk_put_string_stream,glk_put_buffer:glk_put_buffer,glk_put_buffer_stream:glk_put_buffer_stream,glk_set_style:glk_set_style,glk_set_style_stream:glk_set_style_stream,glk_get_char_stream:glk_get_char_stream,glk_get_line_stream:glk_get_line_stream,glk_get_buffer_stream:glk_get_buffer_stream,glk_char_to_lower:glk_char_to_lower,glk_char_to_upper:glk_char_to_upper,glk_stylehint_set:glk_stylehint_set,glk_stylehint_clear:glk_stylehint_clear,glk_style_distinguish:glk_style_distinguish,glk_style_measure:glk_style_measure,glk_select:glk_select,glk_select_poll:glk_select_poll,glk_request_line_event:glk_request_line_event,glk_cancel_line_event:glk_cancel_line_event,glk_request_char_event:glk_request_char_event,glk_cancel_char_event:glk_cancel_char_event,glk_request_mouse_event:glk_request_mouse_event,glk_cancel_mouse_event:glk_cancel_mouse_event,glk_request_timer_events:glk_request_timer_events,glk_image_get_info:glk_image_get_info,glk_image_draw:glk_image_draw,glk_image_draw_scaled:glk_image_draw_scaled,glk_window_flow_break:glk_window_flow_break,glk_window_erase_rect:glk_window_erase_rect,glk_window_fill_rect:glk_window_fill_rect,glk_window_set_background_color:glk_window_set_background_color,glk_schannel_iterate:glk_schannel_iterate,glk_schannel_get_rock:glk_schannel_get_rock,glk_schannel_create:glk_schannel_create,glk_schannel_destroy:glk_schannel_destroy,glk_schannel_play:glk_schannel_play,glk_schannel_play_ext:glk_schannel_play_ext,glk_schannel_stop:glk_schannel_stop,glk_schannel_set_volume:glk_schannel_set_volume,glk_schannel_create_ext:glk_schannel_create_ext,glk_schannel_play_multi:glk_schannel_play_multi,glk_schannel_pause:glk_schannel_pause,glk_schannel_unpause:glk_schannel_unpause,glk_schannel_set_volume_ext:glk_schannel_set_volume_ext,glk_sound_load_hint:glk_sound_load_hint,glk_set_hyperlink:glk_set_hyperlink,glk_set_hyperlink_stream:glk_set_hyperlink_stream,glk_request_hyperlink_event:glk_request_hyperlink_event,glk_cancel_hyperlink_event:glk_cancel_hyperlink_event,glk_buffer_to_lower_case_uni:glk_buffer_to_lower_case_uni,glk_buffer_to_upper_case_uni:glk_buffer_to_upper_case_uni,glk_buffer_to_title_case_uni:glk_buffer_to_title_case_uni,glk_buffer_canon_decompose_uni:glk_buffer_canon_decompose_uni,glk_buffer_canon_normalize_uni:glk_buffer_canon_normalize_uni,glk_put_char_uni:glk_put_char_uni,glk_put_string_uni:glk_put_string_uni,glk_put_buffer_uni:glk_put_buffer_uni,glk_put_char_stream_uni:glk_put_char_stream_uni,glk_put_string_stream_uni:glk_put_string_stream_uni,glk_put_buffer_stream_uni:glk_put_buffer_stream_uni,glk_get_char_stream_uni:glk_get_char_stream_uni,glk_get_buffer_stream_uni:glk_get_buffer_stream_uni,glk_get_line_stream_uni:glk_get_line_stream_uni,glk_stream_open_file_uni:glk_stream_open_file_uni,glk_stream_open_memory_uni:glk_stream_open_memory_uni,glk_request_char_event_uni:glk_request_char_event_uni,glk_request_line_event_uni:glk_request_line_event_uni,glk_set_echo_line_event:glk_set_echo_line_event,glk_set_terminators_line_event:glk_set_terminators_line_event,glk_current_time:glk_current_time,glk_current_simple_time:glk_current_simple_time,glk_time_to_date_utc:glk_time_to_date_utc,glk_time_to_date_local:glk_time_to_date_local,glk_simple_time_to_date_utc:glk_simple_time_to_date_utc,glk_simple_time_to_date_local:glk_simple_time_to_date_local,glk_date_to_time_utc:glk_date_to_time_utc,glk_date_to_time_local:glk_date_to_time_local,glk_date_to_simple_time_utc:glk_date_to_simple_time_utc,glk_date_to_simple_time_local:glk_date_to_simple_time_local,glk_stream_open_resource:glk_stream_open_resource,glk_stream_open_resource_uni:glk_stream_open_resource_uni};}();
</script>

<script type="text/javascript">
Quixe=function(){var self={};function quixe_prepare(image,all_options){game_image=image;var ls=game_image.slice(0,64);var ix,val;for(ix=0;ix<ls.length;ix++){val=ls[ix].toString(16);if(val.length<2)
val="0"+val;ls[ix]=val;}
game_signature=ls.join('');if(all_options){opt_rethrow_exceptions=all_options.rethrow_exceptions;opt_do_vm_autosave=all_options.do_vm_autosave;opt_clear_vm_autosave=all_options.clear_vm_autosave;}
if(all_options&&all_options.debug_info_chunk){parse_inform_debug_data();}}
function quixe_init(){if(self.vm_started){Glk.fatal_error("Quixe was inited twice!");return;}
try{setup_bytestring_table();setup_operandlist_table();setup_vm();execute_loop();}
catch(ex){if(ex.stack)
qlog('JS stack dump:\n'+ex.stack);qstackdump();Glk.fatal_error("Quixe init: "+show_exception(ex));if(opt_rethrow_exceptions)
throw ex;}}
function quixe_resume(){try{self.done_executing=self.vm_stopped;execute_loop();}
catch(ex){if(ex.stack)
qlog('JS stack dump:\n'+ex.stack);qstackdump();Glk.fatal_error("Quixe run: "+show_exception(ex));if(opt_rethrow_exceptions)
throw ex;}}
function show_exception(ex){if(typeof(ex)=='string')
return ex;var res=ex.toString();if(ex.message)
res=res+' '+ex.message;if(ex.fileName)
res=res+' '+ex.fileName;if(ex.lineNumber)
res=res+' line:'+ex.lineNumber;if(ex.name)
res=res+' '+ex.name;if(ex.number)
res=res+' '+ex.number;return res;}
function qlog(msg){if(window.console&&console.log)
console.log(msg);else if(window.opera&&opera.postError)
opera.postError(msg);}
function qobjdump(obj,depth){var key,proplist;if(jQuery.type(obj)==='array'){if(depth)
depth--;var ls=jQuery.map(obj,function(v,ix){return qobjdump(v,depth);});return("["+ls.join(",")+"]");}
if(!(jQuery.type(obj)==='object'))
return(""+obj);proplist=[];for(key in obj){var val=obj[key];if(depth&&jQuery.type(val)==='object')
val=qobjdump(val,depth-1);proplist.push(key+":"+val);}
return"{ "+proplist.join(", ")+" }";}
function qstackdump(){if(!stack||!stack.length)
return;var ix,val,debugfunc;var frm;var ls=[];for(ix=0;ix<stack.length;ix++){frm=stack[ix];if(!frm.vmfunc.funcaddr){ls.push("(anonymous)");continue;}
val="0x"+frm.vmfunc.funcaddr.toString(16);debugfunc=debuginfo.functionmap[frm.vmfunc.funcaddr];if(debugfunc)
val=val+(" \""+debugfunc.name+"\"");ls.push(val);}
qlog("VM stack dump: "+ls.join(", "));}
if(Math.imul===undefined){qlog("Polyfilling Math.imul().");Math.imul=function(a,b){var ah=(a>>>16)&0xffff;var al=a&0xffff;var bh=(b>>>16)&0xffff;var bl=b&0xffff;return((al*bl)+(((ah*bl+al*bh)<<16)>>>0)|0);};}
var bytestring_table=Array(256);var quotechar_table=Array(256);function setup_bytestring_table(){var ix,val;for(ix=0;ix<0x100;ix++){val=ix.toString(16);if(ix<0x10)
val="0"+val;bytestring_table[ix]=val;}
for(ix=0;ix<0x100;ix++){if(ix>=0x20&&ix<0x7f){if(ix==0x22||ix==0x27||ix==0x5c)
val="\\"+String.fromCharCode(ix);else
val=String.fromCharCode(ix);}
else if(ix==0x0a){val="\\n";}
else{val="\\x"+bytestring_table[ix];}
quotechar_table[ix]=val;}}
function ByteRead4(arr,addr){return(arr[addr]*0x1000000)+(arr[addr+1]*0x10000)
+(arr[addr+2]*0x100)+(arr[addr+3]);}
function ByteRead2(arr,addr){return(arr[addr]*0x100)+(arr[addr+1]);}
function ByteRead1(arr,addr){return arr[addr];}
function Mem1(addr){return memmap[addr];}
function Mem2(addr){return(memmap[addr]*0x100)+(memmap[addr+1]);}
function Mem4(addr){return(memmap[addr]*0x1000000)+(memmap[addr+1]*0x10000)
+(memmap[addr+2]*0x100)+(memmap[addr+3]);}
function MemSlice(addr,length){return memmap.slice(addr,addr+length);}
function MemW1(addr,val){memmap[addr]=val&0xFF;}
function MemW2(addr,val){memmap[addr]=(val>>8)&0xFF;memmap[addr+1]=val&0xFF;}
function MemW4(addr,val){memmap[addr]=(val>>24)&0xFF;memmap[addr+1]=(val>>16)&0xFF;memmap[addr+2]=(val>>8)&0xFF;memmap[addr+3]=val&0xFF;}
self.Mem1=Mem1;self.Mem2=Mem2;self.Mem4=Mem4;self.MemSlice=MemSlice;self.MemW1=MemW1;self.MemW2=MemW2;self.MemW4=MemW4;function BytePushString(arr,str){for(var ix=0;ix<str.length;ix++){arr.push(str.charCodeAt(ix));}}
function BytePush4(arr,val){arr.push((val>>24)&0xFF);arr.push((val>>16)&0xFF);arr.push((val>>8)&0xFF);arr.push(val&0xFF);}
function BytePush2(arr,val){arr.push((val>>8)&0xFF);arr.push(val&0xFF);}
function BytePush1(arr,val){arr.push(val&0xFF);}
function ByteWrite4(arr,addr,val){arr[addr]=(val>>24)&0xFF;arr[addr+1]=(val>>16)&0xFF;arr[addr+2]=(val>>8)&0xFF;arr[addr+3]=val&0xFF;}
function ByteReadString(arr,addr,len){return String.fromCharCode.apply(this,arr.slice(addr,addr+len));}
function QuoteMem1(addr){if(memmap[addr]>=0x80)
return"0xffffff"+bytestring_table[memmap[addr]];return"0x"+bytestring_table[memmap[addr]];}
function QuoteMem2(addr){if(memmap[addr]>=0x80)
return"0xffff"+bytestring_table[memmap[addr]]+bytestring_table[memmap[addr+1]];if(memmap[addr])
return"0x"+bytestring_table[memmap[addr]]+bytestring_table[memmap[addr+1]];return"0x"+bytestring_table[memmap[addr+1]];}
function QuoteMem4(addr){if(memmap[addr])
return"0x"+bytestring_table[memmap[addr]]+bytestring_table[memmap[addr+1]]+bytestring_table[memmap[addr+2]]+bytestring_table[memmap[addr+3]];if(memmap[addr+1])
return"0x"+bytestring_table[memmap[addr+1]]+bytestring_table[memmap[addr+2]]+bytestring_table[memmap[addr+3]];if(memmap[addr+2])
return"0x"+bytestring_table[memmap[addr+2]]+bytestring_table[memmap[addr+3]];return"0x"+bytestring_table[memmap[addr+3]];}
function ReadArgByte(addr){if(addr==0xffffffff)
return self.frame.valstack.pop()&0xFF;else
return Mem1(addr);}
function WriteArgByte(addr,val){if(addr==0xffffffff)
self.frame.valstack.push(val&0xFF);else
MemW1(addr,val);}
function ReadArgWord(addr){if(addr==0xffffffff)
return self.frame.valstack.pop();else
return Mem4(addr);}
function WriteArgWord(addr,val){if(addr==0xffffffff)
self.frame.valstack.push(val);else
MemW4(addr,val);}
function ReadStructField(addr,fieldnum){if(addr==0xffffffff)
return self.frame.valstack.pop();else
return Mem4(addr+4*fieldnum);}
function WriteStructField(addr,fieldnum,val){if(addr==0xffffffff)
self.frame.valstack.push(val);else
MemW4(addr+4*fieldnum,val);}
function SetResumeStore(val){self.resumevalue=val;}
function CharToString(val){if(val<0x10000){return String.fromCharCode(val);}
else{val-=0x10000;return String.fromCharCode(0xD800+(val>>10),0xDC00+(val&0x3FF));}}
function QuoteCharToString(val){if(val<0x100){return quotechar_table[val];}
else if(val<0x10000){val=val.toString(16);while(val.length<4)
val="0"+val;return("\\u"+val);}
else{var val2;val-=0x10000;val2=0xD800+(val>>10);val=0xDC00+(val&0x3FF);return("\\u"+val2.toString(16)+"\\u"+val.toString(16));}}
function QuoteStr1ToString(val){return QuoteCharToString(val.charCodeAt(0));}
var regexp_string_unsafe=/[^a-zA-Z0-9 .,;:?!=_+()-]/g;function QuoteEscapeString(val){val=val.replace(regexp_string_unsafe,QuoteStr1ToString);return'"'+val+'"';}
function fatal_error(msg){var ix,val;if(arguments.length>1){msg+=" (";for(ix=1;ix<arguments.length;ix++){val=arguments[ix];if(typeof(val)=='number'){val=val.toString(16);}
else{val=""+val;}
if(ix!=1)
msg+=" ";msg+=val;}
msg+=")";}
qlog(msg);throw(new Error(msg));}
self.fatal_error=fatal_error;function make_code(val,funcname,arg1,arg2){var func;if(funcname===undefined)
funcname='_func';if(arg1===undefined)
func=new Function('self',val);else if(arg2===undefined)
func=new Function('self',arg1,val);else
func=new Function('self',arg1,arg2,val);return func;}
function VMFunc(funcaddr,startpc,localsformat,rawformat){if(!funcaddr){this.funcaddr=null;this.startpc=null;this.functype=null;}
else{this.funcaddr=funcaddr;this.startpc=startpc;this.functype=Mem1(funcaddr);}
this.pathaddrs={};this[0]={};this[1]={};this[2]={};this.locallen=null;this.localsformat=localsformat;this.rawformat=rawformat;this.localsindex=[];var ix,jx;var locallen=0;for(ix=0;ix<this.localsformat.length;ix++){var form=this.localsformat[ix];if(form.size==4){while(locallen&3)
locallen++;}
else if(form.size==2){while(locallen&1)
locallen++;}
for(jx=0;jx<form.count;jx++){this.localsindex.push({size:form.size,pos:locallen});locallen+=form.size;}}
while(locallen&3)
locallen++;this.locallen=locallen;}
function StackFrame(vmfunc){var ix;this.vmfunc=vmfunc;this.depth=null;this.framestart=null;this.framelen=null;this.valstack=[];this.localspos=null;this.localsindex=vmfunc.localsindex;this.locals=[];for(ix=0;ix<this.localsindex.length;ix++){var form=this.localsindex[ix];this.locals[form.pos]=0;}
this.framelen=8+vmfunc.rawformat.length+vmfunc.locallen;}
function clone_stackframe(frame){var other=new StackFrame(frame.vmfunc);other.depth=frame.depth;other.framestart=frame.framestart;other.framelen=frame.framelen;other.valstack=frame.valstack.slice(0);other.localspos=frame.localspos;other.locals=frame.locals.slice(0);other.framelen=frame.framelen;return other;}
function push_serialized_stackframe(frame,arr){BytePush4(arr,frame.framelen);var rawformat=frame.vmfunc.rawformat;BytePush4(arr,8+rawformat.length);for(var i=0;i<rawformat.length;i++){arr.push(rawformat[i]);}
for(var i=0;i<frame.vmfunc.localsindex.length;i++){var form=frame.vmfunc.localsindex[i];if(form.size==4){while(arr.length&3)
arr.push(0);BytePush4(arr,frame.locals[form.pos]);}
else if(form.size==2){while(arr.length&1)
arr.push(0);BytePush2(arr,frame.locals[form.pos]);}
else{BytePush1(arr,frame.locals[form.pos]);}}
while(arr.length&3)
arr.push(0);for(var i=0;i<frame.valstack.length;i++){BytePush4(arr,frame.valstack[i]);}}
function pop_deserialized_stackframe(arr){var frameptr=ByteRead4(arr,arr.length-4);if(frameptr<0||frameptr>=arr.length){qlog("Bad frameptr in serialized stack frame");return undefined;}
arr=arr.splice(frameptr,arr.length);var framelen=ByteRead4(arr,0);var localspos=ByteRead4(arr,4);var rawformat=arr.slice(8,localspos);var localsformat=[];var addr=8;while(1){var loctype=ByteRead1(arr,addr);addr++;var locnum=ByteRead1(arr,addr);addr++;if(loctype==0){break;}
if(loctype!=1&&loctype!=2&&loctype!=4){fatal_error("Invalid local variable size in function header.",loctype);}
localsformat.push({size:loctype,count:locnum});}
var vmfunc=new VMFunc(null,null,localsformat,rawformat);var frame=new StackFrame(vmfunc);frame.framestart=frameptr;for(var i=0;i<frame.vmfunc.localsindex.length;i++){var form=frame.vmfunc.localsindex[i];if(form.size==4){frame.locals[form.pos]=ByteRead4(arr,localspos+form.pos);}
else if(form.size==2){frame.locals[form.pos]=ByteRead2(arr,localspos+form.pos);}
else{frame.locals[form.pos]=ByteRead1(arr,localspos+form.pos);}}
for(var pos=framelen;pos<arr.length;pos+=4){frame.valstack.push(ByteRead4(arr,pos));}
return frame;}
function VMTextEnv(addr,dectab){if(addr==0)
fatal_error("Tried to create a VMTextEnv for address zero.");this.addr=addr;this.cacheable=(dectab!==undefined);this.decoding_tree=dectab;this.vmstring_tables=[];if(this.cacheable){this.vmstring_tables[0]={};this.vmstring_tables[1]={};this.vmstring_tables[2]={};}}
var operandlist_table=null;function setup_operandlist_table(){function OperandList(formlist,argsize){this.argsize=(argsize?argsize:4);this.numops=formlist.length;var ls=[];for(var ix=0;ix<formlist.length;ix++)
ls.push(formlist.charAt(ix));this.formlist=ls;}
var list_none=new OperandList("");var list_L=new OperandList("L");var list_LL=new OperandList("LL");var list_LLL=new OperandList("LLL");var list_LLLL=new OperandList("LLLL");var list_LS=new OperandList("LS");var list_LLS=new OperandList("LLS");var list_LLLLLLS=new OperandList("LLLLLLS");var list_LLLLLLLS=new OperandList("LLLLLLLS");var list_LLSS=new OperandList("LLSS");var list_LC=new OperandList("LC");var list_LLC=new OperandList("LLC");var list_LLLC=new OperandList("LLLC");var list_LLLLC=new OperandList("LLLLC");var list_ES=new OperandList("ES");var list_LES=new OperandList("LES");var list_EES=new OperandList("EES");var list_F=new OperandList("F");var list_LF=new OperandList("LF");var list_LLF=new OperandList("LLF");var list_EF=new OperandList("EF");var list_1EF=new OperandList("EF",1);var list_2EF=new OperandList("EF",2);var list_S=new OperandList("S");var list_SS=new OperandList("SS");var list_CL=new OperandList("CL");var list_C=new OperandList("C");operandlist_table={0x00:list_none,0x10:list_EES,0x11:list_LES,0x12:list_LLS,0x13:list_LLS,0x14:list_LLS,0x15:list_ES,0x18:list_EES,0x19:list_EES,0x1A:list_EES,0x1B:list_ES,0x1C:list_LLS,0x1D:list_LLS,0x1E:list_LLS,0x20:list_L,0x22:list_LL,0x23:list_LL,0x24:list_LLL,0x25:list_LLL,0x26:list_LLL,0x27:list_LLL,0x28:list_LLL,0x29:list_LLL,0x2A:list_LLL,0x2B:list_LLL,0x2C:list_LLL,0x2D:list_LLL,0x30:list_LLC,0x31:list_L,0x32:list_CL,0x33:list_LL,0x34:list_LL,0x40:list_EF,0x41:list_2EF,0x42:list_1EF,0x44:list_LS,0x45:list_LS,0x48:list_LLS,0x49:list_LLS,0x4A:list_LLS,0x4B:list_LLS,0x4C:list_LLL,0x4D:list_LLL,0x4E:list_LLL,0x4F:list_LLL,0x50:list_F,0x51:list_LF,0x52:list_none,0x53:list_LL,0x54:list_L,0x70:list_L,0x71:list_L,0x72:list_L,0x73:list_L,0x100:list_LLS,0x101:list_L,0x102:list_S,0x103:list_LS,0x104:list_L,0x110:list_LS,0x111:list_L,0x120:list_none,0x121:list_S,0x122:list_none,0x123:list_LC,0x124:list_LF,0x125:list_C,0x126:list_F,0x127:list_LL,0x130:list_LLF,0x140:list_S,0x141:list_L,0x148:list_SS,0x149:list_LL,0x150:list_LLLLLLLS,0x151:list_LLLLLLLS,0x152:list_LLLLLLS,0x160:list_LC,0x161:list_LLC,0x162:list_LLLC,0x163:list_LLLLC,0x170:list_LL,0x171:list_LLL,0x178:list_LS,0x179:list_L,0x180:list_LL,0x181:list_LL,0x190:list_LS,0x191:list_LS,0x192:list_LS,0x198:list_LS,0x199:list_LS,0x1A0:list_LLS,0x1A1:list_LLS,0x1A2:list_LLS,0x1A3:list_LLS,0x1A4:list_LLSS,0x1A8:list_LS,0x1A9:list_LS,0x1AA:list_LS,0x1AB:list_LLS,0x1B0:list_LS,0x1B1:list_LS,0x1B2:list_LS,0x1B3:list_LS,0x1B4:list_LS,0x1B5:list_LS,0x1B6:list_LLS,0x1C0:list_LLLL,0x1C1:list_LLLL,0x1C2:list_LLL,0x1C3:list_LLL,0x1C4:list_LLL,0x1C5:list_LLL,0x1C8:list_LL,0x1C9:list_LL}}
self.funcop_cache={};function oputil_record_funcop(funcop){if(funcop.mode==0){return"null";}
var key="m"+funcop.mode;if(funcop.argsize!=null)
key=key+"s"+funcop.argsize;if(funcop.addr!=null)
key=key+"a"+funcop.addr;if(self.funcop_cache.key)
return"self.funcop_cache."+key;var obj={key:key,mode:funcop.mode,argsize:funcop.argsize,addr:funcop.addr};self.funcop_cache[key]=obj;return"self.funcop_cache."+key;}
function oputil_store(context,funcop,operand){switch(funcop.mode){case 8:if(funcop.argsize==4){var opchar=operand[0];if(opchar==="0"){context.offstack.push(operand);return;}
if(opchar==="_"){push_offstack_holdvar(context,operand);return;}}
holdvar=alloc_holdvar(context,true);context.offstack.push(holdvar);if(funcop.argsize==4){context.code.push(holdvar+"=("+operand+");");}
else if(funcop.argsize==2){context.code.push(holdvar+"=0xffff&("+operand+");");}
else{context.code.push(holdvar+"=0xff&("+operand+");");}
return;case 0:context.code.push("("+operand+");");return;case 11:if(funcop.argsize==4){var opchar=operand[0];if(opchar==="0"){store_offloc_value(context,funcop.addr,operand,false);return;}
if(opchar==="_"){store_offloc_value(context,funcop.addr,operand,true);return;}}
store_offloc_value(context,funcop.addr,undefined);if(funcop.argsize==4){context.code.push("self.frame.locals["+funcop.addr+"]=("+operand+");");}
else if(funcop.argsize==2){context.code.push("self.frame.locals["+funcop.addr+"]=(0xffff &"+operand+");");}
else{context.code.push("self.frame.locals["+funcop.addr+"]=(0xff &"+operand+");");}
return;case 15:if(funcop.argsize==4){context.code.push("self.MemW4("+funcop.addr+","+operand+");");}
else if(funcop.argsize==2){context.code.push("self.MemW2("+funcop.addr+","+operand+");");}
else{context.code.push("self.MemW1("+funcop.addr+","+operand+");");}
return;default:fatal_error("Unknown addressing mode in store func operand.");}}
function oputil_push_callstub(context,operand,addr){if(addr===undefined)
addr=context.cp;context.code.push("self.frame.valstack.push("+operand+","+addr+",self.frame.framestart);");}
function oputil_push_substring_callstub(context){context.code.push("if (!substring) { substring=true;");context.code.push("self.frame.valstack.push(0x11,0,nextcp,self.frame.framestart);");context.code.push("}");}
function oputil_unload_offstate(context,keepstack){var ix;if(context.offstack.length){context.code.push("self.frame.valstack.push("+context.offstack.join(",")+");");}
if(context.offloc.length){for(ix=0;ix<context.offloc.length;ix++){if(context.offloc[ix]!==undefined&&context.offlocdirty[ix]){context.code.push("self.frame.locals["+ix+"]="+context.offloc[ix]+";");}}}
if(!keepstack){var holdvar;for(ix=0;ix<context.offloc.length;ix++){holdvar=context.offloc[ix];if(holdvar!==undefined){if(context.holduse[holdvar]!==undefined)
context.holduse[holdvar]=false;}}
context.offloc.length=0;context.offlocdirty.length=0;while(context.offstack.length){holdvar=context.offstack.pop();if(context.holduse[holdvar]!==undefined)
context.holduse[holdvar]=false;}}}
function oputil_flush_string(context){if(context.buffer.length==0)
return;var str=context.buffer.join("");context.buffer.length=0;context.code.push("Glk.glk_put_jstring("+QuoteEscapeString(str)+");");}
function oputil_signify_operand(context,operand,hold){var val;if(quot_isconstant(operand)){val=Number(operand);if(val&0x80000000)
return""+(val-0x100000000);else
return operand;}
val="("+operand+"&0xffffffff)";if(hold){var holdvar=alloc_holdvar(context);context.code.push(holdvar+"="+val+";");return holdvar;}
else{return val;}}
function oputil_decode_float(context,operand,hold){var val;if(quot_isconstant(operand)){val=Number(operand);if(val==0x80000000)
return"-0";return""+decode_float(val);}
val="self.decode_float("+operand+")";if(hold){var holdvar=alloc_holdvar(context);context.code.push(holdvar+"="+val+";");return holdvar;}
else{return val;}}
function oputil_perform_jump(context,operand,unconditional){if(quot_isconstant(operand)){var val=Number(operand);if(val==0||val==1){if(unconditional){context.offstack.length=0;context.offloc.length=0;context.offlocdirty.length=0;}
else{}
context.code.push("if (self.leave_function()) return self.VMStopped;");context.code.push("self.pop_callstub("+val+");");}
else{oputil_unload_offstate(context,!unconditional);var newpc=(context.cp+val-2)>>>0;context.code.push("self.pc = "+newpc+";");context.vmfunc.pathaddrs[newpc]=true;}}
else{oputil_unload_offstate(context,!unconditional);context.code.push("if (("+operand+")==0 || ("+operand+")==1) {");context.code.push("if (self.leave_function()) return self.VMStopped;");context.code.push("self.pop_callstub("+operand+");");context.code.push("}");context.code.push("else {");context.code.push("self.pc = ("+context.cp+"+("+operand+")-2) >>>0;");context.code.push("}");}
context.code.push("return;");}
var opcode_table={0x0:function(context,operands){},0x10:function(context,operands){context.code.push(operands[2]+"(("+operands[0]+")+("+operands[1]+")) >>>0);");},0x11:function(context,operands){context.code.push(operands[2]+"(("+operands[0]+")-("+operands[1]+")) >>>0);");},0x12:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);var sign1=oputil_signify_operand(context,operands[1]);context.code.push(operands[2]+"(Math.imul(("+sign0+"),("+sign1+"))) >>>0);");},0x13:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);var sign1=oputil_signify_operand(context,operands[1]);var holdvar=alloc_holdvar(context);context.code.push(holdvar+"=(("+sign0+")/("+sign1+"));");context.code.push("if (!isFinite("+holdvar+")) self.fatal_error('Division by zero.');");context.code.push(operands[2]+"("+holdvar+">=0)?Math.floor("+holdvar+"):(-Math.floor(-"+holdvar+") >>>0));");},0x14:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);var sign1=oputil_signify_operand(context,operands[1]);var holdvar=alloc_holdvar(context);context.code.push(holdvar+"=(("+sign0+")%("+sign1+"));");context.code.push("if (!isFinite("+holdvar+")) self.fatal_error('Modulo division by zero.');");context.code.push(operands[2]+holdvar+" >>>0);");},0x15:function(context,operands){context.code.push(operands[1]+"(-("+operands[0]+")) >>>0);");},0x18:function(context,operands){context.code.push(operands[2]+"(("+operands[0]+")&("+operands[1]+")) >>>0);");},0x19:function(context,operands){context.code.push(operands[2]+"(("+operands[0]+")|("+operands[1]+")) >>>0);");},0x1a:function(context,operands){context.code.push(operands[2]+"(("+operands[0]+")^("+operands[1]+")) >>>0);");},0x1b:function(context,operands){context.code.push(operands[1]+"(~("+operands[0]+")) >>>0);");},0x1c:function(context,operands){if(quot_isconstant(operands[1])){var val=Number(operands[1]);if(val<32)
context.code.push(operands[2]+"(("+operands[0]+")<<"+val+") >>>0);");else
context.code.push(operands[2]+"0);");}
else{context.code.push(operands[2]+"("+operands[1]+"<32) ? (("+operands[0]+"<<"+operands[1]+") >>>0) : 0);");}},0x1d:function(context,operands){if(quot_isconstant(operands[1])){var val=Number(operands[1]);if(val<32)
context.code.push(operands[2]+"(("+operands[0]+")>>"+val+") >>>0);");else
context.code.push(operands[2]+"(("+operands[0]+")&0x80000000) ? 0xffffffff : 0);");}
else{context.code.push("if ("+operands[0]+" & 0x80000000) {");context.code.push(operands[2]+"("+operands[1]+"<32) ? (("+operands[0]+">>"+operands[1]+") >>>0) : 0xffffffff);");context.code.push("} else {");context.code.push(operands[2]+"("+operands[1]+"<32) ? (("+operands[0]+">>"+operands[1]+") >>>0) : 0);");context.code.push("}");}},0x1e:function(context,operands){if(quot_isconstant(operands[1])){var val=Number(operands[1]);if(val<32)
context.code.push(operands[2]+"("+operands[0]+")>>>"+val+");");else
context.code.push(operands[2]+"0);");}
else{context.code.push(operands[2]+"("+operands[1]+"<32) ? ("+operands[0]+">>>"+operands[1]+") : 0);");}},0x20:function(context,operands){oputil_perform_jump(context,operands[0],true);context.path_ends=true;},0x104:function(context,operands){if(quot_isconstant(operands[0])){var newpc=Number(operands[0]);context.code.push("self.pc = "+newpc+";");context.vmfunc.pathaddrs[newpc]=true;}
else{context.code.push("self.pc = "+operands[0]+";");}
oputil_unload_offstate(context);context.code.push("return;");context.path_ends=true;},0x22:function(context,operands){context.code.push("if (("+operands[0]+")==0) {");oputil_perform_jump(context,operands[1]);context.code.push("}");},0x23:function(context,operands){context.code.push("if (("+operands[0]+")!=0) {");oputil_perform_jump(context,operands[1]);context.code.push("}");},0x24:function(context,operands){context.code.push("if (("+operands[0]+")==("+operands[1]+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x25:function(context,operands){context.code.push("if (("+operands[0]+")!=("+operands[1]+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x26:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);var sign1=oputil_signify_operand(context,operands[1]);context.code.push("if (("+sign0+")<("+sign1+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x27:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);var sign1=oputil_signify_operand(context,operands[1]);context.code.push("if (("+sign0+")>=("+sign1+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x28:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);var sign1=oputil_signify_operand(context,operands[1]);context.code.push("if (("+sign0+")>("+sign1+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x29:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);var sign1=oputil_signify_operand(context,operands[1]);context.code.push("if (("+sign0+")<=("+sign1+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x2a:function(context,operands){context.code.push("if (("+operands[0]+")<("+operands[1]+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x2b:function(context,operands){context.code.push("if (("+operands[0]+")>=("+operands[1]+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x2c:function(context,operands){context.code.push("if (("+operands[0]+")>("+operands[1]+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x2d:function(context,operands){context.code.push("if (("+operands[0]+")<=("+operands[1]+")) {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x30:function(context,operands){if(quot_isconstant(operands[1])){var ix;var argc=Number(operands[1]);for(ix=0;ix<argc;ix++){if(context.offstack.length){var holdvar=pop_offstack_holdvar(context);context.code.push("self.tempcallargs["+ix+"]="+holdvar+";");}
else{context.code.push("self.tempcallargs["+ix+"]=self.frame.valstack.pop();");}}
oputil_unload_offstate(context);}
else{context.varsused["ix"]=true;oputil_unload_offstate(context);context.code.push("for (ix=0; ix<"+operands[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");}
oputil_push_callstub(context,operands[2]);context.code.push("self.enter_function("+operands[0]+", "+operands[1]+");");context.code.push("return;");context.path_ends=true;},0x34:function(context,operands){if(quot_isconstant(operands[1])){var ix;var argc=Number(operands[1]);for(ix=0;ix<argc;ix++){if(context.offstack.length){var holdvar=pop_offstack_holdvar(context);context.code.push("self.tempcallargs["+ix+"]="+holdvar+";");}
else{context.code.push("self.tempcallargs["+ix+"]=self.frame.valstack.pop();");}}
oputil_unload_offstate(context);}
else{context.varsused["ix"]=true;oputil_unload_offstate(context);context.code.push("for (ix=0; ix<"+operands[1]+"; ix++) { self.tempcallargs[ix]=self.frame.valstack.pop(); }");}
context.code.push("if (self.leave_function()) return self.VMStopped;");context.code.push("self.enter_function("+operands[0]+", "+operands[1]+");");context.code.push("return;");context.path_ends=true;},0x160:function(context,operands){oputil_unload_offstate(context);oputil_push_callstub(context,operands[1]);context.code.push("self.enter_function("+operands[0]+", 0);");context.code.push("return;");context.path_ends=true;},0x161:function(context,operands){oputil_unload_offstate(context);context.code.push("self.tempcallargs[0]=("+operands[1]+");");oputil_push_callstub(context,operands[2]);context.code.push("self.enter_function("+operands[0]+", 1);");context.code.push("return;");context.path_ends=true;},0x162:function(context,operands){oputil_unload_offstate(context);context.code.push("self.tempcallargs[0]=("+operands[1]+");");context.code.push("self.tempcallargs[1]=("+operands[2]+");");oputil_push_callstub(context,operands[3]);context.code.push("self.enter_function("+operands[0]+", 2);");context.code.push("return;");context.path_ends=true;},0x163:function(context,operands){oputil_unload_offstate(context);context.code.push("self.tempcallargs[0]=("+operands[1]+");");context.code.push("self.tempcallargs[1]=("+operands[2]+");");context.code.push("self.tempcallargs[2]=("+operands[3]+");");oputil_push_callstub(context,operands[4]);context.code.push("self.enter_function("+operands[0]+", 3);");context.code.push("return;");context.path_ends=true;},0x31:function(context,operands){context.offstack.length=0;context.offloc.length=0;context.offlocdirty.length=0;context.code.push("if (self.leave_function()) return self.VMStopped;");context.code.push("self.pop_callstub("+operands[0]+");");context.code.push("return;");context.path_ends=true;},0x32:function(context,operands){oputil_unload_offstate(context);oputil_push_callstub(context,operands[0]);context.code.push("self.store_operand("+operands[0]+",self.frame.framestart+self.frame.framelen+4*self.frame.valstack.length);");oputil_perform_jump(context,operands[1],true);context.path_ends=true;},0x33:function(context,operands){context.offstack.length=0;context.offloc.length=0;context.offlocdirty.length=0;context.code.push("self.pop_stack_to("+operands[1]+");");context.code.push("self.pop_callstub("+operands[0]+");");context.code.push("return;");context.path_ends=true;},0x40:function(context,operands){oputil_store(context,operands[1],operands[0]);},0x41:function(context,operands){oputil_store(context,operands[1],operands[0]);},0x42:function(context,operands){oputil_store(context,operands[1],operands[0]);},0x44:function(context,operands){var val;if(quot_isconstant(operands[0])){val=Number(operands[0]);val=(val&0x8000)?((val|0xffff0000)>>>0):(val&0xffff);context.code.push(operands[1]+val+");");}
else{context.code.push(operands[1]+"("+operands[0]+" & 0x8000) ? (("+operands[0]+" | 0xffff0000) >>> 0) : ("+operands[0]+" & 0xffff));");}},0x45:function(context,operands){var val;if(quot_isconstant(operands[0])){val=Number(operands[0]);val=(val&0x80)?((val|0xffffff00)>>>0):(val&0xff);context.code.push(operands[1]+val+");");}
else{context.code.push(operands[1]+"("+operands[0]+" & 0x80) ? (("+operands[0]+" | 0xffffff00) >>> 0) : ("+operands[0]+" & 0xff));");}},0x48:function(context,operands){var val,addr;if(quot_isconstant(operands[1])){if(quot_isconstant(operands[0])){addr=Number(operands[0])+Number(operands[1])*4;val="self.Mem4("+(addr>>>0)+")";}
else{var addr=Number(operands[1])*4;if(addr)
val="self.Mem4(("+operands[0]+"+"+addr+") >>>0)";else
val="self.Mem4("+operands[0]+")";}}
else{val="self.Mem4(("+operands[0]+"+4*"+operands[1]+") >>>0)";}
context.code.push(operands[2]+val+");");},0x49:function(context,operands){var val,addr;if(quot_isconstant(operands[1])){if(quot_isconstant(operands[0])){addr=Number(operands[0])+Number(operands[1])*2;val="self.Mem2("+(addr>>>0)+")";}
else{var addr=Number(operands[1])*2;if(addr)
val="self.Mem2(("+operands[0]+"+"+addr+") >>>0)";else
val="self.Mem2("+operands[0]+")";}}
else{val="self.Mem2(("+operands[0]+"+2*"+operands[1]+") >>>0)";}
context.code.push(operands[2]+val+");");},0x4a:function(context,operands){var val,addr;if(quot_isconstant(operands[1])){if(quot_isconstant(operands[0])){addr=Number(operands[0])+Number(operands[1]);val="self.Mem1("+(addr>>>0)+")";}
else{var addr=Number(operands[1]);if(addr)
val="self.Mem1(("+operands[0]+"+"+addr+") >>>0)";else
val="self.Mem1("+operands[0]+")";}}
else{val="self.Mem1(("+operands[0]+"+"+operands[1]+") >>>0)";}
context.code.push(operands[2]+val+");");},0x4c:function(context,operands){var val,addr;if(quot_isconstant(operands[1])){if(quot_isconstant(operands[0])){addr=Number(operands[0])+Number(operands[1])*4;val=(addr>>>0)+",";}
else{var addr=Number(operands[1])*4;if(addr)
val="("+operands[0]+"+"+addr+") >>>0"+",";else
val=operands[0]+",";}}
else{val="("+operands[0]+"+4*"+operands[1]+") >>>0"+",";}
context.code.push("self.MemW4("+val+operands[2]+")"+";");},0x4d:function(context,operands){var val,addr;if(quot_isconstant(operands[1])){if(quot_isconstant(operands[0])){addr=Number(operands[0])+Number(operands[1])*2;val=(addr>>>0)+",";}
else{var addr=Number(operands[1])*2;if(addr)
val="("+operands[0]+"+"+addr+") >>>0"+",";else
val=operands[0]+",";}}
else{val="("+operands[0]+"+2*"+operands[1]+") >>>0"+",";}
context.code.push("self.MemW2("+val+operands[2]+")"+";");},0x4e:function(context,operands){var val,addr;if(quot_isconstant(operands[1])){if(quot_isconstant(operands[0])){addr=Number(operands[0])+Number(operands[1]);val=(addr>>>0)+",";}
else{var addr=Number(operands[1]);if(addr)
val="("+operands[0]+"+"+addr+") >>>0"+",";else
val=operands[0]+",";}}
else{val="("+operands[0]+"+"+operands[1]+") >>>0"+",";}
context.code.push("self.MemW1("+val+operands[2]+")"+";");},0x4b:function(context,operands){if(quot_isconstant(operands[1])){var bitx,addrx,bitnum;bitnum=Number(operands[1])&0xffffffff;bitx=bitnum&7;if(quot_isconstant(operands[0])){addrx=Number(operands[0]);if(bitnum>=0)
addrx+=(bitnum>>3);else
addrx-=(1+((-1-bitnum)>>3));}
else{if(bitnum>=0){if(bitnum<=7)
addrx=operands[0];else
addrx=(operands[0]+"+"+(bitnum>>3));}
else{addrx=(operands[0]+"-"+(1+((-1-bitnum)>>3)));}}
context.code.push(operands[2]+"(self.Mem1("+addrx+") & "+(1<<bitx)+")?1:0);");}
else{context.varsused["bitx"]=true;context.varsused["addrx"]=true;var sign1=oputil_signify_operand(context,operands[1],true);context.code.push("bitx = "+sign1+"&7;");context.code.push("if ("+sign1+">=0) addrx = "+operands[0]+" + ("+sign1+">>3);");context.code.push("else addrx = "+operands[0]+" - (1+((-1-("+sign1+"))>>3));");context.code.push(operands[2]+"(self.Mem1(addrx) & (1<<bitx))?1:0);");}},0x4f:function(context,operands){var bitx,addrx,mask,bitnum;if(quot_isconstant(operands[1])){bitnum=Number(operands[1])&0xffffffff;bitx=bitnum&7;if(quot_isconstant(operands[0])){addrx=Number(operands[0]);if(bitnum>=0)
addrx+=(bitnum>>3);else
addrx-=(1+((-1-bitnum)>>3));}
else{if(bitnum>=0){if(bitnum<=7)
addrx=operands[0];else
addrx=(operands[0]+"+"+(bitnum>>3));}
else{addrx=(operands[0]+"-"+(1+((-1-bitnum)>>3)));}}
mask=(1<<bitx);}
else{context.varsused["bitx"]=true;context.varsused["addrx"]=true;var sign1=oputil_signify_operand(context,operands[1],true);context.code.push("bitx = "+sign1+"&7;");context.code.push("if ("+sign1+">=0) addrx = "+operands[0]+" + ("+sign1+">>3);");context.code.push("else addrx = "+operands[0]+" - (1+((-1-("+sign1+"))>>3));");addrx="addrx";mask="(1<<bitx)";}
if(quot_isconstant(operands[2])){if(Number(operands[2]))
context.code.push("self.MemW1("+addrx+", self.Mem1("+addrx+") | "+mask+");");else
context.code.push("self.MemW1("+addrx+", self.Mem1("+addrx+") & ~("+mask+"));");}
else{context.code.push("if ("+operands[2]+") self.MemW1("+addrx+", self.Mem1("+addrx+") | "+mask+");");context.code.push("else self.MemW1("+addrx+", self.Mem1("+addrx+") & ~("+mask+"));");}},0x50:function(context,operands){var val;var count=context.offstack.length;if(count)
val="self.frame.valstack.length+"+count;else
val="self.frame.valstack.length";oputil_store(context,operands[0],val);},0x51:function(context,operands){var val;if(quot_isconstant(operands[0])){var pos=Number(operands[0]);if(pos<context.offstack.length){val=context.offstack[context.offstack.length-(pos+1)];}
else{val="self.frame.valstack[self.frame.valstack.length-"+((pos+1)-context.offstack.length)+"]";}}
else{oputil_unload_offstate(context);val="self.frame.valstack[self.frame.valstack.length-("+operands[0]+"+1)]";}
oputil_store(context,operands[1],val);},0x52:function(context,operands){var temp,len;if(context.offstack.length<2){transfer_to_offstack(context,2);}
len=context.offstack.length;temp=context.offstack[len-1];context.offstack[len-1]=context.offstack[len-2];context.offstack[len-2]=temp;},0x53:function(context,operands){oputil_unload_offstate(context);context.varsused["ix"]=true;context.varsused["pos"]=true;context.varsused["roll"]=true;context.varsused["vals1"]=true;var sign0=oputil_signify_operand(context,operands[0],true);var sign1=oputil_signify_operand(context,operands[1],true);context.code.push("if ("+sign0+" > 0) {");context.code.push("if ("+sign1+" > 0) {");context.code.push("vals1 = "+sign1+" % "+sign0+";");context.code.push("} else {");context.code.push("vals1 = "+sign0+" - (-("+sign1+")) % "+sign0+";");context.code.push("}");context.code.push("if (vals1) {");context.code.push("pos = self.frame.valstack.length - "+sign0+";");context.code.push("roll = self.frame.valstack.slice(self.frame.valstack.length-vals1, self.frame.valstack.length).concat(self.frame.valstack.slice(pos, self.frame.valstack.length-vals1));");context.code.push("for (ix=0; ix<"+sign0+"; ix++) { self.frame.valstack[pos+ix] = roll[ix]; }");context.code.push("roll = undefined;");context.code.push("}");context.code.push("}");},0x54:function(context,operands){oputil_unload_offstate(context);if(quot_isconstant(operands[0])){var ix,holdvar;var pos=Number(operands[0]);for(ix=0;ix<pos;ix++){holdvar=alloc_holdvar(context,true);context.offstack.push(holdvar);context.code.push(holdvar+"=self.frame.valstack[self.frame.valstack.length-"+(pos-ix)+"];");}}
else{context.varsused["ix"]=true;context.varsused["jx"]=true;context.code.push("jx = self.frame.valstack.length-("+operands[0]+");");context.code.push("for (ix=0; ix<"+operands[0]+"; ix++) { self.frame.valstack.push(self.frame.valstack[jx+ix]); }");}},0x100:function(context,operands){var expr="self.do_gestalt(("+operands[0]+"),("+operands[1]+"))";context.code.push(operands[2]+expr+");");},0x101:function(context,operands){context.code.push("self.fatal_error('User debugtrap encountered.', "+operands[0]+");");},0x102:function(context,operands){context.code.push(operands[0]+"self.endmem);");},0x103:function(context,operands){context.code.push("self.change_memsize("+operands[0]+",false);");context.code.push(operands[1]+"0);");},0x110:function(context,operands){var expr;if(quot_isconstant(operands[0])){var val=Number(operands[0])&0xffffffff;if(val==0)
expr="(Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0";else if(val>0)
expr="Math.floor(self.random_func() * "+val+")";else
expr="-Math.floor(self.random_func() * "+(-val)+")";}
else{var sign0=oputil_signify_operand(context,operands[0],true);var holdvar=alloc_holdvar(context);expr=holdvar;context.code.push("if ("+sign0+" > 0)");context.code.push(holdvar+" = Math.floor(self.random_func() * "+sign0+");");context.code.push("else if ("+sign0+" < 0)");context.code.push(holdvar+" = -Math.floor(self.random_func() * -"+sign0+");");context.code.push("else");context.code.push(holdvar+" = (Math.floor(self.random_func() * 0x10000) | (Math.floor(self.random_func() * 0x10000) << 16)) >>>0;");}
context.code.push(operands[1]+expr+");");},0x111:function(context,operands){context.code.push("self.set_random("+operands[0]+");");},0x120:function(context,operands){context.offstack.length=0;context.offloc.length=0;context.offlocdirty.length=0;context.code.push("return self.VMStopped;");context.path_ends=true;},0x121:function(context,operands){context.code.push(operands[0]+"self.perform_verify());");},0x122:function(context,operands){context.offstack.length=0;context.offloc.length=0;context.offlocdirty.length=0;context.code.push("self.vm_restart();");context.code.push("return;");context.path_ends=true;},0x123:function(context,operands){oputil_unload_offstate(context);context.varsused["ix"]=true;oputil_push_callstub(context,operands[1]);context.code.push("ix = self.vm_save("+operands[0]+");");context.code.push("self.pop_callstub(ix ? 0 : 1);");context.code.push("return;");context.path_ends=true;},0x124:function(context,operands){oputil_unload_offstate(context);context.code.push("if (self.vm_restore("+operands[0]+")) {");context.code.push("self.pop_callstub((-1)>>>0);");context.code.push("} else {");oputil_store(context,operands[1],"1");oputil_unload_offstate(context);context.code.push("self.pc = "+context.cp+";");context.code.push("}");context.code.push("return;");context.path_ends=true;},0x125:function(context,operands){oputil_unload_offstate(context);oputil_push_callstub(context,operands[0]);context.code.push("self.vm_saveundo();");context.code.push("self.pop_callstub(0);");context.code.push("return;");context.path_ends=true;},0x126:function(context,operands){oputil_unload_offstate(context);context.code.push("if (self.vm_restoreundo()) {");context.code.push("self.pop_callstub((-1)>>>0);");context.code.push("} else {");oputil_store(context,operands[0],"1");oputil_unload_offstate(context);context.code.push("self.pc = "+context.cp+";");context.code.push("}");context.code.push("return;");context.path_ends=true;},0x127:function(context,operands){context.code.push("self.protectstart="+operands[0]+";");context.code.push("self.protectend=self.protectstart+("+operands[1]+");");context.code.push("if (self.protectstart==self.protectend) {")
context.code.push("  self.protectstart=0; self.protectend=0;");context.code.push("}");},0x170:function(context,operands){context.varsused["maddr"]=true;context.varsused["mlen"]=true;context.varsused["ix"]=true;context.code.push("mlen="+operands[0]+";");context.code.push("maddr="+operands[1]+";");context.code.push("for (ix=0; ix<mlen; ix++, maddr++) self.MemW1(maddr, 0);");},0x171:function(context,operands){context.varsused["msrc"]=true;context.varsused["mdest"]=true;context.varsused["mlen"]=true;context.varsused["ix"]=true;context.code.push("mlen="+operands[0]+";");context.code.push("msrc="+operands[1]+";");context.code.push("mdest="+operands[2]+";");context.code.push("if (mdest < msrc) {");context.code.push("for (ix=0; ix<mlen; ix++, msrc++, mdest++) self.MemW1(mdest, self.Mem1(msrc));");context.code.push("} else {");context.code.push("msrc += (mlen-1); mdest += (mlen-1);");context.code.push("for (ix=0; ix<mlen; ix++, msrc--, mdest--) self.MemW1(mdest, self.Mem1(msrc));");context.code.push("}");},0x178:function(context,operands){var expr="self.heap_malloc("+operands[0]+")";context.code.push(operands[1]+expr+");");},0x179:function(context,operands){context.code.push("self.heap_free("+operands[0]+");");},0x180:function(context,operands){context.code.push("self.accel_funcnum_map["+operands[1]+"] = "+operands[0]+";");context.code.push("self.accel_address_map["+operands[1]+"] = self.accel_func_map["+operands[0]+"];");},0x181:function(context,operands){context.code.push("if ("+operands[0]+" < 9) {");context.code.push("  self.accel_params["+operands[0]+"] = "+operands[1]+";");context.code.push("}");},0x150:function(context,operands){var expr="self.linear_search(("+operands[0]+"),("+operands[1]+"),("+operands[2]+"),("+operands[3]+"),("+operands[4]+"),("+operands[5]+"),("+operands[6]+"))";context.code.push(operands[7]+expr+");");},0x151:function(context,operands){var expr="self.binary_search(("+operands[0]+"),("+operands[1]+"),("+operands[2]+"),("+operands[3]+"),("+operands[4]+"),("+operands[5]+"),("+operands[6]+"))";context.code.push(operands[7]+expr+");");},0x152:function(context,operands){var expr="self.linked_search(("+operands[0]+"),("+operands[1]+"),("+operands[2]+"),("+operands[3]+"),("+operands[4]+"),("+operands[5]+"))";context.code.push(operands[6]+expr+");");},0x70:function(context,operands){switch(context.curiosys){case 2:if(quot_isconstant(operands[0])){var val=Number(operands[0])&0xff;context.code.push("Glk.glk_put_char("+val+");");}
else{context.code.push("Glk.glk_put_char(("+operands[0]+")&0xff);");}
break;case 1:oputil_unload_offstate(context);context.code.push("self.tempcallargs[0]=(("+operands[0]+")&0xff);");oputil_push_callstub(context,"0,0");context.code.push("self.enter_function(self.iosysrock, 1);");context.code.push("return;");context.path_ends=true;break;case 0:break;}},0x71:function(context,operands){switch(context.curiosys){case 2:var sign0=oputil_signify_operand(context,operands[0]);if(quot_isconstant(operands[0])){var val=Number(sign0).toString(10);context.code.push("Glk.glk_put_jstring("+QuoteEscapeString(val)+", true);");}
else{context.code.push("Glk.glk_put_jstring(("+sign0+").toString(10), true);");}
break;case 1:oputil_unload_offstate(context);context.code.push("self.stream_num("+context.cp+","+operands[0]+", false, 0);");context.code.push("return;");context.path_ends=true;break;case 0:break;}},0x72:function(context,operands){oputil_unload_offstate(context);context.code.push("if (self.stream_string("+context.cp+","+operands[0]+", 0, 0)) return;");},0x73:function(context,operands){switch(context.curiosys){case 2:if(quot_isconstant(operands[0])){var val=Number(operands[0]);context.code.push("Glk.glk_put_char_uni("+val+");");}
else{context.code.push("Glk.glk_put_char_uni("+operands[0]+");");}
break;case 1:oputil_unload_offstate(context);context.code.push("self.tempcallargs[0]=("+operands[0]+");");oputil_push_callstub(context,"0,0");context.code.push("self.enter_function(self.iosysrock, 1);");context.code.push("return;");context.path_ends=true;break;case 0:break;}},0x140:function(context,operands){context.code.push(operands[0]+"self.stringtable)");},0x141:function(context,operands){context.code.push("self.set_string_table("+operands[0]+");");},0x148:function(context,operands){context.code.push(operands[0]+"self.iosysmode)");context.code.push(operands[1]+"self.iosysrock)");},0x149:function(context,operands){context.code.push("self.set_iosys("+operands[0]+","+operands[1]+");");if(quot_isconstant(operands[0])){var val=Number(operands[0]);context.curiosys=val;}
else{oputil_unload_offstate(context);context.code.push("self.pc = "+context.cp+";");context.code.push("return;");context.path_ends=true;}},0x190:function(context,operands){var sign0=oputil_signify_operand(context,operands[0]);if(quot_isconstant(operands[0])){var val=Number(sign0);context.code.push(operands[1]+encode_float(val)+");");}
else{context.code.push(operands[1]+"self.encode_float("+sign0+"));");}},0x191:function(context,operands){context.varsused["valf"]=true;context.varsused["res"]=true;context.code.push("valf = "+oputil_decode_float(context,operands[0])+";");context.code.push("if (!("+operands[0]+" & 0x80000000)) {");context.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf > 0x7fffffff))");context.code.push("    res = 0x7fffffff;");context.code.push("  else");context.code.push("    res = Math.floor(valf);");context.code.push("} else {");context.code.push("  if (isNaN(valf) || !isFinite(valf) || (valf < -0x80000000))");context.code.push("    res = -0x80000000;");context.code.push("  else");context.code.push("    res = Math.ceil(valf);");context.code.push("}");context.code.push(operands[1]+"res>>>0);");},0x192:function(context,operands){context.varsused["valf"]=true;context.varsused["res"]=true;context.code.push("valf = "+oputil_decode_float(context,operands[0])+";");context.code.push("if (!("+operands[0]+" & 0x80000000)) {");context.code.push("  if (isNaN(valf) || !isFinite(valf))");context.code.push("    res = 0x7fffffff;");context.code.push("  else");context.code.push("    res = Math.round(valf);");context.code.push("  if (res > 0x7fffffff) res = 0x7fffffff;");context.code.push("} else {");context.code.push("  if (isNaN(valf) || !isFinite(valf))");context.code.push("    res = -0x80000000;");context.code.push("  else");context.code.push("    res = Math.round(valf);");context.code.push("  if (res < -0x80000000) res = -0x80000000;");context.code.push("}");context.code.push(operands[1]+"res>>>0);");},0x198:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.ceil("+valf+")));");},0x199:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.floor("+valf+")));");},0x1A0:function(context,operands){var valf0=oputil_decode_float(context,operands[0]);var valf1=oputil_decode_float(context,operands[1]);context.code.push(operands[2]+"self.encode_float("+valf0+" + "+valf1+"));");},0x1A1:function(context,operands){var valf0=oputil_decode_float(context,operands[0]);var valf1=oputil_decode_float(context,operands[1]);context.code.push(operands[2]+"self.encode_float("+valf0+" - "+valf1+"));");},0x1A2:function(context,operands){var valf0=oputil_decode_float(context,operands[0]);var valf1=oputil_decode_float(context,operands[1]);context.code.push(operands[2]+"self.encode_float("+valf0+" * "+valf1+"));");},0x1A3:function(context,operands){var valf0=oputil_decode_float(context,operands[0]);var valf1=oputil_decode_float(context,operands[1]);context.code.push(operands[2]+"self.encode_float("+valf0+" / "+valf1+"));");},0x1A4:function(context,operands){var valf0=oputil_decode_float(context,operands[0],true);var valf1=oputil_decode_float(context,operands[1],true);context.varsused["modv"]=true;context.varsused["quov"]=true;context.code.push("modv=("+valf0+" % "+valf1+");");context.code.push("quov=self.encode_float(("+valf0+" - modv) / "+valf1+");");context.code.push("if (quov == 0x0 || quov == 0x80000000) {");context.code.push("  quov = (("+operands[0]+" ^ "+operands[1]+") & 0x80000000) >>>0;");context.code.push("}");context.code.push(operands[2]+"self.encode_float(modv));");context.code.push(operands[3]+"quov);");},0x1A8:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.sqrt("+valf+")));");},0x1A9:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.exp("+valf+")));");},0x1AA:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.log("+valf+")));");},0x1AB:function(context,operands){context.varsused["valf"]=true;var valf0=oputil_decode_float(context,operands[0],true);var valf1=oputil_decode_float(context,operands[1],true);context.code.push("if ("+operands[0]+" == 0x3f800000) {");context.code.push("  valf = 0x3f800000;");context.code.push("} else if ("+operands[0]+" == 0xbf800000 && ("+operands[1]+" == 0xff800000 || "+operands[1]+" == 0x7f800000)) {");context.code.push("  valf = 0x3f800000;");context.code.push("} else {");context.code.push("  valf=self.encode_float(Math.pow("+valf0+", "+valf1+"));");context.code.push("}");context.code.push(operands[2]+"valf);");},0x1B0:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.sin("+valf+")));");},0x1B1:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.cos("+valf+")));");},0x1B2:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.tan("+valf+")));");},0x1B3:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.asin("+valf+")));");},0x1B4:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.acos("+valf+")));");},0x1B5:function(context,operands){var valf=oputil_decode_float(context,operands[0]);context.code.push(operands[1]+"self.encode_float(Math.atan("+valf+")));");},0x1B6:function(context,operands){var valf0=oputil_decode_float(context,operands[0]);var valf1=oputil_decode_float(context,operands[1]);context.code.push(operands[2]+"self.encode_float(Math.atan2("+valf0+", "+valf1+")));");},0x1C0:function(context,operands){var val,valf0,valf1,valf2;context.varsused["fequal"]=true;context.varsused["fdiff"]=true;context.code.push("if (("+operands[2]+" & 0x7f800000) == 0x7f800000 && ("+operands[2]+" & 0x007fffff) != 0) {");context.code.push("  fequal = 0;");context.code.push("} else if (("+operands[0]+" == 0xff800000 || "+operands[0]+" == 0x7f800000) && ("+operands[1]+" == 0xff800000 || "+operands[1]+" == 0x7f800000)) {");context.code.push("  fequal = ("+operands[0]+" == "+operands[1]+");");context.code.push("} else {");if(quot_isconstant(operands[2])){val=Number(operands[2]);valf2=""+decode_float(val&0x7fffffff);}
else{val="self.decode_float(("+operands[2]+") & 0x7fffffff)";valf2=alloc_holdvar(context);context.code.push(valf2+"="+val+";");}
valf0=oputil_decode_float(context,operands[0]);valf1=oputil_decode_float(context,operands[1]);context.code.push("  fdiff = "+valf1+" - "+valf0+";");context.code.push("  fequal = (fdiff <= "+valf2+" && fdiff >= -("+valf2+"));");context.code.push("}");context.code.push("if (fequal) {");oputil_perform_jump(context,operands[3]);context.code.push("}");},0x1C1:function(context,operands){var val,valf0,valf1,valf2;context.varsused["fequal"]=true;context.varsused["fdiff"]=true;context.code.push("if (("+operands[2]+" & 0x7f800000) == 0x7f800000 && ("+operands[2]+" & 0x007fffff) != 0) {");context.code.push("  fequal = 0;");context.code.push("} else if (("+operands[0]+" == 0xff800000 || "+operands[0]+" == 0x7f800000) && ("+operands[1]+" == 0xff800000 || "+operands[1]+" == 0x7f800000)) {");context.code.push("  fequal = ("+operands[0]+" == "+operands[1]+");");context.code.push("} else {");if(quot_isconstant(operands[2])){val=Number(operands[2]);valf2=""+decode_float(val&0x7fffffff);}
else{val="self.decode_float(("+operands[2]+") & 0x7fffffff)";valf2=alloc_holdvar(context);context.code.push(valf2+"="+val+";");}
valf0=oputil_decode_float(context,operands[0]);valf1=oputil_decode_float(context,operands[1]);context.code.push("  fdiff = "+valf1+" - "+valf0+";");context.code.push("  fequal = (fdiff <= "+valf2+" && fdiff >= -("+valf2+"));");context.code.push("}");context.code.push("if (!fequal) {");oputil_perform_jump(context,operands[3]);context.code.push("}");},0x1C2:function(context,operands){valf0=oputil_decode_float(context,operands[0]);valf1=oputil_decode_float(context,operands[1]);context.code.push("if ("+valf0+" < "+valf1+") {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x1C3:function(context,operands){valf0=oputil_decode_float(context,operands[0]);valf1=oputil_decode_float(context,operands[1]);context.code.push("if ("+valf0+" <= "+valf1+") {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x1C4:function(context,operands){valf0=oputil_decode_float(context,operands[0]);valf1=oputil_decode_float(context,operands[1]);context.code.push("if ("+valf0+" > "+valf1+") {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x1C5:function(context,operands){valf0=oputil_decode_float(context,operands[0]);valf1=oputil_decode_float(context,operands[1]);context.code.push("if ("+valf0+" >= "+valf1+") {");oputil_perform_jump(context,operands[2]);context.code.push("}");},0x1C8:function(context,operands){context.code.push("if (("+operands[0]+" & 0x7f800000) == 0x7f800000 && ("+operands[0]+" & 0x007fffff) != 0) {");oputil_perform_jump(context,operands[1]);context.code.push("}");},0x1C9:function(context,operands){context.code.push("if ("+operands[0]+" == 0xff800000 || "+operands[0]+" == 0x7f800000) {");oputil_perform_jump(context,operands[1]);context.code.push("}");},0x130:function(context,operands){var mayblock;if(quot_isconstant(operands[0]))
mayblock=Glk.call_may_not_return(Number(operands[0]));else
mayblock=true;if(mayblock){context.code.push("  self.prevpc = "+context.prevcp+";");context.code.push("  self.pc = "+context.cp+";");}
context.code.push("self.tempglkargs.length = "+operands[1]+";");if(quot_isconstant(operands[1])){var ix;var argc=Number(operands[1]);for(ix=0;ix<argc;ix++){if(context.offstack.length){var holdvar=pop_offstack_holdvar(context);context.code.push("self.tempglkargs["+ix+"]="+holdvar+";");}
else{context.code.push("self.tempglkargs["+ix+"]=self.frame.valstack.pop();");}}
oputil_unload_offstate(context);}
else{context.varsused["ix"]=true;oputil_unload_offstate(context);context.code.push("for (ix=0; ix<"+operands[1]+"; ix++) { self.tempglkargs[ix]=self.frame.valstack.pop(); }");}
context.varsused["glkret"]=true;context.code.push("glkret = GiDispa.get_function("+operands[0]+")(self.tempglkargs);");if(mayblock){context.code.push("if (glkret === Glk.DidNotReturn) {");context.code.push("  self.resumefuncop = "+oputil_record_funcop(operands[2])+";");context.code.push("  self.resumevalue = 0;");context.code.push("  self.pc = "+context.cp+";");context.code.push("  self.done_executing = true;");context.code.push("  return;");context.code.push("}");}
oputil_store(context,operands[2],"glkret");}}
function alloc_holdvar(context,use){var ix=0;var key;while(true){key="_hold"+ix;if(!context.holduse[key]){context.holduse[key]=(use?1:true);return key;}
ix++;}}
function pop_offstack_holdvar(context){var holdvar=context.offstack.pop();if(quot_isconstant(holdvar)){return holdvar;}
var use=context.holduse[holdvar];use--;if(use==0)
use=true;context.holduse[holdvar]=use;return holdvar;}
function push_offstack_holdvar(context,holdvar){context.offstack.push(holdvar);var use=context.holduse[holdvar];if(!use||use===true)
use=1;else
use++;context.holduse[holdvar]=use;}
function store_offloc_value(context,addr,value,inchold){var oldvar=context.offloc[addr];if(oldvar&&quot_isholdvar(oldvar)){var use=context.holduse[oldvar];use--;if(use==0)
use=true;context.holduse[oldvar]=use;}
if(value===undefined){context.offloc[addr]=undefined;context.offlocdirty[addr]=false;return;}
context.offloc[addr]=value;context.offlocdirty[addr]=true;if(inchold){var holdvar=value;var use=context.holduse[holdvar];if(!use||use===true)
use=1;else
use++;context.holduse[holdvar]=use;}}
function transfer_to_offstack(context,count){var holdvar;while(context.offstack.length<count){holdvar=alloc_holdvar(context,true);context.offstack.unshift(holdvar);context.code.push(holdvar+"=self.frame.valstack.pop();");}}
function quot_isconstant(val){return(val[0]==="0");}
function quot_isholdvar(val){return(val[0]==="_");}
function parse_operands(context,cp,oplist,operands){var modeaddr;var ix,modeval,mode;var value,addr;var holdvar;operands.desttype=0;operands.numops=oplist.numops;modeaddr=cp;cp+=((oplist.numops+1)>>1);for(ix=0;ix<oplist.numops;ix++){if((ix&1)==0){modeval=Mem1(modeaddr);mode=(modeval&0x0F);}
else{mode=((modeval>>4)&0x0F);modeaddr++;}
var optype=oplist.formlist[ix];if(optype=="L"){switch(mode){case 8:if(context.offstack.length){operands[ix]=pop_offstack_holdvar(context);}
else{holdvar=alloc_holdvar(context);context.code.push(holdvar+"=self.frame.valstack.pop();");operands[ix]=holdvar;}
continue;case 0:operands[ix]="0";continue;case 1:value=QuoteMem1(cp);cp++;operands[ix]=value;continue;case 2:value=QuoteMem2(cp);cp+=2;operands[ix]=value;continue;case 3:value=QuoteMem4(cp);cp+=4;operands[ix]=value;continue;}
if(mode>=9&&mode<=11){if(mode==9){addr=Mem1(cp);cp++;}
else if(mode==10){addr=Mem2(cp);cp+=2;}
else if(mode==11){addr=Mem4(cp);cp+=4;}
if(context.offloc[addr]!==undefined){operands[ix]=context.offloc[addr];continue;}
if(oplist.argsize==4){value="self.frame.locals["+addr+"]";}
else if(oplist.argsize==2){value="self.frame.locals["+addr+"] & 0xffff";}
else{value="self.frame.locals["+addr+"] & 0xff";}
holdvar=alloc_holdvar(context,true);context.code.push(holdvar+"=("+value+");");context.offloc[addr]=holdvar;context.offlocdirty[addr]=false;operands[ix]=holdvar;continue;}
switch(mode){case 15:addr=Mem4(cp)+ramstart;cp+=4;break;case 14:addr=Mem2(cp)+ramstart;cp+=2;break;case 13:addr=Mem1(cp)+ramstart;cp++;break;case 7:addr=Mem4(cp);cp+=4;break;case 6:addr=Mem2(cp);cp+=2;break;case 5:addr=Mem1(cp);cp++;break;default:fatal_error("Unknown addressing mode in load operand.");}
if(oplist.argsize==4){value="self.Mem4("+addr+")";}
else if(oplist.argsize==2){value="self.Mem2("+addr+")";}
else{value="self.Mem1("+addr+")";}
holdvar=alloc_holdvar(context);context.code.push(holdvar+"=("+value+");");operands[ix]=holdvar;continue;}
else if(optype=="E"){switch(mode){case 8:if(context.offstack.length){operands[ix]=pop_offstack_holdvar(context);}
else{operands[ix]="self.frame.valstack.pop()";}
continue;case 0:operands[ix]="0";continue;case 1:value=QuoteMem1(cp);cp++;operands[ix]=value;continue;case 2:value=QuoteMem2(cp);cp+=2;operands[ix]=value;continue;case 3:value=QuoteMem4(cp);cp+=4;operands[ix]=value;continue;}
if(mode>=9&&mode<=11){if(mode==9){addr=Mem1(cp);cp++;}
else if(mode==10){addr=Mem2(cp);cp+=2;}
else if(mode==11){addr=Mem4(cp);cp+=4;}
if(context.offloc[addr]!==undefined){operands[ix]=context.offloc[addr];continue;}
if(oplist.argsize==4){value="self.frame.locals["+addr+"]";}
else if(oplist.argsize==2){value="self.frame.locals["+addr+"] & 0xffff";}
else{value="self.frame.locals["+addr+"] & 0xff";}
holdvar=alloc_holdvar(context,true);context.code.push(holdvar+"=("+value+");");context.offloc[addr]=holdvar;context.offlocdirty[addr]=false;operands[ix]=holdvar;continue;}
switch(mode){case 15:addr=Mem4(cp)+ramstart;cp+=4;break;case 14:addr=Mem2(cp)+ramstart;cp+=2;break;case 13:addr=Mem1(cp)+ramstart;cp++;break;case 7:addr=Mem4(cp);cp+=4;break;case 6:addr=Mem2(cp);cp+=2;break;case 5:addr=Mem1(cp);cp++;break;default:fatal_error("Unknown addressing mode in load operand.");}
if(oplist.argsize==4){value="self.Mem4("+addr+")";}
else if(oplist.argsize==2){value="self.Mem2("+addr+")";}
else{value="self.Mem1("+addr+")";}
operands[ix]=value;continue;}
else if(optype=="S"){switch(mode){case 8:holdvar=alloc_holdvar(context,true);context.offstack.push(holdvar);operands[ix]=holdvar+"=(";continue;case 0:operands[ix]="(";continue;}
if(mode>=9&&mode<=11){if(mode==9){addr=Mem1(cp);cp++;}
else if(mode==10){addr=Mem2(cp);cp+=2;}
else if(mode==11){addr=Mem4(cp);cp+=4;}
if(oplist.argsize==4){holdvar=alloc_holdvar(context,true);store_offloc_value(context,addr,holdvar,false);operands[ix]=holdvar+"=(";}
else if(oplist.argsize==2){store_offloc_value(context,addr,undefined);operands[ix]="self.frame.locals["+addr+"]=(0xffff &";}
else{store_offloc_value(context,addr,undefined);operands[ix]="self.frame.locals["+addr+"]=(0xff &";}
continue;}
switch(mode){case 15:addr=Mem4(cp)+ramstart;cp+=4;break;case 14:addr=Mem2(cp)+ramstart;cp+=2;break;case 13:addr=Mem1(cp)+ramstart;cp++;break;case 7:addr=Mem4(cp);cp+=4;break;case 6:addr=Mem2(cp);cp+=2;break;case 5:addr=Mem1(cp);cp++;break;default:fatal_error("Unknown addressing mode in store operand.");}
if(oplist.argsize==4){value="self.MemW4("+addr+",";}
else if(oplist.argsize==2){value="self.MemW2("+addr+",";}
else{value="self.MemW1("+addr+",";}
operands[ix]=value;continue;}
else if(optype=="F"){var funcop=operands.func_store;switch(mode){case 8:funcop.mode=8;funcop.argsize=oplist.argsize;operands[ix]=funcop;continue;case 0:funcop.mode=0;funcop.argsize=oplist.argsize;operands[ix]=funcop;continue;}
if(mode>=9&&mode<=11){if(mode==9){addr=Mem1(cp);cp++;}
else if(mode==10){addr=Mem2(cp);cp+=2;}
else if(mode==11){addr=Mem4(cp);cp+=4;}
funcop.mode=11;funcop.addr=addr;funcop.argsize=oplist.argsize;operands[ix]=funcop;continue;}
switch(mode){case 15:addr=Mem4(cp)+ramstart;cp+=4;break;case 14:addr=Mem2(cp)+ramstart;cp+=2;break;case 13:addr=Mem1(cp)+ramstart;cp++;break;case 7:addr=Mem4(cp);cp+=4;break;case 6:addr=Mem2(cp);cp+=2;break;case 5:addr=Mem1(cp);cp++;break;default:fatal_error("Unknown addressing mode in store operand.");}
funcop.mode=15;funcop.addr=addr;funcop.argsize=oplist.argsize;operands[ix]=funcop;continue;}
else if(optype=="C"){switch(mode){case 8:operands[ix]="3,0";continue;case 0:operands[ix]="0,0";continue;}
if(mode>=9&&mode<=11){if(mode==9){addr=Mem1(cp);cp++;}
else if(mode==10){addr=Mem2(cp);cp+=2;}
else if(mode==11){addr=Mem4(cp);cp+=4;}
operands[ix]="2,"+addr;continue;}
switch(mode){case 15:addr=Mem4(cp)+ramstart;cp+=4;break;case 14:addr=Mem2(cp)+ramstart;cp+=2;break;case 13:addr=Mem1(cp)+ramstart;cp++;break;case 7:addr=Mem4(cp);cp+=4;break;case 6:addr=Mem2(cp);cp+=2;break;case 5:addr=Mem1(cp);cp++;break;default:fatal_error("Unknown addressing mode in store operand.");}
operands[ix]="1,"+addr;continue;}
else{fatal_error("Unknown operand type.",optype);}}
return cp;}
function compile_func(funcaddr){var addr=funcaddr;var functype=Mem1(addr);if(functype!=0xC0&&functype!=0xC1){if(functype>=0xC0&&functype<=0xDF)
fatal_error("Call to unknown type of function.",addr);else
fatal_error("Call to non-function.",addr);}
addr++;var localsformat=[];var rawstart=addr;var ix=0;while(1){var loctype=Mem1(addr);addr++;var locnum=Mem1(addr);addr++;if(loctype==0){break;}
if(loctype!=1&&loctype!=2&&loctype!=4){fatal_error("Invalid local variable size in function header.",loctype);}
localsformat.push({size:loctype,count:locnum});}
var rawformat=memmap.slice(rawstart,addr);while(rawformat.length%4)
rawformat.push(0);return new VMFunc(funcaddr,addr,localsformat,rawformat);}
function compile_path(vmfunc,startaddr,startiosys){var cp=startaddr;var opcode;var opcodecp;var key;var context={vmfunc:vmfunc,cp:null,prevcp:null,curiosys:startiosys,code:[],holduse:{},varsused:{},offstack:[],offloc:[],offlocdirty:[],path_ends:false};var operands={};operands.func_store={};context.code.push("");while(!context.path_ends){context.prevcp=cp;opcodecp=cp;opcode=Mem1(cp);if(opcode===undefined)
fatal_error("Tried to compile nonexistent address",cp);cp++;if(opcode&0x80){if(opcode&0x40){opcode&=0x3F;opcode=(opcode*0x100)|Mem1(cp);cp++;opcode=(opcode*0x100)|Mem1(cp);cp++;opcode=(opcode*0x100)|Mem1(cp);cp++;}
else{opcode&=0x7F;opcode=(opcode*0x100)|Mem1(cp);cp++;}}
var oplist=operandlist_table[opcode];if(!oplist)
fatal_error("Encountered unknown opcode.",opcode);cp=parse_operands(context,cp,oplist,operands);context.cp=cp;var ophandler=opcode_table[opcode];if(!ophandler)
fatal_error("Encountered unhandled opcode.",opcode);ophandler(context,operands);for(key in context.holduse){if(context.holduse[key]===true)
context.holduse[key]=false;}
if(vmfunc.pathaddrs[cp]&&!context.path_ends){context.code.push("self.pc="+cp+";");oputil_unload_offstate(context);context.code.push("return;");context.path_ends=true;}}
if(context.offstack.length)
fatal_error("Path compilation ended with nonempty offstack.",context.offstack.length);if(context.offloc.length)
fatal_error("Path compilation ended with nonempty offloc.",context.offloc.length);{var ls=[];for(key in context.holduse)
ls.push(key);for(key in context.varsused)
ls.push(key);if(ls.length)
context.code[0]="var "+ls.join(",")+";";}
return make_code(context.code.join("\n"),"_func_path_"+startaddr);}
function enter_function(addr,argcount){var ix;total_function_calls++;var accelfunc=accel_address_map[addr];if(accelfunc!==undefined){accel_function_calls++;var val=accelfunc(argcount,self.tempcallargs);pop_callstub(val);return;}
var vmfunc=vmfunc_table[addr];if(vmfunc===undefined){vmfunc=compile_func(addr);if(addr<ramstart)
vmfunc_table[addr]=vmfunc;}
self.pc=vmfunc.startpc;var newframe=new StackFrame(vmfunc);newframe.depth=stack.length;if(stack.length==0)
newframe.framestart=0;else
newframe.framestart=self.frame.framestart+self.frame.framelen+4*self.frame.valstack.length;stack.push(newframe);self.frame=newframe;if(vmfunc.functype==0xC0){for(ix=argcount-1;ix>=0;ix--)
self.frame.valstack.push(self.tempcallargs[ix]);self.frame.valstack.push(argcount);}
else{for(ix=0;ix<argcount;ix++){var form=vmfunc.localsindex[ix];if(form===undefined)
break;if(form.size==4)
self.frame.locals[form.pos]=self.tempcallargs[ix];else if(form.size==2)
self.frame.locals[form.pos]=self.tempcallargs[ix]&0xFFFF;else if(form.size==1)
self.frame.locals[form.pos]=self.tempcallargs[ix]&0xFF;}}}
self.enter_function=enter_function;function leave_function(){var olddepth=self.frame.depth;stack.pop();if(stack.length==0){self.frame=null;return true;}
self.frame=stack[stack.length-1];if(self.frame.depth!=olddepth-1)
fatal_error("Stack inconsistent after function exit.");}
self.leave_function=leave_function;function pop_stack_to(val){while(stack.length&&stack[stack.length-1].framestart>val)
stack.pop();if(stack.length==0)
fatal_error("Stack evaporated during throw.");self.frame=stack[stack.length-1];val-=(self.frame.framestart+self.frame.framelen);if(val<0)
fatal_error("Attempted to throw below the frame value stack.");if(val&3)
fatal_error("Attempted to throw to an unaligned address.");val>>>=2;if(val>self.frame.valstack.length)
fatal_error("Attempted to throw beyond the frame value stack.");self.frame.valstack.length=val;}
self.pop_stack_to=pop_stack_to;function pop_callstub(val){var destaddr,desttype;if(isNaN(val))
fatal_error("Function returned undefined value.");var valstack=self.frame.valstack;var vallen=valstack.length;var framestart=valstack[vallen-1];if(framestart!=self.frame.framestart){valstack.length-=1;fatal_error("Call stub frameptr ("+framestart+") "+"does not match frame ("+self.frame.framestart+")");}
self.pc=valstack[vallen-2];destaddr=valstack[vallen-3];desttype=valstack[vallen-4];valstack.length-=4;switch(desttype){case 0:return;case 1:MemW4(destaddr,val);return;case 2:self.frame.locals[destaddr]=val;return;case 3:self.frame.valstack.push(val);return;case 0x11:fatal_error("String-terminator call stub at end of function call.");return;case 0x10:stream_string(0,self.pc,0xE1,destaddr);return;case 0x12:stream_num(0,self.pc,true,destaddr);return;case 0x13:stream_string(0,self.pc,0xE0,destaddr);return;case 0x14:stream_string(0,self.pc,0xE2,destaddr);return;default:fatal_error("Unrecognized desttype in callstub.",desttype);}}
self.pop_callstub=pop_callstub;function store_operand(desttype,destaddr,val){switch(desttype){case 0:return;case 1:MemW4(destaddr,val);return;case 2:self.frame.locals[destaddr]=val;return;case 3:self.frame.valstack.push(val);return;default:fatal_error("Unrecognized desttype in callstub.",desttype);}}
self.store_operand=store_operand;function store_operand_by_funcop(funcop,val){if(!funcop)
return;switch(funcop.mode){case 8:self.frame.valstack.push(val);return;case 0:return;case 11:if(funcop.argsize==4){self.frame.locals[funcop.addr]=(val);}
else if(funcop.argsize==2){self.frame.locals[funcop.addr]=(0xffff&val);}
else{self.frame.locals[funcop.addr]=(0xff&val);}
return;case 15:if(funcop.argsize==4){MemW4(funcop.addr,val);}
else if(funcop.argsize==2){MemW2(funcop.addr,val);}
else{MemW1(funcop.addr,val);}
return;default:fatal_error("Unknown addressing mode in store func by operand.");}}
function parse_partial_operand()
{var addr=self.prevpc;var opcode=Mem1(addr);addr++;if(opcode&0x80){if(opcode&0x40){opcode&=0x3F;opcode=(opcode<<8)|Mem1(addr);addr++;opcode=(opcode<<8)|Mem1(addr);addr++;opcode=(opcode<<8)|Mem1(addr);addr++;}
else{opcode&=0x7F;opcode=(opcode<<8)|Mem1(addr);addr++;}}
if(opcode!=0x130){qlog("parse_partial_operand: parsed wrong opcode: "+opcode);return null;}
return{selop:Mem1(addr)&0x0F,argsop:(Mem1(addr)>>4)&0x0F,resop:Mem1(addr+1)&0x0F};}
function set_random(val){if(val==0){self.random_func=Math.random;}
else{srand_set_seed(val);self.random_func=srand_get_random;}}
self.set_random=set_random;var srand_table=undefined;var srand_index1,srand_index2;function srand_set_seed(seed){var i,ii,k,val,loop;if(srand_table===undefined)
srand_table=Array(55);srand_table[54]=seed;srand_index1=0;srand_index2=31;k=1;for(i=0;i<55;i++){ii=(21*i)%55;srand_table[ii]=k;k=(seed-k)>>>0;seed=srand_table[ii];}
for(loop=0;loop<4;loop++){for(i=0;i<55;i++){val=srand_table[i]-srand_table[(1+i+30)%55];srand_table[i]=val>>>0;}}}
function srand_get_random(){srand_index1=(srand_index1+1)%55;srand_index2=(srand_index2+1)%55;srand_table[srand_index1]=(srand_table[srand_index1]-srand_table[srand_index2])>>>0;return srand_table[srand_index1]/0x100000000;}
var accel_address_map={};var accel_funcnum_map={};self.accel_address_map=accel_address_map;self.accel_funcnum_map=accel_funcnum_map;var accel_params=[0,0,0,0,0,0,0,0,0];self.accel_params=accel_params;var accel_func_map={1:function func_1_z__region(argc,argv){if(argc<1)
return 0;var addr=argv[0];if(addr<36)
return 0;if(addr>=self.endmem)
return 0;var tb=Mem1(addr);if(tb>=0xE0){return 3;}
if(tb>=0xC0){return 2;}
if(tb>=0x70&&tb<=0x7F&&addr>=ramstart){return 1;}
return 0;},2:function func_2_cp__tab(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);if(accel_func_map[1](argc,argv)!=1){Glk.glk_put_jstring("\n[** Programming error: tried to find the \".\" of (something) **]\n");return 0;}
var otab=Mem4(obj+16);if(!otab)
return 0;var max=Mem4(otab);otab+=4;return binary_search(id,2,otab,10,max,0,0);},3:function func_3_ra__pr(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);var prop=accel_helper_get_prop(obj,id);if(prop==0)
return 0;return Mem4(prop+4);},4:function func_4_rl__pr(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);var prop=accel_helper_get_prop(obj,id);if(prop==0)
return 0;return 4*Mem2(prop+2);},5:function func_5_oc__cl(argc,argv){var zr,prop,inlist,inlistlen,jx;var obj=((argc>0)?argv[0]:0);var cla=((argc>1)?argv[1]:0);zr=accel_func_map[1](argc,argv);if(zr==3)
return(cla==accel_params[5])?1:0;if(zr==2)
return(cla==accel_params[4])?1:0;if(zr!=1)
return 0;if(cla==accel_params[2]){if(accel_helper_obj_in_class(obj))
return 1;if(obj==accel_params[2])
return 1;if(obj==accel_params[5])
return 1;if(obj==accel_params[4])
return 1;if(obj==accel_params[3])
return 1;return 0;}
if(cla==accel_params[3]){if(accel_helper_obj_in_class(obj))
return 0;if(obj==accel_params[2])
return 0;if(obj==accel_params[5])
return 0;if(obj==accel_params[4])
return 0;if(obj==accel_params[3])
return 0;return 1;}
if((cla==accel_params[5])||(cla==accel_params[4]))
return 0;if(!accel_helper_obj_in_class(cla)){Glk.glk_put_jstring("\n[** Programming error: tried to apply 'ofclass' with non-class **]\n");return 0;}
prop=accel_helper_get_prop(obj,2);if(prop==0)
return 0;inlist=Mem4(prop+4);if(inlist==0)
return 0;inlistlen=Mem2(prop+2);for(jx=0;jx<inlistlen;jx++){if(Mem4(inlist+(4*jx))==cla)
return 1;}
return 0;},6:function func_6_rv__pr(argc,argv){var id=((argc>1)?argv[1]:0);var addr;addr=accel_func_map[3](argc,argv);if(addr==0){if((id>0)&&(id<accel_params[1])){return Mem4(accel_params[8]+(4*id));}
Glk.glk_put_jstring("\n[** Programming error: tried to read (something) **]\n");return 0;}
return Mem4(addr);},7:function func_7_op__pr(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);var indiv_prop_start=accel_params[1];var zr=accel_func_map[1](argc,argv);if(zr==3){if(id==indiv_prop_start+6)
return 1;if(id==indiv_prop_start+7)
return 1;return 0;}
if(zr==2){return((id==indiv_prop_start+5)?1:0);}
if(zr!=1)
return 0;if((id>=indiv_prop_start)&&(id<indiv_prop_start+8)){if(accel_helper_obj_in_class(obj))
return 1;}
return((accel_func_map[3](argc,argv))?1:0);},8:function func_8_cp__tab(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);if(accel_func_map[1](argc,argv)!=1){Glk.glk_put_jstring("\n[** Programming error: tried to find the \".\" of (something) **]\n");return 0;}
var otab=Mem4(obj+4*(3+(accel_params[7]>>2)));if(!otab)
return 0;var max=Mem4(otab);otab+=4;return binary_search(id,2,otab,10,max,0,0);},9:function func_9_ra__pr(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);var prop=accel_helper_get_prop_new(obj,id);if(prop==0)
return 0;return Mem4(prop+4);},10:function func_10_rl__pr(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);var prop=accel_helper_get_prop_new(obj,id);if(prop==0)
return 0;return 4*Mem2(prop+2);},11:function func_11_oc__cl(argc,argv){var zr,prop,inlist,inlistlen,jx;var obj=((argc>0)?argv[0]:0);var cla=((argc>1)?argv[1]:0);zr=accel_func_map[1](argc,argv);if(zr==3)
return(cla==accel_params[5])?1:0;if(zr==2)
return(cla==accel_params[4])?1:0;if(zr!=1)
return 0;if(cla==accel_params[2]){if(accel_helper_obj_in_class(obj))
return 1;if(obj==accel_params[2])
return 1;if(obj==accel_params[5])
return 1;if(obj==accel_params[4])
return 1;if(obj==accel_params[3])
return 1;return 0;}
if(cla==accel_params[3]){if(accel_helper_obj_in_class(obj))
return 0;if(obj==accel_params[2])
return 0;if(obj==accel_params[5])
return 0;if(obj==accel_params[4])
return 0;if(obj==accel_params[3])
return 0;return 1;}
if((cla==accel_params[5])||(cla==accel_params[4]))
return 0;if(!accel_helper_obj_in_class(cla)){Glk.glk_put_jstring("\n[** Programming error: tried to apply 'ofclass' with non-class **]\n");return 0;}
prop=accel_helper_get_prop_new(obj,2);if(prop==0)
return 0;inlist=Mem4(prop+4);if(inlist==0)
return 0;inlistlen=Mem2(prop+2);for(jx=0;jx<inlistlen;jx++){if(Mem4(inlist+(4*jx))==cla)
return 1;}
return 0;},12:function func_12_rv__pr(argc,argv){var id=((argc>1)?argv[1]:0);var addr;addr=accel_func_map[9](argc,argv);if(addr==0){if((id>0)&&(id<accel_params[1])){return Mem4(accel_params[8]+(4*id));}
Glk.glk_put_jstring("\n[** Programming error: tried to read (something) **]\n");return 0;}
return Mem4(addr);},13:function func_13_op__pr(argc,argv){var obj=((argc>0)?argv[0]:0);var id=((argc>1)?argv[1]:0);var indiv_prop_start=accel_params[1];var zr=accel_func_map[1](argc,argv);if(zr==3){if(id==indiv_prop_start+6)
return 1;if(id==indiv_prop_start+7)
return 1;return 0;}
if(zr==2){return((id==indiv_prop_start+5)?1:0);}
if(zr!=1)
return 0;if((id>=indiv_prop_start)&&(id<indiv_prop_start+8)){if(accel_helper_obj_in_class(obj))
return 1;}
return((accel_func_map[9](argc,argv))?1:0);}};self.accel_func_map=accel_func_map;var accel_helper_temp_args=[0,0];function accel_helper_obj_in_class(obj)
{return(Mem4(obj+13+accel_params[7])==accel_params[2]);}
function accel_helper_get_prop(obj,id)
{var cla=0;var prop;if(id&0xFFFF0000){cla=Mem4(accel_params[0]+((id&0xFFFF)*4));accel_helper_temp_args[0]=obj;accel_helper_temp_args[1]=cla;if(accel_func_map[5](2,accel_helper_temp_args)==0)
return 0;id=id>>16;obj=cla;}
accel_helper_temp_args[0]=obj;accel_helper_temp_args[1]=id;prop=accel_func_map[2](2,accel_helper_temp_args);if(prop==0)
return 0;if(accel_helper_obj_in_class(obj)&&(cla==0)){if((id<accel_params[1])||(id>=accel_params[1]+8))
return 0;}
if(Mem4(accel_params[6])!=obj){if(Mem1(prop+9)&1)
return 0;}
return prop;}
function accel_helper_get_prop_new(obj,id)
{var cla=0;var prop;if(id&0xFFFF0000){cla=Mem4(accel_params[0]+((id&0xFFFF)*4));accel_helper_temp_args[0]=obj;accel_helper_temp_args[1]=cla;if(accel_func_map[11](2,accel_helper_temp_args)==0)
return 0;id=id>>16;obj=cla;}
accel_helper_temp_args[0]=obj;accel_helper_temp_args[1]=id;prop=accel_func_map[8](2,accel_helper_temp_args);if(prop==0)
return 0;if(accel_helper_obj_in_class(obj)&&(cla==0)){if((id<accel_params[1])||(id>=accel_params[1]+8))
return 0;}
if(Mem4(accel_params[6])!=obj){if(Mem1(prop+9)&1)
return 0;}
return prop;}
function set_string_table(addr){if(self.stringtable==addr)
return;decoding_tree=undefined;vmstring_table=undefined;self.stringtable=addr;if(self.stringtable==0){return;}
var textenv=vmtextenv_table[self.stringtable];if(textenv===undefined){var dectab=undefined;var tablelen=Mem4(self.stringtable);var rootaddr=Mem4(self.stringtable+8);var cache_stringtable=(self.stringtable+tablelen<=ramstart);if(cache_stringtable){var tmparray=Array(1);build_decoding_tree(tmparray,rootaddr,4,0);dectab=tmparray[0];if(dectab===undefined)
fatal_error("Failed to create decoding tree.");}
textenv=new VMTextEnv(self.stringtable,dectab);vmtextenv_table[self.stringtable]=textenv;}
decoding_tree=textenv.decoding_tree;vmstring_table=textenv.vmstring_tables[self.iosysmode];}
self.set_string_table=set_string_table;function set_iosys(mode,rock){switch(mode){case 0:rock=0;break;case 1:break;case 2:rock=0;break;default:mode=0;rock=0;break;}
self.iosysmode=mode;self.iosysrock=rock;var textenv=vmtextenv_table[self.stringtable];if(textenv===undefined)
vmstring_table=undefined;else
vmstring_table=textenv.vmstring_tables[self.iosysmode];}
self.set_iosys=set_iosys;function build_decoding_tree(cablist,nodeaddr,depth,mask){var ix,type,cab;var depthbit;type=Mem1(nodeaddr);if(type==0&&depth==4){cab=Array(16);cab.type=0;cab.depth=4;cablist[mask]=cab;build_decoding_tree(cab,nodeaddr,0,0);return;}
if(type==0){var leftaddr=Mem4(nodeaddr+1);var rightaddr=Mem4(nodeaddr+5);build_decoding_tree(cablist,leftaddr,depth+1,mask);build_decoding_tree(cablist,rightaddr,depth+1,(mask|(1<<depth)));return;}
nodeaddr++;cab={};cab.type=type;cab.depth=depth;switch(type){case 0x02:cab.value=Mem1(nodeaddr);cab.cchar=CharToString(cab.value);break;case 0x04:cab.value=Mem4(nodeaddr);cab.cchar=CharToString(cab.value);break;case 0x03:case 0x05:cab.addr=nodeaddr;break;case 0x08:case 0x09:cab.addr=Mem4(nodeaddr);break;case 0x0A:case 0x0B:cab.addr=nodeaddr;break;case 0x01:break;default:fatal_error("Unknown node type in string table.",type);}
depthbit=(1<<depth);for(ix=mask;ix<16;ix+=depthbit){cablist[ix]=cab;}}
function stream_num(nextcp,value,inmiddle,charnum){var buf=(value&0xffffffff).toString(10);switch(self.iosysmode){case 2:if(charnum)
buf=buf.slice(charnum);Glk.glk_put_jstring(buf,true);break;case 1:if(!inmiddle){self.frame.valstack.push(0x11,0,nextcp,self.frame.framestart);inmiddle=true;}
if(charnum<buf.length){var ch=buf.charCodeAt(charnum);self.frame.valstack.push(0x12,charnum+1,value,self.frame.framestart);self.tempcallargs[0]=ch;enter_function(self.iosysrock,1);return true;}
break;case 0:break;}
if(inmiddle){var desttype,destaddr;if(self.frame.valstack.pop()!=self.frame.framestart)
fatal_error("Call stub frameptr does not match frame.");self.pc=self.frame.valstack.pop();destaddr=self.frame.valstack.pop();desttype=self.frame.valstack.pop();if(desttype!=0x11)
fatal_error("String-on-string call stub while printing number.");}}
self.stream_num=stream_num;function stream_string(nextcp,addr,inmiddle,bitnum){var substring=(inmiddle!=0);var addrkey,strop,res;var desttype,destaddr;while(true){strop=undefined;if(inmiddle==0)
addrkey=addr;else
addrkey=addr+"/"+inmiddle+"/"+bitnum;if(vmstring_table!==undefined&&addr<ramstart){strop=vmstring_table[addrkey];if(strop===undefined){strop=compile_string(self.iosysmode,addr,inmiddle,bitnum);vmstring_table[addrkey]=strop;strings_compiled++;strings_cached++;}}
else{strop=compile_string(self.iosysmode,addr,inmiddle,bitnum);strings_compiled++;}
if(!(strop instanceof Function)){Glk.glk_put_jstring(strop);if(!substring)
return false;}
else{res=strop(self,nextcp,substring);if(res instanceof Array){substring=true;addr=res[0];inmiddle=res[1];bitnum=res[2];continue;}
if(res){return true;}}
if(self.frame.valstack.pop()!=self.frame.framestart)
fatal_error("Call stub frameptr does not match frame.");self.pc=self.frame.valstack.pop();destaddr=self.frame.valstack.pop();desttype=self.frame.valstack.pop();if(desttype==0x11){return true;}
else if(desttype==0x10){substring=true;bitnum=destaddr;inmiddle=0xE1;addr=self.pc;}
else{fatal_error("Function-terminator call stub at end of string.");}}}
self.stream_string=stream_string;function compile_string(curiosys,startaddr,inmiddle,startbitnum){var addr=startaddr;var bitnum=startbitnum;var retval=undefined;var ch,type;if(!addr)
fatal_error("Called compile_string with null address.");var context={startaddr:startaddr,startbitnum:startbitnum,buffer:[],code:[]}
if(inmiddle==0){type=Mem1(addr);if(type==0xE2)
addr+=4;else
addr++;bitnum=0;}
else{type=inmiddle;}
if(type==0xE1){if(decoding_tree){var bits,numbits,readahead,tmpaddr;var cablist,cab;var done=false;bits=Mem1(addr);if(bitnum)
bits>>=bitnum;numbits=(8-bitnum);readahead=false;if(!(decoding_tree instanceof Array)){done=true;}
cablist=decoding_tree;while(!done){if(numbits<4){var newbyte=Mem1(addr+1);bits|=(newbyte<<numbits);numbits+=8;readahead=true;}
cab=cablist[bits&0x0F];numbits-=cab.depth;bits>>=cab.depth;bitnum+=cab.depth;if(bitnum>=8){addr+=1;bitnum-=8;if(readahead){readahead=false;}
else{var newbyte=Mem1(addr);bits|=(newbyte<<numbits);numbits+=8;}}
if(cab instanceof Array){cablist=cab;continue;}
switch(cab.type){case 0x01:done=true;break;case 0x02:case 0x04:switch(curiosys){case 2:context.buffer.push(cab.cchar);break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);oputil_push_callstub(context,"0x10,"+bitnum,addr);context.code.push("self.tempcallargs[0]="+cab.value+";");context.code.push("self.enter_function(self.iosysrock, 1);");retval=true;done=true;break;}
cablist=decoding_tree;break;case 0x03:switch(curiosys){case 2:tmpaddr=cab.addr;while(true){ch=Mem1(tmpaddr);if(ch==0)
break;context.buffer.push(CharToString(ch));tmpaddr++;}
break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);oputil_push_callstub(context,"0x10,"+bitnum,addr);retval="["+(cab.addr)+", 0xE0, 0]";done=true;break;}
cablist=decoding_tree;break;case 0x05:switch(curiosys){case 2:tmpaddr=cab.addr;while(true){ch=Mem4(tmpaddr);if(ch==0)
break;context.buffer.push(CharToString(ch));tmpaddr+=4;}
break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);oputil_push_callstub(context,"0x10,"+bitnum,addr);retval="["+(cab.addr)+", 0xE2, 0]";done=true;break;}
cablist=decoding_tree;break;case 0x08:case 0x09:case 0x0A:case 0x0B:oputil_flush_string(context);oputil_push_substring_callstub(context);context.code.push("var otype, retval;");context.code.push("var oaddr = "+(cab.addr)+";");if(cab.type>=0x09)
context.code.push("oaddr = self.Mem4(oaddr);");if(cab.type==0x0B)
context.code.push("oaddr = self.Mem4(oaddr);");context.code.push("otype = self.Mem1(oaddr);");retval="retval";done=true;oputil_push_callstub(context,"0x10,"+bitnum,addr);context.code.push("if (otype >= 0xE0 && otype <= 0xFF) {");context.code.push("retval = [oaddr, 0, 0];");context.code.push("}");context.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var argc=0;if(cab.type==0x0A||cab.type==0x0B){argc=Mem4(cab.addr+4);for(var ix=0;ix<argc;ix++)
context.code.push("self.tempcallargs["+ix+"]="+Mem4(cab.addr+8+4*ix)+";");}
context.code.push("self.enter_function(oaddr, "+argc+");");context.code.push("retval = true;");context.code.push("}");context.code.push("else {");context.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);");context.code.push("}");break;default:fatal_error("Unknown entity in string decoding (cached).");break;}}}
else{var node,byt,nodetype;var done=false;if(!self.stringtable)
fatal_error("Attempted to print a compressed string with no table set.");byt=Mem1(addr);if(bitnum)
byt>>=bitnum;node=Mem4(self.stringtable+8);while(!done){nodetype=Mem1(node);node++;switch(nodetype){case 0x00:if(byt&1)
node=Mem4(node+4);else
node=Mem4(node+0);if(bitnum==7){bitnum=0;addr++;byt=Mem1(addr);}
else{bitnum++;byt>>=1;}
break;case 0x01:retval=false;done=true;break;case 0x02:ch=Mem1(node);switch(curiosys){case 2:context.buffer.push(CharToString(ch));break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);oputil_push_callstub(context,"0x10,"+bitnum,addr);context.code.push("self.tempcallargs[0]="+ch+";");context.code.push("self.enter_function(self.iosysrock, 1);");retval=true;done=true;break;}
node=Mem4(self.stringtable+8);break;case 0x04:ch=Mem4(node);switch(curiosys){case 2:context.buffer.push(CharToString(ch));break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);oputil_push_callstub(context,"0x10,"+bitnum,addr);context.code.push("self.tempcallargs[0]="+ch+";");context.code.push("self.enter_function(self.iosysrock, 1);");retval=true;done=true;break;}
node=Mem4(self.stringtable+8);break;case 0x03:switch(curiosys){case 2:while(true){ch=Mem1(node);if(ch==0)
break;context.buffer.push(CharToString(ch));node++;}
break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);oputil_push_callstub(context,"0x10,"+bitnum,addr);retval="["+node+", 0xE0, 0]";done=true;break;}
node=Mem4(self.stringtable+8);break;case 0x05:switch(curiosys){case 2:while(true){ch=Mem4(node);if(ch==0)
break;context.buffer.push(CharToString(ch));node+=4;}
break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);oputil_push_callstub(context,"0x10,"+bitnum,addr);retval="["+node+", 0xE2, 0]";done=true;break;}
node=Mem4(self.stringtable+8);break;case 0x08:case 0x09:case 0x0A:case 0x0B:oputil_flush_string(context);oputil_push_substring_callstub(context);context.code.push("var otype, retval;");context.code.push("var oaddr = "+Mem4(node)+";");if(nodetype==0x09||nodetype==0x0B)
context.code.push("oaddr = self.Mem4(oaddr);");context.code.push("otype = self.Mem1(oaddr);");retval="retval";done=true;oputil_push_callstub(context,"0x10,"+bitnum,addr);context.code.push("if (otype >= 0xE0 && otype <= 0xFF) {");context.code.push("retval = [oaddr, 0, 0];");context.code.push("}");context.code.push("else if (otype >= 0xC0 && otype <= 0xDF) {");var argc=0;if(nodetype==0x0A||nodetype==0x0B){argc=Mem4(node+4);for(var ix=0;ix<argc;ix++)
context.code.push("self.tempcallargs["+ix+"]="+Mem4(node+8+4*ix)+";");}
context.code.push("self.enter_function(oaddr, "+argc+");");context.code.push("retval = true;");context.code.push("}");context.code.push("else {");context.code.push("self.fatal_error('Unknown object while decoding string indirect reference.', otype);");context.code.push("}");break;default:fatal_error("Unknown entity in string decoding.",nodetype);break;}}}}
else if(type==0xE0){var ch;switch(curiosys){case 2:while(1){ch=Mem1(addr);addr++;if(ch==0)
break;context.buffer.push(CharToString(ch));}
break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);ch=Mem1(addr);addr++;if(ch!=0){oputil_push_callstub(context,"0x13,0",addr);context.code.push("self.tempcallargs[0]="+ch+";");context.code.push("self.enter_function(self.iosysrock, 1);");retval=true;}
else{retval="false";}
break;}}
else if(type==0xE2){var ch;switch(curiosys){case 2:while(1){ch=Mem4(addr);addr+=4;if(ch==0)
break;context.buffer.push(CharToString(ch));}
break;case 1:oputil_flush_string(context);oputil_push_substring_callstub(context);ch=Mem4(addr);addr+=4;if(ch!=0){oputil_push_callstub(context,"0x14,0",addr);context.code.push("self.tempcallargs[0]="+ch+";");context.code.push("self.enter_function(self.iosysrock, 1);");retval=true;}
else{retval="false";}
break;}}
else if(type>=0xE0&&type<=0xFF){fatal_error("Attempt to print unknown type of string.");}
else{fatal_error("Attempt to print non-string.");}
if(!retval){return context.buffer.join("");}
else{oputil_flush_string(context);context.code.push("return "+retval+";");return make_code(context.code.join("\n"),"_func_str_"+startaddr,"nextcp","substring");}}
function do_gestalt(val,val2){var ix;switch(val){case 0:return 0x00030102;case 1:return 0x00020106;case 2:return 1;case 3:return 1;case 4:switch(val2){case 0:return 1;case 1:return 1;case 2:return 1;default:return 0;}
break;case 5:return 1;case 6:return 1;case 7:return 1;case 8:return heap_get_start();case 9:return 1;case 10:if(accel_func_map[val2])
return 1;else
return 0;case 11:return 1;default:return 0;}}
self.do_gestalt=do_gestalt;function fetch_search_key(addr,len,options){var ix;if(options&1){return MemSlice(addr,len);}
else{switch(len){case 4:return[(addr>>24)&0xFF,(addr>>16)&0xFF,(addr>>8)&0xFF,addr&0xFF];case 2:return[(addr>>8)&0xFF,addr&0xFF];case 1:return[addr&0xFF];default:fatal_error('Direct search key must hold one, two, or four bytes.');}}}
function linear_search(key,keysize,start,structsize,numstructs,keyoffset,options){var ix,count,match,bytes;var retindex=((options&4)!=0);var zeroterm=((options&2)!=0);var keybuf=fetch_search_key(key,keysize,options);for(count=0;count<numstructs;count++,start+=structsize){match=true;bytes=MemSlice(start+keyoffset,keysize);for(ix=0;match&&ix<keysize;ix++){if(bytes[ix]!=keybuf[ix])
match=false;}
if(match){if(retindex)
return count;else
return start;}
if(zeroterm){match=true;bytes=MemSlice(start+keyoffset,keysize);for(ix=0;match&&ix<keysize;ix++){if(bytes[ix]!=0)
match=false;}
if(match){break;}}}
if(retindex)
return 0xFFFFFFFF;else
return 0;}
function binary_search(key,keysize,start,structsize,numstructs,keyoffset,options){var top,bot,addr,val,cmp,ix;var byt,byt2;var retindex=((options&4)!=0);var keybuf=fetch_search_key(key,keysize,options);bot=0;top=numstructs;while(bot<top){cmp=0;val=(top+bot)>>1;addr=start+val*structsize;for(ix=0;(!cmp)&&ix<keysize;ix++){byt=Mem1(addr+keyoffset+ix);byt2=keybuf[ix];if(byt<byt2)
cmp=-1;else if(byt>byt2)
cmp=1;}
if(!cmp){if(retindex)
return val;else
return addr;}
if(cmp<0){bot=val+1;}
else{top=val;}}
if(retindex)
return 0xFFFFFFFF;else
return 0;}
function linked_search(key,keysize,start,keyoffset,nextoffset,options){var ix,byt,match;var zeroterm=((options&2)!=0);var keybuf=fetch_search_key(key,keysize,options);while(start!=0){match=true;for(ix=0;match&&ix<keysize;ix++){byt=Mem1(start+keyoffset+ix);if(byt!=keybuf[ix])
match=false;}
if(match){return start;}
if(zeroterm){match=true;for(ix=0;match&&ix<keysize;ix++){byt=Mem1(start+keyoffset+ix);if(byt!=0)
match=false;}
if(match){break;}}
start=Mem4(start+nextoffset);}
return 0;}
self.linear_search=linear_search;self.binary_search=binary_search;self.linked_search=linked_search;function decode_float(val){var sign,res,expo;if(val&0x80000000){sign=true;val=val&0x7fffffff;}
else{sign=false;}
if(val==0){return(sign?-0.0:0.0);}
if((val&0x7f800000)==0x7f800000){if((val&0x7fffff)==0){return(sign?-Infinity:Infinity);}
else{return(sign?-NaN:NaN);}}
expo=(val>>23&0xff);if(expo){res=((val&0x7fffff|0x800000)/8388608*Math.pow(2,(expo-127)));}
else{res=((val&0x7fffff)/8388608*Math.pow(2,-126));}
if(sign)
return-res;else
return res;}
function encode_float(val){var absval,fbits;var mant,expo,sign;if(isNaN(val)){return 0x7f800001;}
if(!isFinite(val)){if(val<0)
return 0xff800000;else
return 0x7f800000;}
if(val==0){if(1/val<0)
return 0x80000000;else
return 0x0;}
if(val<0){sign=true;absval=-val;}
else{sign=false;absval=val;}
expo=Math.floor(Math.log(absval)/Math.log(2));mant=absval/Math.pow(2,expo);if(expo>=128){return(sign?0xff800000:0x7f800000);}
else if(expo<-126){mant=mant*Math.pow(2,126+expo);expo=0;}
else if(!(expo==0&&mant==0.0)){expo+=127;mant-=1.0;}
mant=mant*8388608.0;fbits=(mant+0.4999999999999999)<<0;if(fbits>=8388608){fbits=0;expo++;if(expo>=255){return(sign?0xff800000:0x7f800000);}}
if(sign)
return((0x80000000)|(expo<<23)|(fbits))>>>0;else
return(expo<<23)|(fbits);}
self.decode_float=decode_float;self.encode_float=encode_float;var game_image=null;var game_signature=null;var opt_rethrow_exceptions=null;var opt_do_vm_autosave=null;var opt_clear_vm_autosave=null;var memmap;var stack;self.frame=null;self.vm_started=false;self.vm_stopped=false;self.tempcallargs=null;self.tempglkargs=null;self.done_executing=null;var vmfunc_table;var vmtextenv_table;var decoding_tree;var vmstring_table;self.random_func=null;var ramstart;var endgamefile;var origendmem;var stacksize;var startfuncaddr;var origstringtable;var checksum;self.pc=null;self.stringtable=null;self.endmem=null;self.protectstart=null;self.protectend=null;self.iosysmode=null;self.iosysrock=null;self.prevpc=null;var undostack;self.resumefuncop=null;self.resumevalue=null;var heapstart;var usedlist;var freelist;var total_execution_time=0;var total_function_calls=0;var accel_function_calls=0;var total_path_calls=0;var paths_cached=0;var paths_compiled=0;var strings_cached=0;var strings_compiled=0;function setup_vm(){var val,version;if(!game_image)
fatal_error("There is no Glulx game file loaded.");self.vm_started=true;self.resumefuncop=null;self.resumevalue=0;memmap=null;stack=[];self.frame=null;self.pc=0;self.prevpc=0;if(game_image.length<36)
fatal_error("This is too short to be a valid Glulx file.");val=ByteRead4(game_image,0);if(val!=0x476c756c)
fatal_error("This is not a valid Glulx file.");version=ByteRead4(game_image,4);if(version<0x20000)
fatal_error("This Glulx file is too old a version to execute.");if(version>=0x30200)
fatal_error("This Glulx file is too new a version to execute.");ramstart=ByteRead4(game_image,8);endgamefile=ByteRead4(game_image,12);origendmem=ByteRead4(game_image,16);stacksize=ByteRead4(game_image,20);startfuncaddr=ByteRead4(game_image,24);origstringtable=ByteRead4(game_image,28);checksum=ByteRead4(game_image,32);self.protectstart=0;self.protectend=0;if(ramstart<0x100||endgamefile<ramstart||origendmem<endgamefile)
fatal_error("The segment boundaries in the header are in an impossible order.");if(endgamefile!=game_image.length)
fatal_error("The game file length does not agree with the header.");self.done_executing=false;vmfunc_table={};vmtextenv_table={};decoding_tree=undefined;vmstring_table=undefined;self.tempcallargs=Array(8);self.tempglkargs=Array(8);set_random(0);self.endmem=origendmem;self.stringtable=0;undostack=[];heapstart=0;usedlist=[];freelist=[];if(opt_clear_vm_autosave){Dialog.autosave_write(game_signature,null);}
if(opt_do_vm_autosave&&!opt_clear_vm_autosave){try{var snapshot=Dialog.autosave_read(game_signature);if(snapshot){qlog('Found autosave...');vm_autorestore(snapshot);return;}}
catch(ex){qlog('Autorestore failed, deleting it: '+show_exception(ex));if(ex.stack)
qlog('JS stack dump:\n'+ex.stack);Dialog.autosave_write(game_signature,null);}}
vm_restart();}
function vm_restart(){var ix;heap_clear();var protect=copy_protected_range();memmap=null;memmap=game_image.slice(0,endgamefile);self.endmem=memmap.length;change_memsize(origendmem,false);paste_protected_range(protect);stack=[];self.frame=null;self.pc=0;self.prevpc=0;self.iosysmode=0;self.iosysrock=0;set_string_table(origstringtable);enter_function(startfuncaddr,0);}
self.vm_restart=vm_restart;function compress_bytes(arr){result=[];var i=0;while(i<arr.length){var zeroes=0;while(i<arr.length&&arr[i]==0&&zeroes<=255){zeroes++;i++;}
if(zeroes>0){result.push(0);result.push(zeroes-1);}
while(i<arr.length&&arr[i]!=0){result.push(arr[i]);i++;}}
return result;}
function decompress_bytes(arr){result=[];var i=0;while(i<arr.length){var b=arr[i++];if(b==0){var count=arr[i++]+1;for(var j=0;j<count;j++){result.push(0);}}else{result.push(b);}}
return result;}
function pack_iff_chunks(chunks){bytes=[];for(var ix=0;ix<chunks.length;ix++){var key=chunks[ix].key;var chunk=chunks[ix].chunk;if(key.length!=4){fatal_error("Bad chunk ID (must be exactly 4 chars): "+key);}
if(chunk==undefined){fatal_error("Missing chunk data: "+key);}
BytePushString(bytes,key);BytePush4(bytes,chunk.length);bytes=bytes.concat(chunk);if(bytes.length&1)
bytes.push(0);}
return bytes;}
function unpack_iff_chunks(bytes){chunks={};var pos=0;while(pos<bytes.length){if((pos+8)>bytes.length){qlog("IFF chunk header is truncated");return undefined;}
var key=ByteReadString(bytes,pos,4);var size=ByteRead4(bytes,pos+4);pos+=8;if((pos+size)>bytes.length){qlog(key+" chunk is truncated "+"("+size+" bytes needed, "+(bytes.length-pos)+" available");return undefined;}
chunks[key]=bytes.slice(pos,pos+size);pos+=size;if(pos&1)
pos+=1;}
return chunks;}
function vm_save(streamid){if(self.iosysmode!=2)
fatal_error("Streams are only available in Glk I/O system.");var str=GiDispa.class_obj_from_id('stream',streamid);if(!str)
return false;chunks=[];chunks.push({key:"IFhd",chunk:game_image.slice(0,128)});var cmem=memmap.slice(ramstart);for(var i=ramstart;i<game_image.length;i++){cmem[i-ramstart]^=game_image[i];}
cmem=compress_bytes(cmem);cmem.splice(0,0,0,0,0,0);ByteWrite4(cmem,0,self.endmem);chunks.push({key:"CMem",chunk:cmem});var stkschunk=[];chunks.push({key:"Stks",chunk:stkschunk});for(var i=0;i<stack.length;i++){push_serialized_stackframe(stack[i],stkschunk);}
if(heap_is_active()){var mallchunk=[];chunks.push({key:"MAll",chunk:mallchunk});BytePush4(mallchunk,heapstart);BytePush4(mallchunk,usedlist.length);for(var i=0;i<usedlist.length;i++){BytePush4(mallchunk,usedlist[i].addr);BytePush4(mallchunk,usedlist[i].size);}}
var payload_bytes=[]
BytePushString(payload_bytes,"IFZS");payload_bytes=payload_bytes.concat(pack_iff_chunks(chunks));var quetzal=pack_iff_chunks([{key:"FORM",chunk:payload_bytes}])
Glk.glk_put_buffer_stream(str,quetzal);return true;}
function vm_restore(streamid){if(self.iosysmode!=2)
fatal_error("Streams are only available in Glk I/O system.");var str=GiDispa.class_obj_from_id('stream',streamid);if(!str)
return false;var quetzal=new Array(0);var buffer=new Array(1024);var count=1;while(count>0){count=Glk.glk_get_buffer_stream(str,buffer);quetzal=quetzal.concat(buffer.slice(0,count));}
quetzal=unpack_iff_chunks(quetzal);if(!quetzal){qlog("vm_restore failed: file is not Quetzal");return false;}
quetzal=quetzal["FORM"];if(!quetzal||ByteReadString(quetzal,0,4)!="IFZS"){qlog("vm_restore failed: file doesn't start with FORM/IFZS header");return false;}
var chunks=unpack_iff_chunks(quetzal.slice(4));if(!chunks["IFhd"]){qlog("vm_restore failed: missing required IFhd chunk");return false;}
for(var i=0;i<128;i++){if(chunks["IFhd"][i]!=game_image[i]){qlog("vm_restore failed: this save image is for a different game");return false;}}
if(!chunks["CMem"]){qlog("vm_restore failed: missing required CMem chunk");return false;}
if(!chunks["Stks"]){qlog("vm_restore failed: missing required Stks chunk");return false;}
var protect=copy_protected_range();heap_clear();var newendmem=ByteRead4(chunks["CMem"],0);var ram_xor=chunks["CMem"].slice(4);ram_xor=decompress_bytes(ram_xor);while(ram_xor.length<newendmem-ramstart)
ram_xor.push(0);change_memsize(newendmem,false);memmap=game_image.slice(0,ramstart).concat(ram_xor);for(var i=ramstart;i<game_image.length;i++){memmap[i]^=game_image[i];}
var stackchunk=chunks["Stks"];stack=[];while(stackchunk.length){self.frame=pop_deserialized_stackframe(stackchunk);if(!self.frame){fatal_error("vm_restore failed: bad stack frame");}
stack.unshift(self.frame);}
for(var i=0;i<stack.length;i++){stack[i].depth=i;}
self.frame=stack[stack.length-1];var heapchunk=chunks["MAll"];if(heapchunk&&heapchunk.length>=8){heapstart=ByteRead4(heapchunk,0);var numblocks=ByteRead4(heapchunk,4);for(var i=0;i<numblocks;i++){var addr=ByteRead4(heapchunk,8+8*i);var size=ByteRead4(heapchunk,12+8*i);usedlist.push(new HeapBlock(addr,size));}
usedlist.sort(function(blk1,blk2){return blk1.addr-blk2.addr;});var heapend=heapstart;for(var i=0;i<usedlist.length;i++){var addr=usedlist[i].addr;var size=usedlist[i].size;if(addr<heapend||(addr+size)>self.endmem){fatal_error("vm_restore failed: corrupt dynamic heap");}
if(addr>heapend){freelist.push(new HeapBlock(heapend,addr-heapend));}
heapend=addr+size;}
if(heapend<self.endmem){freelist.push(new HeapBlock(heapend,self.endmem-heapend));}}
paste_protected_range(protect);return true;}
function vm_autosave(eventaddr){if(eventaddr<0){Dialog.autosave_write(game_signature,null);return;}
var opmodes=parse_partial_operand();if(!opmodes)
return;var snapshot={};var valstack=self.frame.valstack;var origstacklen=valstack.length;valstack.push(eventaddr);if(opmodes.argsop==8){valstack.push(1);}
if(opmodes.selop==8){valstack.push(0x00C0);}
valstack.push(0,0,self.prevpc,self.frame.framestart);snapshot.ram=memmap.slice(ramstart);snapshot.endmem=self.endmem;snapshot.pc=self.pc;snapshot.stack=[];for(var i=0;i<stack.length;i++){push_serialized_stackframe(stack[i],snapshot.stack);}
if(heap_is_active()){snapshot.heapstart=heapstart;snapshot.usedlist=[];for(var i=0;i<usedlist.length;i++){snapshot.usedlist.push(usedlist[i].addr);snapshot.usedlist.push(usedlist[i].size);}}
valstack.length=origstacklen;snapshot.stringtable=self.stringtable;snapshot.iosysmode=self.iosysmode;snapshot.iosysrock=self.iosysrock;snapshot.protectstart=self.protectstart;snapshot.protectend=self.protectend;if(self.random_func==srand_get_random&&srand_table){snapshot.srand_table=srand_table.slice(0);snapshot.srand_index1=srand_index1;snapshot.srand_index2=srand_index2;}
snapshot.accel_params=accel_params.slice(0);snapshot.accel_funcnum_map={};for(var ix in accel_funcnum_map)
snapshot.accel_funcnum_map[ix]=accel_funcnum_map[ix];snapshot.glk=Glk.save_allstate();Dialog.autosave_write(game_signature,snapshot);}
function vm_autorestore(snapshot){memmap=game_image.slice(0,endgamefile);memmap=memmap.slice(0,ramstart).concat(snapshot.ram);self.endmem=snapshot.endmem;self.pc=snapshot.pc;stack=[];var stackchunk=snapshot.stack.slice(0);while(stackchunk.length){var frm=pop_deserialized_stackframe(stackchunk);if(!frm){fatal_error("vm_autorestore failed: bad stack frame");}
stack.unshift(frm);}
for(var i=0;i<stack.length;i++){stack[i].depth=i;}
self.frame=stack[stack.length-1];if(snapshot.heapstart===undefined){heapstart=0;usedlist=[];freelist=[];}
else{heapstart=snapshot.heapstart;usedlist=[];for(var ix=0;ix<snapshot.usedlist.length;ix+=2){var addr=snapshot.usedlist[ix];var size=snapshot.usedlist[ix+1];usedlist.push(new HeapBlock(addr,size));}
usedlist.sort(function(blk1,blk2){return blk1.addr-blk2.addr;});freelist=[];var heapend=heapstart;for(var i=0;i<usedlist.length;i++){var addr=usedlist[i].addr;var size=usedlist[i].size;if(addr<heapend||(addr+size)>self.endmem){fatal_error("vm_autorestore failed: corrupt dynamic heap");}
if(addr>heapend){freelist.push(new HeapBlock(heapend,addr-heapend));}
heapend=addr+size;}
if(heapend<self.endmem){freelist.push(new HeapBlock(heapend,self.endmem-heapend));}}
set_string_table(snapshot.stringtable);set_iosys(snapshot.iosysmode,snapshot.iosysrock);self.protectstart=snapshot.protectstart;self.protectend=snapshot.protectend;if(snapshot.srand_table===undefined){set_random(0);}
else{set_random(1);srand_table=snapshot.srand_table.slice(0);srand_index1=snapshot.srand_index1;srand_index2=snapshot.srand_index2;}
accel_params=snapshot.accel_params.slice(0);for(var ix in snapshot.accel_funcnum_map){accel_funcnum_map[ix]=snapshot.accel_funcnum_map[ix];accel_address_map[ix]=self.accel_func_map[accel_funcnum_map[ix]];}
Glk.restore_allstate(snapshot.glk);pop_callstub(0);}
function vm_saveundo(){var snapshot={};snapshot.ram=memmap.slice(ramstart);snapshot.endmem=self.endmem;snapshot.pc=self.pc;snapshot.stack=[];for(var i=0;i<stack.length;i++){snapshot.stack[i]=clone_stackframe(stack[i]);}
snapshot.heapstart=heapstart;snapshot.usedlist=usedlist.slice(0);snapshot.freelist=freelist.slice(0);undostack.push(snapshot);if(undostack.length>10){undostack.shift();}}
function vm_restoreundo(){if(undostack.length==0){return false;}
var snapshot=undostack.pop();var protect=copy_protected_range();memmap=memmap.slice(0,ramstart).concat(snapshot.ram);self.endmem=snapshot.endmem;stack=snapshot.stack;self.frame=stack[stack.length-1];self.pc=snapshot.pc;heapstart=snapshot.heapstart;usedlist=snapshot.usedlist;freelist=snapshot.freelist;paste_protected_range(protect);return true;}
self.vm_save=vm_save;self.vm_restore=vm_restore;self.vm_saveundo=vm_saveundo;self.vm_restoreundo=vm_restoreundo;function change_memsize(newlen,internal){var lx;if(newlen==self.endmem)
return;if((!internal)&&heap_is_active())
fatal_error("Cannot resize Glulx memory space while heap is active.");if(newlen<origendmem)
fatal_error("Cannot resize Glulx memory space smaller than it started.");if(newlen&0xFF)
fatal_error("Can only resize Glulx memory space to a 256-byte boundary.");memmap.length=newlen;if(newlen>self.endmem){for(lx=self.endmem;lx<newlen;lx++){memmap[lx]=0;}}
self.endmem=newlen;}
self.change_memsize=change_memsize;function copy_protected_range(){if(self.protectstart>=self.protectend)
return null;var len=self.protectend-self.protectstart;var obj={start:self.protectstart,end:self.protectend,len:len};var arr=memmap.slice(self.protectstart,self.protectend);while(arr.length<len)
arr.push(0);obj.mem=arr;return obj;}
function paste_protected_range(obj){if(!obj)
return;var ix,addr;var arr=obj.mem;var start=obj.start;var end=obj.end;if(end>self.endmem)
end=self.endmem;for(ix=0,addr=start;addr<end;ix++,addr++){memmap[addr]=arr[ix];}}
function perform_verify(){var imagelen=game_image.length;var ix,newsum,checksum;if(imagelen<0x100||(imagelen&0xFF)!=0)
return 1;if(imagelen!=ByteRead4(game_image,12))
return 1;checksum=ByteRead4(game_image,32);newsum=(-checksum)>>>0;for(ix=0;ix<imagelen;ix+=4){newsum=(newsum+ByteRead4(game_image,ix))>>>0;}
if(newsum!=checksum)
return 1;return 0;}
self.perform_verify=perform_verify;function quixe_get_signature(){return game_signature;}
function quixe_get_vm_self(){return self;}
function quixe_get_statistics(){var stat={game_image_length:game_image.length,total_execution_time:total_execution_time,total_function_calls:total_function_calls,accel_function_calls:accel_function_calls,total_path_calls:total_path_calls,paths_cached:paths_cached,paths_compiled:paths_compiled,strings_cached:strings_cached,strings_compiled:strings_compiled};return stat;}
function heap_clear(){heapstart=0;usedlist=[];freelist=[];}
function heap_is_active(){return(usedlist.length>0);}
function heap_get_start(){return heapstart;}
function HeapBlock(addr,size){this.addr=addr;this.size=size;this.end=addr+size;}
function heap_binary_search(list,addr){var low=0;var high=list.length;while(low<high){var mid=(low+high)>>1;if(list[mid].addr<addr){low=mid+1;}else{high=mid;}}
return low;}
function heap_malloc(size){if(!heap_is_active()){heapstart=self.endmem;}
for(var i=0,max=freelist.length;i<max;i++){var freeblock=freelist[i];if(freeblock.size>=size){if(freeblock.size>size){freelist[i]=new HeapBlock(freeblock.addr+size,freeblock.size-size);}else{freelist.splice(i,1);}
var pos=heap_binary_search(usedlist,freeblock.addr);usedlist.splice(pos,0,new HeapBlock(freeblock.addr,size));return freeblock.addr;}}
var addr=self.endmem;var rounded_up_size=((size+0xFF)&0xFFFFFF00);change_memsize(self.endmem+rounded_up_size,true);if(rounded_up_size>size){freelist.push(new HeapBlock(addr+size,rounded_up_size-size));}
usedlist.push(new HeapBlock(addr,size));return addr;}
self.heap_malloc=heap_malloc;function heap_free(addr){var pos=heap_binary_search(usedlist,addr);var block=usedlist[pos];if(!block||block.addr!=addr){fatal_error("Tried to free non-existent block");}
usedlist.splice(pos,1);if(usedlist.length==0){change_memsize(heapstart,true);heap_clear();return;}
pos=heap_binary_search(freelist,addr);var next=freelist[pos];if(next&&next.addr==block.end){block=new HeapBlock(addr,block.size+next.size);freelist.splice(pos,1);}
var prev=freelist[pos-1];if(prev&&prev.end==block.addr){block=new HeapBlock(prev.addr,prev.size+block.size);freelist.splice(pos-1,1);pos-=1;}
freelist.splice(pos,0,block);}
self.heap_free=heap_free;function assert_heap_valid(){if(!heap_is_active()){if(heapstart!=0)
fatal_error("Heap inconsistency: heapstart nonzero");if(usedlist.length>0)
fatal_error("Heap inconsistency: usedlist nonempty");if(freelist.length>0)
fatal_error("Heap inconsistency: usedlist nonempty");return;}
if(heapstart==0)
fatal_error("Heap inconsistency: heapstart is zero");var addr=heapstart;var upos=0,fpos=0;while(upos<usedlist.length||fpos<freelist.length){var u=usedlist[upos];var f=freelist[fpos];if(u&&u.addr==addr){addr+=u.size;upos++;}else if(f&&f.addr==addr){addr+=f.size;fpos++;}else{fatal_error("Heap inconsistency: no block at address "+addr);}}
if(addr!=self.endmem)
fatal_error("Heap inconsistency: overrun at end of heap");}
self.assert_heap_valid=assert_heap_valid;var debuginfo={map:{},functions:[],functionmap:{}};function quixe_get_debuginfo(){return debuginfo;}
function parse_inform_debug_data(){var buf=GiLoad.get_debug_info();if(!buf)
return;var done;var pos,oldpos;if(!(buf[0]==0xDE&&buf[1]==0xBF&&buf[2]==0&&buf[3]==0)){qlog("Dbug chunk did not contain an (old-style) Inform gameinfo.dbg file");return;}
var informversion=(buf[4]<<8)|(buf[5]);pos=6;done=false;while(!done){var rectype=buf[pos++];switch(rectype){case 0:case undefined:done=true;break;case 1:var filenum=buf[pos++];oldpos=pos;while(buf[pos]){pos++};var includename=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;oldpos=pos;while(buf[pos]){pos++};var filename=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;break;case 2:oldpos=pos;while(buf[pos]){pos++};var classname=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;var linestart=buf.slice(pos,pos+4);pos+=4;var lineend=buf.slice(pos,pos+4);pos+=4;break;case 3:var objnum=(buf[pos++]<<8)|(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var objname=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;var linestart=buf.slice(pos,pos+4);pos+=4;var lineend=buf.slice(pos,pos+4);pos+=4;break;case 4:var num=(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var name=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;break;case 5:var num=(buf[pos++]<<8)|(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var name=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;break;case 6:var num=(buf[pos++]<<8)|(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var name=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;break;case 7:var num=(buf[pos++]<<8)|(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var name=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;break;case 8:var num=(buf[pos++]<<8)|(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var name=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;break;case 9:pos+=64;break;case 10:var funcnum=(buf[pos++]<<8)|(buf[pos++]);var seqcount=(buf[pos++]<<8)|(buf[pos++]);pos+=seqcount*6;break;case 11:var funcnum=(buf[pos++]<<8)|(buf[pos++]);var line=buf.slice(pos,pos+4);pos+=4;var funcaddr=(buf[pos++]<<16)|(buf[pos++]<<8)|(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var funcname=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;var locals=[];while(buf[pos]){oldpos=pos;while(buf[pos]){pos++};var locname=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;locals.push(locname);}
pos++;debuginfo.functions.push({num:funcnum,name:funcname,addr:funcaddr,locals:locals});break;case 12:var arrayaddr=(buf[pos++]<<8)|(buf[pos++]);oldpos=pos;while(buf[pos]){pos++};var name=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;break;case 13:while(buf[pos]){oldpos=pos;while(buf[pos]){pos++};var name=String.fromCharCode.apply(this,buf.slice(oldpos,pos));pos++;var addr=(buf[pos++]<<16)|(buf[pos++]<<8)|(buf[pos++]);debuginfo.map[name]=addr;}
pos++;break;case 14:var funcnum=(buf[pos++]<<8)|(buf[pos++]);var line=buf.slice(pos,pos+4);pos+=4;var endaddr=(buf[pos++]<<16)|(buf[pos++]<<8)|(buf[pos++]);break;default:qlog("Unknown record type in debug data: "+rectype);done=true;break;}}
var funcbase=debuginfo.map["code area"];if(funcbase){var ix;for(ix=0;ix<debuginfo.functions.length;ix++){var func=debuginfo.functions[ix];debuginfo.functionmap[funcbase+func.addr]=func;}}}
self.VMStopped={dummy:'The top-level function has returned.'};function execute_loop(){var vmfunc,pathtab,path;var pathstart,pathend;if(self.resumefuncop){store_operand_by_funcop(self.resumefuncop,self.resumevalue);self.resumefuncop=null;self.resumevalue=0;}
pathstart=new Date().getTime();while(!self.done_executing){vmfunc=self.frame.vmfunc;pathtab=vmfunc[self.iosysmode];path=pathtab[self.pc];if(path===undefined){vmfunc.pathaddrs[self.pc]=true;path=compile_path(vmfunc,self.pc,self.iosysmode);paths_compiled++;if(self.pc<ramstart){pathtab[self.pc]=path;paths_cached++;}}
total_path_calls++;var res=path(self);if(res===self.VMStopped){self.done_executing=true;self.vm_stopped=true;}}
pathend=new Date().getTime();total_execution_time+=(pathend-pathstart)/1000.0;if(self.vm_stopped){Glk.glk_exit();}
Glk.update();qlog("### done executing; path time = "+(pathend-pathstart)+" ms");}
return{version:'2.1.6',prepare:quixe_prepare,init:quixe_init,resume:quixe_resume,get_signature:quixe_get_signature,get_vm_internals:quixe_get_vm_self,get_statistics:quixe_get_statistics,get_debuginfo:quixe_get_debuginfo,ReadByte:ReadArgByte,WriteByte:WriteArgByte,ReadWord:ReadArgWord,WriteWord:WriteArgWord,ReadStructField:ReadStructField,WriteStructField:WriteStructField,SetResumeStore:SetResumeStore,do_autosave:vm_autosave};}();GiDispa=function(){var self={};self.VM=null;function set_vm(vm_api){self.VM=vm_api;}
var class_defs={0:'window',1:'stream',2:'fileref',3:'schannel'};function FuncSpec(id,name,proto){this.id=id;this.name=name;this.proto=proto;}
function Prototype(args,retarg){this.args=args;this.retarg=retarg;}
function ArgString(){this.macro='Byte';this.refsize=1;this.serialize=function(){return{type:'ArgString'};};}
function ArgUnicode(){this.macro='Word';this.refsize=4;this.serialize=function(){return{type:'ArgUnicode'};};}
function ArgChar(signed){this.signed=signed;this.macro='Byte';this.refsize=1;this.literal=(signed?'arg_char_signed':'arg_char_unsigned');this.serialize=function(){return{type:'ArgChar',signed:signed};};}
function ArgInt(signed){this.signed=signed;this.macro='Word';this.refsize=4;this.literal=(signed?'arg_int_signed':'arg_int_unsigned');this.serialize=function(){return{type:'ArgInt',signed:signed};};}
function ArgClass(name){this.name=name;this.macro='Word';this.refsize=4;}
function ArgStruct(form){this.form=form;}
function ArgRef(arg,passin,passout,nonnull){this.arg=arg;this.passin=passin;this.passout=passout;this.nonnull=nonnull;}
function ArgArray(arg,retained,passin,passout,nonnull){this.arg=arg;this.retained=retained;this.passin=passin;this.passout=passout;this.nonnull=nonnull;}
function arg_deserialize(obj){switch(obj.type){case'ArgString':return new ArgString();case'ArgUnicode':return new ArgUnicode();case'ArgInt':if(obj.signed)
return arg_int_signed;else
return arg_int_unsigned;case'ArgChar':if(obj.signed===null)
return arg_char_native;else if(obj.signed)
return arg_char_signed;else
return arg_char_unsigned;}
throw new Error('arg_deserialize: unknown type: '+obj.type);}
var arg_int_unsigned=new ArgInt(false);var arg_int_signed=new ArgInt(true);var arg_char_unsigned=new ArgChar(false);var arg_char_native=new ArgChar(null);var arg_char_signed=new ArgChar(true);var arg_class_window=new ArgClass("window");var arg_class_stream=new ArgClass("stream");var arg_class_fileref=new ArgClass("fileref");var arg_class_schannel=new ArgClass("schannel");var proto_map={1:new FuncSpec(1,"exit",new Prototype([],null)),3:new FuncSpec(3,"tick",new Prototype([],null)),4:new FuncSpec(4,"gestalt",new Prototype([arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),5:new FuncSpec(5,"gestalt_ext",new Prototype([arg_int_unsigned,arg_int_unsigned,new ArgArray(arg_int_unsigned,false,true,true,false)],new ArgRef(arg_int_unsigned,false,true,true))),32:new FuncSpec(32,"window_iterate",new Prototype([arg_class_window,new ArgRef(arg_int_unsigned,false,true,false)],new ArgRef(arg_class_window,false,true,true))),33:new FuncSpec(33,"window_get_rock",new Prototype([arg_class_window],new ArgRef(arg_int_unsigned,false,true,true))),34:new FuncSpec(34,"window_get_root",new Prototype([],new ArgRef(arg_class_window,false,true,true))),35:new FuncSpec(35,"window_open",new Prototype([arg_class_window,arg_int_unsigned,arg_int_unsigned,arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_window,false,true,true))),36:new FuncSpec(36,"window_close",new Prototype([arg_class_window,new ArgRef(new ArgStruct(new Prototype([arg_int_unsigned,arg_int_unsigned],null)),false,true,false)],null)),37:new FuncSpec(37,"window_get_size",new Prototype([arg_class_window,new ArgRef(arg_int_unsigned,false,true,false),new ArgRef(arg_int_unsigned,false,true,false)],null)),38:new FuncSpec(38,"window_set_arrangement",new Prototype([arg_class_window,arg_int_unsigned,arg_int_unsigned,arg_class_window],null)),39:new FuncSpec(39,"window_get_arrangement",new Prototype([arg_class_window,new ArgRef(arg_int_unsigned,false,true,false),new ArgRef(arg_int_unsigned,false,true,false),new ArgRef(arg_class_window,false,true,false)],null)),40:new FuncSpec(40,"window_get_type",new Prototype([arg_class_window],new ArgRef(arg_int_unsigned,false,true,true))),41:new FuncSpec(41,"window_get_parent",new Prototype([arg_class_window],new ArgRef(arg_class_window,false,true,true))),42:new FuncSpec(42,"window_clear",new Prototype([arg_class_window],null)),43:new FuncSpec(43,"window_move_cursor",new Prototype([arg_class_window,arg_int_unsigned,arg_int_unsigned],null)),44:new FuncSpec(44,"window_get_stream",new Prototype([arg_class_window],new ArgRef(arg_class_stream,false,true,true))),45:new FuncSpec(45,"window_set_echo_stream",new Prototype([arg_class_window,arg_class_stream],null)),46:new FuncSpec(46,"window_get_echo_stream",new Prototype([arg_class_window],new ArgRef(arg_class_stream,false,true,true))),47:new FuncSpec(47,"set_window",new Prototype([arg_class_window],null)),48:new FuncSpec(48,"window_get_sibling",new Prototype([arg_class_window],new ArgRef(arg_class_window,false,true,true))),64:new FuncSpec(64,"stream_iterate",new Prototype([arg_class_stream,new ArgRef(arg_int_unsigned,false,true,false)],new ArgRef(arg_class_stream,false,true,true))),65:new FuncSpec(65,"stream_get_rock",new Prototype([arg_class_stream],new ArgRef(arg_int_unsigned,false,true,true))),66:new FuncSpec(66,"stream_open_file",new Prototype([arg_class_fileref,arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_stream,false,true,true))),67:new FuncSpec(67,"stream_open_memory",new Prototype([new ArgArray(arg_char_native,true,true,true,false),arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_stream,false,true,true))),68:new FuncSpec(68,"stream_close",new Prototype([arg_class_stream,new ArgRef(new ArgStruct(new Prototype([arg_int_unsigned,arg_int_unsigned],null)),false,true,false)],null)),69:new FuncSpec(69,"stream_set_position",new Prototype([arg_class_stream,arg_int_signed,arg_int_unsigned],null)),70:new FuncSpec(70,"stream_get_position",new Prototype([arg_class_stream],new ArgRef(arg_int_unsigned,false,true,true))),71:new FuncSpec(71,"stream_set_current",new Prototype([arg_class_stream],null)),72:new FuncSpec(72,"stream_get_current",new Prototype([],new ArgRef(arg_class_stream,false,true,true))),73:new FuncSpec(73,"stream_open_resource",new Prototype([arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_stream,false,true,true))),96:new FuncSpec(96,"fileref_create_temp",new Prototype([arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_fileref,false,true,true))),97:new FuncSpec(97,"fileref_create_by_name",new Prototype([arg_int_unsigned,new ArgString(),arg_int_unsigned],new ArgRef(arg_class_fileref,false,true,true))),98:new FuncSpec(98,"fileref_create_by_prompt",new Prototype([arg_int_unsigned,arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_fileref,false,true,true))),99:new FuncSpec(99,"fileref_destroy",new Prototype([arg_class_fileref],null)),100:new FuncSpec(100,"fileref_iterate",new Prototype([arg_class_fileref,new ArgRef(arg_int_unsigned,false,true,false)],new ArgRef(arg_class_fileref,false,true,true))),101:new FuncSpec(101,"fileref_get_rock",new Prototype([arg_class_fileref],new ArgRef(arg_int_unsigned,false,true,true))),102:new FuncSpec(102,"fileref_delete_file",new Prototype([arg_class_fileref],null)),103:new FuncSpec(103,"fileref_does_file_exist",new Prototype([arg_class_fileref],new ArgRef(arg_int_unsigned,false,true,true))),104:new FuncSpec(104,"fileref_create_from_fileref",new Prototype([arg_int_unsigned,arg_class_fileref,arg_int_unsigned],new ArgRef(arg_class_fileref,false,true,true))),128:new FuncSpec(128,"put_char",new Prototype([arg_char_unsigned],null)),129:new FuncSpec(129,"put_char_stream",new Prototype([arg_class_stream,arg_char_unsigned],null)),130:new FuncSpec(130,"put_string",new Prototype([new ArgString()],null)),131:new FuncSpec(131,"put_string_stream",new Prototype([arg_class_stream,new ArgString()],null)),132:new FuncSpec(132,"put_buffer",new Prototype([new ArgArray(arg_char_native,false,true,false,true)],null)),133:new FuncSpec(133,"put_buffer_stream",new Prototype([arg_class_stream,new ArgArray(arg_char_native,false,true,false,true)],null)),134:new FuncSpec(134,"set_style",new Prototype([arg_int_unsigned],null)),135:new FuncSpec(135,"set_style_stream",new Prototype([arg_class_stream,arg_int_unsigned],null)),144:new FuncSpec(144,"get_char_stream",new Prototype([arg_class_stream],new ArgRef(arg_int_signed,false,true,true))),145:new FuncSpec(145,"get_line_stream",new Prototype([arg_class_stream,new ArgArray(arg_char_native,false,false,true,true)],new ArgRef(arg_int_unsigned,false,true,true))),146:new FuncSpec(146,"get_buffer_stream",new Prototype([arg_class_stream,new ArgArray(arg_char_native,false,false,true,true)],new ArgRef(arg_int_unsigned,false,true,true))),160:new FuncSpec(160,"char_to_lower",new Prototype([arg_char_unsigned],new ArgRef(arg_char_unsigned,false,true,true))),161:new FuncSpec(161,"char_to_upper",new Prototype([arg_char_unsigned],new ArgRef(arg_char_unsigned,false,true,true))),176:new FuncSpec(176,"stylehint_set",new Prototype([arg_int_unsigned,arg_int_unsigned,arg_int_unsigned,arg_int_signed],null)),177:new FuncSpec(177,"stylehint_clear",new Prototype([arg_int_unsigned,arg_int_unsigned,arg_int_unsigned],null)),178:new FuncSpec(178,"style_distinguish",new Prototype([arg_class_window,arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),179:new FuncSpec(179,"style_measure",new Prototype([arg_class_window,arg_int_unsigned,arg_int_unsigned,new ArgRef(arg_int_unsigned,false,true,false)],new ArgRef(arg_int_unsigned,false,true,true))),192:new FuncSpec(192,"select",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_unsigned,arg_class_window,arg_int_unsigned,arg_int_unsigned],null)),false,true,true)],null)),193:new FuncSpec(193,"select_poll",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_unsigned,arg_class_window,arg_int_unsigned,arg_int_unsigned],null)),false,true,true)],null)),208:new FuncSpec(208,"request_line_event",new Prototype([arg_class_window,new ArgArray(arg_char_native,true,true,true,true),arg_int_unsigned],null)),209:new FuncSpec(209,"cancel_line_event",new Prototype([arg_class_window,new ArgRef(new ArgStruct(new Prototype([arg_int_unsigned,arg_class_window,arg_int_unsigned,arg_int_unsigned],null)),false,true,false)],null)),210:new FuncSpec(210,"request_char_event",new Prototype([arg_class_window],null)),211:new FuncSpec(211,"cancel_char_event",new Prototype([arg_class_window],null)),212:new FuncSpec(212,"request_mouse_event",new Prototype([arg_class_window],null)),213:new FuncSpec(213,"cancel_mouse_event",new Prototype([arg_class_window],null)),214:new FuncSpec(214,"request_timer_events",new Prototype([arg_int_unsigned],null)),224:new FuncSpec(224,"image_get_info",new Prototype([arg_int_unsigned,new ArgRef(arg_int_unsigned,false,true,false),new ArgRef(arg_int_unsigned,false,true,false)],new ArgRef(arg_int_unsigned,false,true,true))),225:new FuncSpec(225,"image_draw",new Prototype([arg_class_window,arg_int_unsigned,arg_int_signed,arg_int_signed],new ArgRef(arg_int_unsigned,false,true,true))),226:new FuncSpec(226,"image_draw_scaled",new Prototype([arg_class_window,arg_int_unsigned,arg_int_signed,arg_int_signed,arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),232:new FuncSpec(232,"window_flow_break",new Prototype([arg_class_window],null)),233:new FuncSpec(233,"window_erase_rect",new Prototype([arg_class_window,arg_int_signed,arg_int_signed,arg_int_unsigned,arg_int_unsigned],null)),234:new FuncSpec(234,"window_fill_rect",new Prototype([arg_class_window,arg_int_unsigned,arg_int_signed,arg_int_signed,arg_int_unsigned,arg_int_unsigned],null)),235:new FuncSpec(235,"window_set_background_color",new Prototype([arg_class_window,arg_int_unsigned],null)),240:new FuncSpec(240,"schannel_iterate",new Prototype([arg_class_schannel,new ArgRef(arg_int_unsigned,false,true,false)],new ArgRef(arg_class_schannel,false,true,true))),241:new FuncSpec(241,"schannel_get_rock",new Prototype([arg_class_schannel],new ArgRef(arg_int_unsigned,false,true,true))),242:new FuncSpec(242,"schannel_create",new Prototype([arg_int_unsigned],new ArgRef(arg_class_schannel,false,true,true))),243:new FuncSpec(243,"schannel_destroy",new Prototype([arg_class_schannel],null)),244:new FuncSpec(244,"schannel_create_ext",new Prototype([arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_schannel,false,true,true))),247:new FuncSpec(247,"schannel_play_multi",new Prototype([new ArgArray(arg_class_schannel,false,true,false,true),new ArgArray(arg_int_unsigned,false,true,false,true),arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),248:new FuncSpec(248,"schannel_play",new Prototype([arg_class_schannel,arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),249:new FuncSpec(249,"schannel_play_ext",new Prototype([arg_class_schannel,arg_int_unsigned,arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),250:new FuncSpec(250,"schannel_stop",new Prototype([arg_class_schannel],null)),251:new FuncSpec(251,"schannel_set_volume",new Prototype([arg_class_schannel,arg_int_unsigned],null)),252:new FuncSpec(252,"sound_load_hint",new Prototype([arg_int_unsigned,arg_int_unsigned],null)),253:new FuncSpec(253,"schannel_set_volume_ext",new Prototype([arg_class_schannel,arg_int_unsigned,arg_int_unsigned,arg_int_unsigned],null)),254:new FuncSpec(254,"schannel_pause",new Prototype([arg_class_schannel],null)),255:new FuncSpec(255,"schannel_unpause",new Prototype([arg_class_schannel],null)),256:new FuncSpec(256,"set_hyperlink",new Prototype([arg_int_unsigned],null)),257:new FuncSpec(257,"set_hyperlink_stream",new Prototype([arg_class_stream,arg_int_unsigned],null)),258:new FuncSpec(258,"request_hyperlink_event",new Prototype([arg_class_window],null)),259:new FuncSpec(259,"cancel_hyperlink_event",new Prototype([arg_class_window],null)),288:new FuncSpec(288,"buffer_to_lower_case_uni",new Prototype([new ArgArray(arg_int_unsigned,false,true,true,true),arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),289:new FuncSpec(289,"buffer_to_upper_case_uni",new Prototype([new ArgArray(arg_int_unsigned,false,true,true,true),arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),290:new FuncSpec(290,"buffer_to_title_case_uni",new Prototype([new ArgArray(arg_int_unsigned,false,true,true,true),arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),291:new FuncSpec(291,"buffer_canon_decompose_uni",new Prototype([new ArgArray(arg_int_unsigned,false,true,true,true),arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),292:new FuncSpec(292,"buffer_canon_normalize_uni",new Prototype([new ArgArray(arg_int_unsigned,false,true,true,true),arg_int_unsigned],new ArgRef(arg_int_unsigned,false,true,true))),296:new FuncSpec(296,"put_char_uni",new Prototype([arg_int_unsigned],null)),297:new FuncSpec(297,"put_string_uni",new Prototype([new ArgUnicode()],null)),298:new FuncSpec(298,"put_buffer_uni",new Prototype([new ArgArray(arg_int_unsigned,false,true,false,true)],null)),299:new FuncSpec(299,"put_char_stream_uni",new Prototype([arg_class_stream,arg_int_unsigned],null)),300:new FuncSpec(300,"put_string_stream_uni",new Prototype([arg_class_stream,new ArgUnicode()],null)),301:new FuncSpec(301,"put_buffer_stream_uni",new Prototype([arg_class_stream,new ArgArray(arg_int_unsigned,false,true,false,true)],null)),304:new FuncSpec(304,"get_char_stream_uni",new Prototype([arg_class_stream],new ArgRef(arg_int_signed,false,true,true))),305:new FuncSpec(305,"get_buffer_stream_uni",new Prototype([arg_class_stream,new ArgArray(arg_int_unsigned,false,false,true,true)],new ArgRef(arg_int_unsigned,false,true,true))),306:new FuncSpec(306,"get_line_stream_uni",new Prototype([arg_class_stream,new ArgArray(arg_int_unsigned,false,false,true,true)],new ArgRef(arg_int_unsigned,false,true,true))),312:new FuncSpec(312,"stream_open_file_uni",new Prototype([arg_class_fileref,arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_stream,false,true,true))),313:new FuncSpec(313,"stream_open_memory_uni",new Prototype([new ArgArray(arg_int_unsigned,true,true,true,false),arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_stream,false,true,true))),314:new FuncSpec(314,"stream_open_resource_uni",new Prototype([arg_int_unsigned,arg_int_unsigned],new ArgRef(arg_class_stream,false,true,true))),320:new FuncSpec(320,"request_char_event_uni",new Prototype([arg_class_window],null)),321:new FuncSpec(321,"request_line_event_uni",new Prototype([arg_class_window,new ArgArray(arg_int_unsigned,true,true,true,true),arg_int_unsigned],null)),336:new FuncSpec(336,"set_echo_line_event",new Prototype([arg_class_window,arg_int_unsigned],null)),337:new FuncSpec(337,"set_terminators_line_event",new Prototype([arg_class_window,new ArgArray(arg_int_unsigned,false,true,false,false)],null)),352:new FuncSpec(352,"current_time",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_unsigned,arg_int_signed],null)),false,true,true)],null)),353:new FuncSpec(353,"current_simple_time",new Prototype([arg_int_unsigned],new ArgRef(arg_int_signed,false,true,true))),360:new FuncSpec(360,"time_to_date_utc",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_unsigned,arg_int_signed],null)),true,false,true),new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),false,true,true)],null)),361:new FuncSpec(361,"time_to_date_local",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_unsigned,arg_int_signed],null)),true,false,true),new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),false,true,true)],null)),362:new FuncSpec(362,"simple_time_to_date_utc",new Prototype([arg_int_signed,arg_int_unsigned,new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),false,true,true)],null)),363:new FuncSpec(363,"simple_time_to_date_local",new Prototype([arg_int_signed,arg_int_unsigned,new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),false,true,true)],null)),364:new FuncSpec(364,"date_to_time_utc",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),true,false,true),new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_unsigned,arg_int_signed],null)),false,true,true)],null)),365:new FuncSpec(365,"date_to_time_local",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),true,false,true),new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_unsigned,arg_int_signed],null)),false,true,true)],null)),366:new FuncSpec(366,"date_to_simple_time_utc",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),true,false,true),arg_int_unsigned],new ArgRef(arg_int_signed,false,true,true))),367:new FuncSpec(367,"date_to_simple_time_local",new Prototype([new ArgRef(new ArgStruct(new Prototype([arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed,arg_int_signed],null)),true,false,true),arg_int_unsigned],new ArgRef(arg_int_signed,false,true,true)))};self.arg_int_unsigned=arg_int_unsigned;self.arg_int_signed=arg_int_signed;self.arg_char_unsigned=arg_char_unsigned;self.arg_char_native=arg_char_native;self.arg_char_signed=arg_char_signed;function convert_arg(arg,passin,val){if(arg instanceof ArgInt){if(passin){if(!arg.signed)
return val;else
return val+' & 0xFFFFFFFF';}
else{return'0';}}
if(arg instanceof ArgChar){if(passin){if(!arg.signed)
return val+' & 0xFF';else
return'self.cast_signed_char('+val+')'}
else{return'0';}}
if(arg instanceof ArgClass){if(passin){return'self.class_obj_from_id("'+arg.name+'", '+val+')';}
else{return'null';}}
return'???';}
function unconvert_arg(arg,val){if(arg instanceof ArgInt){return val+' >>> 0';}
if(arg instanceof ArgChar){if(!arg.signed)
return val+' & 0xFF';else
return'self.uncast_signed_char('+val+')'}
if(arg instanceof ArgClass){return'self.class_obj_to_id("'+arg.name+'", '+val+')';}
return'???';}
function cast_signed_char(val){val=val&0xFF;if(val&0x80)
val-=0x100;return val;}
self.cast_signed_char=cast_signed_char;function uncast_signed_char(val){val=val&0xFF;if(val&0x80)
val+=0xFFFFFF00;return val;}
self.uncast_signed_char=uncast_signed_char;function class_obj_to_id(clas,val){if(!val)
return 0;return val.disprock;}
self.class_obj_to_id=class_obj_to_id;function class_obj_from_id(clas,val){if(val==0||!val)
return null;return class_map[clas][val];}
self.class_obj_from_id=class_obj_from_id;function build_function(func){var ix,jx;var form,retarg,argpos,argjoin,subargs;var arg,refarg,tmpvar,val,retval,ls;var mayblock;var out=[];var locals={};var arraycount=0;out.push('// no local vars');out.push('// '+func.id+': '+func.name);form=func.proto;retarg=null;if(form.retarg)
retarg=form.retarg.arg;out.push('var self = this;');mayblock=Glk.call_may_not_return(func.id);argpos=0;argjoin=[];for(ix=0;ix<form.args.length;ix++){arg=form.args[ix];tmpvar='glka'+ix;argjoin.push(tmpvar);locals[tmpvar]=true;if((arg instanceof ArgInt)||(arg instanceof ArgChar)||(arg instanceof ArgClass)){val=convert_arg(arg,true,'callargs['+argpos+']');out.push(tmpvar+' = '+val+';');argpos+=1;}
else if(arg instanceof ArgRef){refarg=arg.arg;out.push('if (callargs['+argpos+'] == 0) {');if(arg.nonnull)
out.push('  throw new Error("glk '+func.name+': null argument");');else
out.push('  '+tmpvar+' = null;');out.push('} else {');if((refarg instanceof ArgInt)||(refarg instanceof ArgChar)||(refarg instanceof ArgClass)){out.push('  '+tmpvar+' = new Glk.RefBox();');val=convert_arg(refarg,arg.passin,'self.VM.ReadWord(callargs['+argpos+'])');out.push('  '+tmpvar+'.set_value('+val+');');}
else if(refarg instanceof ArgStruct){subargs=refarg.form.args;out.push('  '+tmpvar+' = new Glk.RefStruct('+subargs.length+');');for(jx=0;jx<subargs.length;jx++){val=convert_arg(subargs[jx],arg.passin,'self.VM.ReadStructField(callargs['+argpos+'], '+jx+')');out.push('  '+tmpvar+'.push_field('+val+');');}}
else{throw new Error('buildfunc: unsupported refarg type: '+func.name);}
out.push('}');argpos+=1;}
else if(arg instanceof ArgArray){locals['glklen']=true;refarg=arg.arg;out.push('if (callargs['+argpos+'] == 0) {');if(arg.nonnull)
out.push('  throw new Error("glk '+func.name+': null argument");');else
out.push('  '+tmpvar+' = null;');out.push('} else {');out.push('  glklen = callargs['+(argpos+1)+'];');out.push('  '+tmpvar+' = Array(glklen);');if(arg.passin){locals['ix']=true;locals['jx']=true;out.push('  for (ix=0, jx=callargs['+argpos+']; ix<glklen; ix++, jx+='+refarg.refsize+') {');val=convert_arg(refarg,true,'self.VM.Read'+refarg.macro+'(jx)');out.push('    '+tmpvar+'[ix] = '+val+';');out.push('  }');}
if(arg.retained){if(arraycount==0)
out.push('  self.temp_arg_arrays.length = 0;');arraycount+=1;out.push('  self.make_arg_array('+tmpvar+', callargs['+argpos+'], glklen, self.'+refarg.literal+');');}
out.push('}');argpos+=2;}
else if((arg instanceof ArgString)||(arg instanceof ArgUnicode)){locals['ix']=true;locals['jx']=true;var confunc,checkbyte;if(arg instanceof ArgString){checkbyte='0xE0';confunc='byte_array_to_string';}
else{checkbyte='0xE2';confunc='uni_array_to_string';}
out.push(tmpvar+' = Array();');out.push('jx = callargs['+argpos+'];');out.push('if (self.VM.ReadByte(jx) != '+checkbyte+') throw new Error("glk '+func.name+': string argument must be unencoded");');out.push('for (jx+='+arg.refsize+'; true; jx+='+arg.refsize+') {');out.push('  ix = self.VM.Read'+arg.macro+'(jx);');out.push('  if (ix == 0) break;');out.push('  '+tmpvar+'.push(ix);');out.push('}');out.push(tmpvar+' = Glk.'+confunc+'('+tmpvar+');');argpos+=1;}
else{throw new Error('buildfunc: unsupported arg type: '+func.name);}}
out.push('if (callargs.length != '+argpos+') throw "glk '+func.name+': wrong number of arguments";');if(retarg||mayblock){locals['glkret']=true;retval='glkret = ';}
else{retval='';}
out.push(retval+'Glk.glk_'+func.name+'('+argjoin.join(', ')+');');if(mayblock){out.push('if (glkret === Glk.DidNotReturn) {');out.push('  self.set_blocked_selector('+func.id+', callargs);');out.push('  return glkret;');out.push('}');}
argpos=0;for(ix=0;ix<form.args.length;ix++){arg=form.args[ix];tmpvar='glka'+ix;if((arg instanceof ArgInt)||(arg instanceof ArgChar)||(arg instanceof ArgClass)){argpos+=1;}
else if(arg instanceof ArgRef){refarg=arg.arg;if(arg.passout){out.push('if ('+tmpvar+') {');if((refarg instanceof ArgInt)||(refarg instanceof ArgChar)||(refarg instanceof ArgClass)){val=unconvert_arg(refarg,tmpvar+'.get_value()');out.push('  self.VM.WriteWord(callargs['+argpos+'], '+val+');');}
else if(refarg instanceof ArgStruct){subargs=refarg.form.args;for(jx=0;jx<subargs.length;jx++){val=unconvert_arg(subargs[jx],tmpvar+'.get_field('+jx+')');out.push('  self.VM.WriteStructField(callargs['+argpos+'], '+jx+', '+val+');');}}
else{throw new Error('buildfunc: unsupported refarg type: '+func.name);}
out.push('}');}
argpos+=1;}
else if(arg instanceof ArgArray){refarg=arg.arg;if(arg.passout&&!arg.retained){out.push('if ('+tmpvar+') {');locals['ix']=true;locals['jx']=true;out.push('  for (ix=0, jx=callargs['+argpos+']; ix<glklen; ix++, jx+='+refarg.refsize+') {');val=unconvert_arg(refarg,tmpvar+'[ix]');out.push('    self.VM.Write'+refarg.macro+'(jx, '+val+')');out.push('  }');out.push('}');}
argpos+=2;}
else if((arg instanceof ArgString)||(arg instanceof ArgUnicode)){argpos+=1;}
else{throw new Error('buildfunc: unsupported arg type: '+func.name);}}
if(arraycount!=0)
out.push('self.temp_arg_arrays.length = 0;');if(retarg){val=unconvert_arg(retarg,'glkret');out.push('return '+val+';');}
else{out.push('return 0;');}
ls=[];for(val in locals)
ls.push(val);if(ls.length)
out[0]='var '+ls.join(', ')+';';val=out.join('\n');var resfunc=new Function('callargs',val);return resfunc.bind(self);}
var function_map={};function get_function(id){var proto;var func=function_map[id];if(func===undefined){proto=proto_map[id];if(proto===undefined)
throw new Error('dispatch: unknown Glk function: '+id);func=build_function(proto);function_map[id]=func;}
return func;}
var blocked_selector=null;var blocked_callargs=null;var last_event_type=-1;function set_blocked_selector(sel,args){blocked_selector=sel;blocked_callargs=args.slice(0);}
self.set_blocked_selector=set_blocked_selector;function check_autosave(){if(blocked_selector==0x0C0&&blocked_callargs&&blocked_callargs.length>0){if(last_event_type==2||last_event_type==3||last_event_type==4||last_event_type==8){return blocked_callargs[0];}}
return null;}
function prepare_resume(glka0){if(blocked_selector==0x0C0){if(blocked_callargs[0]!=0){last_event_type=(glka0.get_field(0)>>>0);self.VM.WriteStructField(blocked_callargs[0],0,glka0.get_field(0)>>>0);self.VM.WriteStructField(blocked_callargs[0],1,class_obj_to_id("window",glka0.get_field(1)));self.VM.WriteStructField(blocked_callargs[0],2,glka0.get_field(2)>>>0);self.VM.WriteStructField(blocked_callargs[0],3,glka0.get_field(3)>>>0);}}
else if(blocked_selector==0x062){self.VM.SetResumeStore(class_obj_to_id("fileref",glka0));}
blocked_selector=null;blocked_callargs=null;}
var temp_arg_arrays=[];self.temp_arg_arrays=temp_arg_arrays;var retained_arrays=[];self.retained_arrays=retained_arrays;function make_arg_array(arr,addr,len,arg){var obj;if(!arr)
return;obj={arr:arr,addr:addr,len:len,arg:arg};temp_arg_arrays.push(obj);}
self.make_arg_array=make_arg_array;function retain_array(arr,useobj){var ix,obj;if(!arr)
return;if(useobj!==undefined){if(arr!==useobj.arr)
throw new Error('retain_array: array does not match useobj');obj={addr:useobj.addr,len:useobj.len,arr:arr,arg:arg_deserialize(useobj.arg)}
if(obj.len!=arr.length)
throw new Error('retain_array: array length from useobj does not match');}
else{obj=undefined;for(ix=0;ix<temp_arg_arrays.length;ix++){if(temp_arg_arrays[ix].arr===arr){obj=temp_arg_arrays[ix];break;}}}
if(obj===undefined)
throw new Error('retain_array: array is not an argument');for(ix=0;!(retained_arrays[ix]===undefined);ix++){};retained_arrays[ix]=obj;}
function get_retained_array(arr){var ix;for(ix=0;ix<retained_arrays.length;ix++){if(retained_arrays[ix]===undefined)
continue;if(retained_arrays[ix].arr===arr){return retained_arrays[ix];}}
return null;}
function unretain_array(arr){var ix,jx,obj;if(!arr)
return;obj=undefined;for(ix=0;ix<retained_arrays.length;ix++){if(retained_arrays[ix]===undefined)
continue;if(retained_arrays[ix].arr===arr){obj=retained_arrays[ix];delete retained_arrays[ix];break;}}
if(obj===undefined)
throw new Error('unretain_array: array was never retained');if(obj.arg instanceof ArgInt){for(ix=0,jx=obj.addr;ix<obj.len;ix++,jx+=4){self.VM.WriteWord(jx,obj.arr[ix]>>>0);}}
else if(obj.arg instanceof ArgChar){if(!obj.arg.signed){for(ix=0,jx=obj.addr;ix<obj.len;ix++,jx++){self.VM.WriteByte(jx,obj.arr[ix]&0xFF);}}
else{for(ix=0,jx=obj.addr;ix<obj.len;ix++,jx++){self.VM.WriteByte(jx,uncast_signed_char(obj.arr[ix]));}}}
else{throw new Error('unretain_array: unsupported refarg type');}}
var class_map={};var last_used_id;function class_register(clas,obj,usedisprock){if(usedisprock===undefined){if(obj.disprock)
throw new Error('class_register: object is already registered');obj.disprock=last_used_id;last_used_id++;}
else{if(obj.disprock!=usedisprock)
throw new Error('class_register: object is not already registered');if(last_used_id<=usedisprock)
last_used_id=usedisprock+1;}
class_map[clas][obj.disprock]=obj;}
function class_unregister(clas,obj){if(!obj.disprock||class_map[clas][obj.disprock]===undefined)
throw new Error('class_unregister: object is not registered');delete class_map[clas][obj.disprock];obj.disprock=undefined;}
function init_module(){var ix,key;last_used_id=1+Math.round(Math.random()*1000);for(ix in class_defs){key=class_defs[ix];class_map[key]={};}};init_module();return{set_vm:set_vm,get_function:get_function,prepare_resume:prepare_resume,check_autosave:check_autosave,class_register:class_register,class_unregister:class_unregister,class_obj_to_id:class_obj_to_id,class_obj_from_id:class_obj_from_id,retain_array:retain_array,unretain_array:unretain_array,get_retained_array:get_retained_array};}();GiLoad=function(){var all_options={vm:null,io:null,spacing:4,use_query_story:true,default_story:null,set_page_title:true,default_page_title:'Game',exit_warning:'The game session has ended.',image_info_map:null,proxy_url:'http://zcode.appspot.com/proxy/'};var gameurl=null;var metadata={};var debug_info=null;var blorbchunks={};var alttexts={};function load_run(optobj,image,image_format){all_options.vm=window.Quixe;all_options.io=window.Glk;if(!optobj)
optobj=window.game_options;if(optobj)
jQuery.extend(all_options,optobj);if(all_options.image_info_map!=undefined){if(jQuery.type(all_options.image_info_map)==='string'){if(window[all_options.image_info_map])
all_options.image_info_map=window[all_options.image_info_map];else
delete all_options.image_info_map;}}
gameurl=null;if(all_options.use_query_story){var qparams=get_query_params();gameurl=qparams['story'];}
if(!gameurl&&image){GlkOte.log('GiLoad: trying pre-loaded load ('+image_format+')...');switch(image_format){case'base64':image=decode_base64(image);break;case'raw':image=decode_text(image);break;case'array':break;default:all_options.io.fatal_error("Could not decode story file data: "+image_format);return;}
start_game(image);return;}
if(!gameurl){gameurl=all_options.default_story;}
if(!gameurl){all_options.io.fatal_error("No story file specified!");return;}
image=null;image_format=null;var xhr=new XMLHttpRequest();var binary_supported=(xhr.overrideMimeType!==undefined);var crossorigin_supported=(xhr.withCredentials!==undefined);xhr=null;var regex_urldomain=/^(file:|(\w+:)?\/\/[^\/?#]+)/;var page_domain=regex_urldomain.exec(location)[0];var data_exec=regex_urldomain.exec(gameurl);var is_relative=data_exec?false:true;var data_domain=data_exec?data_exec[0]:page_domain;var same_origin=(page_domain==data_domain);if(navigator.userAgent.match(/chrome/i)&&data_domain=='file:'){same_origin=false;}
var old_js_url=gameurl.match(/[.]js$/i);GlkOte.log('GiLoad: is_relative='+is_relative+', same_origin='+same_origin+', binary_supported='+binary_supported+', crossorigin_supported='+crossorigin_supported);if(old_js_url&&same_origin){GlkOte.log('GiLoad: trying old-fashioned load...');window.processBase64Zcode=function(val){start_game(decode_base64(val));};jQuery.ajax(gameurl,{'type':'GET',dataType:'script',cache:true,error:function(jqxhr,textstatus,errorthrown){all_options.io.fatal_error("The story could not be loaded. ("+gameurl+"): Error "+textstatus+": "+errorthrown);}});return;}
if(old_js_url){GlkOte.log('GiLoad: trying script load...');window.processBase64Zcode=function(val){start_game(decode_base64(val));};var headls=$('head');if(!headls.length){all_options.io.fatal_error("This page has no <head> element!");return;}
var script=$('<script>',{src:gameurl,'type':"text/javascript"});headls.get(0).appendChild(script.get(0));return;}
if(binary_supported&&same_origin){GlkOte.log('GiLoad: trying binary load...');jQuery.ajax(gameurl,{'type':'GET',beforeSend:function(jqxhr,settings){jqxhr.overrideMimeType('text/plain; charset=x-user-defined');},success:function(response,textstatus,errorthrown){start_game(decode_raw_text(response));},error:function(jqxhr,textstatus,errorthrown){all_options.io.fatal_error("The story could not be loaded. ("+gameurl+"): Error "+textstatus+": "+errorthrown);}});return;}
if(data_domain=='file:'){all_options.io.fatal_error("The story could not be loaded. ("+gameurl+"): A local file cannot be sent to the proxy.");return;}
var absgameurl=gameurl;if(is_relative){absgameurl=absolutize(gameurl);GlkOte.log('GiLoad: absolutize '+gameurl+' to '+absgameurl);}
if(crossorigin_supported){GlkOte.log('GiLoad: trying proxy load... ('+all_options.proxy_url+')');jQuery.ajax(all_options.proxy_url,{'type':'GET',data:{encode:'base64',url:absgameurl},error:function(jqxhr,textstatus,errorthrown){all_options.io.fatal_error("The story could not be loaded. ("+gameurl+"): Error "+textstatus+": "+errorthrown);},success:function(response,textstatus,errorthrown){start_game(decode_base64(response));}});return;}
if(true){var fullurl=all_options.proxy_url+'?encode=base64&callback=processBase64Zcode&url='+absgameurl;GlkOte.log('GiLoad: trying proxy-script load... ('+fullurl+')');window.processBase64Zcode=function(val){start_game(decode_base64(val));};var headls=$('head');if(!headls.length){all_options.io.fatal_error("This page has no <head> element!");return;}
var script=$('<script>',{src:fullurl,'type':"text/javascript"});headls.append(script);return;}
all_options.io.fatal_error("The story could not be loaded. ("+gameurl+"): I don't know how to load this data.");}
function get_query_params(){var map={};var qs=location.search.substring(1,location.search.length);if(qs.length){var args=qs.split('&');qs=qs.replace(/\+/g,' ');for(var ix=0;ix<args.length;ix++){var pair=args[ix].split('=');var name=decodeURIComponent(pair[0]);var value=(pair.length==2)?decodeURIComponent(pair[1]):name;map[name]=value;}}
return map;}
function absolutize(url){if(url.match(/^(file|data|http|https):/i)){return url;}
var div=document.createElement('div');div.innerHTML='<a></a>';div.firstChild.href=url;div.innerHTML=div.innerHTML;return div.firstChild.href;}
function get_metadata(val){return metadata[val];}
function get_debug_info(){return debug_info;}
function get_image_info(val){if(all_options.image_info_map!=undefined){var img=all_options.image_info_map[val];if(img)
return img;}
var chunk=blorbchunks['Pict:'+val];if(chunk){var img={image:val};if(chunk.type=='JPEG')
img.type='jpeg';else if(chunk.type=='PNG ')
img.type='png';else
img.type='????';if(chunk.imagesize===undefined){var imgsize=undefined;if(chunk.type=='JPEG'){imgsize=find_dimensions_jpeg(chunk.content);}
else if(chunk.type=='PNG '){imgsize=find_dimensions_png(chunk.content);}
if(imgsize)
chunk.imagesize=imgsize;}
if(chunk.imagesize){img.width=chunk.imagesize.width;img.height=chunk.imagesize.height;}
var rdtext=alttexts['Pict:'+val];if(rdtext)
img.alttext=rdtext;return img;}
return undefined;}
function get_image_url(val){if(all_options.image_info_map){var img=all_options.image_info_map[val];if(img&&img.url)
return absolutize(img.url);}
var chunk=blorbchunks['Pict:'+val];if(chunk){if(chunk.dataurl)
return chunk.dataurl;var info=get_image_info(val);if(info&&chunk.content){var mimetype='application/octet-stream';if(chunk.type=='JPEG')
mimetype='image/jpeg';else if(chunk.type=='PNG ')
mimetype='image/png';var b64dat=encode_base64(chunk.content);chunk.dataurl='data:'+mimetype+';base64,'+b64dat;return chunk.dataurl;}}
return undefined;}
function find_data_chunk(val){var chunk=blorbchunks['Data:'+val];if(!chunk)
return null;var returntype=chunk.type;if(returntype=='FORM')
returntype='BINA';return{data:chunk.content,type:returntype};}
function unpack_blorb(image){var len=image.length;var ix;var rindex=[];var result=null;var pos=12;while(pos<len){var chunktype=String.fromCharCode(image[pos+0],image[pos+1],image[pos+2],image[pos+3]);pos+=4;var chunklen=(image[pos+0]<<24)|(image[pos+1]<<16)|(image[pos+2]<<8)|(image[pos+3]);pos+=4;if(chunktype=="RIdx"){var npos=pos;var numchunks=(image[npos+0]<<24)|(image[npos+1]<<16)|(image[npos+2]<<8)|(image[npos+3]);npos+=4;for(ix=0;ix<numchunks;ix++){var chunkusage=String.fromCharCode(image[npos+0],image[npos+1],image[npos+2],image[npos+3]);npos+=4;var chunknum=(image[npos+0]<<24)|(image[npos+1]<<16)|(image[npos+2]<<8)|(image[npos+3]);npos+=4;var chunkpos=(image[npos+0]<<24)|(image[npos+1]<<16)|(image[npos+2]<<8)|(image[npos+3]);npos+=4;rindex.push({usage:chunkusage,num:chunknum,pos:chunkpos});}}
if(chunktype=="IFmd"){var arr=image.slice(pos,pos+chunklen);var dat=encode_utf8_text(arr);var met=$('<metadata>').html(dat);var bibels=met.find('bibliographic').children();if(bibels.length){var el;for(ix=0;ix<bibels.length;ix++){el=bibels[ix];metadata[el.tagName.toLowerCase()]=el.textContent;}}}
if(chunktype=="Dbug"){if(all_options.debug_info_chunk){var arr=image.slice(pos,pos+chunklen);debug_info=arr;}}
if(chunktype=="RDes"){var npos=pos;var numentries=(image[npos+0]<<24)|(image[npos+1]<<16)|(image[npos+2]<<8)|(image[npos+3]);npos+=4;for(ix=0;ix<numentries;ix++){var rdusage=String.fromCharCode.apply(this,image.slice(npos,npos+4));npos+=4;var rdnumber=(image[npos+0]<<24)|(image[npos+1]<<16)|(image[npos+2]<<8)|(image[npos+3]);npos+=4;var rdlen=(image[npos+0]<<24)|(image[npos+1]<<16)|(image[npos+2]<<8)|(image[npos+3]);npos+=4;var rdtext=encode_utf8_text(image.slice(npos,npos+rdlen));npos+=rdlen;alttexts[rdusage+':'+rdnumber]=rdtext;}}
pos+=chunklen;if(pos&1)
pos++;}
for(ix=0;ix<rindex.length;ix++){var el=rindex[ix];pos=el.pos;var chunktype=String.fromCharCode(image[pos+0],image[pos+1],image[pos+2],image[pos+3]);pos+=4;var chunklen=(image[pos+0]<<24)|(image[pos+1]<<16)|(image[pos+2]<<8)|(image[pos+3]);pos+=4;el.type=chunktype;el.len=chunklen;el.content=null;if(el.usage=="Exec"&&el.num==0&&chunktype=="GLUL"){result=image.slice(pos,pos+chunklen);}
else{if(chunktype=="FORM"){el.content=image.slice(pos-8,pos+chunklen);}
else{el.content=image.slice(pos,pos+chunklen);}
blorbchunks[el.usage+':'+el.num]=el;}}
return result;}
function decode_raw_text(str){var arr=Array(str.length);var ix;for(ix=0;ix<str.length;ix++){arr[ix]=str.charCodeAt(ix)&0xFF;}
return arr;}
function encode_utf8_text(arr){var res=[];var ch;var pos=0;while(pos<arr.length){var val0,val1,val2,val3;if(pos>=arr.length)
break;val0=arr[pos];pos++;if(val0<0x80){ch=val0;}
else{if(pos>=arr.length)
break;val1=arr[pos];pos++;if((val1&0xC0)!=0x80)
break;if((val0&0xE0)==0xC0){ch=(val0&0x1F)<<6;ch|=(val1&0x3F);}
else{if(pos>=arr.length)
break;val2=arr[pos];pos++;if((val2&0xC0)!=0x80)
break;if((val0&0xF0)==0xE0){ch=(((val0&0xF)<<12)&0x0000F000);ch|=(((val1&0x3F)<<6)&0x00000FC0);ch|=(((val2&0x3F))&0x0000003F);}
else if((val0&0xF0)==0xF0){if(pos>=arr.length)
break;val3=arr[pos];pos++;if((val3&0xC0)!=0x80)
break;ch=(((val0&0x7)<<18)&0x1C0000);ch|=(((val1&0x3F)<<12)&0x03F000);ch|=(((val2&0x3F)<<6)&0x000FC0);ch|=(((val3&0x3F))&0x00003F);}
else{break;}}}
res.push(ch);}
return String.fromCharCode.apply(this,res);}
if(window.atob){decode_base64=function(base64data){var data=atob(base64data);var image=Array(data.length);var ix;for(ix=0;ix<data.length;ix++)
image[ix]=data.charCodeAt(ix);return image;}}
else{var b64decoder=(function(){var b64encoder="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var out=[];var ix;for(ix=0;ix<b64encoder.length;ix++)
out[b64encoder.charAt(ix)]=ix;return out;})();decode_base64=function(base64data){var out=[];var c1,c2,c3,e1,e2,e3,e4;var i=0,len=base64data.length;while(i<len){e1=b64decoder[base64data.charAt(i++)];e2=b64decoder[base64data.charAt(i++)];e3=b64decoder[base64data.charAt(i++)];e4=b64decoder[base64data.charAt(i++)];c1=(e1<<2)+(e2>>4);c2=((e2&15)<<4)+(e3>>2);c3=((e3&3)<<6)+e4;out.push(c1,c2,c3);}
if(e4==64)
out.pop();if(e3==64)
out.pop();return out;}}
var encode_base64;var decode_base64;if(window.btoa){encode_base64=function(image){var blocks=[];var imglen=image.length;for(var ix=0;ix<imglen;ix+=16384){blocks.push(String.fromCharCode.apply(String,image.slice(ix,ix+16384)));}
return btoa(blocks.join(''));};}
else{encode_base64=function(arr){var coder="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var res=[];var byte0,byte1,byte2;for(var ix=0;ix<arr.length;ix+=3){byte0=arr[ix];byte1=arr[ix+1];byte2=arr[ix+2];res.push(coder.charAt((byte0>>2)&0x3F));res.push(coder.charAt(((byte0<<4)&0x30)|((byte1>>4)&0x0F)));res.push(coder.charAt(((byte1<<2)&0x3C)|((byte2>>6)&0x03)));res.push(coder.charAt((byte2)&0x3F));}
if(byte1===undefined&&res.length>=2){res[res.length-2]='=';}
if(byte2===undefined&&res.length>=1){res[res.length-1]='=';}
return res.join('');}}
function find_dimensions_png(arr){var pos=0;if(arr[0]!=0x89||String.fromCharCode.apply(this,arr.slice(1,4))!='PNG'){GlkOte.log('find_dimensions_png: PNG signature does not match');return undefined;}
pos+=8;while(pos<arr.length){var chunklen=(arr[pos+0]<<24)|(arr[pos+1]<<16)|(arr[pos+2]<<8)|(arr[pos+3]);pos+=4;var chunktype=String.fromCharCode.apply(this,arr.slice(pos,pos+4));pos+=4;if(chunktype=='IHDR'){var res={};res.width=(arr[pos+0]<<24)|(arr[pos+1]<<16)|(arr[pos+2]<<8)|(arr[pos+3]);pos+=4;res.height=(arr[pos+0]<<24)|(arr[pos+1]<<16)|(arr[pos+2]<<8)|(arr[pos+3]);pos+=4;return res;}
pos+=chunklen;pos+=4;}
GlkOte.log('find_dimensions_png: no PNG header block found');return undefined;}
function find_dimensions_jpeg(arr){var pos=0;while(pos<arr.length){if(arr[pos]!=0xFF){GlkOte.log('find_dimensions_jpeg: marker is not 0xFF');return undefined;}
while(arr[pos]==0xFF)
pos+=1;var marker=arr[pos];pos+=1;if(marker==0x01||(marker>=0xD0&&marker<=0xD9)){continue;}
var chunklen=(arr[pos+0]<<8)|(arr[pos+1]);if(marker>=0xC0&&marker<=0xCF&&marker!=0xC8){if(chunklen<7){GlkOte.log('find_dimensions_jpeg: SOF block is too small');return undefined;}
var res={};res.height=(arr[pos+3]<<8)|(arr[pos+4]);res.width=(arr[pos+5]<<8)|(arr[pos+6]);return res;}
pos+=chunklen;}
GlkOte.log('find_dimensions_jpeg: no SOF marker found');return undefined;}
function start_game(image){if(image.length==0){all_options.io.fatal_error("No game file was loaded. (Zero-length response.)");return;}
if(image[0]==0x46&&image[1]==0x4F&&image[2]==0x52&&image[3]==0x4D){var formtype=String.fromCharCode(image[8],image[9],image[10],image[11]);if(formtype=='IFZS'){all_options.io.fatal_error("This is a saved-game file, not a Glulx game file. You must launch the game first, then restore your save.");return;}
if(formtype!='IFRS'){all_options.io.fatal_error("This IFF file is not a Blorb file!");return;}
try{image=unpack_blorb(image);}
catch(ex){all_options.io.fatal_error("Blorb file could not be parsed: "+ex);return;}
if(!image){all_options.io.fatal_error("Blorb file contains no Glulx game!");return;}}
{var title=null;if(metadata)
title=metadata.title;if(!title&&gameurl)
title=gameurl.slice(gameurl.lastIndexOf("/")+1);if(!title)
title=all_options.default_page_title;if(!title)
title='Game';if(!all_options.recording_label)
all_options.recording_label=title;if(all_options.set_page_title)
document.title=title+" - Quixe";}
all_options.vm.prepare(image,all_options);all_options.io.init(all_options);}
return{load_run:load_run,find_data_chunk:find_data_chunk,get_metadata:get_metadata,get_debug_info:get_debug_info,get_image_info:get_image_info,get_image_url:get_image_url};}();
</script>

<script type="text/javascript">
StaticImageInfo = {};


function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = value;
    });
    return vars;
}

var thestory = getUrlVars()["thestory"];

if (!thestory) {
    thestory = "http://howtophil.com/IF/wakeup/Wake%20Up.ulx"
}

</script>


<script type="text/javascript">
game_options = {
  default_story: thestory,
  spacing: 0,
  use_query_story: true,
  set_page_title: false
};
</script>
</head>

<body onload="GiLoad.load_run();">

<div id="header">

<div id="subheader">

<select name="storychange" onchange="location = this.value;">
 <option value="">Select Game</option>
 <option value="?thestory=http://howtophil.com/IF/wakeup/Wake%20Up.ulx">Wake Up</option>
</select>

<div class="framelabel" style="z-index: 1700">
<center>
</center>
</div>
</div>
</div>
<div id="column"><div id="subcolumn">

<div id="gameport" style="z-index:2000; border-style: solid; border-color: grey; border-style: outset;">
<div id="windowport">
<noscript><hr>
<p>You'll need to turn on Javascript in your web browser to play this game.</p>
<hr></noscript>
</div>
<div id="loadingpane">
<img src="media/waiting.gif" alt="LOADING"><br>
<em>&nbsp;&nbsp;&nbsp;Loading...</em>
</div>
<div id="errorpane" style="display:none;"><div id="errorcontent">...</div></div>
</div>

</div>

</div>

<div id="footer"><div id="subfooter">
<div class="framelabel">
</div>
</div>
</div>
</body>

</html>
